var OM=Object.defineProperty;var DM=(n,e,t)=>e in n?OM(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var b=(n,e,t)=>DM(n,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();function bS(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var wp={exports:{}},Ic={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var XE;function NM(){if(XE)return Ic;XE=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(s,r,i){var o=null;if(i!==void 0&&(o=""+i),r.key!==void 0&&(o=""+r.key),"key"in r){i={};for(var l in r)l!=="key"&&(i[l]=r[l])}else i=r;return r=i.ref,{$$typeof:n,type:s,key:o,ref:r!==void 0?r:null,props:i}}return Ic.Fragment=e,Ic.jsx=t,Ic.jsxs=t,Ic}var JE;function FM(){return JE||(JE=1,wp.exports=NM()),wp.exports}var ar=FM(),Rp={exports:{}},Be={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var WE;function PM(){if(WE)return Be;WE=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),i=Symbol.for("react.consumer"),o=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),m=Symbol.iterator;function A(M){return M===null||typeof M!="object"?null:(M=m&&M[m]||M["@@iterator"],typeof M=="function"?M:null)}var y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},E=Object.assign,v={};function S(M,Z,ae){this.props=M,this.context=Z,this.refs=v,this.updater=ae||y}S.prototype.isReactComponent={},S.prototype.setState=function(M,Z){if(typeof M!="object"&&typeof M!="function"&&M!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,M,Z,"setState")},S.prototype.forceUpdate=function(M){this.updater.enqueueForceUpdate(this,M,"forceUpdate")};function x(){}x.prototype=S.prototype;function O(M,Z,ae){this.props=M,this.context=Z,this.refs=v,this.updater=ae||y}var R=O.prototype=new x;R.constructor=O,E(R,S.prototype),R.isPureReactComponent=!0;var D=Array.isArray,z={H:null,A:null,T:null,S:null,V:null},J=Object.prototype.hasOwnProperty;function ie(M,Z,ae,ue,_e,De){return ae=De.ref,{$$typeof:n,type:M,key:Z,ref:ae!==void 0?ae:null,props:De}}function re(M,Z){return ie(M.type,Z,void 0,void 0,void 0,M.props)}function ee(M){return typeof M=="object"&&M!==null&&M.$$typeof===n}function le(M){var Z={"=":"=0",":":"=2"};return"$"+M.replace(/[=:]/g,function(ae){return Z[ae]})}var fe=/\/+/g;function ye(M,Z){return typeof M=="object"&&M!==null&&M.key!=null?le(""+M.key):Z.toString(36)}function ke(){}function me(M){switch(M.status){case"fulfilled":return M.value;case"rejected":throw M.reason;default:switch(typeof M.status=="string"?M.then(ke,ke):(M.status="pending",M.then(function(Z){M.status==="pending"&&(M.status="fulfilled",M.value=Z)},function(Z){M.status==="pending"&&(M.status="rejected",M.reason=Z)})),M.status){case"fulfilled":return M.value;case"rejected":throw M.reason}}throw M}function Oe(M,Z,ae,ue,_e){var De=typeof M;(De==="undefined"||De==="boolean")&&(M=null);var Ce=!1;if(M===null)Ce=!0;else switch(De){case"bigint":case"string":case"number":Ce=!0;break;case"object":switch(M.$$typeof){case n:case e:Ce=!0;break;case g:return Ce=M._init,Oe(Ce(M._payload),Z,ae,ue,_e)}}if(Ce)return _e=_e(M),Ce=ue===""?"."+ye(M,0):ue,D(_e)?(ae="",Ce!=null&&(ae=Ce.replace(fe,"$&/")+"/"),Oe(_e,Z,ae,"",function(_r){return _r})):_e!=null&&(ee(_e)&&(_e=re(_e,ae+(_e.key==null||M&&M.key===_e.key?"":(""+_e.key).replace(fe,"$&/")+"/")+Ce)),Z.push(_e)),1;Ce=0;var An=ue===""?".":ue+":";if(D(M))for(var ct=0;ct<M.length;ct++)ue=M[ct],De=An+ye(ue,ct),Ce+=Oe(ue,Z,ae,De,_e);else if(ct=A(M),typeof ct=="function")for(M=ct.call(M),ct=0;!(ue=M.next()).done;)ue=ue.value,De=An+ye(ue,ct++),Ce+=Oe(ue,Z,ae,De,_e);else if(De==="object"){if(typeof M.then=="function")return Oe(me(M),Z,ae,ue,_e);throw Z=String(M),Error("Objects are not valid as a React child (found: "+(Z==="[object Object]"?"object with keys {"+Object.keys(M).join(", ")+"}":Z)+"). If you meant to render a collection of children, use an array instead.")}return Ce}function W(M,Z,ae){if(M==null)return M;var ue=[],_e=0;return Oe(M,ue,"","",function(De){return Z.call(ae,De,_e++)}),ue}function oe(M){if(M._status===-1){var Z=M._result;Z=Z(),Z.then(function(ae){(M._status===0||M._status===-1)&&(M._status=1,M._result=ae)},function(ae){(M._status===0||M._status===-1)&&(M._status=2,M._result=ae)}),M._status===-1&&(M._status=0,M._result=Z)}if(M._status===1)return M._result.default;throw M._result}var pe=typeof reportError=="function"?reportError:function(M){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Z=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof M=="object"&&M!==null&&typeof M.message=="string"?String(M.message):String(M),error:M});if(!window.dispatchEvent(Z))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",M);return}console.error(M)};function He(){}return Be.Children={map:W,forEach:function(M,Z,ae){W(M,function(){Z.apply(this,arguments)},ae)},count:function(M){var Z=0;return W(M,function(){Z++}),Z},toArray:function(M){return W(M,function(Z){return Z})||[]},only:function(M){if(!ee(M))throw Error("React.Children.only expected to receive a single React element child.");return M}},Be.Component=S,Be.Fragment=t,Be.Profiler=r,Be.PureComponent=O,Be.StrictMode=s,Be.Suspense=f,Be.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=z,Be.__COMPILER_RUNTIME={__proto__:null,c:function(M){return z.H.useMemoCache(M)}},Be.cache=function(M){return function(){return M.apply(null,arguments)}},Be.cloneElement=function(M,Z,ae){if(M==null)throw Error("The argument must be a React element, but you passed "+M+".");var ue=E({},M.props),_e=M.key,De=void 0;if(Z!=null)for(Ce in Z.ref!==void 0&&(De=void 0),Z.key!==void 0&&(_e=""+Z.key),Z)!J.call(Z,Ce)||Ce==="key"||Ce==="__self"||Ce==="__source"||Ce==="ref"&&Z.ref===void 0||(ue[Ce]=Z[Ce]);var Ce=arguments.length-2;if(Ce===1)ue.children=ae;else if(1<Ce){for(var An=Array(Ce),ct=0;ct<Ce;ct++)An[ct]=arguments[ct+2];ue.children=An}return ie(M.type,_e,void 0,void 0,De,ue)},Be.createContext=function(M){return M={$$typeof:o,_currentValue:M,_currentValue2:M,_threadCount:0,Provider:null,Consumer:null},M.Provider=M,M.Consumer={$$typeof:i,_context:M},M},Be.createElement=function(M,Z,ae){var ue,_e={},De=null;if(Z!=null)for(ue in Z.key!==void 0&&(De=""+Z.key),Z)J.call(Z,ue)&&ue!=="key"&&ue!=="__self"&&ue!=="__source"&&(_e[ue]=Z[ue]);var Ce=arguments.length-2;if(Ce===1)_e.children=ae;else if(1<Ce){for(var An=Array(Ce),ct=0;ct<Ce;ct++)An[ct]=arguments[ct+2];_e.children=An}if(M&&M.defaultProps)for(ue in Ce=M.defaultProps,Ce)_e[ue]===void 0&&(_e[ue]=Ce[ue]);return ie(M,De,void 0,void 0,null,_e)},Be.createRef=function(){return{current:null}},Be.forwardRef=function(M){return{$$typeof:l,render:M}},Be.isValidElement=ee,Be.lazy=function(M){return{$$typeof:g,_payload:{_status:-1,_result:M},_init:oe}},Be.memo=function(M,Z){return{$$typeof:h,type:M,compare:Z===void 0?null:Z}},Be.startTransition=function(M){var Z=z.T,ae={};z.T=ae;try{var ue=M(),_e=z.S;_e!==null&&_e(ae,ue),typeof ue=="object"&&ue!==null&&typeof ue.then=="function"&&ue.then(He,pe)}catch(De){pe(De)}finally{z.T=Z}},Be.unstable_useCacheRefresh=function(){return z.H.useCacheRefresh()},Be.use=function(M){return z.H.use(M)},Be.useActionState=function(M,Z,ae){return z.H.useActionState(M,Z,ae)},Be.useCallback=function(M,Z){return z.H.useCallback(M,Z)},Be.useContext=function(M){return z.H.useContext(M)},Be.useDebugValue=function(){},Be.useDeferredValue=function(M,Z){return z.H.useDeferredValue(M,Z)},Be.useEffect=function(M,Z,ae){var ue=z.H;if(typeof ae=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return ue.useEffect(M,Z)},Be.useId=function(){return z.H.useId()},Be.useImperativeHandle=function(M,Z,ae){return z.H.useImperativeHandle(M,Z,ae)},Be.useInsertionEffect=function(M,Z){return z.H.useInsertionEffect(M,Z)},Be.useLayoutEffect=function(M,Z){return z.H.useLayoutEffect(M,Z)},Be.useMemo=function(M,Z){return z.H.useMemo(M,Z)},Be.useOptimistic=function(M,Z){return z.H.useOptimistic(M,Z)},Be.useReducer=function(M,Z,ae){return z.H.useReducer(M,Z,ae)},Be.useRef=function(M){return z.H.useRef(M)},Be.useState=function(M){return z.H.useState(M)},Be.useSyncExternalStore=function(M,Z,ae){return z.H.useSyncExternalStore(M,Z,ae)},Be.useTransition=function(){return z.H.useTransition()},Be.version="19.1.0",Be}var YE;function bA(){return YE||(YE=1,Rp.exports=PM()),Rp.exports}var ge=bA();const UM=bS(ge);var xp={exports:{}},Mc={},Ip={exports:{}},Mp={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var KE;function LM(){return KE||(KE=1,function(n){function e(W,oe){var pe=W.length;W.push(oe);e:for(;0<pe;){var He=pe-1>>>1,M=W[He];if(0<r(M,oe))W[He]=oe,W[pe]=M,pe=He;else break e}}function t(W){return W.length===0?null:W[0]}function s(W){if(W.length===0)return null;var oe=W[0],pe=W.pop();if(pe!==oe){W[0]=pe;e:for(var He=0,M=W.length,Z=M>>>1;He<Z;){var ae=2*(He+1)-1,ue=W[ae],_e=ae+1,De=W[_e];if(0>r(ue,pe))_e<M&&0>r(De,ue)?(W[He]=De,W[_e]=pe,He=_e):(W[He]=ue,W[ae]=pe,He=ae);else if(_e<M&&0>r(De,pe))W[He]=De,W[_e]=pe,He=_e;else break e}}return oe}function r(W,oe){var pe=W.sortIndex-oe.sortIndex;return pe!==0?pe:W.id-oe.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var o=Date,l=o.now();n.unstable_now=function(){return o.now()-l}}var f=[],h=[],g=1,m=null,A=3,y=!1,E=!1,v=!1,S=!1,x=typeof setTimeout=="function"?setTimeout:null,O=typeof clearTimeout=="function"?clearTimeout:null,R=typeof setImmediate<"u"?setImmediate:null;function D(W){for(var oe=t(h);oe!==null;){if(oe.callback===null)s(h);else if(oe.startTime<=W)s(h),oe.sortIndex=oe.expirationTime,e(f,oe);else break;oe=t(h)}}function z(W){if(v=!1,D(W),!E)if(t(f)!==null)E=!0,J||(J=!0,ye());else{var oe=t(h);oe!==null&&Oe(z,oe.startTime-W)}}var J=!1,ie=-1,re=5,ee=-1;function le(){return S?!0:!(n.unstable_now()-ee<re)}function fe(){if(S=!1,J){var W=n.unstable_now();ee=W;var oe=!0;try{e:{E=!1,v&&(v=!1,O(ie),ie=-1),y=!0;var pe=A;try{t:{for(D(W),m=t(f);m!==null&&!(m.expirationTime>W&&le());){var He=m.callback;if(typeof He=="function"){m.callback=null,A=m.priorityLevel;var M=He(m.expirationTime<=W);if(W=n.unstable_now(),typeof M=="function"){m.callback=M,D(W),oe=!0;break t}m===t(f)&&s(f),D(W)}else s(f);m=t(f)}if(m!==null)oe=!0;else{var Z=t(h);Z!==null&&Oe(z,Z.startTime-W),oe=!1}}break e}finally{m=null,A=pe,y=!1}oe=void 0}}finally{oe?ye():J=!1}}}var ye;if(typeof R=="function")ye=function(){R(fe)};else if(typeof MessageChannel<"u"){var ke=new MessageChannel,me=ke.port2;ke.port1.onmessage=fe,ye=function(){me.postMessage(null)}}else ye=function(){x(fe,0)};function Oe(W,oe){ie=x(function(){W(n.unstable_now())},oe)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(W){W.callback=null},n.unstable_forceFrameRate=function(W){0>W||125<W?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):re=0<W?Math.floor(1e3/W):5},n.unstable_getCurrentPriorityLevel=function(){return A},n.unstable_next=function(W){switch(A){case 1:case 2:case 3:var oe=3;break;default:oe=A}var pe=A;A=oe;try{return W()}finally{A=pe}},n.unstable_requestPaint=function(){S=!0},n.unstable_runWithPriority=function(W,oe){switch(W){case 1:case 2:case 3:case 4:case 5:break;default:W=3}var pe=A;A=W;try{return oe()}finally{A=pe}},n.unstable_scheduleCallback=function(W,oe,pe){var He=n.unstable_now();switch(typeof pe=="object"&&pe!==null?(pe=pe.delay,pe=typeof pe=="number"&&0<pe?He+pe:He):pe=He,W){case 1:var M=-1;break;case 2:M=250;break;case 5:M=1073741823;break;case 4:M=1e4;break;default:M=5e3}return M=pe+M,W={id:g++,callback:oe,priorityLevel:W,startTime:pe,expirationTime:M,sortIndex:-1},pe>He?(W.sortIndex=pe,e(h,W),t(f)===null&&W===t(h)&&(v?(O(ie),ie=-1):v=!0,Oe(z,pe-He))):(W.sortIndex=M,e(f,W),E||y||(E=!0,J||(J=!0,ye()))),W},n.unstable_shouldYield=le,n.unstable_wrapCallback=function(W){var oe=A;return function(){var pe=A;A=oe;try{return W.apply(this,arguments)}finally{A=pe}}}}(Mp)),Mp}var qE;function kM(){return qE||(qE=1,Ip.exports=LM()),Ip.exports}var Op={exports:{}},Jt={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var QE;function HM(){if(QE)return Jt;QE=1;var n=bA();function e(f){var h="https://react.dev/errors/"+f;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)h+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+f+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var s={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},r=Symbol.for("react.portal");function i(f,h,g){var m=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:m==null?null:""+m,children:f,containerInfo:h,implementation:g}}var o=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function l(f,h){if(f==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return Jt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,Jt.createPortal=function(f,h){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(e(299));return i(f,h,null,g)},Jt.flushSync=function(f){var h=o.T,g=s.p;try{if(o.T=null,s.p=2,f)return f()}finally{o.T=h,s.p=g,s.d.f()}},Jt.preconnect=function(f,h){typeof f=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,s.d.C(f,h))},Jt.prefetchDNS=function(f){typeof f=="string"&&s.d.D(f)},Jt.preinit=function(f,h){if(typeof f=="string"&&h&&typeof h.as=="string"){var g=h.as,m=l(g,h.crossOrigin),A=typeof h.integrity=="string"?h.integrity:void 0,y=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;g==="style"?s.d.S(f,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:m,integrity:A,fetchPriority:y}):g==="script"&&s.d.X(f,{crossOrigin:m,integrity:A,fetchPriority:y,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},Jt.preinitModule=function(f,h){if(typeof f=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var g=l(h.as,h.crossOrigin);s.d.M(f,{crossOrigin:g,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&s.d.M(f)},Jt.preload=function(f,h){if(typeof f=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var g=h.as,m=l(g,h.crossOrigin);s.d.L(f,g,{crossOrigin:m,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},Jt.preloadModule=function(f,h){if(typeof f=="string")if(h){var g=l(h.as,h.crossOrigin);s.d.m(f,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:g,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else s.d.m(f)},Jt.requestFormReset=function(f){s.d.r(f)},Jt.unstable_batchedUpdates=function(f,h){return f(h)},Jt.useFormState=function(f,h,g){return o.H.useFormState(f,h,g)},Jt.useFormStatus=function(){return o.H.useHostTransitionStatus()},Jt.version="19.1.0",Jt}var ZE;function TS(){if(ZE)return Op.exports;ZE=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Op.exports=HM(),Op.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var e1;function GM(){if(e1)return Mc;e1=1;var n=kM(),e=bA(),t=TS();function s(a){var c="https://react.dev/errors/"+a;if(1<arguments.length){c+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)c+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+a+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function i(a){var c=a,u=a;if(a.alternate)for(;c.return;)c=c.return;else{a=c;do c=a,(c.flags&4098)!==0&&(u=c.return),a=c.return;while(a)}return c.tag===3?u:null}function o(a){if(a.tag===13){var c=a.memoizedState;if(c===null&&(a=a.alternate,a!==null&&(c=a.memoizedState)),c!==null)return c.dehydrated}return null}function l(a){if(i(a)!==a)throw Error(s(188))}function f(a){var c=a.alternate;if(!c){if(c=i(a),c===null)throw Error(s(188));return c!==a?null:a}for(var u=a,d=c;;){var p=u.return;if(p===null)break;var _=p.alternate;if(_===null){if(d=p.return,d!==null){u=d;continue}break}if(p.child===_.child){for(_=p.child;_;){if(_===u)return l(p),a;if(_===d)return l(p),c;_=_.sibling}throw Error(s(188))}if(u.return!==d.return)u=p,d=_;else{for(var T=!1,C=p.child;C;){if(C===u){T=!0,u=p,d=_;break}if(C===d){T=!0,d=p,u=_;break}C=C.sibling}if(!T){for(C=_.child;C;){if(C===u){T=!0,u=_,d=p;break}if(C===d){T=!0,d=_,u=p;break}C=C.sibling}if(!T)throw Error(s(189))}}if(u.alternate!==d)throw Error(s(190))}if(u.tag!==3)throw Error(s(188));return u.stateNode.current===u?a:c}function h(a){var c=a.tag;if(c===5||c===26||c===27||c===6)return a;for(a=a.child;a!==null;){if(c=h(a),c!==null)return c;a=a.sibling}return null}var g=Object.assign,m=Symbol.for("react.element"),A=Symbol.for("react.transitional.element"),y=Symbol.for("react.portal"),E=Symbol.for("react.fragment"),v=Symbol.for("react.strict_mode"),S=Symbol.for("react.profiler"),x=Symbol.for("react.provider"),O=Symbol.for("react.consumer"),R=Symbol.for("react.context"),D=Symbol.for("react.forward_ref"),z=Symbol.for("react.suspense"),J=Symbol.for("react.suspense_list"),ie=Symbol.for("react.memo"),re=Symbol.for("react.lazy"),ee=Symbol.for("react.activity"),le=Symbol.for("react.memo_cache_sentinel"),fe=Symbol.iterator;function ye(a){return a===null||typeof a!="object"?null:(a=fe&&a[fe]||a["@@iterator"],typeof a=="function"?a:null)}var ke=Symbol.for("react.client.reference");function me(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===ke?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case E:return"Fragment";case S:return"Profiler";case v:return"StrictMode";case z:return"Suspense";case J:return"SuspenseList";case ee:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case y:return"Portal";case R:return(a.displayName||"Context")+".Provider";case O:return(a._context.displayName||"Context")+".Consumer";case D:var c=a.render;return a=a.displayName,a||(a=c.displayName||c.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case ie:return c=a.displayName||null,c!==null?c:me(a.type)||"Memo";case re:c=a._payload,a=a._init;try{return me(a(c))}catch{}}return null}var Oe=Array.isArray,W=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,oe=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,pe={pending:!1,data:null,method:null,action:null},He=[],M=-1;function Z(a){return{current:a}}function ae(a){0>M||(a.current=He[M],He[M]=null,M--)}function ue(a,c){M++,He[M]=a.current,a.current=c}var _e=Z(null),De=Z(null),Ce=Z(null),An=Z(null);function ct(a,c){switch(ue(Ce,c),ue(De,a),ue(_e,null),c.nodeType){case 9:case 11:a=(a=c.documentElement)&&(a=a.namespaceURI)?bE(a):0;break;default:if(a=c.tagName,c=c.namespaceURI)c=bE(c),a=TE(c,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}ae(_e),ue(_e,a)}function _r(){ae(_e),ae(De),ae(Ce)}function hd(a){a.memoizedState!==null&&ue(An,a);var c=_e.current,u=TE(c,a.type);c!==u&&(ue(De,a),ue(_e,u))}function Ul(a){De.current===a&&(ae(_e),ae(De)),An.current===a&&(ae(An),Bc._currentValue=pe)}var dd=Object.prototype.hasOwnProperty,gd=n.unstable_scheduleCallback,pd=n.unstable_cancelCallback,ux=n.unstable_shouldYield,fx=n.unstable_requestPaint,Bs=n.unstable_now,hx=n.unstable_getCurrentPriorityLevel,eb=n.unstable_ImmediatePriority,tb=n.unstable_UserBlockingPriority,Ll=n.unstable_NormalPriority,dx=n.unstable_LowPriority,nb=n.unstable_IdlePriority,gx=n.log,px=n.unstable_setDisableYieldValue,Da=null,yn=null;function Ar(a){if(typeof gx=="function"&&px(a),yn&&typeof yn.setStrictMode=="function")try{yn.setStrictMode(Da,a)}catch{}}var bn=Math.clz32?Math.clz32:Ax,mx=Math.log,_x=Math.LN2;function Ax(a){return a>>>=0,a===0?32:31-(mx(a)/_x|0)|0}var kl=256,Hl=4194304;function ci(a){var c=a&42;if(c!==0)return c;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function Gl(a,c,u){var d=a.pendingLanes;if(d===0)return 0;var p=0,_=a.suspendedLanes,T=a.pingedLanes;a=a.warmLanes;var C=d&134217727;return C!==0?(d=C&~_,d!==0?p=ci(d):(T&=C,T!==0?p=ci(T):u||(u=C&~a,u!==0&&(p=ci(u))))):(C=d&~_,C!==0?p=ci(C):T!==0?p=ci(T):u||(u=d&~a,u!==0&&(p=ci(u)))),p===0?0:c!==0&&c!==p&&(c&_)===0&&(_=p&-p,u=c&-c,_>=u||_===32&&(u&4194048)!==0)?c:p}function Na(a,c){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&c)===0}function yx(a,c){switch(a){case 1:case 2:case 4:case 8:case 64:return c+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function sb(){var a=kl;return kl<<=1,(kl&4194048)===0&&(kl=256),a}function rb(){var a=Hl;return Hl<<=1,(Hl&62914560)===0&&(Hl=4194304),a}function md(a){for(var c=[],u=0;31>u;u++)c.push(a);return c}function Fa(a,c){a.pendingLanes|=c,c!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function bx(a,c,u,d,p,_){var T=a.pendingLanes;a.pendingLanes=u,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=u,a.entangledLanes&=u,a.errorRecoveryDisabledLanes&=u,a.shellSuspendCounter=0;var C=a.entanglements,I=a.expirationTimes,j=a.hiddenUpdates;for(u=T&~u;0<u;){var Y=31-bn(u),Q=1<<Y;C[Y]=0,I[Y]=-1;var $=j[Y];if($!==null)for(j[Y]=null,Y=0;Y<$.length;Y++){var X=$[Y];X!==null&&(X.lane&=-536870913)}u&=~Q}d!==0&&ib(a,d,0),_!==0&&p===0&&a.tag!==0&&(a.suspendedLanes|=_&~(T&~c))}function ib(a,c,u){a.pendingLanes|=c,a.suspendedLanes&=~c;var d=31-bn(c);a.entangledLanes|=c,a.entanglements[d]=a.entanglements[d]|1073741824|u&4194090}function ob(a,c){var u=a.entangledLanes|=c;for(a=a.entanglements;u;){var d=31-bn(u),p=1<<d;p&c|a[d]&c&&(a[d]|=c),u&=~p}}function _d(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function Ad(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function ab(){var a=oe.p;return a!==0?a:(a=window.event,a===void 0?32:HE(a.type))}function Tx(a,c){var u=oe.p;try{return oe.p=a,c()}finally{oe.p=u}}var yr=Math.random().toString(36).slice(2),$t="__reactFiber$"+yr,rn="__reactProps$"+yr,Yi="__reactContainer$"+yr,yd="__reactEvents$"+yr,Ex="__reactListeners$"+yr,Cx="__reactHandles$"+yr,cb="__reactResources$"+yr,Pa="__reactMarker$"+yr;function bd(a){delete a[$t],delete a[rn],delete a[yd],delete a[Ex],delete a[Cx]}function Ki(a){var c=a[$t];if(c)return c;for(var u=a.parentNode;u;){if(c=u[Yi]||u[$t]){if(u=c.alternate,c.child!==null||u!==null&&u.child!==null)for(a=BE(a);a!==null;){if(u=a[$t])return u;a=BE(a)}return c}a=u,u=a.parentNode}return null}function qi(a){if(a=a[$t]||a[Yi]){var c=a.tag;if(c===5||c===6||c===13||c===26||c===27||c===3)return a}return null}function Ua(a){var c=a.tag;if(c===5||c===26||c===27||c===6)return a.stateNode;throw Error(s(33))}function Qi(a){var c=a[cb];return c||(c=a[cb]={hoistableStyles:new Map,hoistableScripts:new Map}),c}function Dt(a){a[Pa]=!0}var lb=new Set,ub={};function li(a,c){Zi(a,c),Zi(a+"Capture",c)}function Zi(a,c){for(ub[a]=c,a=0;a<c.length;a++)lb.add(c[a])}var vx=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),fb={},hb={};function Bx(a){return dd.call(hb,a)?!0:dd.call(fb,a)?!1:vx.test(a)?hb[a]=!0:(fb[a]=!0,!1)}function Vl(a,c,u){if(Bx(c))if(u===null)a.removeAttribute(c);else{switch(typeof u){case"undefined":case"function":case"symbol":a.removeAttribute(c);return;case"boolean":var d=c.toLowerCase().slice(0,5);if(d!=="data-"&&d!=="aria-"){a.removeAttribute(c);return}}a.setAttribute(c,""+u)}}function jl(a,c,u){if(u===null)a.removeAttribute(c);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(c);return}a.setAttribute(c,""+u)}}function $s(a,c,u,d){if(d===null)a.removeAttribute(u);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(u);return}a.setAttributeNS(c,u,""+d)}}var Td,db;function eo(a){if(Td===void 0)try{throw Error()}catch(u){var c=u.stack.trim().match(/\n( *(at )?)/);Td=c&&c[1]||"",db=-1<u.stack.indexOf(`
    at`)?" (<anonymous>)":-1<u.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Td+a+db}var Ed=!1;function Cd(a,c){if(!a||Ed)return"";Ed=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var d={DetermineComponentFrameRoot:function(){try{if(c){var Q=function(){throw Error()};if(Object.defineProperty(Q.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Q,[])}catch(X){var $=X}Reflect.construct(a,[],Q)}else{try{Q.call()}catch(X){$=X}a.call(Q.prototype)}}else{try{throw Error()}catch(X){$=X}(Q=a())&&typeof Q.catch=="function"&&Q.catch(function(){})}}catch(X){if(X&&$&&typeof X.stack=="string")return[X.stack,$.stack]}return[null,null]}};d.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var p=Object.getOwnPropertyDescriptor(d.DetermineComponentFrameRoot,"name");p&&p.configurable&&Object.defineProperty(d.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var _=d.DetermineComponentFrameRoot(),T=_[0],C=_[1];if(T&&C){var I=T.split(`
`),j=C.split(`
`);for(p=d=0;d<I.length&&!I[d].includes("DetermineComponentFrameRoot");)d++;for(;p<j.length&&!j[p].includes("DetermineComponentFrameRoot");)p++;if(d===I.length||p===j.length)for(d=I.length-1,p=j.length-1;1<=d&&0<=p&&I[d]!==j[p];)p--;for(;1<=d&&0<=p;d--,p--)if(I[d]!==j[p]){if(d!==1||p!==1)do if(d--,p--,0>p||I[d]!==j[p]){var Y=`
`+I[d].replace(" at new "," at ");return a.displayName&&Y.includes("<anonymous>")&&(Y=Y.replace("<anonymous>",a.displayName)),Y}while(1<=d&&0<=p);break}}}finally{Ed=!1,Error.prepareStackTrace=u}return(u=a?a.displayName||a.name:"")?eo(u):""}function Sx(a){switch(a.tag){case 26:case 27:case 5:return eo(a.type);case 16:return eo("Lazy");case 13:return eo("Suspense");case 19:return eo("SuspenseList");case 0:case 15:return Cd(a.type,!1);case 11:return Cd(a.type.render,!1);case 1:return Cd(a.type,!0);case 31:return eo("Activity");default:return""}}function gb(a){try{var c="";do c+=Sx(a),a=a.return;while(a);return c}catch(u){return`
Error generating stack: `+u.message+`
`+u.stack}}function Un(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function pb(a){var c=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(c==="checkbox"||c==="radio")}function wx(a){var c=pb(a)?"checked":"value",u=Object.getOwnPropertyDescriptor(a.constructor.prototype,c),d=""+a[c];if(!a.hasOwnProperty(c)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var p=u.get,_=u.set;return Object.defineProperty(a,c,{configurable:!0,get:function(){return p.call(this)},set:function(T){d=""+T,_.call(this,T)}}),Object.defineProperty(a,c,{enumerable:u.enumerable}),{getValue:function(){return d},setValue:function(T){d=""+T},stopTracking:function(){a._valueTracker=null,delete a[c]}}}}function zl(a){a._valueTracker||(a._valueTracker=wx(a))}function mb(a){if(!a)return!1;var c=a._valueTracker;if(!c)return!0;var u=c.getValue(),d="";return a&&(d=pb(a)?a.checked?"true":"false":a.value),a=d,a!==u?(c.setValue(a),!0):!1}function $l(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var Rx=/[\n"\\]/g;function Ln(a){return a.replace(Rx,function(c){return"\\"+c.charCodeAt(0).toString(16)+" "})}function vd(a,c,u,d,p,_,T,C){a.name="",T!=null&&typeof T!="function"&&typeof T!="symbol"&&typeof T!="boolean"?a.type=T:a.removeAttribute("type"),c!=null?T==="number"?(c===0&&a.value===""||a.value!=c)&&(a.value=""+Un(c)):a.value!==""+Un(c)&&(a.value=""+Un(c)):T!=="submit"&&T!=="reset"||a.removeAttribute("value"),c!=null?Bd(a,T,Un(c)):u!=null?Bd(a,T,Un(u)):d!=null&&a.removeAttribute("value"),p==null&&_!=null&&(a.defaultChecked=!!_),p!=null&&(a.checked=p&&typeof p!="function"&&typeof p!="symbol"),C!=null&&typeof C!="function"&&typeof C!="symbol"&&typeof C!="boolean"?a.name=""+Un(C):a.removeAttribute("name")}function _b(a,c,u,d,p,_,T,C){if(_!=null&&typeof _!="function"&&typeof _!="symbol"&&typeof _!="boolean"&&(a.type=_),c!=null||u!=null){if(!(_!=="submit"&&_!=="reset"||c!=null))return;u=u!=null?""+Un(u):"",c=c!=null?""+Un(c):u,C||c===a.value||(a.value=c),a.defaultValue=c}d=d??p,d=typeof d!="function"&&typeof d!="symbol"&&!!d,a.checked=C?a.checked:!!d,a.defaultChecked=!!d,T!=null&&typeof T!="function"&&typeof T!="symbol"&&typeof T!="boolean"&&(a.name=T)}function Bd(a,c,u){c==="number"&&$l(a.ownerDocument)===a||a.defaultValue===""+u||(a.defaultValue=""+u)}function to(a,c,u,d){if(a=a.options,c){c={};for(var p=0;p<u.length;p++)c["$"+u[p]]=!0;for(u=0;u<a.length;u++)p=c.hasOwnProperty("$"+a[u].value),a[u].selected!==p&&(a[u].selected=p),p&&d&&(a[u].defaultSelected=!0)}else{for(u=""+Un(u),c=null,p=0;p<a.length;p++){if(a[p].value===u){a[p].selected=!0,d&&(a[p].defaultSelected=!0);return}c!==null||a[p].disabled||(c=a[p])}c!==null&&(c.selected=!0)}}function Ab(a,c,u){if(c!=null&&(c=""+Un(c),c!==a.value&&(a.value=c),u==null)){a.defaultValue!==c&&(a.defaultValue=c);return}a.defaultValue=u!=null?""+Un(u):""}function yb(a,c,u,d){if(c==null){if(d!=null){if(u!=null)throw Error(s(92));if(Oe(d)){if(1<d.length)throw Error(s(93));d=d[0]}u=d}u==null&&(u=""),c=u}u=Un(c),a.defaultValue=u,d=a.textContent,d===u&&d!==""&&d!==null&&(a.value=d)}function no(a,c){if(c){var u=a.firstChild;if(u&&u===a.lastChild&&u.nodeType===3){u.nodeValue=c;return}}a.textContent=c}var xx=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function bb(a,c,u){var d=c.indexOf("--")===0;u==null||typeof u=="boolean"||u===""?d?a.setProperty(c,""):c==="float"?a.cssFloat="":a[c]="":d?a.setProperty(c,u):typeof u!="number"||u===0||xx.has(c)?c==="float"?a.cssFloat=u:a[c]=(""+u).trim():a[c]=u+"px"}function Tb(a,c,u){if(c!=null&&typeof c!="object")throw Error(s(62));if(a=a.style,u!=null){for(var d in u)!u.hasOwnProperty(d)||c!=null&&c.hasOwnProperty(d)||(d.indexOf("--")===0?a.setProperty(d,""):d==="float"?a.cssFloat="":a[d]="");for(var p in c)d=c[p],c.hasOwnProperty(p)&&u[p]!==d&&bb(a,p,d)}else for(var _ in c)c.hasOwnProperty(_)&&bb(a,_,c[_])}function Sd(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ix=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Mx=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Xl(a){return Mx.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}var wd=null;function Rd(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var so=null,ro=null;function Eb(a){var c=qi(a);if(c&&(a=c.stateNode)){var u=a[rn]||null;e:switch(a=c.stateNode,c.type){case"input":if(vd(a,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name),c=u.name,u.type==="radio"&&c!=null){for(u=a;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll('input[name="'+Ln(""+c)+'"][type="radio"]'),c=0;c<u.length;c++){var d=u[c];if(d!==a&&d.form===a.form){var p=d[rn]||null;if(!p)throw Error(s(90));vd(d,p.value,p.defaultValue,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name)}}for(c=0;c<u.length;c++)d=u[c],d.form===a.form&&mb(d)}break e;case"textarea":Ab(a,u.value,u.defaultValue);break e;case"select":c=u.value,c!=null&&to(a,!!u.multiple,c,!1)}}}var xd=!1;function Cb(a,c,u){if(xd)return a(c,u);xd=!0;try{var d=a(c);return d}finally{if(xd=!1,(so!==null||ro!==null)&&(Mu(),so&&(c=so,a=ro,ro=so=null,Eb(c),a)))for(c=0;c<a.length;c++)Eb(a[c])}}function La(a,c){var u=a.stateNode;if(u===null)return null;var d=u[rn]||null;if(d===null)return null;u=d[c];e:switch(c){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(a=a.type,d=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!d;break e;default:a=!1}if(a)return null;if(u&&typeof u!="function")throw Error(s(231,c,typeof u));return u}var Xs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Id=!1;if(Xs)try{var ka={};Object.defineProperty(ka,"passive",{get:function(){Id=!0}}),window.addEventListener("test",ka,ka),window.removeEventListener("test",ka,ka)}catch{Id=!1}var br=null,Md=null,Jl=null;function vb(){if(Jl)return Jl;var a,c=Md,u=c.length,d,p="value"in br?br.value:br.textContent,_=p.length;for(a=0;a<u&&c[a]===p[a];a++);var T=u-a;for(d=1;d<=T&&c[u-d]===p[_-d];d++);return Jl=p.slice(a,1<d?1-d:void 0)}function Wl(a){var c=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&c===13&&(a=13)):a=c,a===10&&(a=13),32<=a||a===13?a:0}function Yl(){return!0}function Bb(){return!1}function on(a){function c(u,d,p,_,T){this._reactName=u,this._targetInst=p,this.type=d,this.nativeEvent=_,this.target=T,this.currentTarget=null;for(var C in a)a.hasOwnProperty(C)&&(u=a[C],this[C]=u?u(_):_[C]);return this.isDefaultPrevented=(_.defaultPrevented!=null?_.defaultPrevented:_.returnValue===!1)?Yl:Bb,this.isPropagationStopped=Bb,this}return g(c.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=Yl)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=Yl)},persist:function(){},isPersistent:Yl}),c}var ui={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Kl=on(ui),Ha=g({},ui,{view:0,detail:0}),Ox=on(Ha),Od,Dd,Ga,ql=g({},Ha,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Fd,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==Ga&&(Ga&&a.type==="mousemove"?(Od=a.screenX-Ga.screenX,Dd=a.screenY-Ga.screenY):Dd=Od=0,Ga=a),Od)},movementY:function(a){return"movementY"in a?a.movementY:Dd}}),Sb=on(ql),Dx=g({},ql,{dataTransfer:0}),Nx=on(Dx),Fx=g({},Ha,{relatedTarget:0}),Nd=on(Fx),Px=g({},ui,{animationName:0,elapsedTime:0,pseudoElement:0}),Ux=on(Px),Lx=g({},ui,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),kx=on(Lx),Hx=g({},ui,{data:0}),wb=on(Hx),Gx={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Vx={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},jx={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function zx(a){var c=this.nativeEvent;return c.getModifierState?c.getModifierState(a):(a=jx[a])?!!c[a]:!1}function Fd(){return zx}var $x=g({},Ha,{key:function(a){if(a.key){var c=Gx[a.key]||a.key;if(c!=="Unidentified")return c}return a.type==="keypress"?(a=Wl(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?Vx[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Fd,charCode:function(a){return a.type==="keypress"?Wl(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?Wl(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),Xx=on($x),Jx=g({},ql,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Rb=on(Jx),Wx=g({},Ha,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Fd}),Yx=on(Wx),Kx=g({},ui,{propertyName:0,elapsedTime:0,pseudoElement:0}),qx=on(Kx),Qx=g({},ql,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),Zx=on(Qx),eI=g({},ui,{newState:0,oldState:0}),tI=on(eI),nI=[9,13,27,32],Pd=Xs&&"CompositionEvent"in window,Va=null;Xs&&"documentMode"in document&&(Va=document.documentMode);var sI=Xs&&"TextEvent"in window&&!Va,xb=Xs&&(!Pd||Va&&8<Va&&11>=Va),Ib=" ",Mb=!1;function Ob(a,c){switch(a){case"keyup":return nI.indexOf(c.keyCode)!==-1;case"keydown":return c.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Db(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var io=!1;function rI(a,c){switch(a){case"compositionend":return Db(c);case"keypress":return c.which!==32?null:(Mb=!0,Ib);case"textInput":return a=c.data,a===Ib&&Mb?null:a;default:return null}}function iI(a,c){if(io)return a==="compositionend"||!Pd&&Ob(a,c)?(a=vb(),Jl=Md=br=null,io=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(c.ctrlKey||c.altKey||c.metaKey)||c.ctrlKey&&c.altKey){if(c.char&&1<c.char.length)return c.char;if(c.which)return String.fromCharCode(c.which)}return null;case"compositionend":return xb&&c.locale!=="ko"?null:c.data;default:return null}}var oI={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Nb(a){var c=a&&a.nodeName&&a.nodeName.toLowerCase();return c==="input"?!!oI[a.type]:c==="textarea"}function Fb(a,c,u,d){so?ro?ro.push(d):ro=[d]:so=d,c=Uu(c,"onChange"),0<c.length&&(u=new Kl("onChange","change",null,u,d),a.push({event:u,listeners:c}))}var ja=null,za=null;function aI(a){pE(a,0)}function Ql(a){var c=Ua(a);if(mb(c))return a}function Pb(a,c){if(a==="change")return c}var Ub=!1;if(Xs){var Ud;if(Xs){var Ld="oninput"in document;if(!Ld){var Lb=document.createElement("div");Lb.setAttribute("oninput","return;"),Ld=typeof Lb.oninput=="function"}Ud=Ld}else Ud=!1;Ub=Ud&&(!document.documentMode||9<document.documentMode)}function kb(){ja&&(ja.detachEvent("onpropertychange",Hb),za=ja=null)}function Hb(a){if(a.propertyName==="value"&&Ql(za)){var c=[];Fb(c,za,a,Rd(a)),Cb(aI,c)}}function cI(a,c,u){a==="focusin"?(kb(),ja=c,za=u,ja.attachEvent("onpropertychange",Hb)):a==="focusout"&&kb()}function lI(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return Ql(za)}function uI(a,c){if(a==="click")return Ql(c)}function fI(a,c){if(a==="input"||a==="change")return Ql(c)}function hI(a,c){return a===c&&(a!==0||1/a===1/c)||a!==a&&c!==c}var Tn=typeof Object.is=="function"?Object.is:hI;function $a(a,c){if(Tn(a,c))return!0;if(typeof a!="object"||a===null||typeof c!="object"||c===null)return!1;var u=Object.keys(a),d=Object.keys(c);if(u.length!==d.length)return!1;for(d=0;d<u.length;d++){var p=u[d];if(!dd.call(c,p)||!Tn(a[p],c[p]))return!1}return!0}function Gb(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function Vb(a,c){var u=Gb(a);a=0;for(var d;u;){if(u.nodeType===3){if(d=a+u.textContent.length,a<=c&&d>=c)return{node:u,offset:c-a};a=d}e:{for(;u;){if(u.nextSibling){u=u.nextSibling;break e}u=u.parentNode}u=void 0}u=Gb(u)}}function jb(a,c){return a&&c?a===c?!0:a&&a.nodeType===3?!1:c&&c.nodeType===3?jb(a,c.parentNode):"contains"in a?a.contains(c):a.compareDocumentPosition?!!(a.compareDocumentPosition(c)&16):!1:!1}function zb(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var c=$l(a.document);c instanceof a.HTMLIFrameElement;){try{var u=typeof c.contentWindow.location.href=="string"}catch{u=!1}if(u)a=c.contentWindow;else break;c=$l(a.document)}return c}function kd(a){var c=a&&a.nodeName&&a.nodeName.toLowerCase();return c&&(c==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||c==="textarea"||a.contentEditable==="true")}var dI=Xs&&"documentMode"in document&&11>=document.documentMode,oo=null,Hd=null,Xa=null,Gd=!1;function $b(a,c,u){var d=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;Gd||oo==null||oo!==$l(d)||(d=oo,"selectionStart"in d&&kd(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),Xa&&$a(Xa,d)||(Xa=d,d=Uu(Hd,"onSelect"),0<d.length&&(c=new Kl("onSelect","select",null,c,u),a.push({event:c,listeners:d}),c.target=oo)))}function fi(a,c){var u={};return u[a.toLowerCase()]=c.toLowerCase(),u["Webkit"+a]="webkit"+c,u["Moz"+a]="moz"+c,u}var ao={animationend:fi("Animation","AnimationEnd"),animationiteration:fi("Animation","AnimationIteration"),animationstart:fi("Animation","AnimationStart"),transitionrun:fi("Transition","TransitionRun"),transitionstart:fi("Transition","TransitionStart"),transitioncancel:fi("Transition","TransitionCancel"),transitionend:fi("Transition","TransitionEnd")},Vd={},Xb={};Xs&&(Xb=document.createElement("div").style,"AnimationEvent"in window||(delete ao.animationend.animation,delete ao.animationiteration.animation,delete ao.animationstart.animation),"TransitionEvent"in window||delete ao.transitionend.transition);function hi(a){if(Vd[a])return Vd[a];if(!ao[a])return a;var c=ao[a],u;for(u in c)if(c.hasOwnProperty(u)&&u in Xb)return Vd[a]=c[u];return a}var Jb=hi("animationend"),Wb=hi("animationiteration"),Yb=hi("animationstart"),gI=hi("transitionrun"),pI=hi("transitionstart"),mI=hi("transitioncancel"),Kb=hi("transitionend"),qb=new Map,jd="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");jd.push("scrollEnd");function as(a,c){qb.set(a,c),li(c,[a])}var Qb=new WeakMap;function kn(a,c){if(typeof a=="object"&&a!==null){var u=Qb.get(a);return u!==void 0?u:(c={value:a,source:c,stack:gb(c)},Qb.set(a,c),c)}return{value:a,source:c,stack:gb(c)}}var Hn=[],co=0,zd=0;function Zl(){for(var a=co,c=zd=co=0;c<a;){var u=Hn[c];Hn[c++]=null;var d=Hn[c];Hn[c++]=null;var p=Hn[c];Hn[c++]=null;var _=Hn[c];if(Hn[c++]=null,d!==null&&p!==null){var T=d.pending;T===null?p.next=p:(p.next=T.next,T.next=p),d.pending=p}_!==0&&Zb(u,p,_)}}function eu(a,c,u,d){Hn[co++]=a,Hn[co++]=c,Hn[co++]=u,Hn[co++]=d,zd|=d,a.lanes|=d,a=a.alternate,a!==null&&(a.lanes|=d)}function $d(a,c,u,d){return eu(a,c,u,d),tu(a)}function lo(a,c){return eu(a,null,null,c),tu(a)}function Zb(a,c,u){a.lanes|=u;var d=a.alternate;d!==null&&(d.lanes|=u);for(var p=!1,_=a.return;_!==null;)_.childLanes|=u,d=_.alternate,d!==null&&(d.childLanes|=u),_.tag===22&&(a=_.stateNode,a===null||a._visibility&1||(p=!0)),a=_,_=_.return;return a.tag===3?(_=a.stateNode,p&&c!==null&&(p=31-bn(u),a=_.hiddenUpdates,d=a[p],d===null?a[p]=[c]:d.push(c),c.lane=u|536870912),_):null}function tu(a){if(50<_c)throw _c=0,qg=null,Error(s(185));for(var c=a.return;c!==null;)a=c,c=a.return;return a.tag===3?a.stateNode:null}var uo={};function _I(a,c,u,d){this.tag=a,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=c,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function En(a,c,u,d){return new _I(a,c,u,d)}function Xd(a){return a=a.prototype,!(!a||!a.isReactComponent)}function Js(a,c){var u=a.alternate;return u===null?(u=En(a.tag,c,a.key,a.mode),u.elementType=a.elementType,u.type=a.type,u.stateNode=a.stateNode,u.alternate=a,a.alternate=u):(u.pendingProps=c,u.type=a.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=a.flags&65011712,u.childLanes=a.childLanes,u.lanes=a.lanes,u.child=a.child,u.memoizedProps=a.memoizedProps,u.memoizedState=a.memoizedState,u.updateQueue=a.updateQueue,c=a.dependencies,u.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext},u.sibling=a.sibling,u.index=a.index,u.ref=a.ref,u.refCleanup=a.refCleanup,u}function eT(a,c){a.flags&=65011714;var u=a.alternate;return u===null?(a.childLanes=0,a.lanes=c,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=u.childLanes,a.lanes=u.lanes,a.child=u.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=u.memoizedProps,a.memoizedState=u.memoizedState,a.updateQueue=u.updateQueue,a.type=u.type,c=u.dependencies,a.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext}),a}function nu(a,c,u,d,p,_){var T=0;if(d=a,typeof a=="function")Xd(a)&&(T=1);else if(typeof a=="string")T=yM(a,u,_e.current)?26:a==="html"||a==="head"||a==="body"?27:5;else e:switch(a){case ee:return a=En(31,u,c,p),a.elementType=ee,a.lanes=_,a;case E:return di(u.children,p,_,c);case v:T=8,p|=24;break;case S:return a=En(12,u,c,p|2),a.elementType=S,a.lanes=_,a;case z:return a=En(13,u,c,p),a.elementType=z,a.lanes=_,a;case J:return a=En(19,u,c,p),a.elementType=J,a.lanes=_,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case x:case R:T=10;break e;case O:T=9;break e;case D:T=11;break e;case ie:T=14;break e;case re:T=16,d=null;break e}T=29,u=Error(s(130,a===null?"null":typeof a,"")),d=null}return c=En(T,u,c,p),c.elementType=a,c.type=d,c.lanes=_,c}function di(a,c,u,d){return a=En(7,a,d,c),a.lanes=u,a}function Jd(a,c,u){return a=En(6,a,null,c),a.lanes=u,a}function Wd(a,c,u){return c=En(4,a.children!==null?a.children:[],a.key,c),c.lanes=u,c.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},c}var fo=[],ho=0,su=null,ru=0,Gn=[],Vn=0,gi=null,Ws=1,Ys="";function pi(a,c){fo[ho++]=ru,fo[ho++]=su,su=a,ru=c}function tT(a,c,u){Gn[Vn++]=Ws,Gn[Vn++]=Ys,Gn[Vn++]=gi,gi=a;var d=Ws;a=Ys;var p=32-bn(d)-1;d&=~(1<<p),u+=1;var _=32-bn(c)+p;if(30<_){var T=p-p%5;_=(d&(1<<T)-1).toString(32),d>>=T,p-=T,Ws=1<<32-bn(c)+p|u<<p|d,Ys=_+a}else Ws=1<<_|u<<p|d,Ys=a}function Yd(a){a.return!==null&&(pi(a,1),tT(a,1,0))}function Kd(a){for(;a===su;)su=fo[--ho],fo[ho]=null,ru=fo[--ho],fo[ho]=null;for(;a===gi;)gi=Gn[--Vn],Gn[Vn]=null,Ys=Gn[--Vn],Gn[Vn]=null,Ws=Gn[--Vn],Gn[Vn]=null}var nn=null,gt=null,$e=!1,mi=null,Ss=!1,qd=Error(s(519));function _i(a){var c=Error(s(418,""));throw Ya(kn(c,a)),qd}function nT(a){var c=a.stateNode,u=a.type,d=a.memoizedProps;switch(c[$t]=a,c[rn]=d,u){case"dialog":Ie("cancel",c),Ie("close",c);break;case"iframe":case"object":case"embed":Ie("load",c);break;case"video":case"audio":for(u=0;u<yc.length;u++)Ie(yc[u],c);break;case"source":Ie("error",c);break;case"img":case"image":case"link":Ie("error",c),Ie("load",c);break;case"details":Ie("toggle",c);break;case"input":Ie("invalid",c),_b(c,d.value,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name,!0),zl(c);break;case"select":Ie("invalid",c);break;case"textarea":Ie("invalid",c),yb(c,d.value,d.defaultValue,d.children),zl(c)}u=d.children,typeof u!="string"&&typeof u!="number"&&typeof u!="bigint"||c.textContent===""+u||d.suppressHydrationWarning===!0||yE(c.textContent,u)?(d.popover!=null&&(Ie("beforetoggle",c),Ie("toggle",c)),d.onScroll!=null&&Ie("scroll",c),d.onScrollEnd!=null&&Ie("scrollend",c),d.onClick!=null&&(c.onclick=Lu),c=!0):c=!1,c||_i(a)}function sT(a){for(nn=a.return;nn;)switch(nn.tag){case 5:case 13:Ss=!1;return;case 27:case 3:Ss=!0;return;default:nn=nn.return}}function Ja(a){if(a!==nn)return!1;if(!$e)return sT(a),$e=!0,!1;var c=a.tag,u;if((u=c!==3&&c!==27)&&((u=c===5)&&(u=a.type,u=!(u!=="form"&&u!=="button")||dp(a.type,a.memoizedProps)),u=!u),u&&gt&&_i(a),sT(a),c===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(s(317));e:{for(a=a.nextSibling,c=0;a;){if(a.nodeType===8)if(u=a.data,u==="/$"){if(c===0){gt=ls(a.nextSibling);break e}c--}else u!=="$"&&u!=="$!"&&u!=="$?"||c++;a=a.nextSibling}gt=null}}else c===27?(c=gt,Pr(a.type)?(a=_p,_p=null,gt=a):gt=c):gt=nn?ls(a.stateNode.nextSibling):null;return!0}function Wa(){gt=nn=null,$e=!1}function rT(){var a=mi;return a!==null&&(ln===null?ln=a:ln.push.apply(ln,a),mi=null),a}function Ya(a){mi===null?mi=[a]:mi.push(a)}var Qd=Z(null),Ai=null,Ks=null;function Tr(a,c,u){ue(Qd,c._currentValue),c._currentValue=u}function qs(a){a._currentValue=Qd.current,ae(Qd)}function Zd(a,c,u){for(;a!==null;){var d=a.alternate;if((a.childLanes&c)!==c?(a.childLanes|=c,d!==null&&(d.childLanes|=c)):d!==null&&(d.childLanes&c)!==c&&(d.childLanes|=c),a===u)break;a=a.return}}function eg(a,c,u,d){var p=a.child;for(p!==null&&(p.return=a);p!==null;){var _=p.dependencies;if(_!==null){var T=p.child;_=_.firstContext;e:for(;_!==null;){var C=_;_=p;for(var I=0;I<c.length;I++)if(C.context===c[I]){_.lanes|=u,C=_.alternate,C!==null&&(C.lanes|=u),Zd(_.return,u,a),d||(T=null);break e}_=C.next}}else if(p.tag===18){if(T=p.return,T===null)throw Error(s(341));T.lanes|=u,_=T.alternate,_!==null&&(_.lanes|=u),Zd(T,u,a),T=null}else T=p.child;if(T!==null)T.return=p;else for(T=p;T!==null;){if(T===a){T=null;break}if(p=T.sibling,p!==null){p.return=T.return,T=p;break}T=T.return}p=T}}function Ka(a,c,u,d){a=null;for(var p=c,_=!1;p!==null;){if(!_){if((p.flags&524288)!==0)_=!0;else if((p.flags&262144)!==0)break}if(p.tag===10){var T=p.alternate;if(T===null)throw Error(s(387));if(T=T.memoizedProps,T!==null){var C=p.type;Tn(p.pendingProps.value,T.value)||(a!==null?a.push(C):a=[C])}}else if(p===An.current){if(T=p.alternate,T===null)throw Error(s(387));T.memoizedState.memoizedState!==p.memoizedState.memoizedState&&(a!==null?a.push(Bc):a=[Bc])}p=p.return}a!==null&&eg(c,a,u,d),c.flags|=262144}function iu(a){for(a=a.firstContext;a!==null;){if(!Tn(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function yi(a){Ai=a,Ks=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function Xt(a){return iT(Ai,a)}function ou(a,c){return Ai===null&&yi(a),iT(a,c)}function iT(a,c){var u=c._currentValue;if(c={context:c,memoizedValue:u,next:null},Ks===null){if(a===null)throw Error(s(308));Ks=c,a.dependencies={lanes:0,firstContext:c},a.flags|=524288}else Ks=Ks.next=c;return u}var AI=typeof AbortController<"u"?AbortController:function(){var a=[],c=this.signal={aborted:!1,addEventListener:function(u,d){a.push(d)}};this.abort=function(){c.aborted=!0,a.forEach(function(u){return u()})}},yI=n.unstable_scheduleCallback,bI=n.unstable_NormalPriority,wt={$$typeof:R,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function tg(){return{controller:new AI,data:new Map,refCount:0}}function qa(a){a.refCount--,a.refCount===0&&yI(bI,function(){a.controller.abort()})}var Qa=null,ng=0,go=0,po=null;function TI(a,c){if(Qa===null){var u=Qa=[];ng=0,go=rp(),po={status:"pending",value:void 0,then:function(d){u.push(d)}}}return ng++,c.then(oT,oT),c}function oT(){if(--ng===0&&Qa!==null){po!==null&&(po.status="fulfilled");var a=Qa;Qa=null,go=0,po=null;for(var c=0;c<a.length;c++)(0,a[c])()}}function EI(a,c){var u=[],d={status:"pending",value:null,reason:null,then:function(p){u.push(p)}};return a.then(function(){d.status="fulfilled",d.value=c;for(var p=0;p<u.length;p++)(0,u[p])(c)},function(p){for(d.status="rejected",d.reason=p,p=0;p<u.length;p++)(0,u[p])(void 0)}),d}var aT=W.S;W.S=function(a,c){typeof c=="object"&&c!==null&&typeof c.then=="function"&&TI(a,c),aT!==null&&aT(a,c)};var bi=Z(null);function sg(){var a=bi.current;return a!==null?a:ot.pooledCache}function au(a,c){c===null?ue(bi,bi.current):ue(bi,c.pool)}function cT(){var a=sg();return a===null?null:{parent:wt._currentValue,pool:a}}var Za=Error(s(460)),lT=Error(s(474)),cu=Error(s(542)),rg={then:function(){}};function uT(a){return a=a.status,a==="fulfilled"||a==="rejected"}function lu(){}function fT(a,c,u){switch(u=a[u],u===void 0?a.push(c):u!==c&&(c.then(lu,lu),c=u),c.status){case"fulfilled":return c.value;case"rejected":throw a=c.reason,dT(a),a;default:if(typeof c.status=="string")c.then(lu,lu);else{if(a=ot,a!==null&&100<a.shellSuspendCounter)throw Error(s(482));a=c,a.status="pending",a.then(function(d){if(c.status==="pending"){var p=c;p.status="fulfilled",p.value=d}},function(d){if(c.status==="pending"){var p=c;p.status="rejected",p.reason=d}})}switch(c.status){case"fulfilled":return c.value;case"rejected":throw a=c.reason,dT(a),a}throw ec=c,Za}}var ec=null;function hT(){if(ec===null)throw Error(s(459));var a=ec;return ec=null,a}function dT(a){if(a===Za||a===cu)throw Error(s(483))}var Er=!1;function ig(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function og(a,c){a=a.updateQueue,c.updateQueue===a&&(c.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function Cr(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function vr(a,c,u){var d=a.updateQueue;if(d===null)return null;if(d=d.shared,(Ye&2)!==0){var p=d.pending;return p===null?c.next=c:(c.next=p.next,p.next=c),d.pending=c,c=tu(a),Zb(a,null,u),c}return eu(a,d,c,u),tu(a)}function tc(a,c,u){if(c=c.updateQueue,c!==null&&(c=c.shared,(u&4194048)!==0)){var d=c.lanes;d&=a.pendingLanes,u|=d,c.lanes=u,ob(a,u)}}function ag(a,c){var u=a.updateQueue,d=a.alternate;if(d!==null&&(d=d.updateQueue,u===d)){var p=null,_=null;if(u=u.firstBaseUpdate,u!==null){do{var T={lane:u.lane,tag:u.tag,payload:u.payload,callback:null,next:null};_===null?p=_=T:_=_.next=T,u=u.next}while(u!==null);_===null?p=_=c:_=_.next=c}else p=_=c;u={baseState:d.baseState,firstBaseUpdate:p,lastBaseUpdate:_,shared:d.shared,callbacks:d.callbacks},a.updateQueue=u;return}a=u.lastBaseUpdate,a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=c}var cg=!1;function nc(){if(cg){var a=po;if(a!==null)throw a}}function sc(a,c,u,d){cg=!1;var p=a.updateQueue;Er=!1;var _=p.firstBaseUpdate,T=p.lastBaseUpdate,C=p.shared.pending;if(C!==null){p.shared.pending=null;var I=C,j=I.next;I.next=null,T===null?_=j:T.next=j,T=I;var Y=a.alternate;Y!==null&&(Y=Y.updateQueue,C=Y.lastBaseUpdate,C!==T&&(C===null?Y.firstBaseUpdate=j:C.next=j,Y.lastBaseUpdate=I))}if(_!==null){var Q=p.baseState;T=0,Y=j=I=null,C=_;do{var $=C.lane&-536870913,X=$!==C.lane;if(X?(Ne&$)===$:(d&$)===$){$!==0&&$===go&&(cg=!0),Y!==null&&(Y=Y.next={lane:0,tag:C.tag,payload:C.payload,callback:null,next:null});e:{var Ee=a,Ae=C;$=c;var et=u;switch(Ae.tag){case 1:if(Ee=Ae.payload,typeof Ee=="function"){Q=Ee.call(et,Q,$);break e}Q=Ee;break e;case 3:Ee.flags=Ee.flags&-65537|128;case 0:if(Ee=Ae.payload,$=typeof Ee=="function"?Ee.call(et,Q,$):Ee,$==null)break e;Q=g({},Q,$);break e;case 2:Er=!0}}$=C.callback,$!==null&&(a.flags|=64,X&&(a.flags|=8192),X=p.callbacks,X===null?p.callbacks=[$]:X.push($))}else X={lane:$,tag:C.tag,payload:C.payload,callback:C.callback,next:null},Y===null?(j=Y=X,I=Q):Y=Y.next=X,T|=$;if(C=C.next,C===null){if(C=p.shared.pending,C===null)break;X=C,C=X.next,X.next=null,p.lastBaseUpdate=X,p.shared.pending=null}}while(!0);Y===null&&(I=Q),p.baseState=I,p.firstBaseUpdate=j,p.lastBaseUpdate=Y,_===null&&(p.shared.lanes=0),Or|=T,a.lanes=T,a.memoizedState=Q}}function gT(a,c){if(typeof a!="function")throw Error(s(191,a));a.call(c)}function pT(a,c){var u=a.callbacks;if(u!==null)for(a.callbacks=null,a=0;a<u.length;a++)gT(u[a],c)}var mo=Z(null),uu=Z(0);function mT(a,c){a=rr,ue(uu,a),ue(mo,c),rr=a|c.baseLanes}function lg(){ue(uu,rr),ue(mo,mo.current)}function ug(){rr=uu.current,ae(mo),ae(uu)}var Br=0,Se=null,Qe=null,bt=null,fu=!1,_o=!1,Ti=!1,hu=0,rc=0,Ao=null,CI=0;function At(){throw Error(s(321))}function fg(a,c){if(c===null)return!1;for(var u=0;u<c.length&&u<a.length;u++)if(!Tn(a[u],c[u]))return!1;return!0}function hg(a,c,u,d,p,_){return Br=_,Se=c,c.memoizedState=null,c.updateQueue=null,c.lanes=0,W.H=a===null||a.memoizedState===null?ZT:e0,Ti=!1,_=u(d,p),Ti=!1,_o&&(_=AT(c,u,d,p)),_T(a),_}function _T(a){W.H=Au;var c=Qe!==null&&Qe.next!==null;if(Br=0,bt=Qe=Se=null,fu=!1,rc=0,Ao=null,c)throw Error(s(300));a===null||Nt||(a=a.dependencies,a!==null&&iu(a)&&(Nt=!0))}function AT(a,c,u,d){Se=a;var p=0;do{if(_o&&(Ao=null),rc=0,_o=!1,25<=p)throw Error(s(301));if(p+=1,bt=Qe=null,a.updateQueue!=null){var _=a.updateQueue;_.lastEffect=null,_.events=null,_.stores=null,_.memoCache!=null&&(_.memoCache.index=0)}W.H=II,_=c(u,d)}while(_o);return _}function vI(){var a=W.H,c=a.useState()[0];return c=typeof c.then=="function"?ic(c):c,a=a.useState()[0],(Qe!==null?Qe.memoizedState:null)!==a&&(Se.flags|=1024),c}function dg(){var a=hu!==0;return hu=0,a}function gg(a,c,u){c.updateQueue=a.updateQueue,c.flags&=-2053,a.lanes&=~u}function pg(a){if(fu){for(a=a.memoizedState;a!==null;){var c=a.queue;c!==null&&(c.pending=null),a=a.next}fu=!1}Br=0,bt=Qe=Se=null,_o=!1,rc=hu=0,Ao=null}function an(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return bt===null?Se.memoizedState=bt=a:bt=bt.next=a,bt}function Tt(){if(Qe===null){var a=Se.alternate;a=a!==null?a.memoizedState:null}else a=Qe.next;var c=bt===null?Se.memoizedState:bt.next;if(c!==null)bt=c,Qe=a;else{if(a===null)throw Se.alternate===null?Error(s(467)):Error(s(310));Qe=a,a={memoizedState:Qe.memoizedState,baseState:Qe.baseState,baseQueue:Qe.baseQueue,queue:Qe.queue,next:null},bt===null?Se.memoizedState=bt=a:bt=bt.next=a}return bt}function mg(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function ic(a){var c=rc;return rc+=1,Ao===null&&(Ao=[]),a=fT(Ao,a,c),c=Se,(bt===null?c.memoizedState:bt.next)===null&&(c=c.alternate,W.H=c===null||c.memoizedState===null?ZT:e0),a}function du(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return ic(a);if(a.$$typeof===R)return Xt(a)}throw Error(s(438,String(a)))}function _g(a){var c=null,u=Se.updateQueue;if(u!==null&&(c=u.memoCache),c==null){var d=Se.alternate;d!==null&&(d=d.updateQueue,d!==null&&(d=d.memoCache,d!=null&&(c={data:d.data.map(function(p){return p.slice()}),index:0})))}if(c==null&&(c={data:[],index:0}),u===null&&(u=mg(),Se.updateQueue=u),u.memoCache=c,u=c.data[c.index],u===void 0)for(u=c.data[c.index]=Array(a),d=0;d<a;d++)u[d]=le;return c.index++,u}function Qs(a,c){return typeof c=="function"?c(a):c}function gu(a){var c=Tt();return Ag(c,Qe,a)}function Ag(a,c,u){var d=a.queue;if(d===null)throw Error(s(311));d.lastRenderedReducer=u;var p=a.baseQueue,_=d.pending;if(_!==null){if(p!==null){var T=p.next;p.next=_.next,_.next=T}c.baseQueue=p=_,d.pending=null}if(_=a.baseState,p===null)a.memoizedState=_;else{c=p.next;var C=T=null,I=null,j=c,Y=!1;do{var Q=j.lane&-536870913;if(Q!==j.lane?(Ne&Q)===Q:(Br&Q)===Q){var $=j.revertLane;if($===0)I!==null&&(I=I.next={lane:0,revertLane:0,action:j.action,hasEagerState:j.hasEagerState,eagerState:j.eagerState,next:null}),Q===go&&(Y=!0);else if((Br&$)===$){j=j.next,$===go&&(Y=!0);continue}else Q={lane:0,revertLane:j.revertLane,action:j.action,hasEagerState:j.hasEagerState,eagerState:j.eagerState,next:null},I===null?(C=I=Q,T=_):I=I.next=Q,Se.lanes|=$,Or|=$;Q=j.action,Ti&&u(_,Q),_=j.hasEagerState?j.eagerState:u(_,Q)}else $={lane:Q,revertLane:j.revertLane,action:j.action,hasEagerState:j.hasEagerState,eagerState:j.eagerState,next:null},I===null?(C=I=$,T=_):I=I.next=$,Se.lanes|=Q,Or|=Q;j=j.next}while(j!==null&&j!==c);if(I===null?T=_:I.next=C,!Tn(_,a.memoizedState)&&(Nt=!0,Y&&(u=po,u!==null)))throw u;a.memoizedState=_,a.baseState=T,a.baseQueue=I,d.lastRenderedState=_}return p===null&&(d.lanes=0),[a.memoizedState,d.dispatch]}function yg(a){var c=Tt(),u=c.queue;if(u===null)throw Error(s(311));u.lastRenderedReducer=a;var d=u.dispatch,p=u.pending,_=c.memoizedState;if(p!==null){u.pending=null;var T=p=p.next;do _=a(_,T.action),T=T.next;while(T!==p);Tn(_,c.memoizedState)||(Nt=!0),c.memoizedState=_,c.baseQueue===null&&(c.baseState=_),u.lastRenderedState=_}return[_,d]}function yT(a,c,u){var d=Se,p=Tt(),_=$e;if(_){if(u===void 0)throw Error(s(407));u=u()}else u=c();var T=!Tn((Qe||p).memoizedState,u);T&&(p.memoizedState=u,Nt=!0),p=p.queue;var C=ET.bind(null,d,p,a);if(oc(2048,8,C,[a]),p.getSnapshot!==c||T||bt!==null&&bt.memoizedState.tag&1){if(d.flags|=2048,yo(9,pu(),TT.bind(null,d,p,u,c),null),ot===null)throw Error(s(349));_||(Br&124)!==0||bT(d,c,u)}return u}function bT(a,c,u){a.flags|=16384,a={getSnapshot:c,value:u},c=Se.updateQueue,c===null?(c=mg(),Se.updateQueue=c,c.stores=[a]):(u=c.stores,u===null?c.stores=[a]:u.push(a))}function TT(a,c,u,d){c.value=u,c.getSnapshot=d,CT(c)&&vT(a)}function ET(a,c,u){return u(function(){CT(c)&&vT(a)})}function CT(a){var c=a.getSnapshot;a=a.value;try{var u=c();return!Tn(a,u)}catch{return!0}}function vT(a){var c=lo(a,2);c!==null&&wn(c,a,2)}function bg(a){var c=an();if(typeof a=="function"){var u=a;if(a=u(),Ti){Ar(!0);try{u()}finally{Ar(!1)}}}return c.memoizedState=c.baseState=a,c.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qs,lastRenderedState:a},c}function BT(a,c,u,d){return a.baseState=u,Ag(a,Qe,typeof d=="function"?d:Qs)}function BI(a,c,u,d,p){if(_u(a))throw Error(s(485));if(a=c.action,a!==null){var _={payload:p,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(T){_.listeners.push(T)}};W.T!==null?u(!0):_.isTransition=!1,d(_),u=c.pending,u===null?(_.next=c.pending=_,ST(c,_)):(_.next=u.next,c.pending=u.next=_)}}function ST(a,c){var u=c.action,d=c.payload,p=a.state;if(c.isTransition){var _=W.T,T={};W.T=T;try{var C=u(p,d),I=W.S;I!==null&&I(T,C),wT(a,c,C)}catch(j){Tg(a,c,j)}finally{W.T=_}}else try{_=u(p,d),wT(a,c,_)}catch(j){Tg(a,c,j)}}function wT(a,c,u){u!==null&&typeof u=="object"&&typeof u.then=="function"?u.then(function(d){RT(a,c,d)},function(d){return Tg(a,c,d)}):RT(a,c,u)}function RT(a,c,u){c.status="fulfilled",c.value=u,xT(c),a.state=u,c=a.pending,c!==null&&(u=c.next,u===c?a.pending=null:(u=u.next,c.next=u,ST(a,u)))}function Tg(a,c,u){var d=a.pending;if(a.pending=null,d!==null){d=d.next;do c.status="rejected",c.reason=u,xT(c),c=c.next;while(c!==d)}a.action=null}function xT(a){a=a.listeners;for(var c=0;c<a.length;c++)(0,a[c])()}function IT(a,c){return c}function MT(a,c){if($e){var u=ot.formState;if(u!==null){e:{var d=Se;if($e){if(gt){t:{for(var p=gt,_=Ss;p.nodeType!==8;){if(!_){p=null;break t}if(p=ls(p.nextSibling),p===null){p=null;break t}}_=p.data,p=_==="F!"||_==="F"?p:null}if(p){gt=ls(p.nextSibling),d=p.data==="F!";break e}}_i(d)}d=!1}d&&(c=u[0])}}return u=an(),u.memoizedState=u.baseState=c,d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:IT,lastRenderedState:c},u.queue=d,u=KT.bind(null,Se,d),d.dispatch=u,d=bg(!1),_=Sg.bind(null,Se,!1,d.queue),d=an(),p={state:c,dispatch:null,action:a,pending:null},d.queue=p,u=BI.bind(null,Se,p,_,u),p.dispatch=u,d.memoizedState=a,[c,u,!1]}function OT(a){var c=Tt();return DT(c,Qe,a)}function DT(a,c,u){if(c=Ag(a,c,IT)[0],a=gu(Qs)[0],typeof c=="object"&&c!==null&&typeof c.then=="function")try{var d=ic(c)}catch(T){throw T===Za?cu:T}else d=c;c=Tt();var p=c.queue,_=p.dispatch;return u!==c.memoizedState&&(Se.flags|=2048,yo(9,pu(),SI.bind(null,p,u),null)),[d,_,a]}function SI(a,c){a.action=c}function NT(a){var c=Tt(),u=Qe;if(u!==null)return DT(c,u,a);Tt(),c=c.memoizedState,u=Tt();var d=u.queue.dispatch;return u.memoizedState=a,[c,d,!1]}function yo(a,c,u,d){return a={tag:a,create:u,deps:d,inst:c,next:null},c=Se.updateQueue,c===null&&(c=mg(),Se.updateQueue=c),u=c.lastEffect,u===null?c.lastEffect=a.next=a:(d=u.next,u.next=a,a.next=d,c.lastEffect=a),a}function pu(){return{destroy:void 0,resource:void 0}}function FT(){return Tt().memoizedState}function mu(a,c,u,d){var p=an();d=d===void 0?null:d,Se.flags|=a,p.memoizedState=yo(1|c,pu(),u,d)}function oc(a,c,u,d){var p=Tt();d=d===void 0?null:d;var _=p.memoizedState.inst;Qe!==null&&d!==null&&fg(d,Qe.memoizedState.deps)?p.memoizedState=yo(c,_,u,d):(Se.flags|=a,p.memoizedState=yo(1|c,_,u,d))}function PT(a,c){mu(8390656,8,a,c)}function UT(a,c){oc(2048,8,a,c)}function LT(a,c){return oc(4,2,a,c)}function kT(a,c){return oc(4,4,a,c)}function HT(a,c){if(typeof c=="function"){a=a();var u=c(a);return function(){typeof u=="function"?u():c(null)}}if(c!=null)return a=a(),c.current=a,function(){c.current=null}}function GT(a,c,u){u=u!=null?u.concat([a]):null,oc(4,4,HT.bind(null,c,a),u)}function Eg(){}function VT(a,c){var u=Tt();c=c===void 0?null:c;var d=u.memoizedState;return c!==null&&fg(c,d[1])?d[0]:(u.memoizedState=[a,c],a)}function jT(a,c){var u=Tt();c=c===void 0?null:c;var d=u.memoizedState;if(c!==null&&fg(c,d[1]))return d[0];if(d=a(),Ti){Ar(!0);try{a()}finally{Ar(!1)}}return u.memoizedState=[d,c],d}function Cg(a,c,u){return u===void 0||(Br&1073741824)!==0?a.memoizedState=c:(a.memoizedState=u,a=X0(),Se.lanes|=a,Or|=a,u)}function zT(a,c,u,d){return Tn(u,c)?u:mo.current!==null?(a=Cg(a,u,d),Tn(a,c)||(Nt=!0),a):(Br&42)===0?(Nt=!0,a.memoizedState=u):(a=X0(),Se.lanes|=a,Or|=a,c)}function $T(a,c,u,d,p){var _=oe.p;oe.p=_!==0&&8>_?_:8;var T=W.T,C={};W.T=C,Sg(a,!1,c,u);try{var I=p(),j=W.S;if(j!==null&&j(C,I),I!==null&&typeof I=="object"&&typeof I.then=="function"){var Y=EI(I,d);ac(a,c,Y,Sn(a))}else ac(a,c,d,Sn(a))}catch(Q){ac(a,c,{then:function(){},status:"rejected",reason:Q},Sn())}finally{oe.p=_,W.T=T}}function wI(){}function vg(a,c,u,d){if(a.tag!==5)throw Error(s(476));var p=XT(a).queue;$T(a,p,c,pe,u===null?wI:function(){return JT(a),u(d)})}function XT(a){var c=a.memoizedState;if(c!==null)return c;c={memoizedState:pe,baseState:pe,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qs,lastRenderedState:pe},next:null};var u={};return c.next={memoizedState:u,baseState:u,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qs,lastRenderedState:u},next:null},a.memoizedState=c,a=a.alternate,a!==null&&(a.memoizedState=c),c}function JT(a){var c=XT(a).next.queue;ac(a,c,{},Sn())}function Bg(){return Xt(Bc)}function WT(){return Tt().memoizedState}function YT(){return Tt().memoizedState}function RI(a){for(var c=a.return;c!==null;){switch(c.tag){case 24:case 3:var u=Sn();a=Cr(u);var d=vr(c,a,u);d!==null&&(wn(d,c,u),tc(d,c,u)),c={cache:tg()},a.payload=c;return}c=c.return}}function xI(a,c,u){var d=Sn();u={lane:d,revertLane:0,action:u,hasEagerState:!1,eagerState:null,next:null},_u(a)?qT(c,u):(u=$d(a,c,u,d),u!==null&&(wn(u,a,d),QT(u,c,d)))}function KT(a,c,u){var d=Sn();ac(a,c,u,d)}function ac(a,c,u,d){var p={lane:d,revertLane:0,action:u,hasEagerState:!1,eagerState:null,next:null};if(_u(a))qT(c,p);else{var _=a.alternate;if(a.lanes===0&&(_===null||_.lanes===0)&&(_=c.lastRenderedReducer,_!==null))try{var T=c.lastRenderedState,C=_(T,u);if(p.hasEagerState=!0,p.eagerState=C,Tn(C,T))return eu(a,c,p,0),ot===null&&Zl(),!1}catch{}finally{}if(u=$d(a,c,p,d),u!==null)return wn(u,a,d),QT(u,c,d),!0}return!1}function Sg(a,c,u,d){if(d={lane:2,revertLane:rp(),action:d,hasEagerState:!1,eagerState:null,next:null},_u(a)){if(c)throw Error(s(479))}else c=$d(a,u,d,2),c!==null&&wn(c,a,2)}function _u(a){var c=a.alternate;return a===Se||c!==null&&c===Se}function qT(a,c){_o=fu=!0;var u=a.pending;u===null?c.next=c:(c.next=u.next,u.next=c),a.pending=c}function QT(a,c,u){if((u&4194048)!==0){var d=c.lanes;d&=a.pendingLanes,u|=d,c.lanes=u,ob(a,u)}}var Au={readContext:Xt,use:du,useCallback:At,useContext:At,useEffect:At,useImperativeHandle:At,useLayoutEffect:At,useInsertionEffect:At,useMemo:At,useReducer:At,useRef:At,useState:At,useDebugValue:At,useDeferredValue:At,useTransition:At,useSyncExternalStore:At,useId:At,useHostTransitionStatus:At,useFormState:At,useActionState:At,useOptimistic:At,useMemoCache:At,useCacheRefresh:At},ZT={readContext:Xt,use:du,useCallback:function(a,c){return an().memoizedState=[a,c===void 0?null:c],a},useContext:Xt,useEffect:PT,useImperativeHandle:function(a,c,u){u=u!=null?u.concat([a]):null,mu(4194308,4,HT.bind(null,c,a),u)},useLayoutEffect:function(a,c){return mu(4194308,4,a,c)},useInsertionEffect:function(a,c){mu(4,2,a,c)},useMemo:function(a,c){var u=an();c=c===void 0?null:c;var d=a();if(Ti){Ar(!0);try{a()}finally{Ar(!1)}}return u.memoizedState=[d,c],d},useReducer:function(a,c,u){var d=an();if(u!==void 0){var p=u(c);if(Ti){Ar(!0);try{u(c)}finally{Ar(!1)}}}else p=c;return d.memoizedState=d.baseState=p,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:p},d.queue=a,a=a.dispatch=xI.bind(null,Se,a),[d.memoizedState,a]},useRef:function(a){var c=an();return a={current:a},c.memoizedState=a},useState:function(a){a=bg(a);var c=a.queue,u=KT.bind(null,Se,c);return c.dispatch=u,[a.memoizedState,u]},useDebugValue:Eg,useDeferredValue:function(a,c){var u=an();return Cg(u,a,c)},useTransition:function(){var a=bg(!1);return a=$T.bind(null,Se,a.queue,!0,!1),an().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,c,u){var d=Se,p=an();if($e){if(u===void 0)throw Error(s(407));u=u()}else{if(u=c(),ot===null)throw Error(s(349));(Ne&124)!==0||bT(d,c,u)}p.memoizedState=u;var _={value:u,getSnapshot:c};return p.queue=_,PT(ET.bind(null,d,_,a),[a]),d.flags|=2048,yo(9,pu(),TT.bind(null,d,_,u,c),null),u},useId:function(){var a=an(),c=ot.identifierPrefix;if($e){var u=Ys,d=Ws;u=(d&~(1<<32-bn(d)-1)).toString(32)+u,c=""+c+"R"+u,u=hu++,0<u&&(c+="H"+u.toString(32)),c+=""}else u=CI++,c=""+c+"r"+u.toString(32)+"";return a.memoizedState=c},useHostTransitionStatus:Bg,useFormState:MT,useActionState:MT,useOptimistic:function(a){var c=an();c.memoizedState=c.baseState=a;var u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return c.queue=u,c=Sg.bind(null,Se,!0,u),u.dispatch=c,[a,c]},useMemoCache:_g,useCacheRefresh:function(){return an().memoizedState=RI.bind(null,Se)}},e0={readContext:Xt,use:du,useCallback:VT,useContext:Xt,useEffect:UT,useImperativeHandle:GT,useInsertionEffect:LT,useLayoutEffect:kT,useMemo:jT,useReducer:gu,useRef:FT,useState:function(){return gu(Qs)},useDebugValue:Eg,useDeferredValue:function(a,c){var u=Tt();return zT(u,Qe.memoizedState,a,c)},useTransition:function(){var a=gu(Qs)[0],c=Tt().memoizedState;return[typeof a=="boolean"?a:ic(a),c]},useSyncExternalStore:yT,useId:WT,useHostTransitionStatus:Bg,useFormState:OT,useActionState:OT,useOptimistic:function(a,c){var u=Tt();return BT(u,Qe,a,c)},useMemoCache:_g,useCacheRefresh:YT},II={readContext:Xt,use:du,useCallback:VT,useContext:Xt,useEffect:UT,useImperativeHandle:GT,useInsertionEffect:LT,useLayoutEffect:kT,useMemo:jT,useReducer:yg,useRef:FT,useState:function(){return yg(Qs)},useDebugValue:Eg,useDeferredValue:function(a,c){var u=Tt();return Qe===null?Cg(u,a,c):zT(u,Qe.memoizedState,a,c)},useTransition:function(){var a=yg(Qs)[0],c=Tt().memoizedState;return[typeof a=="boolean"?a:ic(a),c]},useSyncExternalStore:yT,useId:WT,useHostTransitionStatus:Bg,useFormState:NT,useActionState:NT,useOptimistic:function(a,c){var u=Tt();return Qe!==null?BT(u,Qe,a,c):(u.baseState=a,[a,u.queue.dispatch])},useMemoCache:_g,useCacheRefresh:YT},bo=null,cc=0;function yu(a){var c=cc;return cc+=1,bo===null&&(bo=[]),fT(bo,a,c)}function lc(a,c){c=c.props.ref,a.ref=c!==void 0?c:null}function bu(a,c){throw c.$$typeof===m?Error(s(525)):(a=Object.prototype.toString.call(c),Error(s(31,a==="[object Object]"?"object with keys {"+Object.keys(c).join(", ")+"}":a)))}function t0(a){var c=a._init;return c(a._payload)}function n0(a){function c(k,N){if(a){var V=k.deletions;V===null?(k.deletions=[N],k.flags|=16):V.push(N)}}function u(k,N){if(!a)return null;for(;N!==null;)c(k,N),N=N.sibling;return null}function d(k){for(var N=new Map;k!==null;)k.key!==null?N.set(k.key,k):N.set(k.index,k),k=k.sibling;return N}function p(k,N){return k=Js(k,N),k.index=0,k.sibling=null,k}function _(k,N,V){return k.index=V,a?(V=k.alternate,V!==null?(V=V.index,V<N?(k.flags|=67108866,N):V):(k.flags|=67108866,N)):(k.flags|=1048576,N)}function T(k){return a&&k.alternate===null&&(k.flags|=67108866),k}function C(k,N,V,K){return N===null||N.tag!==6?(N=Jd(V,k.mode,K),N.return=k,N):(N=p(N,V),N.return=k,N)}function I(k,N,V,K){var he=V.type;return he===E?Y(k,N,V.props.children,K,V.key):N!==null&&(N.elementType===he||typeof he=="object"&&he!==null&&he.$$typeof===re&&t0(he)===N.type)?(N=p(N,V.props),lc(N,V),N.return=k,N):(N=nu(V.type,V.key,V.props,null,k.mode,K),lc(N,V),N.return=k,N)}function j(k,N,V,K){return N===null||N.tag!==4||N.stateNode.containerInfo!==V.containerInfo||N.stateNode.implementation!==V.implementation?(N=Wd(V,k.mode,K),N.return=k,N):(N=p(N,V.children||[]),N.return=k,N)}function Y(k,N,V,K,he){return N===null||N.tag!==7?(N=di(V,k.mode,K,he),N.return=k,N):(N=p(N,V),N.return=k,N)}function Q(k,N,V){if(typeof N=="string"&&N!==""||typeof N=="number"||typeof N=="bigint")return N=Jd(""+N,k.mode,V),N.return=k,N;if(typeof N=="object"&&N!==null){switch(N.$$typeof){case A:return V=nu(N.type,N.key,N.props,null,k.mode,V),lc(V,N),V.return=k,V;case y:return N=Wd(N,k.mode,V),N.return=k,N;case re:var K=N._init;return N=K(N._payload),Q(k,N,V)}if(Oe(N)||ye(N))return N=di(N,k.mode,V,null),N.return=k,N;if(typeof N.then=="function")return Q(k,yu(N),V);if(N.$$typeof===R)return Q(k,ou(k,N),V);bu(k,N)}return null}function $(k,N,V,K){var he=N!==null?N.key:null;if(typeof V=="string"&&V!==""||typeof V=="number"||typeof V=="bigint")return he!==null?null:C(k,N,""+V,K);if(typeof V=="object"&&V!==null){switch(V.$$typeof){case A:return V.key===he?I(k,N,V,K):null;case y:return V.key===he?j(k,N,V,K):null;case re:return he=V._init,V=he(V._payload),$(k,N,V,K)}if(Oe(V)||ye(V))return he!==null?null:Y(k,N,V,K,null);if(typeof V.then=="function")return $(k,N,yu(V),K);if(V.$$typeof===R)return $(k,N,ou(k,V),K);bu(k,V)}return null}function X(k,N,V,K,he){if(typeof K=="string"&&K!==""||typeof K=="number"||typeof K=="bigint")return k=k.get(V)||null,C(N,k,""+K,he);if(typeof K=="object"&&K!==null){switch(K.$$typeof){case A:return k=k.get(K.key===null?V:K.key)||null,I(N,k,K,he);case y:return k=k.get(K.key===null?V:K.key)||null,j(N,k,K,he);case re:var Re=K._init;return K=Re(K._payload),X(k,N,V,K,he)}if(Oe(K)||ye(K))return k=k.get(V)||null,Y(N,k,K,he,null);if(typeof K.then=="function")return X(k,N,V,yu(K),he);if(K.$$typeof===R)return X(k,N,V,ou(N,K),he);bu(N,K)}return null}function Ee(k,N,V,K){for(var he=null,Re=null,de=N,be=N=0,Pt=null;de!==null&&be<V.length;be++){de.index>be?(Pt=de,de=null):Pt=de.sibling;var Ge=$(k,de,V[be],K);if(Ge===null){de===null&&(de=Pt);break}a&&de&&Ge.alternate===null&&c(k,de),N=_(Ge,N,be),Re===null?he=Ge:Re.sibling=Ge,Re=Ge,de=Pt}if(be===V.length)return u(k,de),$e&&pi(k,be),he;if(de===null){for(;be<V.length;be++)de=Q(k,V[be],K),de!==null&&(N=_(de,N,be),Re===null?he=de:Re.sibling=de,Re=de);return $e&&pi(k,be),he}for(de=d(de);be<V.length;be++)Pt=X(de,k,be,V[be],K),Pt!==null&&(a&&Pt.alternate!==null&&de.delete(Pt.key===null?be:Pt.key),N=_(Pt,N,be),Re===null?he=Pt:Re.sibling=Pt,Re=Pt);return a&&de.forEach(function(Gr){return c(k,Gr)}),$e&&pi(k,be),he}function Ae(k,N,V,K){if(V==null)throw Error(s(151));for(var he=null,Re=null,de=N,be=N=0,Pt=null,Ge=V.next();de!==null&&!Ge.done;be++,Ge=V.next()){de.index>be?(Pt=de,de=null):Pt=de.sibling;var Gr=$(k,de,Ge.value,K);if(Gr===null){de===null&&(de=Pt);break}a&&de&&Gr.alternate===null&&c(k,de),N=_(Gr,N,be),Re===null?he=Gr:Re.sibling=Gr,Re=Gr,de=Pt}if(Ge.done)return u(k,de),$e&&pi(k,be),he;if(de===null){for(;!Ge.done;be++,Ge=V.next())Ge=Q(k,Ge.value,K),Ge!==null&&(N=_(Ge,N,be),Re===null?he=Ge:Re.sibling=Ge,Re=Ge);return $e&&pi(k,be),he}for(de=d(de);!Ge.done;be++,Ge=V.next())Ge=X(de,k,be,Ge.value,K),Ge!==null&&(a&&Ge.alternate!==null&&de.delete(Ge.key===null?be:Ge.key),N=_(Ge,N,be),Re===null?he=Ge:Re.sibling=Ge,Re=Ge);return a&&de.forEach(function(MM){return c(k,MM)}),$e&&pi(k,be),he}function et(k,N,V,K){if(typeof V=="object"&&V!==null&&V.type===E&&V.key===null&&(V=V.props.children),typeof V=="object"&&V!==null){switch(V.$$typeof){case A:e:{for(var he=V.key;N!==null;){if(N.key===he){if(he=V.type,he===E){if(N.tag===7){u(k,N.sibling),K=p(N,V.props.children),K.return=k,k=K;break e}}else if(N.elementType===he||typeof he=="object"&&he!==null&&he.$$typeof===re&&t0(he)===N.type){u(k,N.sibling),K=p(N,V.props),lc(K,V),K.return=k,k=K;break e}u(k,N);break}else c(k,N);N=N.sibling}V.type===E?(K=di(V.props.children,k.mode,K,V.key),K.return=k,k=K):(K=nu(V.type,V.key,V.props,null,k.mode,K),lc(K,V),K.return=k,k=K)}return T(k);case y:e:{for(he=V.key;N!==null;){if(N.key===he)if(N.tag===4&&N.stateNode.containerInfo===V.containerInfo&&N.stateNode.implementation===V.implementation){u(k,N.sibling),K=p(N,V.children||[]),K.return=k,k=K;break e}else{u(k,N);break}else c(k,N);N=N.sibling}K=Wd(V,k.mode,K),K.return=k,k=K}return T(k);case re:return he=V._init,V=he(V._payload),et(k,N,V,K)}if(Oe(V))return Ee(k,N,V,K);if(ye(V)){if(he=ye(V),typeof he!="function")throw Error(s(150));return V=he.call(V),Ae(k,N,V,K)}if(typeof V.then=="function")return et(k,N,yu(V),K);if(V.$$typeof===R)return et(k,N,ou(k,V),K);bu(k,V)}return typeof V=="string"&&V!==""||typeof V=="number"||typeof V=="bigint"?(V=""+V,N!==null&&N.tag===6?(u(k,N.sibling),K=p(N,V),K.return=k,k=K):(u(k,N),K=Jd(V,k.mode,K),K.return=k,k=K),T(k)):u(k,N)}return function(k,N,V,K){try{cc=0;var he=et(k,N,V,K);return bo=null,he}catch(de){if(de===Za||de===cu)throw de;var Re=En(29,de,null,k.mode);return Re.lanes=K,Re.return=k,Re}finally{}}}var To=n0(!0),s0=n0(!1),jn=Z(null),ws=null;function Sr(a){var c=a.alternate;ue(Rt,Rt.current&1),ue(jn,a),ws===null&&(c===null||mo.current!==null||c.memoizedState!==null)&&(ws=a)}function r0(a){if(a.tag===22){if(ue(Rt,Rt.current),ue(jn,a),ws===null){var c=a.alternate;c!==null&&c.memoizedState!==null&&(ws=a)}}else wr()}function wr(){ue(Rt,Rt.current),ue(jn,jn.current)}function Zs(a){ae(jn),ws===a&&(ws=null),ae(Rt)}var Rt=Z(0);function Tu(a){for(var c=a;c!==null;){if(c.tag===13){var u=c.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||u.data==="$?"||mp(u)))return c}else if(c.tag===19&&c.memoizedProps.revealOrder!==void 0){if((c.flags&128)!==0)return c}else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===a)break;for(;c.sibling===null;){if(c.return===null||c.return===a)return null;c=c.return}c.sibling.return=c.return,c=c.sibling}return null}function wg(a,c,u,d){c=a.memoizedState,u=u(d,c),u=u==null?c:g({},c,u),a.memoizedState=u,a.lanes===0&&(a.updateQueue.baseState=u)}var Rg={enqueueSetState:function(a,c,u){a=a._reactInternals;var d=Sn(),p=Cr(d);p.payload=c,u!=null&&(p.callback=u),c=vr(a,p,d),c!==null&&(wn(c,a,d),tc(c,a,d))},enqueueReplaceState:function(a,c,u){a=a._reactInternals;var d=Sn(),p=Cr(d);p.tag=1,p.payload=c,u!=null&&(p.callback=u),c=vr(a,p,d),c!==null&&(wn(c,a,d),tc(c,a,d))},enqueueForceUpdate:function(a,c){a=a._reactInternals;var u=Sn(),d=Cr(u);d.tag=2,c!=null&&(d.callback=c),c=vr(a,d,u),c!==null&&(wn(c,a,u),tc(c,a,u))}};function i0(a,c,u,d,p,_,T){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(d,_,T):c.prototype&&c.prototype.isPureReactComponent?!$a(u,d)||!$a(p,_):!0}function o0(a,c,u,d){a=c.state,typeof c.componentWillReceiveProps=="function"&&c.componentWillReceiveProps(u,d),typeof c.UNSAFE_componentWillReceiveProps=="function"&&c.UNSAFE_componentWillReceiveProps(u,d),c.state!==a&&Rg.enqueueReplaceState(c,c.state,null)}function Ei(a,c){var u=c;if("ref"in c){u={};for(var d in c)d!=="ref"&&(u[d]=c[d])}if(a=a.defaultProps){u===c&&(u=g({},u));for(var p in a)u[p]===void 0&&(u[p]=a[p])}return u}var Eu=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var c=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(c))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)};function a0(a){Eu(a)}function c0(a){console.error(a)}function l0(a){Eu(a)}function Cu(a,c){try{var u=a.onUncaughtError;u(c.value,{componentStack:c.stack})}catch(d){setTimeout(function(){throw d})}}function u0(a,c,u){try{var d=a.onCaughtError;d(u.value,{componentStack:u.stack,errorBoundary:c.tag===1?c.stateNode:null})}catch(p){setTimeout(function(){throw p})}}function xg(a,c,u){return u=Cr(u),u.tag=3,u.payload={element:null},u.callback=function(){Cu(a,c)},u}function f0(a){return a=Cr(a),a.tag=3,a}function h0(a,c,u,d){var p=u.type.getDerivedStateFromError;if(typeof p=="function"){var _=d.value;a.payload=function(){return p(_)},a.callback=function(){u0(c,u,d)}}var T=u.stateNode;T!==null&&typeof T.componentDidCatch=="function"&&(a.callback=function(){u0(c,u,d),typeof p!="function"&&(Dr===null?Dr=new Set([this]):Dr.add(this));var C=d.stack;this.componentDidCatch(d.value,{componentStack:C!==null?C:""})})}function MI(a,c,u,d,p){if(u.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){if(c=u.alternate,c!==null&&Ka(c,u,p,!0),u=jn.current,u!==null){switch(u.tag){case 13:return ws===null?Zg():u.alternate===null&&pt===0&&(pt=3),u.flags&=-257,u.flags|=65536,u.lanes=p,d===rg?u.flags|=16384:(c=u.updateQueue,c===null?u.updateQueue=new Set([d]):c.add(d),tp(a,d,p)),!1;case 22:return u.flags|=65536,d===rg?u.flags|=16384:(c=u.updateQueue,c===null?(c={transitions:null,markerInstances:null,retryQueue:new Set([d])},u.updateQueue=c):(u=c.retryQueue,u===null?c.retryQueue=new Set([d]):u.add(d)),tp(a,d,p)),!1}throw Error(s(435,u.tag))}return tp(a,d,p),Zg(),!1}if($e)return c=jn.current,c!==null?((c.flags&65536)===0&&(c.flags|=256),c.flags|=65536,c.lanes=p,d!==qd&&(a=Error(s(422),{cause:d}),Ya(kn(a,u)))):(d!==qd&&(c=Error(s(423),{cause:d}),Ya(kn(c,u))),a=a.current.alternate,a.flags|=65536,p&=-p,a.lanes|=p,d=kn(d,u),p=xg(a.stateNode,d,p),ag(a,p),pt!==4&&(pt=2)),!1;var _=Error(s(520),{cause:d});if(_=kn(_,u),mc===null?mc=[_]:mc.push(_),pt!==4&&(pt=2),c===null)return!0;d=kn(d,u),u=c;do{switch(u.tag){case 3:return u.flags|=65536,a=p&-p,u.lanes|=a,a=xg(u.stateNode,d,a),ag(u,a),!1;case 1:if(c=u.type,_=u.stateNode,(u.flags&128)===0&&(typeof c.getDerivedStateFromError=="function"||_!==null&&typeof _.componentDidCatch=="function"&&(Dr===null||!Dr.has(_))))return u.flags|=65536,p&=-p,u.lanes|=p,p=f0(p),h0(p,a,u,d),ag(u,p),!1}u=u.return}while(u!==null);return!1}var d0=Error(s(461)),Nt=!1;function Ht(a,c,u,d){c.child=a===null?s0(c,null,u,d):To(c,a.child,u,d)}function g0(a,c,u,d,p){u=u.render;var _=c.ref;if("ref"in d){var T={};for(var C in d)C!=="ref"&&(T[C]=d[C])}else T=d;return yi(c),d=hg(a,c,u,T,_,p),C=dg(),a!==null&&!Nt?(gg(a,c,p),er(a,c,p)):($e&&C&&Yd(c),c.flags|=1,Ht(a,c,d,p),c.child)}function p0(a,c,u,d,p){if(a===null){var _=u.type;return typeof _=="function"&&!Xd(_)&&_.defaultProps===void 0&&u.compare===null?(c.tag=15,c.type=_,m0(a,c,_,d,p)):(a=nu(u.type,null,d,c,c.mode,p),a.ref=c.ref,a.return=c,c.child=a)}if(_=a.child,!Ug(a,p)){var T=_.memoizedProps;if(u=u.compare,u=u!==null?u:$a,u(T,d)&&a.ref===c.ref)return er(a,c,p)}return c.flags|=1,a=Js(_,d),a.ref=c.ref,a.return=c,c.child=a}function m0(a,c,u,d,p){if(a!==null){var _=a.memoizedProps;if($a(_,d)&&a.ref===c.ref)if(Nt=!1,c.pendingProps=d=_,Ug(a,p))(a.flags&131072)!==0&&(Nt=!0);else return c.lanes=a.lanes,er(a,c,p)}return Ig(a,c,u,d,p)}function _0(a,c,u){var d=c.pendingProps,p=d.children,_=a!==null?a.memoizedState:null;if(d.mode==="hidden"){if((c.flags&128)!==0){if(d=_!==null?_.baseLanes|u:u,a!==null){for(p=c.child=a.child,_=0;p!==null;)_=_|p.lanes|p.childLanes,p=p.sibling;c.childLanes=_&~d}else c.childLanes=0,c.child=null;return A0(a,c,d,u)}if((u&536870912)!==0)c.memoizedState={baseLanes:0,cachePool:null},a!==null&&au(c,_!==null?_.cachePool:null),_!==null?mT(c,_):lg(),r0(c);else return c.lanes=c.childLanes=536870912,A0(a,c,_!==null?_.baseLanes|u:u,u)}else _!==null?(au(c,_.cachePool),mT(c,_),wr(),c.memoizedState=null):(a!==null&&au(c,null),lg(),wr());return Ht(a,c,p,u),c.child}function A0(a,c,u,d){var p=sg();return p=p===null?null:{parent:wt._currentValue,pool:p},c.memoizedState={baseLanes:u,cachePool:p},a!==null&&au(c,null),lg(),r0(c),a!==null&&Ka(a,c,d,!0),null}function vu(a,c){var u=c.ref;if(u===null)a!==null&&a.ref!==null&&(c.flags|=4194816);else{if(typeof u!="function"&&typeof u!="object")throw Error(s(284));(a===null||a.ref!==u)&&(c.flags|=4194816)}}function Ig(a,c,u,d,p){return yi(c),u=hg(a,c,u,d,void 0,p),d=dg(),a!==null&&!Nt?(gg(a,c,p),er(a,c,p)):($e&&d&&Yd(c),c.flags|=1,Ht(a,c,u,p),c.child)}function y0(a,c,u,d,p,_){return yi(c),c.updateQueue=null,u=AT(c,d,u,p),_T(a),d=dg(),a!==null&&!Nt?(gg(a,c,_),er(a,c,_)):($e&&d&&Yd(c),c.flags|=1,Ht(a,c,u,_),c.child)}function b0(a,c,u,d,p){if(yi(c),c.stateNode===null){var _=uo,T=u.contextType;typeof T=="object"&&T!==null&&(_=Xt(T)),_=new u(d,_),c.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,_.updater=Rg,c.stateNode=_,_._reactInternals=c,_=c.stateNode,_.props=d,_.state=c.memoizedState,_.refs={},ig(c),T=u.contextType,_.context=typeof T=="object"&&T!==null?Xt(T):uo,_.state=c.memoizedState,T=u.getDerivedStateFromProps,typeof T=="function"&&(wg(c,u,T,d),_.state=c.memoizedState),typeof u.getDerivedStateFromProps=="function"||typeof _.getSnapshotBeforeUpdate=="function"||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(T=_.state,typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount(),T!==_.state&&Rg.enqueueReplaceState(_,_.state,null),sc(c,d,_,p),nc(),_.state=c.memoizedState),typeof _.componentDidMount=="function"&&(c.flags|=4194308),d=!0}else if(a===null){_=c.stateNode;var C=c.memoizedProps,I=Ei(u,C);_.props=I;var j=_.context,Y=u.contextType;T=uo,typeof Y=="object"&&Y!==null&&(T=Xt(Y));var Q=u.getDerivedStateFromProps;Y=typeof Q=="function"||typeof _.getSnapshotBeforeUpdate=="function",C=c.pendingProps!==C,Y||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(C||j!==T)&&o0(c,_,d,T),Er=!1;var $=c.memoizedState;_.state=$,sc(c,d,_,p),nc(),j=c.memoizedState,C||$!==j||Er?(typeof Q=="function"&&(wg(c,u,Q,d),j=c.memoizedState),(I=Er||i0(c,u,I,d,$,j,T))?(Y||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount()),typeof _.componentDidMount=="function"&&(c.flags|=4194308)):(typeof _.componentDidMount=="function"&&(c.flags|=4194308),c.memoizedProps=d,c.memoizedState=j),_.props=d,_.state=j,_.context=T,d=I):(typeof _.componentDidMount=="function"&&(c.flags|=4194308),d=!1)}else{_=c.stateNode,og(a,c),T=c.memoizedProps,Y=Ei(u,T),_.props=Y,Q=c.pendingProps,$=_.context,j=u.contextType,I=uo,typeof j=="object"&&j!==null&&(I=Xt(j)),C=u.getDerivedStateFromProps,(j=typeof C=="function"||typeof _.getSnapshotBeforeUpdate=="function")||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(T!==Q||$!==I)&&o0(c,_,d,I),Er=!1,$=c.memoizedState,_.state=$,sc(c,d,_,p),nc();var X=c.memoizedState;T!==Q||$!==X||Er||a!==null&&a.dependencies!==null&&iu(a.dependencies)?(typeof C=="function"&&(wg(c,u,C,d),X=c.memoizedState),(Y=Er||i0(c,u,Y,d,$,X,I)||a!==null&&a.dependencies!==null&&iu(a.dependencies))?(j||typeof _.UNSAFE_componentWillUpdate!="function"&&typeof _.componentWillUpdate!="function"||(typeof _.componentWillUpdate=="function"&&_.componentWillUpdate(d,X,I),typeof _.UNSAFE_componentWillUpdate=="function"&&_.UNSAFE_componentWillUpdate(d,X,I)),typeof _.componentDidUpdate=="function"&&(c.flags|=4),typeof _.getSnapshotBeforeUpdate=="function"&&(c.flags|=1024)):(typeof _.componentDidUpdate!="function"||T===a.memoizedProps&&$===a.memoizedState||(c.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||T===a.memoizedProps&&$===a.memoizedState||(c.flags|=1024),c.memoizedProps=d,c.memoizedState=X),_.props=d,_.state=X,_.context=I,d=Y):(typeof _.componentDidUpdate!="function"||T===a.memoizedProps&&$===a.memoizedState||(c.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||T===a.memoizedProps&&$===a.memoizedState||(c.flags|=1024),d=!1)}return _=d,vu(a,c),d=(c.flags&128)!==0,_||d?(_=c.stateNode,u=d&&typeof u.getDerivedStateFromError!="function"?null:_.render(),c.flags|=1,a!==null&&d?(c.child=To(c,a.child,null,p),c.child=To(c,null,u,p)):Ht(a,c,u,p),c.memoizedState=_.state,a=c.child):a=er(a,c,p),a}function T0(a,c,u,d){return Wa(),c.flags|=256,Ht(a,c,u,d),c.child}var Mg={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Og(a){return{baseLanes:a,cachePool:cT()}}function Dg(a,c,u){return a=a!==null?a.childLanes&~u:0,c&&(a|=zn),a}function E0(a,c,u){var d=c.pendingProps,p=!1,_=(c.flags&128)!==0,T;if((T=_)||(T=a!==null&&a.memoizedState===null?!1:(Rt.current&2)!==0),T&&(p=!0,c.flags&=-129),T=(c.flags&32)!==0,c.flags&=-33,a===null){if($e){if(p?Sr(c):wr(),$e){var C=gt,I;if(I=C){e:{for(I=C,C=Ss;I.nodeType!==8;){if(!C){C=null;break e}if(I=ls(I.nextSibling),I===null){C=null;break e}}C=I}C!==null?(c.memoizedState={dehydrated:C,treeContext:gi!==null?{id:Ws,overflow:Ys}:null,retryLane:536870912,hydrationErrors:null},I=En(18,null,null,0),I.stateNode=C,I.return=c,c.child=I,nn=c,gt=null,I=!0):I=!1}I||_i(c)}if(C=c.memoizedState,C!==null&&(C=C.dehydrated,C!==null))return mp(C)?c.lanes=32:c.lanes=536870912,null;Zs(c)}return C=d.children,d=d.fallback,p?(wr(),p=c.mode,C=Bu({mode:"hidden",children:C},p),d=di(d,p,u,null),C.return=c,d.return=c,C.sibling=d,c.child=C,p=c.child,p.memoizedState=Og(u),p.childLanes=Dg(a,T,u),c.memoizedState=Mg,d):(Sr(c),Ng(c,C))}if(I=a.memoizedState,I!==null&&(C=I.dehydrated,C!==null)){if(_)c.flags&256?(Sr(c),c.flags&=-257,c=Fg(a,c,u)):c.memoizedState!==null?(wr(),c.child=a.child,c.flags|=128,c=null):(wr(),p=d.fallback,C=c.mode,d=Bu({mode:"visible",children:d.children},C),p=di(p,C,u,null),p.flags|=2,d.return=c,p.return=c,d.sibling=p,c.child=d,To(c,a.child,null,u),d=c.child,d.memoizedState=Og(u),d.childLanes=Dg(a,T,u),c.memoizedState=Mg,c=p);else if(Sr(c),mp(C)){if(T=C.nextSibling&&C.nextSibling.dataset,T)var j=T.dgst;T=j,d=Error(s(419)),d.stack="",d.digest=T,Ya({value:d,source:null,stack:null}),c=Fg(a,c,u)}else if(Nt||Ka(a,c,u,!1),T=(u&a.childLanes)!==0,Nt||T){if(T=ot,T!==null&&(d=u&-u,d=(d&42)!==0?1:_d(d),d=(d&(T.suspendedLanes|u))!==0?0:d,d!==0&&d!==I.retryLane))throw I.retryLane=d,lo(a,d),wn(T,a,d),d0;C.data==="$?"||Zg(),c=Fg(a,c,u)}else C.data==="$?"?(c.flags|=192,c.child=a.child,c=null):(a=I.treeContext,gt=ls(C.nextSibling),nn=c,$e=!0,mi=null,Ss=!1,a!==null&&(Gn[Vn++]=Ws,Gn[Vn++]=Ys,Gn[Vn++]=gi,Ws=a.id,Ys=a.overflow,gi=c),c=Ng(c,d.children),c.flags|=4096);return c}return p?(wr(),p=d.fallback,C=c.mode,I=a.child,j=I.sibling,d=Js(I,{mode:"hidden",children:d.children}),d.subtreeFlags=I.subtreeFlags&65011712,j!==null?p=Js(j,p):(p=di(p,C,u,null),p.flags|=2),p.return=c,d.return=c,d.sibling=p,c.child=d,d=p,p=c.child,C=a.child.memoizedState,C===null?C=Og(u):(I=C.cachePool,I!==null?(j=wt._currentValue,I=I.parent!==j?{parent:j,pool:j}:I):I=cT(),C={baseLanes:C.baseLanes|u,cachePool:I}),p.memoizedState=C,p.childLanes=Dg(a,T,u),c.memoizedState=Mg,d):(Sr(c),u=a.child,a=u.sibling,u=Js(u,{mode:"visible",children:d.children}),u.return=c,u.sibling=null,a!==null&&(T=c.deletions,T===null?(c.deletions=[a],c.flags|=16):T.push(a)),c.child=u,c.memoizedState=null,u)}function Ng(a,c){return c=Bu({mode:"visible",children:c},a.mode),c.return=a,a.child=c}function Bu(a,c){return a=En(22,a,null,c),a.lanes=0,a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},a}function Fg(a,c,u){return To(c,a.child,null,u),a=Ng(c,c.pendingProps.children),a.flags|=2,c.memoizedState=null,a}function C0(a,c,u){a.lanes|=c;var d=a.alternate;d!==null&&(d.lanes|=c),Zd(a.return,c,u)}function Pg(a,c,u,d,p){var _=a.memoizedState;_===null?a.memoizedState={isBackwards:c,rendering:null,renderingStartTime:0,last:d,tail:u,tailMode:p}:(_.isBackwards=c,_.rendering=null,_.renderingStartTime=0,_.last=d,_.tail=u,_.tailMode=p)}function v0(a,c,u){var d=c.pendingProps,p=d.revealOrder,_=d.tail;if(Ht(a,c,d.children,u),d=Rt.current,(d&2)!==0)d=d&1|2,c.flags|=128;else{if(a!==null&&(a.flags&128)!==0)e:for(a=c.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&C0(a,u,c);else if(a.tag===19)C0(a,u,c);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===c)break e;for(;a.sibling===null;){if(a.return===null||a.return===c)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}d&=1}switch(ue(Rt,d),p){case"forwards":for(u=c.child,p=null;u!==null;)a=u.alternate,a!==null&&Tu(a)===null&&(p=u),u=u.sibling;u=p,u===null?(p=c.child,c.child=null):(p=u.sibling,u.sibling=null),Pg(c,!1,p,u,_);break;case"backwards":for(u=null,p=c.child,c.child=null;p!==null;){if(a=p.alternate,a!==null&&Tu(a)===null){c.child=p;break}a=p.sibling,p.sibling=u,u=p,p=a}Pg(c,!0,u,null,_);break;case"together":Pg(c,!1,null,null,void 0);break;default:c.memoizedState=null}return c.child}function er(a,c,u){if(a!==null&&(c.dependencies=a.dependencies),Or|=c.lanes,(u&c.childLanes)===0)if(a!==null){if(Ka(a,c,u,!1),(u&c.childLanes)===0)return null}else return null;if(a!==null&&c.child!==a.child)throw Error(s(153));if(c.child!==null){for(a=c.child,u=Js(a,a.pendingProps),c.child=u,u.return=c;a.sibling!==null;)a=a.sibling,u=u.sibling=Js(a,a.pendingProps),u.return=c;u.sibling=null}return c.child}function Ug(a,c){return(a.lanes&c)!==0?!0:(a=a.dependencies,!!(a!==null&&iu(a)))}function OI(a,c,u){switch(c.tag){case 3:ct(c,c.stateNode.containerInfo),Tr(c,wt,a.memoizedState.cache),Wa();break;case 27:case 5:hd(c);break;case 4:ct(c,c.stateNode.containerInfo);break;case 10:Tr(c,c.type,c.memoizedProps.value);break;case 13:var d=c.memoizedState;if(d!==null)return d.dehydrated!==null?(Sr(c),c.flags|=128,null):(u&c.child.childLanes)!==0?E0(a,c,u):(Sr(c),a=er(a,c,u),a!==null?a.sibling:null);Sr(c);break;case 19:var p=(a.flags&128)!==0;if(d=(u&c.childLanes)!==0,d||(Ka(a,c,u,!1),d=(u&c.childLanes)!==0),p){if(d)return v0(a,c,u);c.flags|=128}if(p=c.memoizedState,p!==null&&(p.rendering=null,p.tail=null,p.lastEffect=null),ue(Rt,Rt.current),d)break;return null;case 22:case 23:return c.lanes=0,_0(a,c,u);case 24:Tr(c,wt,a.memoizedState.cache)}return er(a,c,u)}function B0(a,c,u){if(a!==null)if(a.memoizedProps!==c.pendingProps)Nt=!0;else{if(!Ug(a,u)&&(c.flags&128)===0)return Nt=!1,OI(a,c,u);Nt=(a.flags&131072)!==0}else Nt=!1,$e&&(c.flags&1048576)!==0&&tT(c,ru,c.index);switch(c.lanes=0,c.tag){case 16:e:{a=c.pendingProps;var d=c.elementType,p=d._init;if(d=p(d._payload),c.type=d,typeof d=="function")Xd(d)?(a=Ei(d,a),c.tag=1,c=b0(null,c,d,a,u)):(c.tag=0,c=Ig(null,c,d,a,u));else{if(d!=null){if(p=d.$$typeof,p===D){c.tag=11,c=g0(null,c,d,a,u);break e}else if(p===ie){c.tag=14,c=p0(null,c,d,a,u);break e}}throw c=me(d)||d,Error(s(306,c,""))}}return c;case 0:return Ig(a,c,c.type,c.pendingProps,u);case 1:return d=c.type,p=Ei(d,c.pendingProps),b0(a,c,d,p,u);case 3:e:{if(ct(c,c.stateNode.containerInfo),a===null)throw Error(s(387));d=c.pendingProps;var _=c.memoizedState;p=_.element,og(a,c),sc(c,d,null,u);var T=c.memoizedState;if(d=T.cache,Tr(c,wt,d),d!==_.cache&&eg(c,[wt],u,!0),nc(),d=T.element,_.isDehydrated)if(_={element:d,isDehydrated:!1,cache:T.cache},c.updateQueue.baseState=_,c.memoizedState=_,c.flags&256){c=T0(a,c,d,u);break e}else if(d!==p){p=kn(Error(s(424)),c),Ya(p),c=T0(a,c,d,u);break e}else{switch(a=c.stateNode.containerInfo,a.nodeType){case 9:a=a.body;break;default:a=a.nodeName==="HTML"?a.ownerDocument.body:a}for(gt=ls(a.firstChild),nn=c,$e=!0,mi=null,Ss=!0,u=s0(c,null,d,u),c.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling}else{if(Wa(),d===p){c=er(a,c,u);break e}Ht(a,c,d,u)}c=c.child}return c;case 26:return vu(a,c),a===null?(u=xE(c.type,null,c.pendingProps,null))?c.memoizedState=u:$e||(u=c.type,a=c.pendingProps,d=ku(Ce.current).createElement(u),d[$t]=c,d[rn]=a,Vt(d,u,a),Dt(d),c.stateNode=d):c.memoizedState=xE(c.type,a.memoizedProps,c.pendingProps,a.memoizedState),null;case 27:return hd(c),a===null&&$e&&(d=c.stateNode=SE(c.type,c.pendingProps,Ce.current),nn=c,Ss=!0,p=gt,Pr(c.type)?(_p=p,gt=ls(d.firstChild)):gt=p),Ht(a,c,c.pendingProps.children,u),vu(a,c),a===null&&(c.flags|=4194304),c.child;case 5:return a===null&&$e&&((p=d=gt)&&(d=oM(d,c.type,c.pendingProps,Ss),d!==null?(c.stateNode=d,nn=c,gt=ls(d.firstChild),Ss=!1,p=!0):p=!1),p||_i(c)),hd(c),p=c.type,_=c.pendingProps,T=a!==null?a.memoizedProps:null,d=_.children,dp(p,_)?d=null:T!==null&&dp(p,T)&&(c.flags|=32),c.memoizedState!==null&&(p=hg(a,c,vI,null,null,u),Bc._currentValue=p),vu(a,c),Ht(a,c,d,u),c.child;case 6:return a===null&&$e&&((a=u=gt)&&(u=aM(u,c.pendingProps,Ss),u!==null?(c.stateNode=u,nn=c,gt=null,a=!0):a=!1),a||_i(c)),null;case 13:return E0(a,c,u);case 4:return ct(c,c.stateNode.containerInfo),d=c.pendingProps,a===null?c.child=To(c,null,d,u):Ht(a,c,d,u),c.child;case 11:return g0(a,c,c.type,c.pendingProps,u);case 7:return Ht(a,c,c.pendingProps,u),c.child;case 8:return Ht(a,c,c.pendingProps.children,u),c.child;case 12:return Ht(a,c,c.pendingProps.children,u),c.child;case 10:return d=c.pendingProps,Tr(c,c.type,d.value),Ht(a,c,d.children,u),c.child;case 9:return p=c.type._context,d=c.pendingProps.children,yi(c),p=Xt(p),d=d(p),c.flags|=1,Ht(a,c,d,u),c.child;case 14:return p0(a,c,c.type,c.pendingProps,u);case 15:return m0(a,c,c.type,c.pendingProps,u);case 19:return v0(a,c,u);case 31:return d=c.pendingProps,u=c.mode,d={mode:d.mode,children:d.children},a===null?(u=Bu(d,u),u.ref=c.ref,c.child=u,u.return=c,c=u):(u=Js(a.child,d),u.ref=c.ref,c.child=u,u.return=c,c=u),c;case 22:return _0(a,c,u);case 24:return yi(c),d=Xt(wt),a===null?(p=sg(),p===null&&(p=ot,_=tg(),p.pooledCache=_,_.refCount++,_!==null&&(p.pooledCacheLanes|=u),p=_),c.memoizedState={parent:d,cache:p},ig(c),Tr(c,wt,p)):((a.lanes&u)!==0&&(og(a,c),sc(c,null,null,u),nc()),p=a.memoizedState,_=c.memoizedState,p.parent!==d?(p={parent:d,cache:d},c.memoizedState=p,c.lanes===0&&(c.memoizedState=c.updateQueue.baseState=p),Tr(c,wt,d)):(d=_.cache,Tr(c,wt,d),d!==p.cache&&eg(c,[wt],u,!0))),Ht(a,c,c.pendingProps.children,u),c.child;case 29:throw c.pendingProps}throw Error(s(156,c.tag))}function tr(a){a.flags|=4}function S0(a,c){if(c.type!=="stylesheet"||(c.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!NE(c)){if(c=jn.current,c!==null&&((Ne&4194048)===Ne?ws!==null:(Ne&62914560)!==Ne&&(Ne&536870912)===0||c!==ws))throw ec=rg,lT;a.flags|=8192}}function Su(a,c){c!==null&&(a.flags|=4),a.flags&16384&&(c=a.tag!==22?rb():536870912,a.lanes|=c,Bo|=c)}function uc(a,c){if(!$e)switch(a.tailMode){case"hidden":c=a.tail;for(var u=null;c!==null;)c.alternate!==null&&(u=c),c=c.sibling;u===null?a.tail=null:u.sibling=null;break;case"collapsed":u=a.tail;for(var d=null;u!==null;)u.alternate!==null&&(d=u),u=u.sibling;d===null?c||a.tail===null?a.tail=null:a.tail.sibling=null:d.sibling=null}}function ht(a){var c=a.alternate!==null&&a.alternate.child===a.child,u=0,d=0;if(c)for(var p=a.child;p!==null;)u|=p.lanes|p.childLanes,d|=p.subtreeFlags&65011712,d|=p.flags&65011712,p.return=a,p=p.sibling;else for(p=a.child;p!==null;)u|=p.lanes|p.childLanes,d|=p.subtreeFlags,d|=p.flags,p.return=a,p=p.sibling;return a.subtreeFlags|=d,a.childLanes=u,c}function DI(a,c,u){var d=c.pendingProps;switch(Kd(c),c.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ht(c),null;case 1:return ht(c),null;case 3:return u=c.stateNode,d=null,a!==null&&(d=a.memoizedState.cache),c.memoizedState.cache!==d&&(c.flags|=2048),qs(wt),_r(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(a===null||a.child===null)&&(Ja(c)?tr(c):a===null||a.memoizedState.isDehydrated&&(c.flags&256)===0||(c.flags|=1024,rT())),ht(c),null;case 26:return u=c.memoizedState,a===null?(tr(c),u!==null?(ht(c),S0(c,u)):(ht(c),c.flags&=-16777217)):u?u!==a.memoizedState?(tr(c),ht(c),S0(c,u)):(ht(c),c.flags&=-16777217):(a.memoizedProps!==d&&tr(c),ht(c),c.flags&=-16777217),null;case 27:Ul(c),u=Ce.current;var p=c.type;if(a!==null&&c.stateNode!=null)a.memoizedProps!==d&&tr(c);else{if(!d){if(c.stateNode===null)throw Error(s(166));return ht(c),null}a=_e.current,Ja(c)?nT(c):(a=SE(p,d,u),c.stateNode=a,tr(c))}return ht(c),null;case 5:if(Ul(c),u=c.type,a!==null&&c.stateNode!=null)a.memoizedProps!==d&&tr(c);else{if(!d){if(c.stateNode===null)throw Error(s(166));return ht(c),null}if(a=_e.current,Ja(c))nT(c);else{switch(p=ku(Ce.current),a){case 1:a=p.createElementNS("http://www.w3.org/2000/svg",u);break;case 2:a=p.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;default:switch(u){case"svg":a=p.createElementNS("http://www.w3.org/2000/svg",u);break;case"math":a=p.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;case"script":a=p.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild);break;case"select":a=typeof d.is=="string"?p.createElement("select",{is:d.is}):p.createElement("select"),d.multiple?a.multiple=!0:d.size&&(a.size=d.size);break;default:a=typeof d.is=="string"?p.createElement(u,{is:d.is}):p.createElement(u)}}a[$t]=c,a[rn]=d;e:for(p=c.child;p!==null;){if(p.tag===5||p.tag===6)a.appendChild(p.stateNode);else if(p.tag!==4&&p.tag!==27&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===c)break e;for(;p.sibling===null;){if(p.return===null||p.return===c)break e;p=p.return}p.sibling.return=p.return,p=p.sibling}c.stateNode=a;e:switch(Vt(a,u,d),u){case"button":case"input":case"select":case"textarea":a=!!d.autoFocus;break e;case"img":a=!0;break e;default:a=!1}a&&tr(c)}}return ht(c),c.flags&=-16777217,null;case 6:if(a&&c.stateNode!=null)a.memoizedProps!==d&&tr(c);else{if(typeof d!="string"&&c.stateNode===null)throw Error(s(166));if(a=Ce.current,Ja(c)){if(a=c.stateNode,u=c.memoizedProps,d=null,p=nn,p!==null)switch(p.tag){case 27:case 5:d=p.memoizedProps}a[$t]=c,a=!!(a.nodeValue===u||d!==null&&d.suppressHydrationWarning===!0||yE(a.nodeValue,u)),a||_i(c)}else a=ku(a).createTextNode(d),a[$t]=c,c.stateNode=a}return ht(c),null;case 13:if(d=c.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(p=Ja(c),d!==null&&d.dehydrated!==null){if(a===null){if(!p)throw Error(s(318));if(p=c.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(s(317));p[$t]=c}else Wa(),(c.flags&128)===0&&(c.memoizedState=null),c.flags|=4;ht(c),p=!1}else p=rT(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=p),p=!0;if(!p)return c.flags&256?(Zs(c),c):(Zs(c),null)}if(Zs(c),(c.flags&128)!==0)return c.lanes=u,c;if(u=d!==null,a=a!==null&&a.memoizedState!==null,u){d=c.child,p=null,d.alternate!==null&&d.alternate.memoizedState!==null&&d.alternate.memoizedState.cachePool!==null&&(p=d.alternate.memoizedState.cachePool.pool);var _=null;d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(_=d.memoizedState.cachePool.pool),_!==p&&(d.flags|=2048)}return u!==a&&u&&(c.child.flags|=8192),Su(c,c.updateQueue),ht(c),null;case 4:return _r(),a===null&&cp(c.stateNode.containerInfo),ht(c),null;case 10:return qs(c.type),ht(c),null;case 19:if(ae(Rt),p=c.memoizedState,p===null)return ht(c),null;if(d=(c.flags&128)!==0,_=p.rendering,_===null)if(d)uc(p,!1);else{if(pt!==0||a!==null&&(a.flags&128)!==0)for(a=c.child;a!==null;){if(_=Tu(a),_!==null){for(c.flags|=128,uc(p,!1),a=_.updateQueue,c.updateQueue=a,Su(c,a),c.subtreeFlags=0,a=u,u=c.child;u!==null;)eT(u,a),u=u.sibling;return ue(Rt,Rt.current&1|2),c.child}a=a.sibling}p.tail!==null&&Bs()>xu&&(c.flags|=128,d=!0,uc(p,!1),c.lanes=4194304)}else{if(!d)if(a=Tu(_),a!==null){if(c.flags|=128,d=!0,a=a.updateQueue,c.updateQueue=a,Su(c,a),uc(p,!0),p.tail===null&&p.tailMode==="hidden"&&!_.alternate&&!$e)return ht(c),null}else 2*Bs()-p.renderingStartTime>xu&&u!==536870912&&(c.flags|=128,d=!0,uc(p,!1),c.lanes=4194304);p.isBackwards?(_.sibling=c.child,c.child=_):(a=p.last,a!==null?a.sibling=_:c.child=_,p.last=_)}return p.tail!==null?(c=p.tail,p.rendering=c,p.tail=c.sibling,p.renderingStartTime=Bs(),c.sibling=null,a=Rt.current,ue(Rt,d?a&1|2:a&1),c):(ht(c),null);case 22:case 23:return Zs(c),ug(),d=c.memoizedState!==null,a!==null?a.memoizedState!==null!==d&&(c.flags|=8192):d&&(c.flags|=8192),d?(u&536870912)!==0&&(c.flags&128)===0&&(ht(c),c.subtreeFlags&6&&(c.flags|=8192)):ht(c),u=c.updateQueue,u!==null&&Su(c,u.retryQueue),u=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(u=a.memoizedState.cachePool.pool),d=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(d=c.memoizedState.cachePool.pool),d!==u&&(c.flags|=2048),a!==null&&ae(bi),null;case 24:return u=null,a!==null&&(u=a.memoizedState.cache),c.memoizedState.cache!==u&&(c.flags|=2048),qs(wt),ht(c),null;case 25:return null;case 30:return null}throw Error(s(156,c.tag))}function NI(a,c){switch(Kd(c),c.tag){case 1:return a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 3:return qs(wt),_r(),a=c.flags,(a&65536)!==0&&(a&128)===0?(c.flags=a&-65537|128,c):null;case 26:case 27:case 5:return Ul(c),null;case 13:if(Zs(c),a=c.memoizedState,a!==null&&a.dehydrated!==null){if(c.alternate===null)throw Error(s(340));Wa()}return a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 19:return ae(Rt),null;case 4:return _r(),null;case 10:return qs(c.type),null;case 22:case 23:return Zs(c),ug(),a!==null&&ae(bi),a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 24:return qs(wt),null;case 25:return null;default:return null}}function w0(a,c){switch(Kd(c),c.tag){case 3:qs(wt),_r();break;case 26:case 27:case 5:Ul(c);break;case 4:_r();break;case 13:Zs(c);break;case 19:ae(Rt);break;case 10:qs(c.type);break;case 22:case 23:Zs(c),ug(),a!==null&&ae(bi);break;case 24:qs(wt)}}function fc(a,c){try{var u=c.updateQueue,d=u!==null?u.lastEffect:null;if(d!==null){var p=d.next;u=p;do{if((u.tag&a)===a){d=void 0;var _=u.create,T=u.inst;d=_(),T.destroy=d}u=u.next}while(u!==p)}}catch(C){st(c,c.return,C)}}function Rr(a,c,u){try{var d=c.updateQueue,p=d!==null?d.lastEffect:null;if(p!==null){var _=p.next;d=_;do{if((d.tag&a)===a){var T=d.inst,C=T.destroy;if(C!==void 0){T.destroy=void 0,p=c;var I=u,j=C;try{j()}catch(Y){st(p,I,Y)}}}d=d.next}while(d!==_)}}catch(Y){st(c,c.return,Y)}}function R0(a){var c=a.updateQueue;if(c!==null){var u=a.stateNode;try{pT(c,u)}catch(d){st(a,a.return,d)}}}function x0(a,c,u){u.props=Ei(a.type,a.memoizedProps),u.state=a.memoizedState;try{u.componentWillUnmount()}catch(d){st(a,c,d)}}function hc(a,c){try{var u=a.ref;if(u!==null){switch(a.tag){case 26:case 27:case 5:var d=a.stateNode;break;case 30:d=a.stateNode;break;default:d=a.stateNode}typeof u=="function"?a.refCleanup=u(d):u.current=d}}catch(p){st(a,c,p)}}function Rs(a,c){var u=a.ref,d=a.refCleanup;if(u!==null)if(typeof d=="function")try{d()}catch(p){st(a,c,p)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof u=="function")try{u(null)}catch(p){st(a,c,p)}else u.current=null}function I0(a){var c=a.type,u=a.memoizedProps,d=a.stateNode;try{e:switch(c){case"button":case"input":case"select":case"textarea":u.autoFocus&&d.focus();break e;case"img":u.src?d.src=u.src:u.srcSet&&(d.srcset=u.srcSet)}}catch(p){st(a,a.return,p)}}function Lg(a,c,u){try{var d=a.stateNode;tM(d,a.type,u,c),d[rn]=c}catch(p){st(a,a.return,p)}}function M0(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&Pr(a.type)||a.tag===4}function kg(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||M0(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&Pr(a.type)||a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function Hg(a,c,u){var d=a.tag;if(d===5||d===6)a=a.stateNode,c?(u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u).insertBefore(a,c):(c=u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u,c.appendChild(a),u=u._reactRootContainer,u!=null||c.onclick!==null||(c.onclick=Lu));else if(d!==4&&(d===27&&Pr(a.type)&&(u=a.stateNode,c=null),a=a.child,a!==null))for(Hg(a,c,u),a=a.sibling;a!==null;)Hg(a,c,u),a=a.sibling}function wu(a,c,u){var d=a.tag;if(d===5||d===6)a=a.stateNode,c?u.insertBefore(a,c):u.appendChild(a);else if(d!==4&&(d===27&&Pr(a.type)&&(u=a.stateNode),a=a.child,a!==null))for(wu(a,c,u),a=a.sibling;a!==null;)wu(a,c,u),a=a.sibling}function O0(a){var c=a.stateNode,u=a.memoizedProps;try{for(var d=a.type,p=c.attributes;p.length;)c.removeAttributeNode(p[0]);Vt(c,d,u),c[$t]=a,c[rn]=u}catch(_){st(a,a.return,_)}}var nr=!1,yt=!1,Gg=!1,D0=typeof WeakSet=="function"?WeakSet:Set,Ft=null;function FI(a,c){if(a=a.containerInfo,fp=$u,a=zb(a),kd(a)){if("selectionStart"in a)var u={start:a.selectionStart,end:a.selectionEnd};else e:{u=(u=a.ownerDocument)&&u.defaultView||window;var d=u.getSelection&&u.getSelection();if(d&&d.rangeCount!==0){u=d.anchorNode;var p=d.anchorOffset,_=d.focusNode;d=d.focusOffset;try{u.nodeType,_.nodeType}catch{u=null;break e}var T=0,C=-1,I=-1,j=0,Y=0,Q=a,$=null;t:for(;;){for(var X;Q!==u||p!==0&&Q.nodeType!==3||(C=T+p),Q!==_||d!==0&&Q.nodeType!==3||(I=T+d),Q.nodeType===3&&(T+=Q.nodeValue.length),(X=Q.firstChild)!==null;)$=Q,Q=X;for(;;){if(Q===a)break t;if($===u&&++j===p&&(C=T),$===_&&++Y===d&&(I=T),(X=Q.nextSibling)!==null)break;Q=$,$=Q.parentNode}Q=X}u=C===-1||I===-1?null:{start:C,end:I}}else u=null}u=u||{start:0,end:0}}else u=null;for(hp={focusedElem:a,selectionRange:u},$u=!1,Ft=c;Ft!==null;)if(c=Ft,a=c.child,(c.subtreeFlags&1024)!==0&&a!==null)a.return=c,Ft=a;else for(;Ft!==null;){switch(c=Ft,_=c.alternate,a=c.flags,c.tag){case 0:break;case 11:case 15:break;case 1:if((a&1024)!==0&&_!==null){a=void 0,u=c,p=_.memoizedProps,_=_.memoizedState,d=u.stateNode;try{var Ee=Ei(u.type,p,u.elementType===u.type);a=d.getSnapshotBeforeUpdate(Ee,_),d.__reactInternalSnapshotBeforeUpdate=a}catch(Ae){st(u,u.return,Ae)}}break;case 3:if((a&1024)!==0){if(a=c.stateNode.containerInfo,u=a.nodeType,u===9)pp(a);else if(u===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":pp(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(s(163))}if(a=c.sibling,a!==null){a.return=c.return,Ft=a;break}Ft=c.return}}function N0(a,c,u){var d=u.flags;switch(u.tag){case 0:case 11:case 15:xr(a,u),d&4&&fc(5,u);break;case 1:if(xr(a,u),d&4)if(a=u.stateNode,c===null)try{a.componentDidMount()}catch(T){st(u,u.return,T)}else{var p=Ei(u.type,c.memoizedProps);c=c.memoizedState;try{a.componentDidUpdate(p,c,a.__reactInternalSnapshotBeforeUpdate)}catch(T){st(u,u.return,T)}}d&64&&R0(u),d&512&&hc(u,u.return);break;case 3:if(xr(a,u),d&64&&(a=u.updateQueue,a!==null)){if(c=null,u.child!==null)switch(u.child.tag){case 27:case 5:c=u.child.stateNode;break;case 1:c=u.child.stateNode}try{pT(a,c)}catch(T){st(u,u.return,T)}}break;case 27:c===null&&d&4&&O0(u);case 26:case 5:xr(a,u),c===null&&d&4&&I0(u),d&512&&hc(u,u.return);break;case 12:xr(a,u);break;case 13:xr(a,u),d&4&&U0(a,u),d&64&&(a=u.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(u=zI.bind(null,u),cM(a,u))));break;case 22:if(d=u.memoizedState!==null||nr,!d){c=c!==null&&c.memoizedState!==null||yt,p=nr;var _=yt;nr=d,(yt=c)&&!_?Ir(a,u,(u.subtreeFlags&8772)!==0):xr(a,u),nr=p,yt=_}break;case 30:break;default:xr(a,u)}}function F0(a){var c=a.alternate;c!==null&&(a.alternate=null,F0(c)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(c=a.stateNode,c!==null&&bd(c)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var lt=null,cn=!1;function sr(a,c,u){for(u=u.child;u!==null;)P0(a,c,u),u=u.sibling}function P0(a,c,u){if(yn&&typeof yn.onCommitFiberUnmount=="function")try{yn.onCommitFiberUnmount(Da,u)}catch{}switch(u.tag){case 26:yt||Rs(u,c),sr(a,c,u),u.memoizedState?u.memoizedState.count--:u.stateNode&&(u=u.stateNode,u.parentNode.removeChild(u));break;case 27:yt||Rs(u,c);var d=lt,p=cn;Pr(u.type)&&(lt=u.stateNode,cn=!1),sr(a,c,u),Tc(u.stateNode),lt=d,cn=p;break;case 5:yt||Rs(u,c);case 6:if(d=lt,p=cn,lt=null,sr(a,c,u),lt=d,cn=p,lt!==null)if(cn)try{(lt.nodeType===9?lt.body:lt.nodeName==="HTML"?lt.ownerDocument.body:lt).removeChild(u.stateNode)}catch(_){st(u,c,_)}else try{lt.removeChild(u.stateNode)}catch(_){st(u,c,_)}break;case 18:lt!==null&&(cn?(a=lt,vE(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,u.stateNode),xc(a)):vE(lt,u.stateNode));break;case 4:d=lt,p=cn,lt=u.stateNode.containerInfo,cn=!0,sr(a,c,u),lt=d,cn=p;break;case 0:case 11:case 14:case 15:yt||Rr(2,u,c),yt||Rr(4,u,c),sr(a,c,u);break;case 1:yt||(Rs(u,c),d=u.stateNode,typeof d.componentWillUnmount=="function"&&x0(u,c,d)),sr(a,c,u);break;case 21:sr(a,c,u);break;case 22:yt=(d=yt)||u.memoizedState!==null,sr(a,c,u),yt=d;break;default:sr(a,c,u)}}function U0(a,c){if(c.memoizedState===null&&(a=c.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{xc(a)}catch(u){st(c,c.return,u)}}function PI(a){switch(a.tag){case 13:case 19:var c=a.stateNode;return c===null&&(c=a.stateNode=new D0),c;case 22:return a=a.stateNode,c=a._retryCache,c===null&&(c=a._retryCache=new D0),c;default:throw Error(s(435,a.tag))}}function Vg(a,c){var u=PI(a);c.forEach(function(d){var p=$I.bind(null,a,d);u.has(d)||(u.add(d),d.then(p,p))})}function Cn(a,c){var u=c.deletions;if(u!==null)for(var d=0;d<u.length;d++){var p=u[d],_=a,T=c,C=T;e:for(;C!==null;){switch(C.tag){case 27:if(Pr(C.type)){lt=C.stateNode,cn=!1;break e}break;case 5:lt=C.stateNode,cn=!1;break e;case 3:case 4:lt=C.stateNode.containerInfo,cn=!0;break e}C=C.return}if(lt===null)throw Error(s(160));P0(_,T,p),lt=null,cn=!1,_=p.alternate,_!==null&&(_.return=null),p.return=null}if(c.subtreeFlags&13878)for(c=c.child;c!==null;)L0(c,a),c=c.sibling}var cs=null;function L0(a,c){var u=a.alternate,d=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:Cn(c,a),vn(a),d&4&&(Rr(3,a,a.return),fc(3,a),Rr(5,a,a.return));break;case 1:Cn(c,a),vn(a),d&512&&(yt||u===null||Rs(u,u.return)),d&64&&nr&&(a=a.updateQueue,a!==null&&(d=a.callbacks,d!==null&&(u=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=u===null?d:u.concat(d))));break;case 26:var p=cs;if(Cn(c,a),vn(a),d&512&&(yt||u===null||Rs(u,u.return)),d&4){var _=u!==null?u.memoizedState:null;if(d=a.memoizedState,u===null)if(d===null)if(a.stateNode===null){e:{d=a.type,u=a.memoizedProps,p=p.ownerDocument||p;t:switch(d){case"title":_=p.getElementsByTagName("title")[0],(!_||_[Pa]||_[$t]||_.namespaceURI==="http://www.w3.org/2000/svg"||_.hasAttribute("itemprop"))&&(_=p.createElement(d),p.head.insertBefore(_,p.querySelector("head > title"))),Vt(_,d,u),_[$t]=a,Dt(_),d=_;break e;case"link":var T=OE("link","href",p).get(d+(u.href||""));if(T){for(var C=0;C<T.length;C++)if(_=T[C],_.getAttribute("href")===(u.href==null||u.href===""?null:u.href)&&_.getAttribute("rel")===(u.rel==null?null:u.rel)&&_.getAttribute("title")===(u.title==null?null:u.title)&&_.getAttribute("crossorigin")===(u.crossOrigin==null?null:u.crossOrigin)){T.splice(C,1);break t}}_=p.createElement(d),Vt(_,d,u),p.head.appendChild(_);break;case"meta":if(T=OE("meta","content",p).get(d+(u.content||""))){for(C=0;C<T.length;C++)if(_=T[C],_.getAttribute("content")===(u.content==null?null:""+u.content)&&_.getAttribute("name")===(u.name==null?null:u.name)&&_.getAttribute("property")===(u.property==null?null:u.property)&&_.getAttribute("http-equiv")===(u.httpEquiv==null?null:u.httpEquiv)&&_.getAttribute("charset")===(u.charSet==null?null:u.charSet)){T.splice(C,1);break t}}_=p.createElement(d),Vt(_,d,u),p.head.appendChild(_);break;default:throw Error(s(468,d))}_[$t]=a,Dt(_),d=_}a.stateNode=d}else DE(p,a.type,a.stateNode);else a.stateNode=ME(p,d,a.memoizedProps);else _!==d?(_===null?u.stateNode!==null&&(u=u.stateNode,u.parentNode.removeChild(u)):_.count--,d===null?DE(p,a.type,a.stateNode):ME(p,d,a.memoizedProps)):d===null&&a.stateNode!==null&&Lg(a,a.memoizedProps,u.memoizedProps)}break;case 27:Cn(c,a),vn(a),d&512&&(yt||u===null||Rs(u,u.return)),u!==null&&d&4&&Lg(a,a.memoizedProps,u.memoizedProps);break;case 5:if(Cn(c,a),vn(a),d&512&&(yt||u===null||Rs(u,u.return)),a.flags&32){p=a.stateNode;try{no(p,"")}catch(X){st(a,a.return,X)}}d&4&&a.stateNode!=null&&(p=a.memoizedProps,Lg(a,p,u!==null?u.memoizedProps:p)),d&1024&&(Gg=!0);break;case 6:if(Cn(c,a),vn(a),d&4){if(a.stateNode===null)throw Error(s(162));d=a.memoizedProps,u=a.stateNode;try{u.nodeValue=d}catch(X){st(a,a.return,X)}}break;case 3:if(Vu=null,p=cs,cs=Hu(c.containerInfo),Cn(c,a),cs=p,vn(a),d&4&&u!==null&&u.memoizedState.isDehydrated)try{xc(c.containerInfo)}catch(X){st(a,a.return,X)}Gg&&(Gg=!1,k0(a));break;case 4:d=cs,cs=Hu(a.stateNode.containerInfo),Cn(c,a),vn(a),cs=d;break;case 12:Cn(c,a),vn(a);break;case 13:Cn(c,a),vn(a),a.child.flags&8192&&a.memoizedState!==null!=(u!==null&&u.memoizedState!==null)&&(Wg=Bs()),d&4&&(d=a.updateQueue,d!==null&&(a.updateQueue=null,Vg(a,d)));break;case 22:p=a.memoizedState!==null;var I=u!==null&&u.memoizedState!==null,j=nr,Y=yt;if(nr=j||p,yt=Y||I,Cn(c,a),yt=Y,nr=j,vn(a),d&8192)e:for(c=a.stateNode,c._visibility=p?c._visibility&-2:c._visibility|1,p&&(u===null||I||nr||yt||Ci(a)),u=null,c=a;;){if(c.tag===5||c.tag===26){if(u===null){I=u=c;try{if(_=I.stateNode,p)T=_.style,typeof T.setProperty=="function"?T.setProperty("display","none","important"):T.display="none";else{C=I.stateNode;var Q=I.memoizedProps.style,$=Q!=null&&Q.hasOwnProperty("display")?Q.display:null;C.style.display=$==null||typeof $=="boolean"?"":(""+$).trim()}}catch(X){st(I,I.return,X)}}}else if(c.tag===6){if(u===null){I=c;try{I.stateNode.nodeValue=p?"":I.memoizedProps}catch(X){st(I,I.return,X)}}}else if((c.tag!==22&&c.tag!==23||c.memoizedState===null||c===a)&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===a)break e;for(;c.sibling===null;){if(c.return===null||c.return===a)break e;u===c&&(u=null),c=c.return}u===c&&(u=null),c.sibling.return=c.return,c=c.sibling}d&4&&(d=a.updateQueue,d!==null&&(u=d.retryQueue,u!==null&&(d.retryQueue=null,Vg(a,u))));break;case 19:Cn(c,a),vn(a),d&4&&(d=a.updateQueue,d!==null&&(a.updateQueue=null,Vg(a,d)));break;case 30:break;case 21:break;default:Cn(c,a),vn(a)}}function vn(a){var c=a.flags;if(c&2){try{for(var u,d=a.return;d!==null;){if(M0(d)){u=d;break}d=d.return}if(u==null)throw Error(s(160));switch(u.tag){case 27:var p=u.stateNode,_=kg(a);wu(a,_,p);break;case 5:var T=u.stateNode;u.flags&32&&(no(T,""),u.flags&=-33);var C=kg(a);wu(a,C,T);break;case 3:case 4:var I=u.stateNode.containerInfo,j=kg(a);Hg(a,j,I);break;default:throw Error(s(161))}}catch(Y){st(a,a.return,Y)}a.flags&=-3}c&4096&&(a.flags&=-4097)}function k0(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var c=a;k0(c),c.tag===5&&c.flags&1024&&c.stateNode.reset(),a=a.sibling}}function xr(a,c){if(c.subtreeFlags&8772)for(c=c.child;c!==null;)N0(a,c.alternate,c),c=c.sibling}function Ci(a){for(a=a.child;a!==null;){var c=a;switch(c.tag){case 0:case 11:case 14:case 15:Rr(4,c,c.return),Ci(c);break;case 1:Rs(c,c.return);var u=c.stateNode;typeof u.componentWillUnmount=="function"&&x0(c,c.return,u),Ci(c);break;case 27:Tc(c.stateNode);case 26:case 5:Rs(c,c.return),Ci(c);break;case 22:c.memoizedState===null&&Ci(c);break;case 30:Ci(c);break;default:Ci(c)}a=a.sibling}}function Ir(a,c,u){for(u=u&&(c.subtreeFlags&8772)!==0,c=c.child;c!==null;){var d=c.alternate,p=a,_=c,T=_.flags;switch(_.tag){case 0:case 11:case 15:Ir(p,_,u),fc(4,_);break;case 1:if(Ir(p,_,u),d=_,p=d.stateNode,typeof p.componentDidMount=="function")try{p.componentDidMount()}catch(j){st(d,d.return,j)}if(d=_,p=d.updateQueue,p!==null){var C=d.stateNode;try{var I=p.shared.hiddenCallbacks;if(I!==null)for(p.shared.hiddenCallbacks=null,p=0;p<I.length;p++)gT(I[p],C)}catch(j){st(d,d.return,j)}}u&&T&64&&R0(_),hc(_,_.return);break;case 27:O0(_);case 26:case 5:Ir(p,_,u),u&&d===null&&T&4&&I0(_),hc(_,_.return);break;case 12:Ir(p,_,u);break;case 13:Ir(p,_,u),u&&T&4&&U0(p,_);break;case 22:_.memoizedState===null&&Ir(p,_,u),hc(_,_.return);break;case 30:break;default:Ir(p,_,u)}c=c.sibling}}function jg(a,c){var u=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(u=a.memoizedState.cachePool.pool),a=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(a=c.memoizedState.cachePool.pool),a!==u&&(a!=null&&a.refCount++,u!=null&&qa(u))}function zg(a,c){a=null,c.alternate!==null&&(a=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==a&&(c.refCount++,a!=null&&qa(a))}function xs(a,c,u,d){if(c.subtreeFlags&10256)for(c=c.child;c!==null;)H0(a,c,u,d),c=c.sibling}function H0(a,c,u,d){var p=c.flags;switch(c.tag){case 0:case 11:case 15:xs(a,c,u,d),p&2048&&fc(9,c);break;case 1:xs(a,c,u,d);break;case 3:xs(a,c,u,d),p&2048&&(a=null,c.alternate!==null&&(a=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==a&&(c.refCount++,a!=null&&qa(a)));break;case 12:if(p&2048){xs(a,c,u,d),a=c.stateNode;try{var _=c.memoizedProps,T=_.id,C=_.onPostCommit;typeof C=="function"&&C(T,c.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(I){st(c,c.return,I)}}else xs(a,c,u,d);break;case 13:xs(a,c,u,d);break;case 23:break;case 22:_=c.stateNode,T=c.alternate,c.memoizedState!==null?_._visibility&2?xs(a,c,u,d):dc(a,c):_._visibility&2?xs(a,c,u,d):(_._visibility|=2,Eo(a,c,u,d,(c.subtreeFlags&10256)!==0)),p&2048&&jg(T,c);break;case 24:xs(a,c,u,d),p&2048&&zg(c.alternate,c);break;default:xs(a,c,u,d)}}function Eo(a,c,u,d,p){for(p=p&&(c.subtreeFlags&10256)!==0,c=c.child;c!==null;){var _=a,T=c,C=u,I=d,j=T.flags;switch(T.tag){case 0:case 11:case 15:Eo(_,T,C,I,p),fc(8,T);break;case 23:break;case 22:var Y=T.stateNode;T.memoizedState!==null?Y._visibility&2?Eo(_,T,C,I,p):dc(_,T):(Y._visibility|=2,Eo(_,T,C,I,p)),p&&j&2048&&jg(T.alternate,T);break;case 24:Eo(_,T,C,I,p),p&&j&2048&&zg(T.alternate,T);break;default:Eo(_,T,C,I,p)}c=c.sibling}}function dc(a,c){if(c.subtreeFlags&10256)for(c=c.child;c!==null;){var u=a,d=c,p=d.flags;switch(d.tag){case 22:dc(u,d),p&2048&&jg(d.alternate,d);break;case 24:dc(u,d),p&2048&&zg(d.alternate,d);break;default:dc(u,d)}c=c.sibling}}var gc=8192;function Co(a){if(a.subtreeFlags&gc)for(a=a.child;a!==null;)G0(a),a=a.sibling}function G0(a){switch(a.tag){case 26:Co(a),a.flags&gc&&a.memoizedState!==null&&TM(cs,a.memoizedState,a.memoizedProps);break;case 5:Co(a);break;case 3:case 4:var c=cs;cs=Hu(a.stateNode.containerInfo),Co(a),cs=c;break;case 22:a.memoizedState===null&&(c=a.alternate,c!==null&&c.memoizedState!==null?(c=gc,gc=16777216,Co(a),gc=c):Co(a));break;default:Co(a)}}function V0(a){var c=a.alternate;if(c!==null&&(a=c.child,a!==null)){c.child=null;do c=a.sibling,a.sibling=null,a=c;while(a!==null)}}function pc(a){var c=a.deletions;if((a.flags&16)!==0){if(c!==null)for(var u=0;u<c.length;u++){var d=c[u];Ft=d,z0(d,a)}V0(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)j0(a),a=a.sibling}function j0(a){switch(a.tag){case 0:case 11:case 15:pc(a),a.flags&2048&&Rr(9,a,a.return);break;case 3:pc(a);break;case 12:pc(a);break;case 22:var c=a.stateNode;a.memoizedState!==null&&c._visibility&2&&(a.return===null||a.return.tag!==13)?(c._visibility&=-3,Ru(a)):pc(a);break;default:pc(a)}}function Ru(a){var c=a.deletions;if((a.flags&16)!==0){if(c!==null)for(var u=0;u<c.length;u++){var d=c[u];Ft=d,z0(d,a)}V0(a)}for(a=a.child;a!==null;){switch(c=a,c.tag){case 0:case 11:case 15:Rr(8,c,c.return),Ru(c);break;case 22:u=c.stateNode,u._visibility&2&&(u._visibility&=-3,Ru(c));break;default:Ru(c)}a=a.sibling}}function z0(a,c){for(;Ft!==null;){var u=Ft;switch(u.tag){case 0:case 11:case 15:Rr(8,u,c);break;case 23:case 22:if(u.memoizedState!==null&&u.memoizedState.cachePool!==null){var d=u.memoizedState.cachePool.pool;d!=null&&d.refCount++}break;case 24:qa(u.memoizedState.cache)}if(d=u.child,d!==null)d.return=u,Ft=d;else e:for(u=a;Ft!==null;){d=Ft;var p=d.sibling,_=d.return;if(F0(d),d===u){Ft=null;break e}if(p!==null){p.return=_,Ft=p;break e}Ft=_}}}var UI={getCacheForType:function(a){var c=Xt(wt),u=c.data.get(a);return u===void 0&&(u=a(),c.data.set(a,u)),u}},LI=typeof WeakMap=="function"?WeakMap:Map,Ye=0,ot=null,xe=null,Ne=0,Ke=0,Bn=null,Mr=!1,vo=!1,$g=!1,rr=0,pt=0,Or=0,vi=0,Xg=0,zn=0,Bo=0,mc=null,ln=null,Jg=!1,Wg=0,xu=1/0,Iu=null,Dr=null,Gt=0,Nr=null,So=null,wo=0,Yg=0,Kg=null,$0=null,_c=0,qg=null;function Sn(){if((Ye&2)!==0&&Ne!==0)return Ne&-Ne;if(W.T!==null){var a=go;return a!==0?a:rp()}return ab()}function X0(){zn===0&&(zn=(Ne&536870912)===0||$e?sb():536870912);var a=jn.current;return a!==null&&(a.flags|=32),zn}function wn(a,c,u){(a===ot&&(Ke===2||Ke===9)||a.cancelPendingCommit!==null)&&(Ro(a,0),Fr(a,Ne,zn,!1)),Fa(a,u),((Ye&2)===0||a!==ot)&&(a===ot&&((Ye&2)===0&&(vi|=u),pt===4&&Fr(a,Ne,zn,!1)),Is(a))}function J0(a,c,u){if((Ye&6)!==0)throw Error(s(327));var d=!u&&(c&124)===0&&(c&a.expiredLanes)===0||Na(a,c),p=d?GI(a,c):ep(a,c,!0),_=d;do{if(p===0){vo&&!d&&Fr(a,c,0,!1);break}else{if(u=a.current.alternate,_&&!kI(u)){p=ep(a,c,!1),_=!1;continue}if(p===2){if(_=c,a.errorRecoveryDisabledLanes&_)var T=0;else T=a.pendingLanes&-536870913,T=T!==0?T:T&536870912?536870912:0;if(T!==0){c=T;e:{var C=a;p=mc;var I=C.current.memoizedState.isDehydrated;if(I&&(Ro(C,T).flags|=256),T=ep(C,T,!1),T!==2){if($g&&!I){C.errorRecoveryDisabledLanes|=_,vi|=_,p=4;break e}_=ln,ln=p,_!==null&&(ln===null?ln=_:ln.push.apply(ln,_))}p=T}if(_=!1,p!==2)continue}}if(p===1){Ro(a,0),Fr(a,c,0,!0);break}e:{switch(d=a,_=p,_){case 0:case 1:throw Error(s(345));case 4:if((c&4194048)!==c)break;case 6:Fr(d,c,zn,!Mr);break e;case 2:ln=null;break;case 3:case 5:break;default:throw Error(s(329))}if((c&62914560)===c&&(p=Wg+300-Bs(),10<p)){if(Fr(d,c,zn,!Mr),Gl(d,0,!0)!==0)break e;d.timeoutHandle=EE(W0.bind(null,d,u,ln,Iu,Jg,c,zn,vi,Bo,Mr,_,2,-0,0),p);break e}W0(d,u,ln,Iu,Jg,c,zn,vi,Bo,Mr,_,0,-0,0)}}break}while(!0);Is(a)}function W0(a,c,u,d,p,_,T,C,I,j,Y,Q,$,X){if(a.timeoutHandle=-1,Q=c.subtreeFlags,(Q&8192||(Q&16785408)===16785408)&&(vc={stylesheets:null,count:0,unsuspend:bM},G0(c),Q=EM(),Q!==null)){a.cancelPendingCommit=Q(tE.bind(null,a,c,_,u,d,p,T,C,I,Y,1,$,X)),Fr(a,_,T,!j);return}tE(a,c,_,u,d,p,T,C,I)}function kI(a){for(var c=a;;){var u=c.tag;if((u===0||u===11||u===15)&&c.flags&16384&&(u=c.updateQueue,u!==null&&(u=u.stores,u!==null)))for(var d=0;d<u.length;d++){var p=u[d],_=p.getSnapshot;p=p.value;try{if(!Tn(_(),p))return!1}catch{return!1}}if(u=c.child,c.subtreeFlags&16384&&u!==null)u.return=c,c=u;else{if(c===a)break;for(;c.sibling===null;){if(c.return===null||c.return===a)return!0;c=c.return}c.sibling.return=c.return,c=c.sibling}}return!0}function Fr(a,c,u,d){c&=~Xg,c&=~vi,a.suspendedLanes|=c,a.pingedLanes&=~c,d&&(a.warmLanes|=c),d=a.expirationTimes;for(var p=c;0<p;){var _=31-bn(p),T=1<<_;d[_]=-1,p&=~T}u!==0&&ib(a,u,c)}function Mu(){return(Ye&6)===0?(Ac(0),!1):!0}function Qg(){if(xe!==null){if(Ke===0)var a=xe.return;else a=xe,Ks=Ai=null,pg(a),bo=null,cc=0,a=xe;for(;a!==null;)w0(a.alternate,a),a=a.return;xe=null}}function Ro(a,c){var u=a.timeoutHandle;u!==-1&&(a.timeoutHandle=-1,sM(u)),u=a.cancelPendingCommit,u!==null&&(a.cancelPendingCommit=null,u()),Qg(),ot=a,xe=u=Js(a.current,null),Ne=c,Ke=0,Bn=null,Mr=!1,vo=Na(a,c),$g=!1,Bo=zn=Xg=vi=Or=pt=0,ln=mc=null,Jg=!1,(c&8)!==0&&(c|=c&32);var d=a.entangledLanes;if(d!==0)for(a=a.entanglements,d&=c;0<d;){var p=31-bn(d),_=1<<p;c|=a[p],d&=~_}return rr=c,Zl(),u}function Y0(a,c){Se=null,W.H=Au,c===Za||c===cu?(c=hT(),Ke=3):c===lT?(c=hT(),Ke=4):Ke=c===d0?8:c!==null&&typeof c=="object"&&typeof c.then=="function"?6:1,Bn=c,xe===null&&(pt=1,Cu(a,kn(c,a.current)))}function K0(){var a=W.H;return W.H=Au,a===null?Au:a}function q0(){var a=W.A;return W.A=UI,a}function Zg(){pt=4,Mr||(Ne&4194048)!==Ne&&jn.current!==null||(vo=!0),(Or&134217727)===0&&(vi&134217727)===0||ot===null||Fr(ot,Ne,zn,!1)}function ep(a,c,u){var d=Ye;Ye|=2;var p=K0(),_=q0();(ot!==a||Ne!==c)&&(Iu=null,Ro(a,c)),c=!1;var T=pt;e:do try{if(Ke!==0&&xe!==null){var C=xe,I=Bn;switch(Ke){case 8:Qg(),T=6;break e;case 3:case 2:case 9:case 6:jn.current===null&&(c=!0);var j=Ke;if(Ke=0,Bn=null,xo(a,C,I,j),u&&vo){T=0;break e}break;default:j=Ke,Ke=0,Bn=null,xo(a,C,I,j)}}HI(),T=pt;break}catch(Y){Y0(a,Y)}while(!0);return c&&a.shellSuspendCounter++,Ks=Ai=null,Ye=d,W.H=p,W.A=_,xe===null&&(ot=null,Ne=0,Zl()),T}function HI(){for(;xe!==null;)Q0(xe)}function GI(a,c){var u=Ye;Ye|=2;var d=K0(),p=q0();ot!==a||Ne!==c?(Iu=null,xu=Bs()+500,Ro(a,c)):vo=Na(a,c);e:do try{if(Ke!==0&&xe!==null){c=xe;var _=Bn;t:switch(Ke){case 1:Ke=0,Bn=null,xo(a,c,_,1);break;case 2:case 9:if(uT(_)){Ke=0,Bn=null,Z0(c);break}c=function(){Ke!==2&&Ke!==9||ot!==a||(Ke=7),Is(a)},_.then(c,c);break e;case 3:Ke=7;break e;case 4:Ke=5;break e;case 7:uT(_)?(Ke=0,Bn=null,Z0(c)):(Ke=0,Bn=null,xo(a,c,_,7));break;case 5:var T=null;switch(xe.tag){case 26:T=xe.memoizedState;case 5:case 27:var C=xe;if(!T||NE(T)){Ke=0,Bn=null;var I=C.sibling;if(I!==null)xe=I;else{var j=C.return;j!==null?(xe=j,Ou(j)):xe=null}break t}}Ke=0,Bn=null,xo(a,c,_,5);break;case 6:Ke=0,Bn=null,xo(a,c,_,6);break;case 8:Qg(),pt=6;break e;default:throw Error(s(462))}}VI();break}catch(Y){Y0(a,Y)}while(!0);return Ks=Ai=null,W.H=d,W.A=p,Ye=u,xe!==null?0:(ot=null,Ne=0,Zl(),pt)}function VI(){for(;xe!==null&&!ux();)Q0(xe)}function Q0(a){var c=B0(a.alternate,a,rr);a.memoizedProps=a.pendingProps,c===null?Ou(a):xe=c}function Z0(a){var c=a,u=c.alternate;switch(c.tag){case 15:case 0:c=y0(u,c,c.pendingProps,c.type,void 0,Ne);break;case 11:c=y0(u,c,c.pendingProps,c.type.render,c.ref,Ne);break;case 5:pg(c);default:w0(u,c),c=xe=eT(c,rr),c=B0(u,c,rr)}a.memoizedProps=a.pendingProps,c===null?Ou(a):xe=c}function xo(a,c,u,d){Ks=Ai=null,pg(c),bo=null,cc=0;var p=c.return;try{if(MI(a,p,c,u,Ne)){pt=1,Cu(a,kn(u,a.current)),xe=null;return}}catch(_){if(p!==null)throw xe=p,_;pt=1,Cu(a,kn(u,a.current)),xe=null;return}c.flags&32768?($e||d===1?a=!0:vo||(Ne&536870912)!==0?a=!1:(Mr=a=!0,(d===2||d===9||d===3||d===6)&&(d=jn.current,d!==null&&d.tag===13&&(d.flags|=16384))),eE(c,a)):Ou(c)}function Ou(a){var c=a;do{if((c.flags&32768)!==0){eE(c,Mr);return}a=c.return;var u=DI(c.alternate,c,rr);if(u!==null){xe=u;return}if(c=c.sibling,c!==null){xe=c;return}xe=c=a}while(c!==null);pt===0&&(pt=5)}function eE(a,c){do{var u=NI(a.alternate,a);if(u!==null){u.flags&=32767,xe=u;return}if(u=a.return,u!==null&&(u.flags|=32768,u.subtreeFlags=0,u.deletions=null),!c&&(a=a.sibling,a!==null)){xe=a;return}xe=a=u}while(a!==null);pt=6,xe=null}function tE(a,c,u,d,p,_,T,C,I){a.cancelPendingCommit=null;do Du();while(Gt!==0);if((Ye&6)!==0)throw Error(s(327));if(c!==null){if(c===a.current)throw Error(s(177));if(_=c.lanes|c.childLanes,_|=zd,bx(a,u,_,T,C,I),a===ot&&(xe=ot=null,Ne=0),So=c,Nr=a,wo=u,Yg=_,Kg=p,$0=d,(c.subtreeFlags&10256)!==0||(c.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,XI(Ll,function(){return oE(),null})):(a.callbackNode=null,a.callbackPriority=0),d=(c.flags&13878)!==0,(c.subtreeFlags&13878)!==0||d){d=W.T,W.T=null,p=oe.p,oe.p=2,T=Ye,Ye|=4;try{FI(a,c,u)}finally{Ye=T,oe.p=p,W.T=d}}Gt=1,nE(),sE(),rE()}}function nE(){if(Gt===1){Gt=0;var a=Nr,c=So,u=(c.flags&13878)!==0;if((c.subtreeFlags&13878)!==0||u){u=W.T,W.T=null;var d=oe.p;oe.p=2;var p=Ye;Ye|=4;try{L0(c,a);var _=hp,T=zb(a.containerInfo),C=_.focusedElem,I=_.selectionRange;if(T!==C&&C&&C.ownerDocument&&jb(C.ownerDocument.documentElement,C)){if(I!==null&&kd(C)){var j=I.start,Y=I.end;if(Y===void 0&&(Y=j),"selectionStart"in C)C.selectionStart=j,C.selectionEnd=Math.min(Y,C.value.length);else{var Q=C.ownerDocument||document,$=Q&&Q.defaultView||window;if($.getSelection){var X=$.getSelection(),Ee=C.textContent.length,Ae=Math.min(I.start,Ee),et=I.end===void 0?Ae:Math.min(I.end,Ee);!X.extend&&Ae>et&&(T=et,et=Ae,Ae=T);var k=Vb(C,Ae),N=Vb(C,et);if(k&&N&&(X.rangeCount!==1||X.anchorNode!==k.node||X.anchorOffset!==k.offset||X.focusNode!==N.node||X.focusOffset!==N.offset)){var V=Q.createRange();V.setStart(k.node,k.offset),X.removeAllRanges(),Ae>et?(X.addRange(V),X.extend(N.node,N.offset)):(V.setEnd(N.node,N.offset),X.addRange(V))}}}}for(Q=[],X=C;X=X.parentNode;)X.nodeType===1&&Q.push({element:X,left:X.scrollLeft,top:X.scrollTop});for(typeof C.focus=="function"&&C.focus(),C=0;C<Q.length;C++){var K=Q[C];K.element.scrollLeft=K.left,K.element.scrollTop=K.top}}$u=!!fp,hp=fp=null}finally{Ye=p,oe.p=d,W.T=u}}a.current=c,Gt=2}}function sE(){if(Gt===2){Gt=0;var a=Nr,c=So,u=(c.flags&8772)!==0;if((c.subtreeFlags&8772)!==0||u){u=W.T,W.T=null;var d=oe.p;oe.p=2;var p=Ye;Ye|=4;try{N0(a,c.alternate,c)}finally{Ye=p,oe.p=d,W.T=u}}Gt=3}}function rE(){if(Gt===4||Gt===3){Gt=0,fx();var a=Nr,c=So,u=wo,d=$0;(c.subtreeFlags&10256)!==0||(c.flags&10256)!==0?Gt=5:(Gt=0,So=Nr=null,iE(a,a.pendingLanes));var p=a.pendingLanes;if(p===0&&(Dr=null),Ad(u),c=c.stateNode,yn&&typeof yn.onCommitFiberRoot=="function")try{yn.onCommitFiberRoot(Da,c,void 0,(c.current.flags&128)===128)}catch{}if(d!==null){c=W.T,p=oe.p,oe.p=2,W.T=null;try{for(var _=a.onRecoverableError,T=0;T<d.length;T++){var C=d[T];_(C.value,{componentStack:C.stack})}}finally{W.T=c,oe.p=p}}(wo&3)!==0&&Du(),Is(a),p=a.pendingLanes,(u&4194090)!==0&&(p&42)!==0?a===qg?_c++:(_c=0,qg=a):_c=0,Ac(0)}}function iE(a,c){(a.pooledCacheLanes&=c)===0&&(c=a.pooledCache,c!=null&&(a.pooledCache=null,qa(c)))}function Du(a){return nE(),sE(),rE(),oE()}function oE(){if(Gt!==5)return!1;var a=Nr,c=Yg;Yg=0;var u=Ad(wo),d=W.T,p=oe.p;try{oe.p=32>u?32:u,W.T=null,u=Kg,Kg=null;var _=Nr,T=wo;if(Gt=0,So=Nr=null,wo=0,(Ye&6)!==0)throw Error(s(331));var C=Ye;if(Ye|=4,j0(_.current),H0(_,_.current,T,u),Ye=C,Ac(0,!1),yn&&typeof yn.onPostCommitFiberRoot=="function")try{yn.onPostCommitFiberRoot(Da,_)}catch{}return!0}finally{oe.p=p,W.T=d,iE(a,c)}}function aE(a,c,u){c=kn(u,c),c=xg(a.stateNode,c,2),a=vr(a,c,2),a!==null&&(Fa(a,2),Is(a))}function st(a,c,u){if(a.tag===3)aE(a,a,u);else for(;c!==null;){if(c.tag===3){aE(c,a,u);break}else if(c.tag===1){var d=c.stateNode;if(typeof c.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(Dr===null||!Dr.has(d))){a=kn(u,a),u=f0(2),d=vr(c,u,2),d!==null&&(h0(u,d,c,a),Fa(d,2),Is(d));break}}c=c.return}}function tp(a,c,u){var d=a.pingCache;if(d===null){d=a.pingCache=new LI;var p=new Set;d.set(c,p)}else p=d.get(c),p===void 0&&(p=new Set,d.set(c,p));p.has(u)||($g=!0,p.add(u),a=jI.bind(null,a,c,u),c.then(a,a))}function jI(a,c,u){var d=a.pingCache;d!==null&&d.delete(c),a.pingedLanes|=a.suspendedLanes&u,a.warmLanes&=~u,ot===a&&(Ne&u)===u&&(pt===4||pt===3&&(Ne&62914560)===Ne&&300>Bs()-Wg?(Ye&2)===0&&Ro(a,0):Xg|=u,Bo===Ne&&(Bo=0)),Is(a)}function cE(a,c){c===0&&(c=rb()),a=lo(a,c),a!==null&&(Fa(a,c),Is(a))}function zI(a){var c=a.memoizedState,u=0;c!==null&&(u=c.retryLane),cE(a,u)}function $I(a,c){var u=0;switch(a.tag){case 13:var d=a.stateNode,p=a.memoizedState;p!==null&&(u=p.retryLane);break;case 19:d=a.stateNode;break;case 22:d=a.stateNode._retryCache;break;default:throw Error(s(314))}d!==null&&d.delete(c),cE(a,u)}function XI(a,c){return gd(a,c)}var Nu=null,Io=null,np=!1,Fu=!1,sp=!1,Bi=0;function Is(a){a!==Io&&a.next===null&&(Io===null?Nu=Io=a:Io=Io.next=a),Fu=!0,np||(np=!0,WI())}function Ac(a,c){if(!sp&&Fu){sp=!0;do for(var u=!1,d=Nu;d!==null;){if(a!==0){var p=d.pendingLanes;if(p===0)var _=0;else{var T=d.suspendedLanes,C=d.pingedLanes;_=(1<<31-bn(42|a)+1)-1,_&=p&~(T&~C),_=_&201326741?_&201326741|1:_?_|2:0}_!==0&&(u=!0,hE(d,_))}else _=Ne,_=Gl(d,d===ot?_:0,d.cancelPendingCommit!==null||d.timeoutHandle!==-1),(_&3)===0||Na(d,_)||(u=!0,hE(d,_));d=d.next}while(u);sp=!1}}function JI(){lE()}function lE(){Fu=np=!1;var a=0;Bi!==0&&(nM()&&(a=Bi),Bi=0);for(var c=Bs(),u=null,d=Nu;d!==null;){var p=d.next,_=uE(d,c);_===0?(d.next=null,u===null?Nu=p:u.next=p,p===null&&(Io=u)):(u=d,(a!==0||(_&3)!==0)&&(Fu=!0)),d=p}Ac(a)}function uE(a,c){for(var u=a.suspendedLanes,d=a.pingedLanes,p=a.expirationTimes,_=a.pendingLanes&-62914561;0<_;){var T=31-bn(_),C=1<<T,I=p[T];I===-1?((C&u)===0||(C&d)!==0)&&(p[T]=yx(C,c)):I<=c&&(a.expiredLanes|=C),_&=~C}if(c=ot,u=Ne,u=Gl(a,a===c?u:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),d=a.callbackNode,u===0||a===c&&(Ke===2||Ke===9)||a.cancelPendingCommit!==null)return d!==null&&d!==null&&pd(d),a.callbackNode=null,a.callbackPriority=0;if((u&3)===0||Na(a,u)){if(c=u&-u,c===a.callbackPriority)return c;switch(d!==null&&pd(d),Ad(u)){case 2:case 8:u=tb;break;case 32:u=Ll;break;case 268435456:u=nb;break;default:u=Ll}return d=fE.bind(null,a),u=gd(u,d),a.callbackPriority=c,a.callbackNode=u,c}return d!==null&&d!==null&&pd(d),a.callbackPriority=2,a.callbackNode=null,2}function fE(a,c){if(Gt!==0&&Gt!==5)return a.callbackNode=null,a.callbackPriority=0,null;var u=a.callbackNode;if(Du()&&a.callbackNode!==u)return null;var d=Ne;return d=Gl(a,a===ot?d:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),d===0?null:(J0(a,d,c),uE(a,Bs()),a.callbackNode!=null&&a.callbackNode===u?fE.bind(null,a):null)}function hE(a,c){if(Du())return null;J0(a,c,!0)}function WI(){rM(function(){(Ye&6)!==0?gd(eb,JI):lE()})}function rp(){return Bi===0&&(Bi=sb()),Bi}function dE(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:Xl(""+a)}function gE(a,c){var u=c.ownerDocument.createElement("input");return u.name=c.name,u.value=c.value,a.id&&u.setAttribute("form",a.id),c.parentNode.insertBefore(u,c),a=new FormData(a),u.parentNode.removeChild(u),a}function YI(a,c,u,d,p){if(c==="submit"&&u&&u.stateNode===p){var _=dE((p[rn]||null).action),T=d.submitter;T&&(c=(c=T[rn]||null)?dE(c.formAction):T.getAttribute("formAction"),c!==null&&(_=c,T=null));var C=new Kl("action","action",null,d,p);a.push({event:C,listeners:[{instance:null,listener:function(){if(d.defaultPrevented){if(Bi!==0){var I=T?gE(p,T):new FormData(p);vg(u,{pending:!0,data:I,method:p.method,action:_},null,I)}}else typeof _=="function"&&(C.preventDefault(),I=T?gE(p,T):new FormData(p),vg(u,{pending:!0,data:I,method:p.method,action:_},_,I))},currentTarget:p}]})}}for(var ip=0;ip<jd.length;ip++){var op=jd[ip],KI=op.toLowerCase(),qI=op[0].toUpperCase()+op.slice(1);as(KI,"on"+qI)}as(Jb,"onAnimationEnd"),as(Wb,"onAnimationIteration"),as(Yb,"onAnimationStart"),as("dblclick","onDoubleClick"),as("focusin","onFocus"),as("focusout","onBlur"),as(gI,"onTransitionRun"),as(pI,"onTransitionStart"),as(mI,"onTransitionCancel"),as(Kb,"onTransitionEnd"),Zi("onMouseEnter",["mouseout","mouseover"]),Zi("onMouseLeave",["mouseout","mouseover"]),Zi("onPointerEnter",["pointerout","pointerover"]),Zi("onPointerLeave",["pointerout","pointerover"]),li("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),li("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),li("onBeforeInput",["compositionend","keypress","textInput","paste"]),li("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),li("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),li("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var yc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),QI=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(yc));function pE(a,c){c=(c&4)!==0;for(var u=0;u<a.length;u++){var d=a[u],p=d.event;d=d.listeners;e:{var _=void 0;if(c)for(var T=d.length-1;0<=T;T--){var C=d[T],I=C.instance,j=C.currentTarget;if(C=C.listener,I!==_&&p.isPropagationStopped())break e;_=C,p.currentTarget=j;try{_(p)}catch(Y){Eu(Y)}p.currentTarget=null,_=I}else for(T=0;T<d.length;T++){if(C=d[T],I=C.instance,j=C.currentTarget,C=C.listener,I!==_&&p.isPropagationStopped())break e;_=C,p.currentTarget=j;try{_(p)}catch(Y){Eu(Y)}p.currentTarget=null,_=I}}}}function Ie(a,c){var u=c[yd];u===void 0&&(u=c[yd]=new Set);var d=a+"__bubble";u.has(d)||(mE(c,a,2,!1),u.add(d))}function ap(a,c,u){var d=0;c&&(d|=4),mE(u,a,d,c)}var Pu="_reactListening"+Math.random().toString(36).slice(2);function cp(a){if(!a[Pu]){a[Pu]=!0,lb.forEach(function(u){u!=="selectionchange"&&(QI.has(u)||ap(u,!1,a),ap(u,!0,a))});var c=a.nodeType===9?a:a.ownerDocument;c===null||c[Pu]||(c[Pu]=!0,ap("selectionchange",!1,c))}}function mE(a,c,u,d){switch(HE(c)){case 2:var p=BM;break;case 8:p=SM;break;default:p=Ep}u=p.bind(null,c,u,a),p=void 0,!Id||c!=="touchstart"&&c!=="touchmove"&&c!=="wheel"||(p=!0),d?p!==void 0?a.addEventListener(c,u,{capture:!0,passive:p}):a.addEventListener(c,u,!0):p!==void 0?a.addEventListener(c,u,{passive:p}):a.addEventListener(c,u,!1)}function lp(a,c,u,d,p){var _=d;if((c&1)===0&&(c&2)===0&&d!==null)e:for(;;){if(d===null)return;var T=d.tag;if(T===3||T===4){var C=d.stateNode.containerInfo;if(C===p)break;if(T===4)for(T=d.return;T!==null;){var I=T.tag;if((I===3||I===4)&&T.stateNode.containerInfo===p)return;T=T.return}for(;C!==null;){if(T=Ki(C),T===null)return;if(I=T.tag,I===5||I===6||I===26||I===27){d=_=T;continue e}C=C.parentNode}}d=d.return}Cb(function(){var j=_,Y=Rd(u),Q=[];e:{var $=qb.get(a);if($!==void 0){var X=Kl,Ee=a;switch(a){case"keypress":if(Wl(u)===0)break e;case"keydown":case"keyup":X=Xx;break;case"focusin":Ee="focus",X=Nd;break;case"focusout":Ee="blur",X=Nd;break;case"beforeblur":case"afterblur":X=Nd;break;case"click":if(u.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":X=Sb;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":X=Nx;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":X=Yx;break;case Jb:case Wb:case Yb:X=Ux;break;case Kb:X=qx;break;case"scroll":case"scrollend":X=Ox;break;case"wheel":X=Zx;break;case"copy":case"cut":case"paste":X=kx;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":X=Rb;break;case"toggle":case"beforetoggle":X=tI}var Ae=(c&4)!==0,et=!Ae&&(a==="scroll"||a==="scrollend"),k=Ae?$!==null?$+"Capture":null:$;Ae=[];for(var N=j,V;N!==null;){var K=N;if(V=K.stateNode,K=K.tag,K!==5&&K!==26&&K!==27||V===null||k===null||(K=La(N,k),K!=null&&Ae.push(bc(N,K,V))),et)break;N=N.return}0<Ae.length&&($=new X($,Ee,null,u,Y),Q.push({event:$,listeners:Ae}))}}if((c&7)===0){e:{if($=a==="mouseover"||a==="pointerover",X=a==="mouseout"||a==="pointerout",$&&u!==wd&&(Ee=u.relatedTarget||u.fromElement)&&(Ki(Ee)||Ee[Yi]))break e;if((X||$)&&($=Y.window===Y?Y:($=Y.ownerDocument)?$.defaultView||$.parentWindow:window,X?(Ee=u.relatedTarget||u.toElement,X=j,Ee=Ee?Ki(Ee):null,Ee!==null&&(et=i(Ee),Ae=Ee.tag,Ee!==et||Ae!==5&&Ae!==27&&Ae!==6)&&(Ee=null)):(X=null,Ee=j),X!==Ee)){if(Ae=Sb,K="onMouseLeave",k="onMouseEnter",N="mouse",(a==="pointerout"||a==="pointerover")&&(Ae=Rb,K="onPointerLeave",k="onPointerEnter",N="pointer"),et=X==null?$:Ua(X),V=Ee==null?$:Ua(Ee),$=new Ae(K,N+"leave",X,u,Y),$.target=et,$.relatedTarget=V,K=null,Ki(Y)===j&&(Ae=new Ae(k,N+"enter",Ee,u,Y),Ae.target=V,Ae.relatedTarget=et,K=Ae),et=K,X&&Ee)t:{for(Ae=X,k=Ee,N=0,V=Ae;V;V=Mo(V))N++;for(V=0,K=k;K;K=Mo(K))V++;for(;0<N-V;)Ae=Mo(Ae),N--;for(;0<V-N;)k=Mo(k),V--;for(;N--;){if(Ae===k||k!==null&&Ae===k.alternate)break t;Ae=Mo(Ae),k=Mo(k)}Ae=null}else Ae=null;X!==null&&_E(Q,$,X,Ae,!1),Ee!==null&&et!==null&&_E(Q,et,Ee,Ae,!0)}}e:{if($=j?Ua(j):window,X=$.nodeName&&$.nodeName.toLowerCase(),X==="select"||X==="input"&&$.type==="file")var he=Pb;else if(Nb($))if(Ub)he=fI;else{he=lI;var Re=cI}else X=$.nodeName,!X||X.toLowerCase()!=="input"||$.type!=="checkbox"&&$.type!=="radio"?j&&Sd(j.elementType)&&(he=Pb):he=uI;if(he&&(he=he(a,j))){Fb(Q,he,u,Y);break e}Re&&Re(a,$,j),a==="focusout"&&j&&$.type==="number"&&j.memoizedProps.value!=null&&Bd($,"number",$.value)}switch(Re=j?Ua(j):window,a){case"focusin":(Nb(Re)||Re.contentEditable==="true")&&(oo=Re,Hd=j,Xa=null);break;case"focusout":Xa=Hd=oo=null;break;case"mousedown":Gd=!0;break;case"contextmenu":case"mouseup":case"dragend":Gd=!1,$b(Q,u,Y);break;case"selectionchange":if(dI)break;case"keydown":case"keyup":$b(Q,u,Y)}var de;if(Pd)e:{switch(a){case"compositionstart":var be="onCompositionStart";break e;case"compositionend":be="onCompositionEnd";break e;case"compositionupdate":be="onCompositionUpdate";break e}be=void 0}else io?Ob(a,u)&&(be="onCompositionEnd"):a==="keydown"&&u.keyCode===229&&(be="onCompositionStart");be&&(xb&&u.locale!=="ko"&&(io||be!=="onCompositionStart"?be==="onCompositionEnd"&&io&&(de=vb()):(br=Y,Md="value"in br?br.value:br.textContent,io=!0)),Re=Uu(j,be),0<Re.length&&(be=new wb(be,a,null,u,Y),Q.push({event:be,listeners:Re}),de?be.data=de:(de=Db(u),de!==null&&(be.data=de)))),(de=sI?rI(a,u):iI(a,u))&&(be=Uu(j,"onBeforeInput"),0<be.length&&(Re=new wb("onBeforeInput","beforeinput",null,u,Y),Q.push({event:Re,listeners:be}),Re.data=de)),YI(Q,a,j,u,Y)}pE(Q,c)})}function bc(a,c,u){return{instance:a,listener:c,currentTarget:u}}function Uu(a,c){for(var u=c+"Capture",d=[];a!==null;){var p=a,_=p.stateNode;if(p=p.tag,p!==5&&p!==26&&p!==27||_===null||(p=La(a,u),p!=null&&d.unshift(bc(a,p,_)),p=La(a,c),p!=null&&d.push(bc(a,p,_))),a.tag===3)return d;a=a.return}return[]}function Mo(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function _E(a,c,u,d,p){for(var _=c._reactName,T=[];u!==null&&u!==d;){var C=u,I=C.alternate,j=C.stateNode;if(C=C.tag,I!==null&&I===d)break;C!==5&&C!==26&&C!==27||j===null||(I=j,p?(j=La(u,_),j!=null&&T.unshift(bc(u,j,I))):p||(j=La(u,_),j!=null&&T.push(bc(u,j,I)))),u=u.return}T.length!==0&&a.push({event:c,listeners:T})}var ZI=/\r\n?/g,eM=/\u0000|\uFFFD/g;function AE(a){return(typeof a=="string"?a:""+a).replace(ZI,`
`).replace(eM,"")}function yE(a,c){return c=AE(c),AE(a)===c}function Lu(){}function Ze(a,c,u,d,p,_){switch(u){case"children":typeof d=="string"?c==="body"||c==="textarea"&&d===""||no(a,d):(typeof d=="number"||typeof d=="bigint")&&c!=="body"&&no(a,""+d);break;case"className":jl(a,"class",d);break;case"tabIndex":jl(a,"tabindex",d);break;case"dir":case"role":case"viewBox":case"width":case"height":jl(a,u,d);break;case"style":Tb(a,d,_);break;case"data":if(c!=="object"){jl(a,"data",d);break}case"src":case"href":if(d===""&&(c!=="a"||u!=="href")){a.removeAttribute(u);break}if(d==null||typeof d=="function"||typeof d=="symbol"||typeof d=="boolean"){a.removeAttribute(u);break}d=Xl(""+d),a.setAttribute(u,d);break;case"action":case"formAction":if(typeof d=="function"){a.setAttribute(u,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof _=="function"&&(u==="formAction"?(c!=="input"&&Ze(a,c,"name",p.name,p,null),Ze(a,c,"formEncType",p.formEncType,p,null),Ze(a,c,"formMethod",p.formMethod,p,null),Ze(a,c,"formTarget",p.formTarget,p,null)):(Ze(a,c,"encType",p.encType,p,null),Ze(a,c,"method",p.method,p,null),Ze(a,c,"target",p.target,p,null)));if(d==null||typeof d=="symbol"||typeof d=="boolean"){a.removeAttribute(u);break}d=Xl(""+d),a.setAttribute(u,d);break;case"onClick":d!=null&&(a.onclick=Lu);break;case"onScroll":d!=null&&Ie("scroll",a);break;case"onScrollEnd":d!=null&&Ie("scrollend",a);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(s(61));if(u=d.__html,u!=null){if(p.children!=null)throw Error(s(60));a.innerHTML=u}}break;case"multiple":a.multiple=d&&typeof d!="function"&&typeof d!="symbol";break;case"muted":a.muted=d&&typeof d!="function"&&typeof d!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(d==null||typeof d=="function"||typeof d=="boolean"||typeof d=="symbol"){a.removeAttribute("xlink:href");break}u=Xl(""+d),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",u);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":d!=null&&typeof d!="function"&&typeof d!="symbol"?a.setAttribute(u,""+d):a.removeAttribute(u);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":d&&typeof d!="function"&&typeof d!="symbol"?a.setAttribute(u,""):a.removeAttribute(u);break;case"capture":case"download":d===!0?a.setAttribute(u,""):d!==!1&&d!=null&&typeof d!="function"&&typeof d!="symbol"?a.setAttribute(u,d):a.removeAttribute(u);break;case"cols":case"rows":case"size":case"span":d!=null&&typeof d!="function"&&typeof d!="symbol"&&!isNaN(d)&&1<=d?a.setAttribute(u,d):a.removeAttribute(u);break;case"rowSpan":case"start":d==null||typeof d=="function"||typeof d=="symbol"||isNaN(d)?a.removeAttribute(u):a.setAttribute(u,d);break;case"popover":Ie("beforetoggle",a),Ie("toggle",a),Vl(a,"popover",d);break;case"xlinkActuate":$s(a,"http://www.w3.org/1999/xlink","xlink:actuate",d);break;case"xlinkArcrole":$s(a,"http://www.w3.org/1999/xlink","xlink:arcrole",d);break;case"xlinkRole":$s(a,"http://www.w3.org/1999/xlink","xlink:role",d);break;case"xlinkShow":$s(a,"http://www.w3.org/1999/xlink","xlink:show",d);break;case"xlinkTitle":$s(a,"http://www.w3.org/1999/xlink","xlink:title",d);break;case"xlinkType":$s(a,"http://www.w3.org/1999/xlink","xlink:type",d);break;case"xmlBase":$s(a,"http://www.w3.org/XML/1998/namespace","xml:base",d);break;case"xmlLang":$s(a,"http://www.w3.org/XML/1998/namespace","xml:lang",d);break;case"xmlSpace":$s(a,"http://www.w3.org/XML/1998/namespace","xml:space",d);break;case"is":Vl(a,"is",d);break;case"innerText":case"textContent":break;default:(!(2<u.length)||u[0]!=="o"&&u[0]!=="O"||u[1]!=="n"&&u[1]!=="N")&&(u=Ix.get(u)||u,Vl(a,u,d))}}function up(a,c,u,d,p,_){switch(u){case"style":Tb(a,d,_);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(s(61));if(u=d.__html,u!=null){if(p.children!=null)throw Error(s(60));a.innerHTML=u}}break;case"children":typeof d=="string"?no(a,d):(typeof d=="number"||typeof d=="bigint")&&no(a,""+d);break;case"onScroll":d!=null&&Ie("scroll",a);break;case"onScrollEnd":d!=null&&Ie("scrollend",a);break;case"onClick":d!=null&&(a.onclick=Lu);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!ub.hasOwnProperty(u))e:{if(u[0]==="o"&&u[1]==="n"&&(p=u.endsWith("Capture"),c=u.slice(2,p?u.length-7:void 0),_=a[rn]||null,_=_!=null?_[u]:null,typeof _=="function"&&a.removeEventListener(c,_,p),typeof d=="function")){typeof _!="function"&&_!==null&&(u in a?a[u]=null:a.hasAttribute(u)&&a.removeAttribute(u)),a.addEventListener(c,d,p);break e}u in a?a[u]=d:d===!0?a.setAttribute(u,""):Vl(a,u,d)}}}function Vt(a,c,u){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ie("error",a),Ie("load",a);var d=!1,p=!1,_;for(_ in u)if(u.hasOwnProperty(_)){var T=u[_];if(T!=null)switch(_){case"src":d=!0;break;case"srcSet":p=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,c));default:Ze(a,c,_,T,u,null)}}p&&Ze(a,c,"srcSet",u.srcSet,u,null),d&&Ze(a,c,"src",u.src,u,null);return;case"input":Ie("invalid",a);var C=_=T=p=null,I=null,j=null;for(d in u)if(u.hasOwnProperty(d)){var Y=u[d];if(Y!=null)switch(d){case"name":p=Y;break;case"type":T=Y;break;case"checked":I=Y;break;case"defaultChecked":j=Y;break;case"value":_=Y;break;case"defaultValue":C=Y;break;case"children":case"dangerouslySetInnerHTML":if(Y!=null)throw Error(s(137,c));break;default:Ze(a,c,d,Y,u,null)}}_b(a,_,C,I,j,T,p,!1),zl(a);return;case"select":Ie("invalid",a),d=T=_=null;for(p in u)if(u.hasOwnProperty(p)&&(C=u[p],C!=null))switch(p){case"value":_=C;break;case"defaultValue":T=C;break;case"multiple":d=C;default:Ze(a,c,p,C,u,null)}c=_,u=T,a.multiple=!!d,c!=null?to(a,!!d,c,!1):u!=null&&to(a,!!d,u,!0);return;case"textarea":Ie("invalid",a),_=p=d=null;for(T in u)if(u.hasOwnProperty(T)&&(C=u[T],C!=null))switch(T){case"value":d=C;break;case"defaultValue":p=C;break;case"children":_=C;break;case"dangerouslySetInnerHTML":if(C!=null)throw Error(s(91));break;default:Ze(a,c,T,C,u,null)}yb(a,d,p,_),zl(a);return;case"option":for(I in u)if(u.hasOwnProperty(I)&&(d=u[I],d!=null))switch(I){case"selected":a.selected=d&&typeof d!="function"&&typeof d!="symbol";break;default:Ze(a,c,I,d,u,null)}return;case"dialog":Ie("beforetoggle",a),Ie("toggle",a),Ie("cancel",a),Ie("close",a);break;case"iframe":case"object":Ie("load",a);break;case"video":case"audio":for(d=0;d<yc.length;d++)Ie(yc[d],a);break;case"image":Ie("error",a),Ie("load",a);break;case"details":Ie("toggle",a);break;case"embed":case"source":case"link":Ie("error",a),Ie("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(j in u)if(u.hasOwnProperty(j)&&(d=u[j],d!=null))switch(j){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,c));default:Ze(a,c,j,d,u,null)}return;default:if(Sd(c)){for(Y in u)u.hasOwnProperty(Y)&&(d=u[Y],d!==void 0&&up(a,c,Y,d,u,void 0));return}}for(C in u)u.hasOwnProperty(C)&&(d=u[C],d!=null&&Ze(a,c,C,d,u,null))}function tM(a,c,u,d){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var p=null,_=null,T=null,C=null,I=null,j=null,Y=null;for(X in u){var Q=u[X];if(u.hasOwnProperty(X)&&Q!=null)switch(X){case"checked":break;case"value":break;case"defaultValue":I=Q;default:d.hasOwnProperty(X)||Ze(a,c,X,null,d,Q)}}for(var $ in d){var X=d[$];if(Q=u[$],d.hasOwnProperty($)&&(X!=null||Q!=null))switch($){case"type":_=X;break;case"name":p=X;break;case"checked":j=X;break;case"defaultChecked":Y=X;break;case"value":T=X;break;case"defaultValue":C=X;break;case"children":case"dangerouslySetInnerHTML":if(X!=null)throw Error(s(137,c));break;default:X!==Q&&Ze(a,c,$,X,d,Q)}}vd(a,T,C,I,j,Y,_,p);return;case"select":X=T=C=$=null;for(_ in u)if(I=u[_],u.hasOwnProperty(_)&&I!=null)switch(_){case"value":break;case"multiple":X=I;default:d.hasOwnProperty(_)||Ze(a,c,_,null,d,I)}for(p in d)if(_=d[p],I=u[p],d.hasOwnProperty(p)&&(_!=null||I!=null))switch(p){case"value":$=_;break;case"defaultValue":C=_;break;case"multiple":T=_;default:_!==I&&Ze(a,c,p,_,d,I)}c=C,u=T,d=X,$!=null?to(a,!!u,$,!1):!!d!=!!u&&(c!=null?to(a,!!u,c,!0):to(a,!!u,u?[]:"",!1));return;case"textarea":X=$=null;for(C in u)if(p=u[C],u.hasOwnProperty(C)&&p!=null&&!d.hasOwnProperty(C))switch(C){case"value":break;case"children":break;default:Ze(a,c,C,null,d,p)}for(T in d)if(p=d[T],_=u[T],d.hasOwnProperty(T)&&(p!=null||_!=null))switch(T){case"value":$=p;break;case"defaultValue":X=p;break;case"children":break;case"dangerouslySetInnerHTML":if(p!=null)throw Error(s(91));break;default:p!==_&&Ze(a,c,T,p,d,_)}Ab(a,$,X);return;case"option":for(var Ee in u)if($=u[Ee],u.hasOwnProperty(Ee)&&$!=null&&!d.hasOwnProperty(Ee))switch(Ee){case"selected":a.selected=!1;break;default:Ze(a,c,Ee,null,d,$)}for(I in d)if($=d[I],X=u[I],d.hasOwnProperty(I)&&$!==X&&($!=null||X!=null))switch(I){case"selected":a.selected=$&&typeof $!="function"&&typeof $!="symbol";break;default:Ze(a,c,I,$,d,X)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ae in u)$=u[Ae],u.hasOwnProperty(Ae)&&$!=null&&!d.hasOwnProperty(Ae)&&Ze(a,c,Ae,null,d,$);for(j in d)if($=d[j],X=u[j],d.hasOwnProperty(j)&&$!==X&&($!=null||X!=null))switch(j){case"children":case"dangerouslySetInnerHTML":if($!=null)throw Error(s(137,c));break;default:Ze(a,c,j,$,d,X)}return;default:if(Sd(c)){for(var et in u)$=u[et],u.hasOwnProperty(et)&&$!==void 0&&!d.hasOwnProperty(et)&&up(a,c,et,void 0,d,$);for(Y in d)$=d[Y],X=u[Y],!d.hasOwnProperty(Y)||$===X||$===void 0&&X===void 0||up(a,c,Y,$,d,X);return}}for(var k in u)$=u[k],u.hasOwnProperty(k)&&$!=null&&!d.hasOwnProperty(k)&&Ze(a,c,k,null,d,$);for(Q in d)$=d[Q],X=u[Q],!d.hasOwnProperty(Q)||$===X||$==null&&X==null||Ze(a,c,Q,$,d,X)}var fp=null,hp=null;function ku(a){return a.nodeType===9?a:a.ownerDocument}function bE(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function TE(a,c){if(a===0)switch(c){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&c==="foreignObject"?0:a}function dp(a,c){return a==="textarea"||a==="noscript"||typeof c.children=="string"||typeof c.children=="number"||typeof c.children=="bigint"||typeof c.dangerouslySetInnerHTML=="object"&&c.dangerouslySetInnerHTML!==null&&c.dangerouslySetInnerHTML.__html!=null}var gp=null;function nM(){var a=window.event;return a&&a.type==="popstate"?a===gp?!1:(gp=a,!0):(gp=null,!1)}var EE=typeof setTimeout=="function"?setTimeout:void 0,sM=typeof clearTimeout=="function"?clearTimeout:void 0,CE=typeof Promise=="function"?Promise:void 0,rM=typeof queueMicrotask=="function"?queueMicrotask:typeof CE<"u"?function(a){return CE.resolve(null).then(a).catch(iM)}:EE;function iM(a){setTimeout(function(){throw a})}function Pr(a){return a==="head"}function vE(a,c){var u=c,d=0,p=0;do{var _=u.nextSibling;if(a.removeChild(u),_&&_.nodeType===8)if(u=_.data,u==="/$"){if(0<d&&8>d){u=d;var T=a.ownerDocument;if(u&1&&Tc(T.documentElement),u&2&&Tc(T.body),u&4)for(u=T.head,Tc(u),T=u.firstChild;T;){var C=T.nextSibling,I=T.nodeName;T[Pa]||I==="SCRIPT"||I==="STYLE"||I==="LINK"&&T.rel.toLowerCase()==="stylesheet"||u.removeChild(T),T=C}}if(p===0){a.removeChild(_),xc(c);return}p--}else u==="$"||u==="$?"||u==="$!"?p++:d=u.charCodeAt(0)-48;else d=0;u=_}while(u);xc(c)}function pp(a){var c=a.firstChild;for(c&&c.nodeType===10&&(c=c.nextSibling);c;){var u=c;switch(c=c.nextSibling,u.nodeName){case"HTML":case"HEAD":case"BODY":pp(u),bd(u);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(u.rel.toLowerCase()==="stylesheet")continue}a.removeChild(u)}}function oM(a,c,u,d){for(;a.nodeType===1;){var p=u;if(a.nodeName.toLowerCase()!==c.toLowerCase()){if(!d&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(d){if(!a[Pa])switch(c){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(_=a.getAttribute("rel"),_==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(_!==p.rel||a.getAttribute("href")!==(p.href==null||p.href===""?null:p.href)||a.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin)||a.getAttribute("title")!==(p.title==null?null:p.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(_=a.getAttribute("src"),(_!==(p.src==null?null:p.src)||a.getAttribute("type")!==(p.type==null?null:p.type)||a.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin))&&_&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(c==="input"&&a.type==="hidden"){var _=p.name==null?null:""+p.name;if(p.type==="hidden"&&a.getAttribute("name")===_)return a}else return a;if(a=ls(a.nextSibling),a===null)break}return null}function aM(a,c,u){if(c==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!u||(a=ls(a.nextSibling),a===null))return null;return a}function mp(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState==="complete"}function cM(a,c){var u=a.ownerDocument;if(a.data!=="$?"||u.readyState==="complete")c();else{var d=function(){c(),u.removeEventListener("DOMContentLoaded",d)};u.addEventListener("DOMContentLoaded",d),a._reactRetry=d}}function ls(a){for(;a!=null;a=a.nextSibling){var c=a.nodeType;if(c===1||c===3)break;if(c===8){if(c=a.data,c==="$"||c==="$!"||c==="$?"||c==="F!"||c==="F")break;if(c==="/$")return null}}return a}var _p=null;function BE(a){a=a.previousSibling;for(var c=0;a;){if(a.nodeType===8){var u=a.data;if(u==="$"||u==="$!"||u==="$?"){if(c===0)return a;c--}else u==="/$"&&c++}a=a.previousSibling}return null}function SE(a,c,u){switch(c=ku(u),a){case"html":if(a=c.documentElement,!a)throw Error(s(452));return a;case"head":if(a=c.head,!a)throw Error(s(453));return a;case"body":if(a=c.body,!a)throw Error(s(454));return a;default:throw Error(s(451))}}function Tc(a){for(var c=a.attributes;c.length;)a.removeAttributeNode(c[0]);bd(a)}var $n=new Map,wE=new Set;function Hu(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var ir=oe.d;oe.d={f:lM,r:uM,D:fM,C:hM,L:dM,m:gM,X:mM,S:pM,M:_M};function lM(){var a=ir.f(),c=Mu();return a||c}function uM(a){var c=qi(a);c!==null&&c.tag===5&&c.type==="form"?JT(c):ir.r(a)}var Oo=typeof document>"u"?null:document;function RE(a,c,u){var d=Oo;if(d&&typeof c=="string"&&c){var p=Ln(c);p='link[rel="'+a+'"][href="'+p+'"]',typeof u=="string"&&(p+='[crossorigin="'+u+'"]'),wE.has(p)||(wE.add(p),a={rel:a,crossOrigin:u,href:c},d.querySelector(p)===null&&(c=d.createElement("link"),Vt(c,"link",a),Dt(c),d.head.appendChild(c)))}}function fM(a){ir.D(a),RE("dns-prefetch",a,null)}function hM(a,c){ir.C(a,c),RE("preconnect",a,c)}function dM(a,c,u){ir.L(a,c,u);var d=Oo;if(d&&a&&c){var p='link[rel="preload"][as="'+Ln(c)+'"]';c==="image"&&u&&u.imageSrcSet?(p+='[imagesrcset="'+Ln(u.imageSrcSet)+'"]',typeof u.imageSizes=="string"&&(p+='[imagesizes="'+Ln(u.imageSizes)+'"]')):p+='[href="'+Ln(a)+'"]';var _=p;switch(c){case"style":_=Do(a);break;case"script":_=No(a)}$n.has(_)||(a=g({rel:"preload",href:c==="image"&&u&&u.imageSrcSet?void 0:a,as:c},u),$n.set(_,a),d.querySelector(p)!==null||c==="style"&&d.querySelector(Ec(_))||c==="script"&&d.querySelector(Cc(_))||(c=d.createElement("link"),Vt(c,"link",a),Dt(c),d.head.appendChild(c)))}}function gM(a,c){ir.m(a,c);var u=Oo;if(u&&a){var d=c&&typeof c.as=="string"?c.as:"script",p='link[rel="modulepreload"][as="'+Ln(d)+'"][href="'+Ln(a)+'"]',_=p;switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":_=No(a)}if(!$n.has(_)&&(a=g({rel:"modulepreload",href:a},c),$n.set(_,a),u.querySelector(p)===null)){switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(u.querySelector(Cc(_)))return}d=u.createElement("link"),Vt(d,"link",a),Dt(d),u.head.appendChild(d)}}}function pM(a,c,u){ir.S(a,c,u);var d=Oo;if(d&&a){var p=Qi(d).hoistableStyles,_=Do(a);c=c||"default";var T=p.get(_);if(!T){var C={loading:0,preload:null};if(T=d.querySelector(Ec(_)))C.loading=5;else{a=g({rel:"stylesheet",href:a,"data-precedence":c},u),(u=$n.get(_))&&Ap(a,u);var I=T=d.createElement("link");Dt(I),Vt(I,"link",a),I._p=new Promise(function(j,Y){I.onload=j,I.onerror=Y}),I.addEventListener("load",function(){C.loading|=1}),I.addEventListener("error",function(){C.loading|=2}),C.loading|=4,Gu(T,c,d)}T={type:"stylesheet",instance:T,count:1,state:C},p.set(_,T)}}}function mM(a,c){ir.X(a,c);var u=Oo;if(u&&a){var d=Qi(u).hoistableScripts,p=No(a),_=d.get(p);_||(_=u.querySelector(Cc(p)),_||(a=g({src:a,async:!0},c),(c=$n.get(p))&&yp(a,c),_=u.createElement("script"),Dt(_),Vt(_,"link",a),u.head.appendChild(_)),_={type:"script",instance:_,count:1,state:null},d.set(p,_))}}function _M(a,c){ir.M(a,c);var u=Oo;if(u&&a){var d=Qi(u).hoistableScripts,p=No(a),_=d.get(p);_||(_=u.querySelector(Cc(p)),_||(a=g({src:a,async:!0,type:"module"},c),(c=$n.get(p))&&yp(a,c),_=u.createElement("script"),Dt(_),Vt(_,"link",a),u.head.appendChild(_)),_={type:"script",instance:_,count:1,state:null},d.set(p,_))}}function xE(a,c,u,d){var p=(p=Ce.current)?Hu(p):null;if(!p)throw Error(s(446));switch(a){case"meta":case"title":return null;case"style":return typeof u.precedence=="string"&&typeof u.href=="string"?(c=Do(u.href),u=Qi(p).hoistableStyles,d=u.get(c),d||(d={type:"style",instance:null,count:0,state:null},u.set(c,d)),d):{type:"void",instance:null,count:0,state:null};case"link":if(u.rel==="stylesheet"&&typeof u.href=="string"&&typeof u.precedence=="string"){a=Do(u.href);var _=Qi(p).hoistableStyles,T=_.get(a);if(T||(p=p.ownerDocument||p,T={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},_.set(a,T),(_=p.querySelector(Ec(a)))&&!_._p&&(T.instance=_,T.state.loading=5),$n.has(a)||(u={rel:"preload",as:"style",href:u.href,crossOrigin:u.crossOrigin,integrity:u.integrity,media:u.media,hrefLang:u.hrefLang,referrerPolicy:u.referrerPolicy},$n.set(a,u),_||AM(p,a,u,T.state))),c&&d===null)throw Error(s(528,""));return T}if(c&&d!==null)throw Error(s(529,""));return null;case"script":return c=u.async,u=u.src,typeof u=="string"&&c&&typeof c!="function"&&typeof c!="symbol"?(c=No(u),u=Qi(p).hoistableScripts,d=u.get(c),d||(d={type:"script",instance:null,count:0,state:null},u.set(c,d)),d):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,a))}}function Do(a){return'href="'+Ln(a)+'"'}function Ec(a){return'link[rel="stylesheet"]['+a+"]"}function IE(a){return g({},a,{"data-precedence":a.precedence,precedence:null})}function AM(a,c,u,d){a.querySelector('link[rel="preload"][as="style"]['+c+"]")?d.loading=1:(c=a.createElement("link"),d.preload=c,c.addEventListener("load",function(){return d.loading|=1}),c.addEventListener("error",function(){return d.loading|=2}),Vt(c,"link",u),Dt(c),a.head.appendChild(c))}function No(a){return'[src="'+Ln(a)+'"]'}function Cc(a){return"script[async]"+a}function ME(a,c,u){if(c.count++,c.instance===null)switch(c.type){case"style":var d=a.querySelector('style[data-href~="'+Ln(u.href)+'"]');if(d)return c.instance=d,Dt(d),d;var p=g({},u,{"data-href":u.href,"data-precedence":u.precedence,href:null,precedence:null});return d=(a.ownerDocument||a).createElement("style"),Dt(d),Vt(d,"style",p),Gu(d,u.precedence,a),c.instance=d;case"stylesheet":p=Do(u.href);var _=a.querySelector(Ec(p));if(_)return c.state.loading|=4,c.instance=_,Dt(_),_;d=IE(u),(p=$n.get(p))&&Ap(d,p),_=(a.ownerDocument||a).createElement("link"),Dt(_);var T=_;return T._p=new Promise(function(C,I){T.onload=C,T.onerror=I}),Vt(_,"link",d),c.state.loading|=4,Gu(_,u.precedence,a),c.instance=_;case"script":return _=No(u.src),(p=a.querySelector(Cc(_)))?(c.instance=p,Dt(p),p):(d=u,(p=$n.get(_))&&(d=g({},u),yp(d,p)),a=a.ownerDocument||a,p=a.createElement("script"),Dt(p),Vt(p,"link",d),a.head.appendChild(p),c.instance=p);case"void":return null;default:throw Error(s(443,c.type))}else c.type==="stylesheet"&&(c.state.loading&4)===0&&(d=c.instance,c.state.loading|=4,Gu(d,u.precedence,a));return c.instance}function Gu(a,c,u){for(var d=u.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),p=d.length?d[d.length-1]:null,_=p,T=0;T<d.length;T++){var C=d[T];if(C.dataset.precedence===c)_=C;else if(_!==p)break}_?_.parentNode.insertBefore(a,_.nextSibling):(c=u.nodeType===9?u.head:u,c.insertBefore(a,c.firstChild))}function Ap(a,c){a.crossOrigin==null&&(a.crossOrigin=c.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=c.referrerPolicy),a.title==null&&(a.title=c.title)}function yp(a,c){a.crossOrigin==null&&(a.crossOrigin=c.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=c.referrerPolicy),a.integrity==null&&(a.integrity=c.integrity)}var Vu=null;function OE(a,c,u){if(Vu===null){var d=new Map,p=Vu=new Map;p.set(u,d)}else p=Vu,d=p.get(u),d||(d=new Map,p.set(u,d));if(d.has(a))return d;for(d.set(a,null),u=u.getElementsByTagName(a),p=0;p<u.length;p++){var _=u[p];if(!(_[Pa]||_[$t]||a==="link"&&_.getAttribute("rel")==="stylesheet")&&_.namespaceURI!=="http://www.w3.org/2000/svg"){var T=_.getAttribute(c)||"";T=a+T;var C=d.get(T);C?C.push(_):d.set(T,[_])}}return d}function DE(a,c,u){a=a.ownerDocument||a,a.head.insertBefore(u,c==="title"?a.querySelector("head > title"):null)}function yM(a,c,u){if(u===1||c.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof c.precedence!="string"||typeof c.href!="string"||c.href==="")break;return!0;case"link":if(typeof c.rel!="string"||typeof c.href!="string"||c.href===""||c.onLoad||c.onError)break;switch(c.rel){case"stylesheet":return a=c.disabled,typeof c.precedence=="string"&&a==null;default:return!0}case"script":if(c.async&&typeof c.async!="function"&&typeof c.async!="symbol"&&!c.onLoad&&!c.onError&&c.src&&typeof c.src=="string")return!0}return!1}function NE(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}var vc=null;function bM(){}function TM(a,c,u){if(vc===null)throw Error(s(475));var d=vc;if(c.type==="stylesheet"&&(typeof u.media!="string"||matchMedia(u.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var p=Do(u.href),_=a.querySelector(Ec(p));if(_){a=_._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(d.count++,d=ju.bind(d),a.then(d,d)),c.state.loading|=4,c.instance=_,Dt(_);return}_=a.ownerDocument||a,u=IE(u),(p=$n.get(p))&&Ap(u,p),_=_.createElement("link"),Dt(_);var T=_;T._p=new Promise(function(C,I){T.onload=C,T.onerror=I}),Vt(_,"link",u),c.instance=_}d.stylesheets===null&&(d.stylesheets=new Map),d.stylesheets.set(c,a),(a=c.state.preload)&&(c.state.loading&3)===0&&(d.count++,c=ju.bind(d),a.addEventListener("load",c),a.addEventListener("error",c))}}function EM(){if(vc===null)throw Error(s(475));var a=vc;return a.stylesheets&&a.count===0&&bp(a,a.stylesheets),0<a.count?function(c){var u=setTimeout(function(){if(a.stylesheets&&bp(a,a.stylesheets),a.unsuspend){var d=a.unsuspend;a.unsuspend=null,d()}},6e4);return a.unsuspend=c,function(){a.unsuspend=null,clearTimeout(u)}}:null}function ju(){if(this.count--,this.count===0){if(this.stylesheets)bp(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var zu=null;function bp(a,c){a.stylesheets=null,a.unsuspend!==null&&(a.count++,zu=new Map,c.forEach(CM,a),zu=null,ju.call(a))}function CM(a,c){if(!(c.state.loading&4)){var u=zu.get(a);if(u)var d=u.get(null);else{u=new Map,zu.set(a,u);for(var p=a.querySelectorAll("link[data-precedence],style[data-precedence]"),_=0;_<p.length;_++){var T=p[_];(T.nodeName==="LINK"||T.getAttribute("media")!=="not all")&&(u.set(T.dataset.precedence,T),d=T)}d&&u.set(null,d)}p=c.instance,T=p.getAttribute("data-precedence"),_=u.get(T)||d,_===d&&u.set(null,p),u.set(T,p),this.count++,d=ju.bind(this),p.addEventListener("load",d),p.addEventListener("error",d),_?_.parentNode.insertBefore(p,_.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(p,a.firstChild)),c.state.loading|=4}}var Bc={$$typeof:R,Provider:null,Consumer:null,_currentValue:pe,_currentValue2:pe,_threadCount:0};function vM(a,c,u,d,p,_,T,C){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=md(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=md(0),this.hiddenUpdates=md(null),this.identifierPrefix=d,this.onUncaughtError=p,this.onCaughtError=_,this.onRecoverableError=T,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=C,this.incompleteTransitions=new Map}function FE(a,c,u,d,p,_,T,C,I,j,Y,Q){return a=new vM(a,c,u,T,C,I,j,Q),c=1,_===!0&&(c|=24),_=En(3,null,null,c),a.current=_,_.stateNode=a,c=tg(),c.refCount++,a.pooledCache=c,c.refCount++,_.memoizedState={element:d,isDehydrated:u,cache:c},ig(_),a}function PE(a){return a?(a=uo,a):uo}function UE(a,c,u,d,p,_){p=PE(p),d.context===null?d.context=p:d.pendingContext=p,d=Cr(c),d.payload={element:u},_=_===void 0?null:_,_!==null&&(d.callback=_),u=vr(a,d,c),u!==null&&(wn(u,a,c),tc(u,a,c))}function LE(a,c){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var u=a.retryLane;a.retryLane=u!==0&&u<c?u:c}}function Tp(a,c){LE(a,c),(a=a.alternate)&&LE(a,c)}function kE(a){if(a.tag===13){var c=lo(a,67108864);c!==null&&wn(c,a,67108864),Tp(a,67108864)}}var $u=!0;function BM(a,c,u,d){var p=W.T;W.T=null;var _=oe.p;try{oe.p=2,Ep(a,c,u,d)}finally{oe.p=_,W.T=p}}function SM(a,c,u,d){var p=W.T;W.T=null;var _=oe.p;try{oe.p=8,Ep(a,c,u,d)}finally{oe.p=_,W.T=p}}function Ep(a,c,u,d){if($u){var p=Cp(d);if(p===null)lp(a,c,d,Xu,u),GE(a,d);else if(RM(p,a,c,u,d))d.stopPropagation();else if(GE(a,d),c&4&&-1<wM.indexOf(a)){for(;p!==null;){var _=qi(p);if(_!==null)switch(_.tag){case 3:if(_=_.stateNode,_.current.memoizedState.isDehydrated){var T=ci(_.pendingLanes);if(T!==0){var C=_;for(C.pendingLanes|=2,C.entangledLanes|=2;T;){var I=1<<31-bn(T);C.entanglements[1]|=I,T&=~I}Is(_),(Ye&6)===0&&(xu=Bs()+500,Ac(0))}}break;case 13:C=lo(_,2),C!==null&&wn(C,_,2),Mu(),Tp(_,2)}if(_=Cp(d),_===null&&lp(a,c,d,Xu,u),_===p)break;p=_}p!==null&&d.stopPropagation()}else lp(a,c,d,null,u)}}function Cp(a){return a=Rd(a),vp(a)}var Xu=null;function vp(a){if(Xu=null,a=Ki(a),a!==null){var c=i(a);if(c===null)a=null;else{var u=c.tag;if(u===13){if(a=o(c),a!==null)return a;a=null}else if(u===3){if(c.stateNode.current.memoizedState.isDehydrated)return c.tag===3?c.stateNode.containerInfo:null;a=null}else c!==a&&(a=null)}}return Xu=a,null}function HE(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(hx()){case eb:return 2;case tb:return 8;case Ll:case dx:return 32;case nb:return 268435456;default:return 32}default:return 32}}var Bp=!1,Ur=null,Lr=null,kr=null,Sc=new Map,wc=new Map,Hr=[],wM="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function GE(a,c){switch(a){case"focusin":case"focusout":Ur=null;break;case"dragenter":case"dragleave":Lr=null;break;case"mouseover":case"mouseout":kr=null;break;case"pointerover":case"pointerout":Sc.delete(c.pointerId);break;case"gotpointercapture":case"lostpointercapture":wc.delete(c.pointerId)}}function Rc(a,c,u,d,p,_){return a===null||a.nativeEvent!==_?(a={blockedOn:c,domEventName:u,eventSystemFlags:d,nativeEvent:_,targetContainers:[p]},c!==null&&(c=qi(c),c!==null&&kE(c)),a):(a.eventSystemFlags|=d,c=a.targetContainers,p!==null&&c.indexOf(p)===-1&&c.push(p),a)}function RM(a,c,u,d,p){switch(c){case"focusin":return Ur=Rc(Ur,a,c,u,d,p),!0;case"dragenter":return Lr=Rc(Lr,a,c,u,d,p),!0;case"mouseover":return kr=Rc(kr,a,c,u,d,p),!0;case"pointerover":var _=p.pointerId;return Sc.set(_,Rc(Sc.get(_)||null,a,c,u,d,p)),!0;case"gotpointercapture":return _=p.pointerId,wc.set(_,Rc(wc.get(_)||null,a,c,u,d,p)),!0}return!1}function VE(a){var c=Ki(a.target);if(c!==null){var u=i(c);if(u!==null){if(c=u.tag,c===13){if(c=o(u),c!==null){a.blockedOn=c,Tx(a.priority,function(){if(u.tag===13){var d=Sn();d=_d(d);var p=lo(u,d);p!==null&&wn(p,u,d),Tp(u,d)}});return}}else if(c===3&&u.stateNode.current.memoizedState.isDehydrated){a.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}a.blockedOn=null}function Ju(a){if(a.blockedOn!==null)return!1;for(var c=a.targetContainers;0<c.length;){var u=Cp(a.nativeEvent);if(u===null){u=a.nativeEvent;var d=new u.constructor(u.type,u);wd=d,u.target.dispatchEvent(d),wd=null}else return c=qi(u),c!==null&&kE(c),a.blockedOn=u,!1;c.shift()}return!0}function jE(a,c,u){Ju(a)&&u.delete(c)}function xM(){Bp=!1,Ur!==null&&Ju(Ur)&&(Ur=null),Lr!==null&&Ju(Lr)&&(Lr=null),kr!==null&&Ju(kr)&&(kr=null),Sc.forEach(jE),wc.forEach(jE)}function Wu(a,c){a.blockedOn===c&&(a.blockedOn=null,Bp||(Bp=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,xM)))}var Yu=null;function zE(a){Yu!==a&&(Yu=a,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){Yu===a&&(Yu=null);for(var c=0;c<a.length;c+=3){var u=a[c],d=a[c+1],p=a[c+2];if(typeof d!="function"){if(vp(d||u)===null)continue;break}var _=qi(u);_!==null&&(a.splice(c,3),c-=3,vg(_,{pending:!0,data:p,method:u.method,action:d},d,p))}}))}function xc(a){function c(I){return Wu(I,a)}Ur!==null&&Wu(Ur,a),Lr!==null&&Wu(Lr,a),kr!==null&&Wu(kr,a),Sc.forEach(c),wc.forEach(c);for(var u=0;u<Hr.length;u++){var d=Hr[u];d.blockedOn===a&&(d.blockedOn=null)}for(;0<Hr.length&&(u=Hr[0],u.blockedOn===null);)VE(u),u.blockedOn===null&&Hr.shift();if(u=(a.ownerDocument||a).$$reactFormReplay,u!=null)for(d=0;d<u.length;d+=3){var p=u[d],_=u[d+1],T=p[rn]||null;if(typeof _=="function")T||zE(u);else if(T){var C=null;if(_&&_.hasAttribute("formAction")){if(p=_,T=_[rn]||null)C=T.formAction;else if(vp(p)!==null)continue}else C=T.action;typeof C=="function"?u[d+1]=C:(u.splice(d,3),d-=3),zE(u)}}}function Sp(a){this._internalRoot=a}Ku.prototype.render=Sp.prototype.render=function(a){var c=this._internalRoot;if(c===null)throw Error(s(409));var u=c.current,d=Sn();UE(u,d,a,c,null,null)},Ku.prototype.unmount=Sp.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var c=a.containerInfo;UE(a.current,2,null,a,null,null),Mu(),c[Yi]=null}};function Ku(a){this._internalRoot=a}Ku.prototype.unstable_scheduleHydration=function(a){if(a){var c=ab();a={blockedOn:null,target:a,priority:c};for(var u=0;u<Hr.length&&c!==0&&c<Hr[u].priority;u++);Hr.splice(u,0,a),u===0&&VE(a)}};var $E=e.version;if($E!=="19.1.0")throw Error(s(527,$E,"19.1.0"));oe.findDOMNode=function(a){var c=a._reactInternals;if(c===void 0)throw typeof a.render=="function"?Error(s(188)):(a=Object.keys(a).join(","),Error(s(268,a)));return a=f(c),a=a!==null?h(a):null,a=a===null?null:a.stateNode,a};var IM={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:W,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var qu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!qu.isDisabled&&qu.supportsFiber)try{Da=qu.inject(IM),yn=qu}catch{}}return Mc.createRoot=function(a,c){if(!r(a))throw Error(s(299));var u=!1,d="",p=a0,_=c0,T=l0,C=null;return c!=null&&(c.unstable_strictMode===!0&&(u=!0),c.identifierPrefix!==void 0&&(d=c.identifierPrefix),c.onUncaughtError!==void 0&&(p=c.onUncaughtError),c.onCaughtError!==void 0&&(_=c.onCaughtError),c.onRecoverableError!==void 0&&(T=c.onRecoverableError),c.unstable_transitionCallbacks!==void 0&&(C=c.unstable_transitionCallbacks)),c=FE(a,1,!1,null,null,u,d,p,_,T,C,null),a[Yi]=c.current,cp(a),new Sp(c)},Mc.hydrateRoot=function(a,c,u){if(!r(a))throw Error(s(299));var d=!1,p="",_=a0,T=c0,C=l0,I=null,j=null;return u!=null&&(u.unstable_strictMode===!0&&(d=!0),u.identifierPrefix!==void 0&&(p=u.identifierPrefix),u.onUncaughtError!==void 0&&(_=u.onUncaughtError),u.onCaughtError!==void 0&&(T=u.onCaughtError),u.onRecoverableError!==void 0&&(C=u.onRecoverableError),u.unstable_transitionCallbacks!==void 0&&(I=u.unstable_transitionCallbacks),u.formState!==void 0&&(j=u.formState)),c=FE(a,1,!0,c,u??null,d,p,_,T,C,I,j),c.context=PE(null),u=c.current,d=Sn(),d=_d(d),p=Cr(d),p.callback=null,vr(u,p,d),u=d,c.current.lanes=u,Fa(c,u),Is(c),a[Yi]=c.current,cp(a),new Ku(c)},Mc.version="19.1.0",Mc}var t1;function VM(){if(t1)return xp.exports;t1=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),xp.exports=GM(),xp.exports}var jM=VM();const zM=bS(jM);async function Sl(n,e,t,s){return s._parse(n,e,t,s)}function it(n,e){if(!n)throw new Error(e||"loader assertion failed.")}const Jh=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),n1=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);n1&&parseFloat(n1[1]);const Qu=globalThis,Fo=globalThis.process||{},$M=globalThis.navigator||{};function ES(n){var s,r;if(typeof window<"u"&&((s=window.process)==null?void 0:s.type)==="renderer"||typeof process<"u"&&((r=process.versions)!=null&&r.electron))return!0;const t=typeof navigator<"u"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function zi(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||ES()}function XM(n){return zi()?ES()?"Electron":($M.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const CS="4.1.0";function JM(n){try{const e=window[n],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}class WM{constructor(e,t,s="sessionStorage"){this.storage=JM(s),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function YM(n){let e;return n<10?e=`${n.toFixed(2)}ms`:n<100?e=`${n.toFixed(1)}ms`:n<1e3?e=`${n.toFixed(0)}ms`:e=`${(n/1e3).toFixed(2)}s`,e}function KM(n,e=8){const t=Math.max(e-n.length,0);return`${" ".repeat(t)}${n}`}var Yf;(function(n){n[n.BLACK=30]="BLACK",n[n.RED=31]="RED",n[n.GREEN=32]="GREEN",n[n.YELLOW=33]="YELLOW",n[n.BLUE=34]="BLUE",n[n.MAGENTA=35]="MAGENTA",n[n.CYAN=36]="CYAN",n[n.WHITE=37]="WHITE",n[n.BRIGHT_BLACK=90]="BRIGHT_BLACK",n[n.BRIGHT_RED=91]="BRIGHT_RED",n[n.BRIGHT_GREEN=92]="BRIGHT_GREEN",n[n.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",n[n.BRIGHT_BLUE=94]="BRIGHT_BLUE",n[n.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",n[n.BRIGHT_CYAN=96]="BRIGHT_CYAN",n[n.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Yf||(Yf={}));const qM=10;function s1(n){return typeof n!="string"?n:(n=n.toUpperCase(),Yf[n]||Yf.WHITE)}function QM(n,e,t){return!zi&&typeof n=="string"&&(e&&(n=`\x1B[${s1(e)}m${n}\x1B[39m`),t&&(n=`\x1B[${s1(t)+qM}m${n}\x1B[49m`)),n}function ZM(n,e=["constructor"]){const t=Object.getPrototypeOf(n),s=Object.getOwnPropertyNames(t),r=n;for(const i of s){const o=r[i];typeof o=="function"&&(e.find(l=>i===l)||(r[i]=o.bind(n)))}}function TA(n,e){if(!n)throw new Error("Assertion failed")}function Po(){var e,t,s;let n;if(zi()&&Qu.performance)n=(t=(e=Qu==null?void 0:Qu.performance)==null?void 0:e.now)==null?void 0:t.call(e);else if("hrtime"in Fo){const r=(s=Fo==null?void 0:Fo.hrtime)==null?void 0:s.call(Fo);n=r[0]*1e3+r[1]/1e6}else n=Date.now();return n}const Uo={debug:zi()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},eO={enabled:!0,level:0};function Lo(){}const r1={},i1={once:!0};class Sa{constructor({id:e}={id:""}){this.VERSION=CS,this._startTs=Po(),this._deltaTs=Po(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new WM(`__probe-${this.id}__`,eO),this.timeStamp(`${this.id} started`),ZM(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Po()-this._startTs).toPrecision(10))}getDelta(){return Number((Po()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Uo.warn,arguments,i1)}error(e){return this._getLogFunction(0,e,Uo.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,Uo.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,Uo.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,Uo.debug||Uo.info,arguments,i1)}table(e,t,s){return t?this._getLogFunction(e,t,console.table||Lo,s&&[s],{tag:nO(t)}):Lo}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||Lo)}group(e,t,s={collapsed:!1}){const r=o1({logLevel:e,message:t,opts:s}),{collapsed:i}=s;return r.method=(i?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}groupCollapsed(e,t,s={}){return this.group(e,t,Object.assign({},s,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Lo)}withGroup(e,t,s){this.group(e,t)();try{s()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=vS(e)}_getLogFunction(e,t,s,r,i){if(this._shouldLog(e)){i=o1({logLevel:e,message:t,args:r,opts:i}),s=s||i.method,TA(s),i.total=this.getTotal(),i.delta=this.getDelta(),this._deltaTs=Po();const o=i.tag||i.message;if(i.once&&o)if(!r1[o])r1[o]=Po();else return Lo;return t=tO(this.id,i.message,i),s.bind(console,t,...i.args)}return Lo}}Sa.VERSION=CS;function vS(n){if(!n)return 0;let e;switch(typeof n){case"number":e=n;break;case"object":e=n.logLevel||n.priority||0;break;default:return 0}return TA(Number.isFinite(e)&&e>=0),e}function o1(n){const{logLevel:e,message:t}=n;n.logLevel=vS(e);const s=n.args?Array.from(n.args):[];for(;s.length&&s.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&s.unshift(t),n.message=e;break;case"object":Object.assign(n,e);break}typeof n.message=="function"&&(n.message=n.message());const r=typeof n.message;return TA(r==="string"||r==="object"),Object.assign(n,{args:s},n.opts)}function tO(n,e,t){if(typeof e=="string"){const s=t.time?KM(YM(t.total)):"";e=t.time?`${n}: ${s}  ${e}`:`${n}: ${e}`,e=QM(e,t.color,t.background)}return e}function nO(n){for(const e in n)for(const t in n[e])return t||"untitled";return"empty"}globalThis.probe={};const Wh=new Sa({id:"@probe.gl/log"}),Dp="4.3.2",sO=Dp[0]>="0"&&Dp[0]<="9"?`v${Dp}`:"";function rO(){const n=new Sa({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=n,globalThis.loaders.version=sO,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=n,n}const iO=rO();function oO(n,e){return BS(n||{},e)}function BS(n,e,t=0){if(t>3)return e;const s={...n};for(const[r,i]of Object.entries(e))i&&typeof i=="object"&&!Array.isArray(i)?s[r]=BS(s[r]||{},e[r],t+1):s[r]=e[r];return s}function aO(n){var e;globalThis.loaders||(globalThis.loaders={}),(e=globalThis.loaders).modules||(e.modules={}),Object.assign(globalThis.loaders.modules,n)}function cO(n){var t,s;return((s=(t=globalThis.loaders)==null?void 0:t.modules)==null?void 0:s[n])||null}const lO="latest";function uO(){var n;return(n=globalThis._loadersgl_)!=null&&n.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.2"),globalThis._loadersgl_.version}const SS=uO();function gr(n,e){if(!n)throw new Error(e||"loaders.gl assertion failed.")}const es=typeof process!="object"||String(process)!=="[object process]"||process.browser,EA=typeof importScripts=="function",fO=typeof window<"u"&&typeof window.orientation<"u",a1=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);a1&&parseFloat(a1[1]);class hO{constructor(e,t){b(this,"name");b(this,"workerThread");b(this,"isRunning",!0);b(this,"result");b(this,"_resolve",()=>{});b(this,"_reject",()=>{});this.name=e,this.workerThread=t,this.result=new Promise((s,r)=>{this._resolve=s,this._reject=r})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){gr(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){gr(this.isRunning),this.isRunning=!1,this._reject(e)}}class Np{terminate(){}}const Fp=new Map;function dO(n){gr(n.source&&!n.url||!n.source&&n.url);let e=Fp.get(n.source||n.url);return e||(n.url&&(e=gO(n.url),Fp.set(n.url,e)),n.source&&(e=wS(n.source),Fp.set(n.source,e))),gr(e),e}function gO(n){if(!n.startsWith("http"))return n;const e=pO(n);return wS(e)}function wS(n){const e=new Blob([n],{type:"application/javascript"});return URL.createObjectURL(e)}function pO(n){return`try {
  importScripts('${n}');
} catch (error) {
  console.error(error);
  throw error;
}`}function RS(n,e=!0,t){const s=t||new Set;if(n){if(c1(n))s.add(n);else if(c1(n.buffer))s.add(n.buffer);else if(!ArrayBuffer.isView(n)){if(e&&typeof n=="object")for(const r in n)RS(n[r],e,s)}}return t===void 0?Array.from(s):[]}function c1(n){return n?n instanceof ArrayBuffer||typeof MessagePort<"u"&&n instanceof MessagePort||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas:!1}const Pp=()=>{};class c_{constructor(e){b(this,"name");b(this,"source");b(this,"url");b(this,"terminated",!1);b(this,"worker");b(this,"onMessage");b(this,"onError");b(this,"_loadableURL","");const{name:t,source:s,url:r}=e;gr(s||r),this.name=t,this.source=s,this.url=r,this.onMessage=Pp,this.onError=i=>console.log(i),this.worker=es?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&es||typeof Np<"u"&&!es}destroy(){this.onMessage=Pp,this.onError=Pp,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||RS(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=dO({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){const s=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new Np(s,{eval:!1})}else if(this.source)e=new Np(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}}class mO{constructor(e){b(this,"name","unnamed");b(this,"source");b(this,"url");b(this,"maxConcurrency",1);b(this,"maxMobileConcurrency",1);b(this,"onDebug",()=>{});b(this,"reuseWorkers",!0);b(this,"props",{});b(this,"jobQueue",[]);b(this,"idleQueue",[]);b(this,"count",0);b(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return c_.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,t=(r,i,o)=>r.done(o),s=(r,i)=>r.error(i)){const r=new Promise(i=>(this.jobQueue.push({name:e,onMessage:t,onError:s,onStart:i}),this));return this._startQueuedJob(),await r}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const s=new hO(t.name,e);e.onMessage=r=>t.onMessage(s,r.type,r.payload),e.onError=r=>t.onError(s,r),t.onStart(s);try{await s.result}catch(r){console.error(`Worker exception: ${r}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!es||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new c_({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return fO?this.maxMobileConcurrency:this.maxConcurrency}}const _O={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},Yr=class Yr{constructor(e){b(this,"props");b(this,"workerPools",new Map);this.props={..._O},this.setProps(e),this.workerPools=new Map}static isSupported(){return c_.isSupported()}static getWorkerFarm(e={}){return Yr._workerFarm=Yr._workerFarm||new Yr({}),Yr._workerFarm.setProps(e),Yr._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:s,url:r}=e;let i=this.workerPools.get(t);return i||(i=new mO({name:t,source:s,url:r}),i.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,i)),i}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};b(Yr,"_workerFarm");let Kf=Yr;function AO(n,e={}){const t=e[n.id]||{},s=es?`${n.id}-worker.js`:`${n.id}-worker-node.js`;let r=t.workerUrl;if(!r&&n.id==="compression"&&(r=e.workerUrl),e._workerType==="test"&&(es?r=`modules/${n.module}/dist/${s}`:r=`modules/${n.module}/src/workers/${n.id}-worker-node.ts`),!r){let i=n.version;i==="latest"&&(i=lO);const o=i?`@${i}`:"";r=`https://unpkg.com/@loaders.gl/${n.module}${o}/dist/${s}`}return gr(r),r}function yO(n,e=SS){gr(n,"no worker provided");const t=n.version;return!(!e||!t)}const Up={};async function js(n,e=null,t={},s=null){return e&&(n=bO(n,e,t,s)),Up[n]=Up[n]||TO(n),await Up[n]}function bO(n,e,t={},s=null){if(!t.useLocalLibraries&&n.startsWith("http"))return n;s=s||n;const r=t.modules||{};return r[s]?r[s]:es?t.CDN?(gr(t.CDN.startsWith("http")),`${t.CDN}/${e}@${SS}/dist/libs/${s}`):EA?`../src/libs/${s}`:`modules/${e}/src/libs/${s}`:`modules/${e}/dist/libs/${s}`}async function TO(n){if(n.endsWith("wasm"))return await CO(n);if(!es)try{const{requireFromFile:t}=globalThis.loaders||{};return await(t==null?void 0:t(n))}catch(t){return console.error(t),null}if(EA)return importScripts(n);const e=await vO(n);return EO(e,n)}function EO(n,e){if(!es){const{requireFromString:s}=globalThis.loaders||{};return s==null?void 0:s(n,e)}if(EA)return eval.call(globalThis,n),null;const t=document.createElement("script");t.id=e;try{t.appendChild(document.createTextNode(n))}catch{t.text=n}return document.body.appendChild(t),null}async function CO(n){const{readFileAsArrayBuffer:e}=globalThis.loaders||{};return es||!e||n.startsWith("http")?await(await fetch(n)).arrayBuffer():await e(n)}async function vO(n){const{readFileAsText:e}=globalThis.loaders||{};return es||!e||n.startsWith("http")?await(await fetch(n)).text():await e(n)}const BO={},xS=Object.freeze(Object.defineProperty({__proto__:null,default:BO},Symbol.toStringTag,{value:"Module"}));function SO(n,e){return!Kf.isSupported()||!es&&!(e!=null&&e._nodeWorkers)?!1:n.worker&&(e==null?void 0:e.worker)}async function wO(n,e,t,s,r){const i=n.id,o=AO(n,t),f=Kf.getWorkerFarm(t).getWorkerPool({name:i,url:o});t=JSON.parse(JSON.stringify(t)),s=JSON.parse(JSON.stringify(s||{}));const h=await f.startJob("process-on-worker",RO.bind(null,r));return h.postMessage("process",{input:e,options:t,context:s}),await(await h.result).result}async function RO(n,e,t,s){switch(t){case"done":e.done(s);break;case"error":e.error(new Error(s.error));break;case"process":const{id:r,input:i,options:o}=s;try{const l=await n(i,o);e.postMessage("done",{id:r,result:l})}catch(l){const f=l instanceof Error?l.message:"unknown error";e.postMessage("error",{id:r,error:f})}break;default:console.warn(`parse-with-worker unknown message ${t}`)}}function xO(n,e=5){return typeof n=="string"?n.slice(0,e):ArrayBuffer.isView(n)?l1(n.buffer,n.byteOffset,e):n instanceof ArrayBuffer?l1(n,0,e):""}function l1(n,e,t){if(n.byteLength<=e+t)return"";const s=new DataView(n);let r="";for(let i=0;i<t;i++)r+=String.fromCharCode(s.getUint8(e+i));return r}function IO(n){try{return JSON.parse(n)}catch{throw new Error(`Failed to parse JSON from data starting with "${xO(n)}"`)}}function MO(n,e,t){if(t=t||n.byteLength,n.byteLength<t||e.byteLength<t)return!1;const s=new Uint8Array(n),r=new Uint8Array(e);for(let i=0;i<s.length;++i)if(s[i]!==r[i])return!1;return!0}function OO(...n){return DO(n)}function DO(n){const e=n.map(i=>i instanceof ArrayBuffer?new Uint8Array(i):i),t=e.reduce((i,o)=>i+o.byteLength,0),s=new Uint8Array(t);let r=0;for(const i of e)s.set(i,r),r+=i.byteLength;return s.buffer}function CA(n,e,t){const s=t!==void 0?new Uint8Array(n).subarray(e,e+t):new Uint8Array(n).subarray(e);return new Uint8Array(s).buffer}function wl(n,e){return it(n>=0),it(e>0),n+(e-1)&-4}function NO(n,e,t){let s;if(n instanceof ArrayBuffer)s=new Uint8Array(n);else{const r=n.byteOffset,i=n.byteLength;s=new Uint8Array(n.buffer||n.arrayBuffer,r,i)}return e.set(s,t),t+wl(s.byteLength,4)}async function FO(n){const e=[];for await(const t of n)e.push(t);return OO(...e)}function u1(){let n;if(typeof window<"u"&&window.performance)n=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();n=e[0]*1e3+e[1]/1e6}else n=Date.now();return n}class f1{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=u1(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(u1()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class wa{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:s}=e;let r=this.stats[t];return r||(e instanceof f1?r=e:r=new f1(t,s),this.stats[t]=r),r}}const PO="Queued Requests",UO="Active Requests",LO="Cancelled Requests",kO="Queued Requests Ever",HO="Active Requests Ever",GO={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class VO{constructor(e={}){b(this,"props");b(this,"stats");b(this,"activeRequestCount",0);b(this,"requestQueue",[]);b(this,"requestMap",new Map);b(this,"updateTimer",null);this.props={...GO,...e},this.stats=new wa({id:this.props.id}),this.stats.get(PO),this.stats.get(UO),this.stats.get(LO),this.stats.get(kO),this.stats.get(HO)}scheduleRequest(e,t=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const s={handle:e,priority:0,getPriority:t},r=new Promise(i=>(s.resolve=i,s));return this.requestQueue.push(s),this.requestMap.set(e,r),this._issueNewRequests(),r}_issueRequest(e){const{handle:t,resolve:s}=e;let r=!1;const i=()=>{r||(r=!0,this.requestMap.delete(t),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,s?s({done:i}):Promise.resolve({done:i})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let t=0;t<e;++t){const s=this.requestQueue.shift();s&&this._issueRequest(s)}}}_updateAllRequests(){const e=this.requestQueue;for(let t=0;t<e.length;++t){const s=e[t];this._updateRequest(s)||(e.splice(t,1),this.requestMap.delete(s.handle),t--)}e.sort((t,s)=>t.priority-s.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}let jO="";const h1={};function zO(n){for(const e in h1)if(n.startsWith(e)){const t=h1[e];n=n.replace(e,t)}return!n.startsWith("http://")&&!n.startsWith("https://")&&(n=`${jO}${n}`),n}function $O(n){return n&&typeof n=="object"&&n.isBuffer}function IS(n){if($O(n))return n;if(n instanceof ArrayBuffer)return n;if(ArrayBuffer.isView(n))return n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength);if(typeof n=="string"){const e=n;return new TextEncoder().encode(e).buffer}if(n&&typeof n=="object"&&n._toArrayBuffer)return n._toArrayBuffer();throw new Error("toArrayBuffer")}function XO(){var e;if(typeof process<"u"&&typeof process.cwd<"u")return process.cwd();const n=(e=window.location)==null?void 0:e.pathname;return(n==null?void 0:n.slice(0,n.lastIndexOf("/")+1))||""}function MS(n){const e=n?n.lastIndexOf("/"):-1;return e>=0?n.substr(e+1):""}function vA(n){const e=n?n.lastIndexOf("/"):-1;return e>=0?n.substr(0,e):""}function JO(...n){const e=[];for(let i=0;i<n.length;i++)e[i]=n[i];let t="",s=!1,r;for(let i=e.length-1;i>=-1&&!s;i--){let o;i>=0?o=e[i]:(r===void 0&&(r=XO()),o=r),o.length!==0&&(t=`${o}/${t}`,s=o.charCodeAt(0)===zc)}return t=WO(t,!s),s?`/${t}`:t.length>0?t:"."}const zc=47,Lp=46;function WO(n,e){let t="",s=-1,r=0,i,o=!1;for(let l=0;l<=n.length;++l){if(l<n.length)i=n.charCodeAt(l);else{if(i===zc)break;i=zc}if(i===zc){if(!(s===l-1||r===1))if(s!==l-1&&r===2){if(t.length<2||!o||t.charCodeAt(t.length-1)!==Lp||t.charCodeAt(t.length-2)!==Lp){if(t.length>2){const f=t.length-1;let h=f;for(;h>=0&&t.charCodeAt(h)!==zc;--h);if(h!==f){t=h===-1?"":t.slice(0,h),s=l,r=0,o=!1;continue}}else if(t.length===2||t.length===1){t="",s=l,r=0,o=!1;continue}}e&&(t.length>0?t+="/..":t="..",o=!0)}else{const f=n.slice(s+1,l);t.length>0?t+=`/${f}`:t=f,o=!1}s=l,r=0}else i===Lp&&r!==-1?++r:r=-1}return t}const YO=n=>typeof n=="boolean",el=n=>typeof n=="function",Rl=n=>n!==null&&typeof n=="object",d1=n=>Rl(n)&&n.constructor==={}.constructor,KO=n=>!!n&&typeof n[Symbol.iterator]=="function",qO=n=>n&&typeof n[Symbol.asyncIterator]=="function",$i=n=>typeof Response<"u"&&n instanceof Response||n&&n.arrayBuffer&&n.text&&n.json,Xi=n=>typeof Blob<"u"&&n instanceof Blob,QO=n=>n&&typeof n=="object"&&n.isBuffer,ZO=n=>typeof ReadableStream<"u"&&n instanceof ReadableStream||Rl(n)&&el(n.tee)&&el(n.cancel)&&el(n.getReader),eD=n=>Rl(n)&&el(n.read)&&el(n.pipe)&&YO(n.readable),OS=n=>ZO(n)||eD(n);class tD extends Error{constructor(t,s){super(t);b(this,"reason");b(this,"url");b(this,"response");this.reason=s.reason,this.url=s.url,this.response=s.response}}const nD=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,sD=/^([-\w.]+\/[-\w.+]+)/;function g1(n,e){return n.toLowerCase()===e.toLowerCase()}function rD(n){const e=sD.exec(n);return e?e[1]:n}function p1(n){const e=nD.exec(n);return e?e[1]:""}const DS=/\?.*/;function iD(n){const e=n.match(DS);return e&&e[0]}function BA(n){return n.replace(DS,"")}function oD(n){if(n.length<50)return n;const e=n.slice(n.length-15);return`${n.substr(0,32)}...${e}`}function Yh(n){return $i(n)?n.url:Xi(n)?n.name||"":typeof n=="string"?n:""}function SA(n){if($i(n)){const e=n,t=e.headers.get("content-type")||"",s=BA(e.url);return rD(t)||p1(s)}return Xi(n)?n.type||"":typeof n=="string"?p1(n):""}function aD(n){return $i(n)?n.headers["content-length"]||-1:Xi(n)?n.size:typeof n=="string"?n.length:n instanceof ArrayBuffer||ArrayBuffer.isView(n)?n.byteLength:-1}async function NS(n){if($i(n))return n;const e={},t=aD(n);t>=0&&(e["content-length"]=String(t));const s=Yh(n),r=SA(n);r&&(e["content-type"]=r);const i=await uD(n);i&&(e["x-first-bytes"]=i),typeof n=="string"&&(n=new TextEncoder().encode(n));const o=new Response(n,{headers:e});return Object.defineProperty(o,"url",{value:s}),o}async function cD(n){if(!n.ok)throw await lD(n)}async function lD(n){const e=oD(n.url);let t=`Failed to fetch resource (${n.status}) ${n.statusText}: ${e}`;t=t.length>100?`${t.slice(0,100)}...`:t;const s={reason:n.statusText,url:n.url,response:n};try{const r=n.headers.get("Content-Type");s.reason=!n.bodyUsed&&(r!=null&&r.includes("application/json"))?await n.json():await n.text()}catch{}return new tD(t,s)}async function uD(n){if(typeof n=="string")return`data:,${n.slice(0,5)}`;if(n instanceof Blob){const t=n.slice(0,5);return await new Promise(s=>{const r=new FileReader;r.onload=i=>{var o;return s((o=i==null?void 0:i.target)==null?void 0:o.result)},r.readAsDataURL(t)})}if(n instanceof ArrayBuffer){const t=n.slice(0,5);return`data:base64,${fD(t)}`}return null}function fD(n){let e="";const t=new Uint8Array(n);for(let s=0;s<t.byteLength;s++)e+=String.fromCharCode(t[s]);return btoa(e)}function hD(n){return!dD(n)&&!gD(n)}function dD(n){return n.startsWith("http:")||n.startsWith("https:")}function gD(n){return n.startsWith("data:")}async function m1(n,e){var t,s;if(typeof n=="string"){const r=zO(n);return hD(r)&&(t=globalThis.loaders)!=null&&t.fetchNode?(s=globalThis.loaders)==null?void 0:s.fetchNode(r,e):await fetch(r,e)}return await NS(n)}const _1=new Sa({id:"loaders.gl"});class pD{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class mD{constructor(){b(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const FS={fetch:null,mimeType:void 0,nothrow:!1,log:new mD,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Jh,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},_D={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function PS(){globalThis.loaders=globalThis.loaders||{};const{loaders:n}=globalThis;return n._state||(n._state={}),n._state}function US(){const n=PS();return n.globalOptions=n.globalOptions||{...FS},n.globalOptions}function AD(n,e,t,s){return t=t||[],t=Array.isArray(t)?t:[t],yD(n,t),TD(e,n,s)}function yD(n,e){A1(n,null,FS,_D,e);for(const t of e){const s=n&&n[t.id]||{},r=t.options&&t.options[t.id]||{},i=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};A1(s,t.id,r,i,e)}}function A1(n,e,t,s,r){const i=e||"Top level",o=e?`${e}.`:"";for(const l in n){const f=!e&&Rl(n[l]),h=l==="baseUri"&&!e,g=l==="workerUrl"&&e;if(!(l in t)&&!h&&!g){if(l in s)_1.warn(`${i} loader option '${o}${l}' no longer supported, use '${s[l]}'`)();else if(!f){const m=bD(l,r);_1.warn(`${i} loader option '${o}${l}' not recognized. ${m}`)()}}}}function bD(n,e){const t=n.toLowerCase();let s="";for(const r of e)for(const i in r.options){if(n===i)return`Did you mean '${r.id}.${i}'?`;const o=i.toLowerCase();(t.startsWith(o)||o.startsWith(t))&&(s=s||`Did you mean '${r.id}.${i}'?`)}return s}function TD(n,e,t){const r={...n.options||{}};return ED(r,t),r.log===null&&(r.log=new pD),y1(r,US()),y1(r,e),r}function y1(n,e){for(const t in e)if(t in e){const s=e[t];d1(s)&&d1(n[t])?n[t]={...n[t],...e[t]}:n[t]=e[t]}}function ED(n,e){e&&!("baseUri"in n)&&(n.baseUri=e)}function wA(n){return n?(Array.isArray(n)&&(n=n[0]),Array.isArray(n==null?void 0:n.extensions)):!1}function RA(n){it(n,"null loader"),it(wA(n),"invalid loader");let e;return Array.isArray(n)&&(e=n[1],n=n[0],n={...n,options:{...n.options,...e}}),(n!=null&&n.parseTextSync||n!=null&&n.parseText)&&(n.text=!0),n.text||(n.binary=!0),n}const LS=()=>{const n=PS();return n.loaderRegistry=n.loaderRegistry||[],n.loaderRegistry};function CD(n){const e=LS();n=Array.isArray(n)?n:[n];for(const t of n){const s=RA(t);e.find(r=>s===r)||e.unshift(s)}}function vD(){return LS()}const BD=/\.([^.]+)$/;async function SD(n,e=[],t,s){if(!kS(n))return null;let r=b1(n,e,{...t,nothrow:!0},s);if(r)return r;if(Xi(n)&&(n=await n.slice(0,10).arrayBuffer(),r=b1(n,e,t,s)),!r&&!(t!=null&&t.nothrow))throw new Error(HS(n));return r}function b1(n,e=[],t,s){if(!kS(n))return null;if(e&&!Array.isArray(e))return RA(e);let r=[];e&&(r=r.concat(e)),t!=null&&t.ignoreRegisteredLoaders||r.push(...vD()),RD(r);const i=wD(n,r,t,s);if(!i&&!(t!=null&&t.nothrow))throw new Error(HS(n));return i}function wD(n,e,t,s){const r=Yh(n),i=SA(n),o=BA(r)||(s==null?void 0:s.url);let l=null,f="";return t!=null&&t.mimeType&&(l=kp(e,t==null?void 0:t.mimeType),f=`match forced by supplied MIME type ${t==null?void 0:t.mimeType}`),l=l||xD(e,o),f=f||(l?`matched url ${o}`:""),l=l||kp(e,i),f=f||(l?`matched MIME type ${i}`:""),l=l||MD(e,n),f=f||(l?`matched initial data ${GS(n)}`:""),t!=null&&t.fallbackMimeType&&(l=l||kp(e,t==null?void 0:t.fallbackMimeType),f=f||(l?`matched fallback MIME type ${i}`:"")),f&&iO.log(1,`selectLoader selected ${l==null?void 0:l.name}: ${f}.`),l}function kS(n){return!(n instanceof Response&&n.status===204)}function HS(n){const e=Yh(n),t=SA(n);let s="No valid loader found (";s+=e?`${MS(e)}, `:"no url provided, ",s+=`MIME type: ${t?`"${t}"`:"not provided"}, `;const r=n?GS(n):"";return s+=r?` first bytes: "${r}"`:"first bytes: not available",s+=")",s}function RD(n){for(const e of n)RA(e)}function xD(n,e){const t=e&&BD.exec(e),s=t&&t[1];return s?ID(n,s):null}function ID(n,e){e=e.toLowerCase();for(const t of n)for(const s of t.extensions)if(s.toLowerCase()===e)return t;return null}function kp(n,e){var t;for(const s of n)if((t=s.mimeTypes)!=null&&t.some(r=>g1(e,r))||g1(e,`application/x.${s.id}`))return s;return null}function MD(n,e){if(!e)return null;for(const t of n)if(typeof e=="string"){if(OD(e,t))return t}else if(ArrayBuffer.isView(e)){if(T1(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&T1(e,0,t))return t;return null}function OD(n,e){return e.testText?e.testText(n):(Array.isArray(e.tests)?e.tests:[e.tests]).some(s=>n.startsWith(s))}function T1(n,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(r=>DD(n,e,t,r))}function DD(n,e,t,s){if(s instanceof ArrayBuffer)return MO(s,n,s.byteLength);switch(typeof s){case"function":return s(n);case"string":const r=l_(n,e,s.length);return s===r;default:return!1}}function GS(n,e=5){return typeof n=="string"?n.slice(0,e):ArrayBuffer.isView(n)?l_(n.buffer,n.byteOffset,e):n instanceof ArrayBuffer?l_(n,0,e):""}function l_(n,e,t){if(n.byteLength<e+t)return"";const s=new DataView(n);let r="";for(let i=0;i<t;i++)r+=String.fromCharCode(s.getUint8(e+i));return r}const ND=256*1024;function*FD(n,e){const t=(e==null?void 0:e.chunkSize)||ND;let s=0;const r=new TextEncoder;for(;s<n.length;){const i=Math.min(n.length-s,t),o=n.slice(s,s+i);s+=i,yield r.encode(o)}}const PD=256*1024;function*UD(n,e={}){const{chunkSize:t=PD}=e;let s=0;for(;s<n.byteLength;){const r=Math.min(n.byteLength-s,t),i=new ArrayBuffer(r),o=new Uint8Array(n,s,r);new Uint8Array(i).set(o),s+=r,yield i}}const LD=1024*1024;async function*kD(n,e){const t=(e==null?void 0:e.chunkSize)||LD;let s=0;for(;s<n.size;){const r=s+t,i=await n.slice(s,r).arrayBuffer();s=r,yield i}}function E1(n,e){return Jh?HD(n,e):GD(n)}async function*HD(n,e){const t=n.getReader();let s;try{for(;;){const r=s||t.read();e!=null&&e._streamReadAhead&&(s=t.read());const{done:i,value:o}=await r;if(i)return;yield IS(o)}}catch{t.releaseLock()}}async function*GD(n,e){for await(const t of n)yield IS(t)}function VD(n,e){if(typeof n=="string")return FD(n,e);if(n instanceof ArrayBuffer)return UD(n,e);if(Xi(n))return kD(n,e);if(OS(n))return E1(n,e);if($i(n))return E1(n.body,e);throw new Error("makeIterator")}const VS="Cannot convert supplied data type";function jD(n,e,t){if(e.text&&typeof n=="string")return n;if(QO(n)&&(n=n.buffer),n instanceof ArrayBuffer){const s=n;return e.text&&!e.binary?new TextDecoder("utf8").decode(s):s}if(ArrayBuffer.isView(n)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(n);let s=n.buffer;const r=n.byteLength||n.length;return(n.byteOffset!==0||r!==s.byteLength)&&(s=s.slice(n.byteOffset,n.byteOffset+r)),s}throw new Error(VS)}async function zD(n,e,t){const s=n instanceof ArrayBuffer||ArrayBuffer.isView(n);if(typeof n=="string"||s)return jD(n,e);if(Xi(n)&&(n=await NS(n)),$i(n)){const r=n;return await cD(r),e.binary?await r.arrayBuffer():await r.text()}if(OS(n)&&(n=VD(n,t)),KO(n)||qO(n))return FO(n);throw new Error(VS)}function jS(n,e){const t=US(),s=n||t;return typeof s.fetch=="function"?s.fetch:Rl(s.fetch)?r=>m1(r,s.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:m1}function $D(n,e,t){if(t)return t;const s={fetch:jS(e,n),...n};if(s.url){const r=BA(s.url);s.baseUrl=r,s.queryString=iD(s.url),s.filename=MS(r),s.baseUrl=vA(r)}return Array.isArray(s.loaders)||(s.loaders=null),s}function XD(n,e){if(n&&!Array.isArray(n))return n;let t;if(n&&(t=Array.isArray(n)?n:[n]),e&&e.loaders){const s=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...s]:s}return t&&t.length?t:void 0}async function qf(n,e,t,s){e&&!Array.isArray(e)&&!wA(e)&&(s=void 0,t=e,e=void 0),n=await n,t=t||{};const r=Yh(n),o=XD(e,s),l=await SD(n,o,t);return l?(t=AD(t,l,o,r),s=$D({url:r,_parse:qf,loaders:o},t,s||null),await JD(l,n,t,s)):null}async function JD(n,e,t,s){if(yO(n),t=oO(n.options,t),$i(e)){const i=e,{ok:o,redirected:l,status:f,statusText:h,type:g,url:m}=i,A=Object.fromEntries(i.headers.entries());s.response={headers:A,ok:o,redirected:l,status:f,statusText:h,type:g,url:m}}e=await zD(e,n,t);const r=n;if(r.parseTextSync&&typeof e=="string")return r.parseTextSync(e,t,s);if(SO(n,t))return await wO(n,e,t,s,qf);if(r.parseText&&typeof e=="string")return await r.parseText(e,t,s);if(r.parse)return await r.parse(e,t,s);throw gr(!r.parseSync),new Error(`${n.id} loader - no parser found and worker is disabled`)}function WD(n){switch(n.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function xA(n){let e=1/0,t=1/0,s=1/0,r=-1/0,i=-1/0,o=-1/0;const l=n.POSITION?n.POSITION.value:[],f=l&&l.length;for(let h=0;h<f;h+=3){const g=l[h],m=l[h+1],A=l[h+2];e=g<e?g:e,t=m<t?m:t,s=A<s?A:s,r=g>r?g:r,i=m>i?m:i,o=A>o?A:o}return[[e,t,s],[r,i,o]]}function zS(n,e,t){const s=WD(e.value),r=t||YD(e);return{name:n,type:{type:"fixed-size-list",listSize:e.size,children:[{name:"value",type:s}]},nullable:!1,metadata:r}}function YD(n){const e={};return"byteOffset"in n&&(e.byteOffset=n.byteOffset.toString(10)),"byteStride"in n&&(e.byteStride=n.byteStride.toString(10)),"normalized"in n&&(e.normalized=n.normalized.toString()),e}async function zs(n,e,t,s){let r,i;!Array.isArray(e)&&!wA(e)?(r=[],i=e):(r=e,i=t);const o=jS(i);let l=n;return typeof n=="string"&&(l=await o(n)),Xi(n)&&(l=await o(n)),Array.isArray(r)?await qf(l,r,i):await qf(l,r,i)}const KD="4.3.2";var yS;const qD=(yS=globalThis.loaders)==null?void 0:yS.parseImageNode,u_=typeof Image<"u",f_=typeof ImageBitmap<"u",QD=!!qD,h_=Jh?!0:QD;function ZD(n){switch(n){case"auto":return f_||u_||h_;case"imagebitmap":return f_;case"image":return u_;case"data":return h_;default:throw new Error(`@loaders.gl/images: image ${n} not supported in this environment`)}}function eN(){if(f_)return"imagebitmap";if(u_)return"image";if(h_)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function tN(n){const e=nN(n);if(!e)throw new Error("Not an image");return e}function $S(n){switch(tN(n)){case"data":return n;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=n.width,e.height=n.height,t.drawImage(n,0,0),t.getImageData(0,0,n.width,n.height);default:throw new Error("getImageData")}}function nN(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&n instanceof Image?"image":n&&typeof n=="object"&&n.data&&n.width&&n.height?"data":null}const sN=/^data:image\/svg\+xml/,rN=/\.svg((\?|#).*)?$/;function IA(n){return n&&(sN.test(n)||rN.test(n))}function iN(n,e){if(IA(e)){let s=new TextDecoder().decode(n);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(s=unescape(encodeURIComponent(s)))}catch(i){throw new Error(i.message)}return`data:image/svg+xml;base64,${btoa(s)}`}return XS(n,e)}function XS(n,e){if(IA(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(n)])}async function JS(n,e,t){const s=iN(n,t),r=self.URL||self.webkitURL,i=typeof s!="string"&&r.createObjectURL(s);try{return await oN(i||s,e)}finally{i&&r.revokeObjectURL(i)}}async function oN(n,e){const t=new Image;return t.src=n,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((s,r)=>{try{t.onload=()=>s(t),t.onerror=i=>{const o=i instanceof Error?i.message:"error";r(new Error(o))}}catch(i){r(i)}})}const aN={};let C1=!0;async function cN(n,e,t){let s;IA(t)?s=await JS(n,e,t):s=XS(n,t);const r=e&&e.imagebitmap;return await lN(s,r)}async function lN(n,e=null){if((uN(e)||!C1)&&(e=null),e)try{return await createImageBitmap(n,e)}catch(t){console.warn(t),C1=!1}return await createImageBitmap(n)}function uN(n){for(const e in n||aN)return!1;return!0}function fN(n){return!pN(n,"ftyp",4)||(n[8]&96)===0?null:hN(n)}function hN(n){switch(dN(n,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function dN(n,e,t){return String.fromCharCode(...n.slice(e,t))}function gN(n){return[...n].map(e=>e.charCodeAt(0))}function pN(n,e,t=0){const s=gN(e);for(let r=0;r<s.length;++r)if(s[r]!==n[r+t])return!1;return!0}const Us=!1,tl=!0;function MA(n){const e=xl(n);return _N(e)||bN(e)||AN(e)||yN(e)||mN(e)}function mN(n){const e=new Uint8Array(n instanceof DataView?n.buffer:n),t=fN(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function _N(n){const e=xl(n);return e.byteLength>=24&&e.getUint32(0,Us)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Us),height:e.getUint32(20,Us)}:null}function AN(n){const e=xl(n);return e.byteLength>=10&&e.getUint32(0,Us)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,tl),height:e.getUint16(8,tl)}:null}function yN(n){const e=xl(n);return e.byteLength>=14&&e.getUint16(0,Us)===16973&&e.getUint32(2,tl)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,tl),height:e.getUint32(22,tl)}:null}function bN(n){const e=xl(n);if(!(e.byteLength>=3&&e.getUint16(0,Us)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:s,sofMarkers:r}=TN();let i=2;for(;i+9<e.byteLength;){const o=e.getUint16(i,Us);if(r.has(o))return{mimeType:"image/jpeg",height:e.getUint16(i+5,Us),width:e.getUint16(i+7,Us)};if(!s.has(o))return null;i+=2,i+=e.getUint16(i,Us)}return null}function TN(){const n=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)n.add(t);return{tableMarkers:n,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function xl(n){if(n instanceof DataView)return n;if(ArrayBuffer.isView(n))return new DataView(n.buffer);if(n instanceof ArrayBuffer)return new DataView(n);throw new Error("toDataView")}async function EN(n,e){var r;const{mimeType:t}=MA(n)||{},s=(r=globalThis.loaders)==null?void 0:r.parseImageNode;return it(s),await s(n,t)}async function CN(n,e,t){e=e||{};const r=(e.image||{}).type||"auto",{url:i}=t||{},o=vN(r);let l;switch(o){case"imagebitmap":l=await cN(n,e,i);break;case"image":l=await JS(n,e,i);break;case"data":l=await EN(n);break;default:it(!1)}return r==="data"&&(l=$S(l)),l}function vN(n){switch(n){case"auto":case"data":return eN();default:return ZD(n),n}}const BN=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],SN=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],wN={image:{type:"auto",decode:!0}},WS={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:KD,mimeTypes:SN,extensions:BN,parse:CN,tests:[n=>!!MA(new DataView(n))],options:wN},Hp={};function RN(n){if(Hp[n]===void 0){const e=Jh?IN(n):xN(n);Hp[n]=e}return Hp[n]}function xN(n){var r,i;const e=["image/png","image/jpeg","image/gif"],t=((r=globalThis.loaders)==null?void 0:r.imageFormatsNode)||e;return!!((i=globalThis.loaders)==null?void 0:i.parseImageNode)&&t.includes(n)}function IN(n){switch(n){case"image/avif":case"image/webp":return MN(n);default:return!0}}function MN(n){try{return document.createElement("canvas").toDataURL(n).indexOf(`data:${n}`)===0}catch{return!1}}const Ve=new Sa({id:"deck"});let d_={};function ON(n){d_=n}function qt(n,e,t,s){Ve.level>0&&d_[n]&&d_[n].call(null,e,t,s)}function DN(n){const e=n[0],t=n[n.length-1];return e==="{"&&t==="}"||e==="["&&t==="]"}const NN={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:DN,parseTextSync:JSON.parse};function FN(){const n="9.1.12",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==n)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${n}`);return e||(Ve.log(1,`deck.gl ${n}`)(),globalThis.deck={...globalThis.deck,VERSION:n,version:n,log:Ve,_registerLoggers:ON},CD([NN,[WS,{imagebitmap:{premultiplyAlpha:"none"}}]])),n}const PN=FN();function OA(n,e){if(!n)throw new Error(e||"shadertools: assertion failed.")}const Gp={number:{type:"number",validate(n,e){return Number.isFinite(n)&&typeof e=="object"&&(e.max===void 0||n<=e.max)&&(e.min===void 0||n>=e.min)}},array:{type:"array",validate(n,e){return Array.isArray(n)||ArrayBuffer.isView(n)}}};function UN(n){const e={};for(const[t,s]of Object.entries(n))e[t]=LN(s);return e}function LN(n){let e=v1(n);if(e!=="object")return{value:n,...Gp[e],type:e};if(typeof n=="object")return n?n.type!==void 0?{...n,...Gp[n.type],type:n.type}:n.value===void 0?{type:"object",value:n}:(e=v1(n.value),{...n,...Gp[e],type:e}):{type:"object",value:null};throw new Error("props")}function v1(n){return Array.isArray(n)||ArrayBuffer.isView(n)?"array":typeof n}const kN=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,HN=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,GN={vertex:kN,fragment:HN},B1=/void\s+main\s*\([^)]*\)\s*\{\n?/,S1=/}\n?[^{}]*$/,Vp=[],Ff="__LUMA_INJECT_DECLARATIONS__";function VN(n){const e={vertex:{},fragment:{}};for(const t in n){let s=n[t];const r=jN(t);typeof s=="string"&&(s={order:0,injection:s}),e[r][t]=s}return e}function jN(n){const e=n.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function Qf(n,e,t,s=!1){const r=e==="vertex";for(const i in t){const o=t[i];o.sort((f,h)=>f.order-h.order),Vp.length=o.length;for(let f=0,h=o.length;f<h;++f)Vp[f]=o[f].injection;const l=`${Vp.join(`
`)}
`;switch(i){case"vs:#decl":r&&(n=n.replace(Ff,l));break;case"vs:#main-start":r&&(n=n.replace(B1,f=>f+l));break;case"vs:#main-end":r&&(n=n.replace(S1,f=>l+f));break;case"fs:#decl":r||(n=n.replace(Ff,l));break;case"fs:#main-start":r||(n=n.replace(B1,f=>f+l));break;case"fs:#main-end":r||(n=n.replace(S1,f=>l+f));break;default:n=n.replace(i,f=>f+l)}}return n=n.replace(Ff,""),s&&(n=n.replace(/\}\s*$/,i=>i+GN[e])),n}function Zf(n){n.map(e=>zN(e))}function zN(n){if(n.instance)return;Zf(n.dependencies||[]);const{propTypes:e={},deprecations:t=[],inject:s={}}=n,r={normalizedInjections:VN(s),parsedDeprecations:$N(t)};e&&(r.propValidators=UN(e)),n.instance=r;let i={};e&&(i=Object.entries(e).reduce((o,[l,f])=>{const h=f==null?void 0:f.value;return h&&(o[l]=h),o},{})),n.defaultUniforms={...n.defaultUniforms,...i}}function YS(n,e,t){var s;(s=n.deprecations)==null||s.forEach(r=>{var i;(i=r.regex)!=null&&i.test(e)&&(r.deprecated?t.deprecated(r.old,r.new)():t.removed(r.old,r.new)())})}function $N(n){return n.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),n}function DA(n){Zf(n);const e={},t={};KS({modules:n,level:0,moduleMap:e,moduleDepth:t});const s=Object.keys(t).sort((r,i)=>t[i]-t[r]).map(r=>e[r]);return Zf(s),s}function KS(n){const{modules:e,level:t,moduleMap:s,moduleDepth:r}=n;if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const i of e)s[i.name]=i,(r[i.name]===void 0||r[i.name]<t)&&(r[i.name]=t);for(const i of e)i.dependencies&&KS({modules:i.dependencies,level:t+1,moduleMap:s,moduleDepth:r})}function XN(n){switch(n==null?void 0:n.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function JN(n,e){var s;if(Number(((s=n.match(/^#version[ \t]+(\d+)/m))==null?void 0:s[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return n=w1(n,WN),n;case"fragment":return n=w1(n,YN),n;default:throw new Error(e)}}const qS=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],WN=[...qS,[g_("attribute"),"in $1"],[g_("varying"),"out $1"]],YN=[...qS,[g_("varying"),"in $1"]];function w1(n,e){for(const[t,s]of e)n=n.replace(t,s);return n}function g_(n){return new RegExp(`\\b${n}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function QS(n,e){let t="";for(const s in n){const r=n[s];if(t+=`void ${r.signature} {
`,r.header&&(t+=`  ${r.header}`),e[s]){const i=e[s];i.sort((o,l)=>o.order-l.order);for(const o of i)t+=`  ${o.injection}
`}r.footer&&(t+=`  ${r.footer}`),t+=`}
`}return t}function ZS(n){const e={vertex:{},fragment:{}};for(const t of n){let s,r;typeof t!="string"?(s=t,r=s.hook):(s={},r=t),r=r.trim();const[i,o]=r.split(":"),l=r.replace(/\(.+/,""),f=Object.assign(s,{signature:o});switch(i){case"vs":e.vertex[l]=f;break;case"fs":e.fragment[l]=f;break;default:throw new Error(i)}}return e}function KN(n,e){return{name:qN(n,e),language:"glsl",version:QN(n)}}function qN(n,e="unnamed"){const s=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(n);return s?s[1]:e}function QN(n){let e=100;const t=n.match(/[^\s]+/g);if(t&&t.length>=2&&t[0]==="#version"){const s=parseInt(t[1],10);Number.isFinite(s)&&(e=s)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const e3=`

${Ff}
`,ZN=`precision highp float;
`;function eF(n){const e=DA(n.modules||[]);return{source:nF(n.platformInfo,{...n,source:n.source,stage:"vertex",modules:e}),getUniforms:t3(e)}}function tF(n){const{vs:e,fs:t}=n,s=DA(n.modules||[]);return{vs:R1(n.platformInfo,{...n,source:e,stage:"vertex",modules:s}),fs:R1(n.platformInfo,{...n,source:t,stage:"fragment",modules:s}),getUniforms:t3(s)}}function nF(n,e){var v;const{source:t,stage:s,modules:r,hookFunctions:i=[],inject:o={},log:l}=e;OA(typeof t=="string","shader source must be a string");const f=t;let h="";const g=ZS(i),m={},A={},y={};for(const S in o){const x=typeof o[S]=="string"?{injection:o[S],order:0}:o[S],O=/^(v|f)s:(#)?([\w-]+)$/.exec(S);if(O){const R=O[2],D=O[3];R?D==="decl"?A[S]=[x]:y[S]=[x]:m[S]=[x]}else y[S]=[x]}const E=r;for(const S of E){l&&YS(S,f,l);const x=n3(S,"wgsl");h+=x;const O=((v=S.injections)==null?void 0:v[s])||{};for(const R in O){const D=/^(v|f)s:#([\w-]+)$/.exec(R);if(D){const J=D[2]==="decl"?A:y;J[R]=J[R]||[],J[R].push(O[R])}else m[R]=m[R]||[],m[R].push(O[R])}}return h+=e3,h=Qf(h,s,A),h+=QS(g[s],m),h+=f,h=Qf(h,s,y),h}function R1(n,e){var ie;const{id:t,source:s,stage:r,language:i="glsl",modules:o,defines:l={},hookFunctions:f=[],inject:h={},prologue:g=!0,log:m}=e;OA(typeof s=="string","shader source must be a string");const A=i==="glsl"?KN(s).version:-1,y=n.shaderLanguageVersion,E=A===100?"#version 100":"#version 300 es",S=s.split(`
`).slice(1).join(`
`),x={};o.forEach(re=>{Object.assign(x,re.defines)}),Object.assign(x,l);let O="";switch(i){case"wgsl":break;case"glsl":O=g?`${E}

// ----- PROLOGUE -------------------------
${sF({id:t,source:s,stage:r})}
${`#define SHADER_TYPE_${r.toUpperCase()}`}

${XN(n)}
${r==="fragment"?ZN:""}

// ----- APPLICATION DEFINES -------------------------

${rF(x)}

`:`${E}
`;break}const R=ZS(f),D={},z={},J={};for(const re in h){const ee=typeof h[re]=="string"?{injection:h[re],order:0}:h[re],le=/^(v|f)s:(#)?([\w-]+)$/.exec(re);if(le){const fe=le[2],ye=le[3];fe?ye==="decl"?z[re]=[ee]:J[re]=[ee]:D[re]=[ee]}else J[re]=[ee]}for(const re of o){m&&YS(re,S,m);const ee=n3(re,r);O+=ee;const le=((ie=re.instance)==null?void 0:ie.normalizedInjections[r])||{};for(const fe in le){const ye=/^(v|f)s:#([\w-]+)$/.exec(fe);if(ye){const me=ye[2]==="decl"?z:J;me[fe]=me[fe]||[],me[fe].push(le[fe])}else D[fe]=D[fe]||[],D[fe].push(le[fe])}}return O+="// ----- MAIN SHADER SOURCE -------------------------",O+=e3,O=Qf(O,r,z),O+=QS(R[r],D),O+=S,O=Qf(O,r,J),i==="glsl"&&A!==y&&(O=JN(O,r)),O.trim()}function t3(n){return function(t){var r;const s={};for(const i of n){const o=(r=i.getUniforms)==null?void 0:r.call(i,t,s);Object.assign(s,o)}return s}}function sF(n){const{id:e,source:t,stage:s}=n;return e&&t.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${s}`:""}function rF(n={}){let e="";for(const t in n){const s=n[t];(s||Number.isFinite(s))&&(e+=`#define ${t.toUpperCase()} ${n[t]}
`)}return e}function n3(n,e){let t;switch(e){case"vertex":t=n.vs||"";break;case"fragment":t=n.fs||"";break;case"wgsl":t=n.source||"";break;default:OA(!1)}if(!n.name)throw new Error("Shader module must have a name");const s=n.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let r=`// ----- MODULE ${n.name} ---------------

`;return e!=="wgsl"&&(r+=`#define MODULE_${s}
`),r+=`${t}
`,r}const iF=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,oF=/^\s*\#\s*endif\s*$/;function aF(n,e){var o;const t=n.split(`
`),s=[];let r=!0,i=null;for(const l of t){const f=l.match(iF),h=l.match(oF);f?(i=f[1],r=!!((o=e==null?void 0:e.defines)!=null&&o[i])):h?r=!0:r&&s.push(l)}return s.join(`
`)}const Di=class Di{constructor(){b(this,"_hookFunctions",[]);b(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return Di.defaultShaderAssembler=Di.defaultShaderAssembler||new Di,Di.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(t=>t.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const t=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(s=>s.name!==t)}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const t=this._getModuleList(e.modules),s=this._hookFunctions,{source:r,getUniforms:i}=eF({...e,source:e.source,modules:t,hookFunctions:s});return{source:e.platformInfo.shaderLanguage==="wgsl"?aF(r):r,getUniforms:i,modules:t}}assembleGLSLShaderPair(e){const t=this._getModuleList(e.modules),s=this._hookFunctions;return{...tF({...e,vs:e.vs,fs:e.fs,modules:t,hookFunctions:s}),modules:t}}_getModuleList(e=[]){const t=new Array(this._defaultModules.length+e.length),s={};let r=0;for(let i=0,o=this._defaultModules.length;i<o;++i){const l=this._defaultModules[i],f=l.name;t[r++]=l,s[f]=!0}for(let i=0,o=e.length;i<o;++i){const l=e[i],f=l.name;s[f]||(t[r++]=l,s[f]=!0)}return t.length=r,Zf(t),t}};b(Di,"defaultShaderAssembler");let eh=Di;const cF=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,lF=`#version 300 es
${cF}`;function uF(n){const{input:e,inputChannels:t,output:s}={};if(!e)return lF;if(!t)throw new Error("inputChannels");const r=fF(t),i=hF(e,t);return`#version 300 es
in ${r} ${e};
out vec4 ${s};
void main() {
  ${s} = ${i};
}`}function fF(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${n}`)}}function hF(n,e){switch(e){case 1:return`vec4(${n}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${n}, 0.0, 1.0)`;case 3:return`vec4(${n}, 1.0)`;case 4:return n;default:throw new Error(`invalid channels: ${e}`)}}class dF{constructor(){b(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new wa({id:e})),this.stats.get(e)}}const s3=new dF,te=new Sa({id:"luma.gl"}),jp={};function Kh(n="id"){jp[n]=jp[n]||1;const e=jp[n]++;return`${n}-${e}`}var a_;let nt=(a_=class{constructor(e,t,s){b(this,"id");b(this,"props");b(this,"userData",{});b(this,"_device");b(this,"destroyed",!1);b(this,"allocatedBytes",0);b(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=gF(t,s);const r=this.props.id!=="undefined"?this.props.id:Kh(this[Symbol.toStringTag]);this.props.id=r,this.id=r,this.userData=this.props.userData||{},this.addStats()}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e,t=this[Symbol.toStringTag]){const s=this._device.statsManager.getStats("Resource Counts");s.get("GPU Memory").addCount(e),s.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}},b(a_,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),a_);function gF(n,e){const t={...e};for(const s in n)n[s]!==void 0&&(t[s]=n[s]);return t}const jt=class jt extends nt{constructor(t,s){const r={...s};(s.usage||0)&jt.INDEX&&!s.indexType&&(s.data instanceof Uint32Array?r.indexType="uint32":s.data instanceof Uint16Array&&(r.indexType="uint16")),delete r.data;super(t,r,jt.defaultProps);b(this,"usage");b(this,"indexType");b(this,"updateTimestamp");b(this,"debugData",new ArrayBuffer(0));this.usage=r.usage||0,this.indexType=r.indexType,this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}clone(t){return this.device.createBuffer({...this.props,...t})}readSyncWebGL(t,s){throw new Error("not implemented")}_setDebugData(t,s,r){const i=ArrayBuffer.isView(t)?t.buffer:t,o=Math.min(t?t.byteLength:r,jt.DEBUG_DATA_MAX_LENGTH);i===null?this.debugData=new ArrayBuffer(o):s===0&&r===i.byteLength?this.debugData=i.slice(0,o):this.debugData=i.slice(s,s+o)}};b(jt,"defaultProps",{...nt.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),b(jt,"MAP_READ",1),b(jt,"MAP_WRITE",2),b(jt,"COPY_SRC",4),b(jt,"COPY_DST",8),b(jt,"INDEX",16),b(jt,"VERTEX",32),b(jt,"UNIFORM",64),b(jt,"STORAGE",128),b(jt,"INDIRECT",256),b(jt,"QUERY_RESOLVE",512),b(jt,"DEBUG_DATA_MAX_LENGTH",32);let ut=jt;function r3(n){const e=x1[n],t=pF(e),s=n.includes("norm"),r=!s&&!n.startsWith("float"),i=n.startsWith("s");return{dataType:x1[n],byteLength:t,integer:r,signed:i,normalized:s}}function pF(n){return mF[n]}const x1={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},mF={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},Wt="texture-compression-bc",tt="texture-compression-astc",Ms="texture-compression-etc2",_F="texture-compression-etc1-webgl",Zu="texture-compression-pvrtc-webgl",zp="texture-compression-atc-webgl",ef="float32-renderable-webgl",$p="float16-renderable-webgl",AF="rgb9e5ufloat-renderable-webgl",Xp="snorm8-renderable-webgl",Oc="norm16-renderable-webgl",Jp="snorm16-renderable-webgl",tf="float32-filterable",I1="float16-filterable-webgl";function i3(n){const e=yF[n];if(!e)throw new Error(`Unsupported texture format ${n}`);return e}const yF={r8unorm:{},r8snorm:{render:Xp},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:Xp},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:$p,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:Oc},"r16snorm-webgl":{f:Jp},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:Xp},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:$p,filter:I1},"rg16unorm-webgl":{render:Oc},"rg16snorm-webgl":{render:Jp},r32uint:{},r32sint:{},r32float:{render:ef,filter:tf},rgb9e5ufloat:{channels:"rgb",packed:!0,render:AF},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:ef},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:Oc},"rgb16snorm-webgl":{f:Oc},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:tf},rgba16uint:{},rgba16sint:{},rgba16float:{render:$p,filter:I1},"rgba16unorm-webgl":{render:Oc},"rgba16snorm-webgl":{render:Jp},"rgb32float-webgl":{render:ef,filter:tf},rgba32uint:{},rgba32sint:{},rgba32float:{render:ef,filter:tf},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:Wt},"bc1-rgb-unorm-srgb-webgl":{f:Wt},"bc1-rgba-unorm":{f:Wt},"bc1-rgba-unorm-srgb":{f:Wt},"bc2-rgba-unorm":{f:Wt},"bc2-rgba-unorm-srgb":{f:Wt},"bc3-rgba-unorm":{f:Wt},"bc3-rgba-unorm-srgb":{f:Wt},"bc4-r-unorm":{f:Wt},"bc4-r-snorm":{f:Wt},"bc5-rg-unorm":{f:Wt},"bc5-rg-snorm":{f:Wt},"bc6h-rgb-ufloat":{f:Wt},"bc6h-rgb-float":{f:Wt},"bc7-rgba-unorm":{f:Wt},"bc7-rgba-unorm-srgb":{f:Wt},"etc2-rgb8unorm":{f:Ms},"etc2-rgb8unorm-srgb":{f:Ms},"etc2-rgb8a1unorm":{f:Ms},"etc2-rgb8a1unorm-srgb":{f:Ms},"etc2-rgba8unorm":{f:Ms},"etc2-rgba8unorm-srgb":{f:Ms},"eac-r11unorm":{f:Ms},"eac-r11snorm":{f:Ms},"eac-rg11unorm":{f:Ms},"eac-rg11snorm":{f:Ms},"astc-4x4-unorm":{f:tt},"astc-4x4-unorm-srgb":{f:tt},"astc-5x4-unorm":{f:tt},"astc-5x4-unorm-srgb":{f:tt},"astc-5x5-unorm":{f:tt},"astc-5x5-unorm-srgb":{f:tt},"astc-6x5-unorm":{f:tt},"astc-6x5-unorm-srgb":{f:tt},"astc-6x6-unorm":{f:tt},"astc-6x6-unorm-srgb":{f:tt},"astc-8x5-unorm":{f:tt},"astc-8x5-unorm-srgb":{f:tt},"astc-8x6-unorm":{f:tt},"astc-8x6-unorm-srgb":{f:tt},"astc-8x8-unorm":{f:tt},"astc-8x8-unorm-srgb":{f:tt},"astc-10x5-unorm":{f:tt},"astc-10x5-unorm-srgb":{f:tt},"astc-10x6-unorm":{f:tt},"astc-10x6-unorm-srgb":{f:tt},"astc-10x8-unorm":{f:tt},"astc-10x8-unorm-srgb":{f:tt},"astc-10x10-unorm":{f:tt},"astc-10x10-unorm-srgb":{f:tt},"astc-12x10-unorm":{f:tt},"astc-12x10-unorm-srgb":{f:tt},"astc-12x12-unorm":{f:tt},"astc-12x12-unorm-srgb":{f:tt},"pvrtc-rgb4unorm-webgl":{f:Zu},"pvrtc-rgba4unorm-webgl":{f:Zu},"pvrtc-rbg2unorm-webgl":{f:Zu},"pvrtc-rgba2unorm-webgl":{f:Zu},"etc1-rbg-unorm-webgl":{f:_F},"atc-rgb-unorm-webgl":{f:zp},"atc-rgba-unorm-webgl":{f:zp},"atc-rgbai-unorm-webgl":{f:zp}},bF=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],TF=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function o3(n){return bF.some(e=>n.startsWith(e))}function NA(n){let e=EF(n);if(o3(n)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const s=CF(n);s&&(e.blockWidth=s.blockWidth,e.blockHeight=s.blockHeight)}const t=TF.exec(n);if(t){const[,s,r,i,o,l]=t,f=`${i}${r}`,h=r3(f),g=h.byteLength*8,m=s.length,A=[g,m>=2?g:0,m>=3?g:0,m>=4?g:0];e={format:n,attachment:e.attachment,dataType:h.dataType,components:m,channels:s,integer:h.integer,signed:h.signed,normalized:h.normalized,bitsPerChannel:A,bytesPerPixel:h.byteLength*s.length,packed:e.packed,srgb:e.srgb},l==="-webgl"&&(e.webgl=!0),o==="-srgb"&&(e.srgb=!0)}return n.endsWith("-webgl")&&(e.webgl=!0),n.endsWith("-srgb")&&(e.srgb=!0),e}function EF(n){var i;const e=i3(n),t=e.bytesPerPixel||1,s=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:n,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||((i=e.channels)==null?void 0:i.length)||1,bytesPerPixel:t,bitsPerChannel:s,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function CF(n){const t=/.*-(\d+)x(\d+)-.*/.exec(n);if(t){const[,s,r]=t;return{blockWidth:Number(s),blockHeight:Number(r)}}return null}function vF(n){const e=i3(n),t={format:n,create:e.f??!0,render:e.render??!0,filter:e.filter??!0,blend:e.blend??!0,store:e.store??!0},s=NA(n),r=n.startsWith("depth")||n.startsWith("stencil"),i=s==null?void 0:s.signed,o=s==null?void 0:s.integer,l=s==null?void 0:s.webgl;return t.render&&(t.render=!i),t.filter&&(t.filter=!r&&!i&&!o&&!l),t}class BF{}class SF{constructor(e=[],t){b(this,"features");b(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){var t;return!((t=this.disabledFeatures)!=null&&t[e])&&this.features.has(e)}}const Oh=class Oh{constructor(e){b(this,"id");b(this,"props");b(this,"userData",{});b(this,"statsManager",s3);b(this,"timestamp",0);b(this,"_reused",!1);b(this,"_lumaData",{});this.props={...Oh.defaultProps,...e},this.id=this.props.id||Kh(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}getTextureFormatCapabilities(e){const t=vF(e),s=o=>(typeof o=="string"?this.features.has(o):o)??!0,r=s(t.create),i={format:e,create:r,render:r&&s(t.render),filter:r&&s(t.filter),blend:r&&s(t.blend),store:r&&s(t.store)};return this._getDeviceSpecificTextureFormatCapabilities(i)}isTextureFormatSupported(e,t){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return o3(e)}loseDevice(){return!1}reportError(e){this.props.onError(e)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(e={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t={...e};return(e.usage||0)&ut.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array?t.indexType="uint16":te.warn("indices buffer content must be of integer type")()),t}};b(Oh,"defaultProps",{id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>te.error(e.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:te.get("debug")||void 0,debugShaders:te.get("debug-shaders")||void 0,debugFramebuffers:!!te.get("debug-framebuffers"),debugWebGL:!!te.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0});let ei=Oh;const wF=zi()&&typeof document<"u",RF=()=>wF&&document.readyState==="complete",xF="set luma.log.level=1 (or higher) to trace rendering",M1="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.",Kr=class Kr{constructor(){b(this,"stats",s3);b(this,"log",te);b(this,"VERSION","9.1.9");b(this,"spector");b(this,"preregisteredAdapters",new Map);if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw te.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),te.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");te.error("This version of luma.gl has already been initialized")()}te.log(1,`${this.VERSION} - ${xF}`)(),globalThis.luma=this}registerAdapters(e){for(const t of e)this.preregisteredAdapters.set(t.type,t)}getSupportedAdapters(e=[]){const t=this.getAdapterMap(e);return Array.from(t).map(([,s])=>s).filter(s=>{var r;return(r=s.isSupported)==null?void 0:r.call(s)}).map(s=>s.type)}getBestAvailableAdapter(e=[]){var s,r,i,o;const t=this.getAdapterMap(e);return(r=(s=t.get("webgpu"))==null?void 0:s.isSupported)!=null&&r.call(s)?"webgpu":(o=(i=t.get("webgl"))==null?void 0:i.isSupported)!=null&&o.call(i)?"webgl":null}setDefaultDeviceProps(e){Object.assign(Kr.defaultProps,e)}async createDevice(e={}){var l;e={...Kr.defaultProps,...e},e.waitForPageLoad&&await Kr.pageLoaded;const t=this.getAdapterMap(e.adapters);let s=e.type||"";s==="best-available"&&(s=this.getBestAvailableAdapter(e.adapters)||s);const i=(this.getAdapterMap(e.adapters)||t).get(s),o=await((l=i==null?void 0:i.create)==null?void 0:l.call(i,e));if(o)return o;throw new Error(M1)}async attachDevice(e){var o;const t=this.getAdapterMap(e.adapters);let s="";e.handle instanceof WebGL2RenderingContext&&(s="webgl"),e.createCanvasContext&&await Kr.pageLoaded,e.handle===null&&(s="unknown");const r=t.get(s),i=await((o=r==null?void 0:r.attach)==null?void 0:o.call(r,null));if(i)return i;throw new Error(M1)}enforceWebGL2(e=!0,t=[]){var i;const r=this.getAdapterMap(t).get("webgl");r||te.warn("enforceWebGL2: webgl adapter not found")(),(i=r==null?void 0:r.enforceWebGL2)==null||i.call(r,e)}getAdapterMap(e=[]){const t=new Map(this.preregisteredAdapters);for(const s of e)t.set(s.type,s);return t}registerDevices(e){te.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(const t of e){const s=t.adapter;s&&this.preregisteredAdapters.set(s.type,s)}}};b(Kr,"defaultProps",{...ei.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0}),b(Kr,"pageLoaded",IF().then(()=>{te.probe(2,"DOM is loaded")()}));let p_=Kr;const m_=new p_;function IF(){return RF()||typeof window>"u"?Promise.resolve():new Promise(n=>{window.addEventListener("load",()=>n())})}class MF{}const Dh=class Dh{constructor(e){b(this,"id");b(this,"props");b(this,"canvas");b(this,"htmlCanvas");b(this,"offscreenCanvas");b(this,"type");b(this,"width",1);b(this,"height",1);b(this,"resizeObserver");b(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...Dh.defaultProps,...e},e=this.props,!zi()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=DF(e.canvas):this.canvas=e.canvas;else{const t=NF(e),s=OF((e==null?void 0:e.container)||null);s.insertBefore(t,s.firstChild),this.canvas=t,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(t=>{for(const s of t)s.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),t=this.canvas;return t.parentElement?[t.clientWidth*e,t.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,t]=this.getPixelSize();return e/t}cssToDeviceRatio(){var e;try{const[t]=this.getDrawingBufferSize(),s=this._canvasSizeInfo.clientWidth||((e=this.htmlCanvas)==null?void 0:e.clientWidth);return s?t/s:1}catch{return 1}}cssToDevicePixels(e,t=!0){const s=this.cssToDeviceRatio(),[r,i]=this.getDrawingBufferSize();return FF(e,s,r,i,t)}setDevicePixelRatio(e,t={}){if(!this.htmlCanvas)return;let s="width"in t?t.width:this.htmlCanvas.clientWidth,r="height"in t?t.height:this.htmlCanvas.clientHeight;(!s||!r)&&(te.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,s=this.htmlCanvas.width||1,r=this.htmlCanvas.height||1);const i=this._canvasSizeInfo;if(i.clientWidth!==s||i.clientHeight!==r||i.devicePixelRatio!==e){let o=e;const l=Math.floor(s*o),f=Math.floor(r*o);if(this.htmlCanvas.width=l,this.htmlCanvas.height=f,this.device.gl){const[g,m]=this.getDrawingBufferSize();(g!==l||m!==f)&&(o=Math.min(g/s,m/r),this.htmlCanvas.width=Math.floor(s*o),this.htmlCanvas.height=Math.floor(r*o),te.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=s,this._canvasSizeInfo.clientHeight=r,this._canvasSizeInfo.devicePixelRatio=e}}}getDrawingBufferSize(){const e=this.device.gl;return e?[e.drawingBufferWidth,e.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(e){var t;((t=this.htmlCanvas)==null?void 0:t.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}};b(Dh,"defaultProps",{canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"});let __=Dh;function OF(n){if(typeof n=="string"){const e=document.getElementById(n);if(!e)throw new Error(`${n} is not an HTML element`);return e}else if(n)return n;return document.body}function DF(n){const e=document.getElementById(n);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function NF(n){const{width:e,height:t}=n,s=document.createElement("canvas");return s.id=Kh("lumagl-auto-created-canvas"),s.width=e||1,s.height=t||1,s.style.width=Number.isFinite(e)?`${e}px`:"100%",s.style.height=Number.isFinite(t)?`${t}px`:"100%",s}function FF(n,e,t,s,r){const i=n,o=O1(i[0],e,t);let l=D1(i[1],e,s,r),f=O1(i[0]+1,e,t);const h=f===t-1?f:f-1;f=D1(i[1]+1,e,s,r);let g;return r?(f=f===0?f:f+1,g=l,l=f):g=f===s-1?f:f-1,{x:o,y:l,width:Math.max(h-o+1,1),height:Math.max(g-l+1,1)}}function O1(n,e,t){return Math.min(Math.round(n*e),t-1)}function D1(n,e,t,s){return s?Math.max(0,t-1-Math.round(n*e)):Math.min(Math.round(n*e),t-1)}const zt=class zt extends nt{constructor(t,s){s=zt.normalizeProps(t,s);super(t,s,zt.defaultProps);b(this,"dimension");b(this,"format");b(this,"width");b(this,"height");b(this,"depth");b(this,"mipLevels");b(this,"updateTimestamp");if(this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){const r=zt.getTextureDataSize(this.props.data);this.width=(r==null?void 0:r.width)||1,this.height=(r==null?void 0:r.height)||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?zt.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}clone(t){return this.device.createTexture({...this.props,...t})}static isExternalImage(t){return typeof ImageData<"u"&&t instanceof ImageData||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement||typeof VideoFrame<"u"&&t instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas}static getExternalImageSize(t){if(typeof ImageData<"u"&&t instanceof ImageData||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas)return{width:t.width,height:t.height};if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement)return{width:t.naturalWidth,height:t.naturalHeight};if(typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement)return{width:t.videoWidth,height:t.videoHeight};if(typeof VideoFrame<"u"&&t instanceof VideoFrame)return{width:t.displayWidth,height:t.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(t){const s=t==null?void 0:t.data;return ArrayBuffer.isView(s)}static getTextureDataSize(t){if(!t||ArrayBuffer.isView(t))return null;if(Array.isArray(t))return zt.getTextureDataSize(t[0]);if(zt.isExternalImage(t))return zt.getExternalImageSize(t);if(t&&typeof t=="object"&&t.constructor===Object){const r=Object.values(t)[0];return{width:r.width,height:r.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(t,s){let r;return ArrayBuffer.isView(t)?r=[{data:t,width:s.width,height:s.height}]:Array.isArray(t)?r=t:r=[t],r}static getMipLevelCount(t,s){return Math.floor(Math.log2(Math.max(t,s)))+1}static getCubeFaceDepth(t){switch(t){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(t)}}static normalizeProps(t,s){var f,h;const r={...s},i=((h=(f=t==null?void 0:t.props)==null?void 0:f._resourceDefaults)==null?void 0:h.texture)||{};Object.assign(r,i);const{width:o,height:l}=r;return typeof o=="number"&&(r.width=Math.max(1,Math.ceil(o))),typeof l=="number"&&(r.height=Math.max(1,Math.ceil(l))),r}};b(zt,"COPY_SRC",1),b(zt,"COPY_DST",2),b(zt,"TEXTURE",4),b(zt,"STORAGE",8),b(zt,"RENDER_ATTACHMENT",16),b(zt,"CubeFaces",["+X","-X","+Y","-Y","+Z","-Z"]),b(zt,"defaultProps",{...nt.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0}),b(zt,"defaultCopyExternalImageOptions",{image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1});let dt=zt;const Nh=class Nh extends nt{get[Symbol.toStringTag](){return"TextureView"}constructor(e,t){super(e,t,Nh.defaultProps)}};b(Nh,"defaultProps",{...nt.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let th=Nh;function PF(n,e,t){let s="";const r=e.split(/\r?\n/),i=n.slice().sort((o,l)=>o.lineNum-l.lineNum);switch((t==null?void 0:t.showSourceCode)||"no"){case"all":let o=0;for(let l=1;l<=r.length;l++)for(s+=a3(r[l-1],l,t);i.length>o&&i[o].lineNum===l;){const f=i[o++];s+=N1(f,r,f.lineNum,{...t,inlineSource:!1})}return s;case"issues":case"no":for(const l of n)s+=N1(l,r,l.lineNum,{inlineSource:(t==null?void 0:t.showSourceCode)!=="no"});return s}}function N1(n,e,t,s){if(s!=null&&s.inlineSource){const i=UF(e,t),o=n.linePos>0?`${" ".repeat(n.linePos+5)}^^^
`:"";return`
${i}${o}${n.type.toUpperCase()}: ${n.message}

`}const r=n.type==="error"?"red":"#8B4000";return s!=null&&s.html?`<div class='luma-compiler-log-error' style="color:${r};"><b> ${n.type.toUpperCase()}: ${n.message}</b></div>`:`${n.type.toUpperCase()}: ${n.message}`}function UF(n,e,t){let s="";for(let r=e-2;r<=e;r++){const i=n[r-1];i!==void 0&&(s+=a3(i,e,t))}return s}function a3(n,e,t){const s=t!=null&&t.html?kF(n):n;return`${LF(String(e),4)}: ${s}${t!=null&&t.html?"<br/>":`
`}`}function LF(n,e){let t="";for(let s=n.length;s<e;++s)t+=" ";return t+n}function kF(n){return n.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}const Fh=class Fh extends nt{constructor(t,s){s={...s,debugShaders:s.debugShaders||t.props.debugShaders||"errors"};super(t,{id:HF(s),...s},Fh.defaultProps);b(this,"stage");b(this,"source");b(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const t=this.props.debugShaders;switch(t){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const s=await this.getCompilationInfo();t==="warnings"&&(s==null?void 0:s.length)===0||this._displayShaderLog(s)}_displayShaderLog(t){var h;if(typeof document>"u"||!(document!=null&&document.createElement))return;const s=c3(this.source),r=`${this.stage} ${s}`;let i=PF(t,this.source,{showSourceCode:"all",html:!0});const o=this.getTranslatedSource();o&&(i+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${o}</pre></code>`);const l=document.createElement("Button");l.innerHTML=`
<h1>Shader Compilation Error in ${r}</h1><br /><br />
<code style="user-select:text;"><pre>
${i}
</pre></code>`,l.style.top="10px",l.style.left="10px",l.style.position="absolute",l.style.zIndex="9999",l.style.width="100%",l.style.textAlign="left",document.body.appendChild(l),(h=document.getElementsByClassName("luma-compiler-log-error")[0])==null||h.scrollIntoView(),l.onclick=()=>{const g=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(g)}}};b(Fh,"defaultProps",{...nt.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0});let nh=Fh;function HF(n){return c3(n.source)||n.id||Kh(`unnamed ${n.stage}-shader`)}function c3(n,e="unnamed"){const s=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(n);return s?s[1]:e}const hl=class hl extends nt{get[Symbol.toStringTag](){return"Sampler"}constructor(e,t){t=hl.normalizeProps(e,t),super(e,t,hl.defaultProps)}static normalizeProps(e,t){var i,o;const s=((o=(i=e==null?void 0:e.props)==null?void 0:i._resourceDefaults)==null?void 0:o.sampler)||{};return{...t,...s}}};b(hl,"defaultProps",{...nt.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let sh=hl;const Ph=class Ph extends nt{constructor(t,s={}){super(t,s,Ph.defaultProps);b(this,"width");b(this,"height");this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}clone(t){const s=this.colorAttachments.map(i=>i.texture.clone(t)),r=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(t);return this.device.createFramebuffer({...this.props,colorAttachments:s,depthStencilAttachment:r})}resize(t){let s=!t;if(t){const[r,i]=Array.isArray(t)?t:[t.width,t.height];s=s||i!==this.height||r!==this.width,this.width=r,this.height=i}s&&(te.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((s,r)=>{if(typeof s=="string"){const i=this.createColorTexture(s,r);return this.attachResource(i),i.view}return s instanceof dt?s.view:s});const t=this.props.depthStencilAttachment;if(t)if(typeof t=="string"){const s=this.createDepthStencilTexture(t);this.attachResource(s),this.depthStencilAttachment=s.view}else t instanceof dt?this.depthStencilAttachment=t.view:this.depthStencilAttachment=t}createColorTexture(t,s){return this.device.createTexture({id:`${this.id}-color-attachment-${s}`,usage:dt.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(t){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:dt.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(t,s){for(let r=0;r<this.colorAttachments.length;++r)if(this.colorAttachments[r]){const i=this.colorAttachments[r].texture.clone({width:t,height:s});this.destroyAttachedResource(this.colorAttachments[r]),this.colorAttachments[r]=i.view,this.attachResource(i.view)}if(this.depthStencilAttachment){const r=this.depthStencilAttachment.texture.clone({width:t,height:s});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=r.view,this.attachResource(r)}this.updateAttachments()}};b(Ph,"defaultProps",{...nt.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let rh=Ph;const Uh=class Uh extends nt{constructor(t,s){super(t,s,Uh.defaultProps);b(this,"shaderLayout");b(this,"bufferLayout");b(this,"linkStatus","pending");b(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(t){throw new Error("Use uniform blocks")}};b(Uh,"defaultProps",{...nt.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let ha=Uh;const ds=class ds extends nt{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,t){t=ds.normalizeProps(e,t),super(e,t,ds.defaultProps)}static normalizeProps(e,t){var i;return{...(i=e.props._resourceDefaults)==null?void 0:i.renderPass,...t}}};b(ds,"defaultClearColor",[0,0,0,1]),b(ds,"defaultClearDepth",1),b(ds,"defaultClearStencil",0),b(ds,"defaultProps",{...nt.defaultProps,framebuffer:null,parameters:void 0,clearColor:ds.defaultClearColor,clearColors:void 0,clearDepth:ds.defaultClearDepth,clearStencil:ds.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let A_=ds;const Lh=class Lh extends nt{constructor(t,s){super(t,s,Lh.defaultProps);b(this,"hash","");b(this,"shaderLayout");this.shaderLayout=s.shaderLayout}get[Symbol.toStringTag](){return"ComputePipeline"}};b(Lh,"defaultProps",{...nt.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let ih=Lh;const kh=class kh extends nt{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,t){super(e,t,kh.defaultProps)}};b(kh,"defaultProps",{...nt.defaultProps,measureExecutionTime:void 0});let y_=kh;const Hh=class Hh extends nt{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,t){super(e,t,Hh.defaultProps)}};b(Hh,"defaultProps",{...nt.defaultProps});let b_=Hh;function GF(n){const[e,t]=jF[n],s=e==="i32"||e==="u32",r=e!=="u32",i=zF[e]*t,o=VF(e,t);return{dataType:e,components:t,defaultVertexFormat:o,byteLength:i,integer:s,signed:r}}function VF(n,e){let t;switch(n){case"f32":t="float32";break;case"i32":t="sint32";break;case"u32":t="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?t:`${t}x${e}`}const jF={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},zF={f32:4,f16:2,i32:4,u32:4};function l3(n){let e;n.endsWith("-webgl")&&(n.replace("-webgl",""),e=!0);const[t,s]=n.split("x"),r=t,i=s?parseInt(s):1,o=r3(r),l={type:r,components:i,byteLength:o.byteLength*i,integer:o.integer,signed:o.signed,normalized:o.normalized};return e&&(l.webglOnly=!0),l}function u3(n,e){const t={};for(const s of n.attributes){const r=XF(n,e,s.name);r&&(t[s.name]=r)}return t}function $F(n,e,t=16){const s=u3(n,e),r=new Array(t).fill(null);for(const i of Object.values(s))r[i.location]=i;return r}function XF(n,e,t){const s=JF(n,t),r=WF(e,t);if(!s)return null;const i=GF(s.type),o=(r==null?void 0:r.vertexFormat)||i.defaultVertexFormat,l=l3(o);return{attributeName:(r==null?void 0:r.attributeName)||s.name,bufferName:(r==null?void 0:r.bufferName)||s.name,location:s.location,shaderType:s.type,shaderDataType:i.dataType,shaderComponents:i.components,vertexFormat:o,bufferDataType:l.type,bufferComponents:l.components,normalized:l.normalized,integer:i.integer,stepMode:(r==null?void 0:r.stepMode)||s.stepMode||"vertex",byteOffset:(r==null?void 0:r.byteOffset)||0,byteStride:(r==null?void 0:r.byteStride)||0}}function JF(n,e){const t=n.attributes.find(s=>s.name===e);return t||te.warn(`shader layout attribute "${e}" not present in shader`),t||null}function WF(n,e){YF(n);let t=KF(n,e);return t||(t=qF(n,e),t)?t:(te.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function YF(n){for(const e of n)(e.attributes&&e.format||!e.attributes&&!e.format)&&te.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function KF(n,e){for(const t of n)if(t.format&&t.name===e)return{attributeName:t.name,bufferName:e,stepMode:t.stepMode,vertexFormat:t.format,byteOffset:0,byteStride:t.byteStride||0};return null}function qF(n,e){var t;for(const s of n){let r=s.byteStride;if(typeof s.byteStride!="number")for(const o of s.attributes||[]){const l=l3(o.format);r+=l.byteLength}const i=(t=s.attributes)==null?void 0:t.find(o=>o.attribute===e);if(i)return{attributeName:i.attribute,bufferName:s.name,stepMode:s.stepMode,vertexFormat:i.format,byteOffset:i.byteOffset,byteStride:r}}return null}const Gh=class Gh extends nt{constructor(t,s){super(t,s,Gh.defaultProps);b(this,"maxVertexAttributes");b(this,"attributeInfos");b(this,"indexBuffer",null);b(this,"attributes");this.maxVertexAttributes=t.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);const{shaderLayout:r,bufferLayout:i}=s.renderPipeline||{};if(!r||!i)throw new Error("VertexArray");this.attributeInfos=$F(r,i,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(t,s){this.device.reportError(new Error("constant attributes not supported"))}};b(Gh,"defaultProps",{...nt.defaultProps,renderPipeline:null});let T_=Gh;const Vh=class Vh extends nt{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,t){super(e,t,Vh.defaultProps)}};b(Vh,"defaultProps",{...nt.defaultProps,layout:void 0,buffers:{}});let E_=Vh;const jh=class jh extends nt{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,t){super(e,t,jh.defaultProps)}};b(jh,"defaultProps",{...nt.defaultProps,type:void 0,count:void 0});let C_=jh;const QF={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function ZF(n){return QF[n]}function eP(n,e){switch(e){case 1:return n;case 2:return n+n%2;default:return n+(4-n%4)%4}}let nf;function f3(n){return(!nf||nf.byteLength<n)&&(nf=new ArrayBuffer(n)),nf}function tP(n,e){const t=f3(n.BYTES_PER_ELEMENT*e);return new n(t,0,e)}function nP(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function oh(n){return Array.isArray(n)?n.length===0||typeof n[0]=="number":nP(n)}const F1=1024;class sP{constructor(e){b(this,"layout",{});b(this,"byteLength");let t=0;for(const[r,i]of Object.entries(e)){const o=ZF(i),{type:l,components:f}=o;t=eP(t,f);const h=t;t+=f,this.layout[r]={type:l,size:f,offset:h}}t+=(4-t%4)%4;const s=t*4;this.byteLength=Math.max(s,F1)}getData(e){const t=Math.max(this.byteLength,F1),s=f3(t),r={i32:new Int32Array(s),u32:new Uint32Array(s),f32:new Float32Array(s),f16:new Uint16Array(s)};for(const[i,o]of Object.entries(e)){const l=this.layout[i];if(!l){te.warn(`Supplied uniform value ${i} not present in uniform block layout`)();continue}const{type:f,size:h,offset:g}=l,m=r[f];if(h===1){if(typeof o!="number"&&typeof o!="boolean"){te.warn(`Supplied value for single component uniform ${i} is not a number: ${o}`)();continue}m[g]=Number(o)}else{if(!oh(o)){te.warn(`Supplied value for multi component / array uniform ${i} is not a numeric array: ${o}`)();continue}m.set(o,g)}}return new Uint8Array(s)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function rP(n,e,t=16){if(n!==e)return!1;const s=n,r=e;if(!oh(s))return!1;if(oh(r)&&s.length===r.length){for(let i=0;i<s.length;++i)if(r[i]!==s[i])return!1}return!0}function iP(n){return oh(n)?n.slice():n}class oP{constructor(e){b(this,"name");b(this,"uniforms",{});b(this,"modifiedUniforms",{});b(this,"modified",!0);b(this,"bindingLayout",{});b(this,"needsRedraw","initialized");var t;if(this.name=(e==null?void 0:e.name)||"unnamed",e!=null&&e.name&&(e!=null&&e.shaderLayout)){const s=(t=e==null?void 0:e.shaderLayout.bindings)==null?void 0:t.find(i=>i.type==="uniform"&&i.name===(e==null?void 0:e.name));if(!s)throw new Error(e==null?void 0:e.name);const r=s;for(const i of r.uniforms||[])this.bindingLayout[i.name]=i}}setUniforms(e){for(const[t,s]of Object.entries(e))this._setUniform(t,s),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${s}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){rP(this.uniforms[e],t)||(this.uniforms[e]=iP(t),this.modifiedUniforms[e]=!0,this.modified=!0)}}class aP{constructor(e){b(this,"uniformBlocks",new Map);b(this,"uniformBufferLayouts",new Map);b(this,"uniformBuffers",new Map);for(const[t,s]of Object.entries(e)){const r=t,i=new sP(s.uniformTypes||{});this.uniformBufferLayouts.set(r,i);const o=new oP({name:t});o.setUniforms(s.defaultUniforms||{}),this.uniformBlocks.set(r,o)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){var t;for(const[s,r]of Object.entries(e))(t=this.uniformBlocks.get(s))==null||t.setUniforms(r);this.updateUniformBuffers()}getUniformBufferByteLength(e){var t;return((t=this.uniformBufferLayouts.get(e))==null?void 0:t.byteLength)||0}getUniformBufferData(e){var s,r;const t=((s=this.uniformBlocks.get(e))==null?void 0:s.getAllUniforms())||{};return(r=this.uniformBufferLayouts.get(e))==null?void 0:r.getData(t)}createUniformBuffer(e,t,s){s&&this.setUniforms(s);const r=this.getUniformBufferByteLength(t),i=e.createBuffer({usage:ut.UNIFORM|ut.COPY_DST,byteLength:r}),o=this.getUniformBufferData(t);return i.write(o),i}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){const s=this.getUniformBufferByteLength(t),r=e.createBuffer({usage:ut.UNIFORM|ut.COPY_DST,byteLength:s});this.uniformBuffers.set(t,r)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(const t of this.uniformBlocks.keys()){const s=this.updateUniformBuffer(t);e||(e=s)}return e&&te.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){var i;const t=this.uniformBlocks.get(e);let s=this.uniformBuffers.get(e),r=!1;if(s&&(t!=null&&t.needsRedraw)){r||(r=t.needsRedraw);const o=this.getUniformBufferData(e);s=this.uniformBuffers.get(e),s==null||s.write(o);const l=(i=this.uniformBlocks.get(e))==null?void 0:i.getAllUniforms();te.log(4,`Writing to uniform buffer ${String(e)}`,o,l)()}return r}}function h3(n){const e=ArrayBuffer.isView(n)?n.constructor:n;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function d3(n){switch(n){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(n)}}function cP(n,e,t){if(!e||e>4)throw new Error(`size ${e}`);const s=e;let r=h3(n);if(r==="uint8"&&t&&s===1)return"unorm8-webgl";if(r==="uint8"&&t&&s===3)return"unorm8x3-webgl";if(r==="uint8"||r==="sint8"){if(s===1||s===3)throw new Error(`size: ${e}`);return t&&(r=r.replace("int","norm")),`${r}x${s}`}if(r==="uint16"||r==="sint16"){if(s===1||s===3)throw new Error(`size: ${e}`);return t&&(r=r.replace("int","norm")),`${r}x${s}`}return s===1?r:`${r}x${s}`}class Wp{constructor(e){b(this,"bufferLayouts");this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(t=>t.name===e)||null}getAttributeNamesForBuffer(e){var t;return e.attributes?(t=e.attributes)==null?void 0:t.map(s=>s.attribute):[e.name]}mergeBufferLayouts(e,t){const s=[...e];for(const r of t){const i=s.findIndex(o=>o.name===r.name);i<0?s.push(r):s[i]=r}return s}getBufferIndex(e){const t=this.bufferLayouts.findIndex(s=>s.name===e);return t===-1&&te.warn(`BufferLayout: Missing buffer for "${e}".`)(),t}}function lP(n,e){const t=Object.fromEntries(n.attributes.map(r=>[r.name,r.location])),s=e.slice();return s.sort((r,i)=>{const o=r.attributes?r.attributes.map(g=>g.attribute):[r.name],l=i.attributes?i.attributes.map(g=>g.attribute):[i.name],f=Math.min(...o.map(g=>t[g])),h=Math.min(...l.map(g=>t[g]));return f-h}),s}class ts{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class P1{constructor(e,t,s){this.name=e,this.type=t,this.attributes=s,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}let qr=class extends ts{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}},ti=class extends ts{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}},v_=class extends ts{constructor(e,t,s){super(e,s),this.format=t}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}},Hi=class extends ts{constructor(e,t,s,r){super(e,s),this.format=t,this.access=r}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}};var Wr;(n=>{n[n.Uniform=0]="Uniform",n[n.Storage=1]="Storage",n[n.Texture=2]="Texture",n[n.Sampler=3]="Sampler",n[n.StorageTexture=4]="StorageTexture"})(Wr||(Wr={}));let sf=class{constructor(e,t,s,r,i,o,l){this.name=e,this.type=t,this.group=s,this.binding=r,this.attributes=i,this.resourceType=o,this.access=l}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}},uP=class{constructor(e,t){this.name=e,this.type=t}};class fP{constructor(e,t,s,r){this.name=e,this.type=t,this.locationType=s,this.location=r,this.interpolation=null}}class U1{constructor(e,t,s,r){this.name=e,this.type=t,this.locationType=s,this.location=r}}class hP{constructor(e,t,s,r){this.name=e,this.type=t,this.attributes=s,this.id=r}}let dP=class{constructor(e,t,s){this.name=e,this.type=t,this.attributes=s}};class gP{constructor(e,t=null,s){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t,this.attributes=s}}class pP{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}const g3=new Float32Array(1),mP=new Int32Array(g3.buffer),Yt=new Uint16Array(1);function _P(n){g3[0]=n;const e=mP[0],t=e>>31&1;let s=e>>23&255,r=8388607&e;if(s===255)return Yt[0]=t<<15|31744|(r!==0?512:0),Yt[0];if(s===0){if(r===0)return Yt[0]=t<<15,Yt[0];r|=8388608;let i=113;for(;!(8388608&r);)r<<=1,i--;return s=127-i,r&=8388607,s>0?(r=(r>>126-s)+(r>>127-s&1),Yt[0]=t<<15|s<<10|r>>13,Yt[0]):(Yt[0]=t<<15,Yt[0])}return s=s-127+15,s>=31?(Yt[0]=t<<15|31744,Yt[0]):s<=0?s<-10?(Yt[0]=t<<15,Yt[0]):(r=(8388608|r)>>1-s,Yt[0]=t<<15|r>>13,Yt[0]):(r>>=13,Yt[0]=t<<15|s<<10|r,Yt[0])}const FA=new Uint32Array(1),p3=new Float32Array(FA.buffer,0,1);function L1(n){const e=112+(n>>6&31)<<23|(63&n)<<17;return FA[0]=e,p3[0]}function AP(n,e,t,s,r,i,o,l,f){const h=s*(o>>=r)*(i>>=r)+t*o+e*l;switch(f){case"r8unorm":return[Xe(n,h,"8unorm",1)[0]];case"r8snorm":return[Xe(n,h,"8snorm",1)[0]];case"r8uint":return[Xe(n,h,"8uint",1)[0]];case"r8sint":return[Xe(n,h,"8sint",1)[0]];case"rg8unorm":{const g=Xe(n,h,"8unorm",2);return[g[0],g[1]]}case"rg8snorm":{const g=Xe(n,h,"8snorm",2);return[g[0],g[1]]}case"rg8uint":{const g=Xe(n,h,"8uint",2);return[g[0],g[1]]}case"rg8sint":{const g=Xe(n,h,"8sint",2);return[g[0],g[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const g=Xe(n,h,"8unorm",4);return[g[0],g[1],g[2],g[3]]}case"rgba8snorm":{const g=Xe(n,h,"8snorm",4);return[g[0],g[1],g[2],g[3]]}case"rgba8uint":{const g=Xe(n,h,"8uint",4);return[g[0],g[1],g[2],g[3]]}case"rgba8sint":{const g=Xe(n,h,"8sint",4);return[g[0],g[1],g[2],g[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const g=Xe(n,h,"8unorm",4);return[g[2],g[1],g[0],g[3]]}case"r16uint":return[Xe(n,h,"16uint",1)[0]];case"r16sint":return[Xe(n,h,"16sint",1)[0]];case"r16float":return[Xe(n,h,"16float",1)[0]];case"rg16uint":{const g=Xe(n,h,"16uint",2);return[g[0],g[1]]}case"rg16sint":{const g=Xe(n,h,"16sint",2);return[g[0],g[1]]}case"rg16float":{const g=Xe(n,h,"16float",2);return[g[0],g[1]]}case"rgba16uint":{const g=Xe(n,h,"16uint",4);return[g[0],g[1],g[2],g[3]]}case"rgba16sint":{const g=Xe(n,h,"16sint",4);return[g[0],g[1],g[2],g[3]]}case"rgba16float":{const g=Xe(n,h,"16float",4);return[g[0],g[1],g[2],g[3]]}case"r32uint":return[Xe(n,h,"32uint",1)[0]];case"r32sint":return[Xe(n,h,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[Xe(n,h,"32float",1)[0]];case"rg32uint":{const g=Xe(n,h,"32uint",2);return[g[0],g[1]]}case"rg32sint":{const g=Xe(n,h,"32sint",2);return[g[0],g[1]]}case"rg32float":{const g=Xe(n,h,"32float",2);return[g[0],g[1]]}case"rgba32uint":{const g=Xe(n,h,"32uint",4);return[g[0],g[1],g[2],g[3]]}case"rgba32sint":{const g=Xe(n,h,"32sint",4);return[g[0],g[1],g[2],g[3]]}case"rgba32float":{const g=Xe(n,h,"32float",4);return[g[0],g[1],g[2],g[3]]}case"rg11b10ufloat":{const g=new Uint32Array(n.buffer,h,1)[0],m=(4192256&g)>>11,A=(4290772992&g)>>22;return[L1(2047&g),L1(m),function(y){const E=112+(y>>5&31)<<23|(31&y)<<18;return FA[0]=E,p3[0]}(A),1]}}return null}function Xe(n,e,t,s){const r=[0,0,0,0];for(let h=0;h<s;++h)switch(t){case"8unorm":r[h]=n[e]/255,e++;break;case"8snorm":r[h]=n[e]/255*2-1,e++;break;case"8uint":r[h]=n[e],e++;break;case"8sint":r[h]=n[e]-127,e++;break;case"16uint":r[h]=n[e]|n[e+1]<<8,e+=2;break;case"16sint":r[h]=(n[e]|n[e+1]<<8)-32768,e+=2;break;case"16float":r[h]=(i=n[e]|n[e+1]<<8,o=void 0,l=void 0,f=void 0,o=(32768&i)>>15,f=1023&i,(l=(31744&i)>>10)==0?(o?-1:1)*Math.pow(2,-14)*(f/Math.pow(2,10)):l==31?f?NaN:1/0*(o?-1:1):(o?-1:1)*Math.pow(2,l-15)*(1+f/Math.pow(2,10))),e+=2;break;case"32uint":case"32sint":r[h]=n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24,e+=4;break;case"32float":r[h]=new Float32Array(n.buffer,e,1)[0],e+=4}var i,o,l,f;return r}function We(n,e,t,s,r){for(let i=0;i<s;++i)switch(t){case"8unorm":n[e]=255*r[i],e++;break;case"8snorm":n[e]=.5*(r[i]+1)*255,e++;break;case"8uint":n[e]=r[i],e++;break;case"8sint":n[e]=r[i]+127,e++;break;case"16uint":new Uint16Array(n.buffer,e,1)[0]=r[i],e+=2;break;case"16sint":new Int16Array(n.buffer,e,1)[0]=r[i],e+=2;break;case"16float":{const o=_P(r[i]);new Uint16Array(n.buffer,e,1)[0]=o,e+=2;break}case"32uint":new Uint32Array(n.buffer,e,1)[0]=r[i],e+=4;break;case"32sint":new Int32Array(n.buffer,e,1)[0]=r[i],e+=4;break;case"32float":new Float32Array(n.buffer,e,1)[0]=r[i],e+=4}return r}const Yp={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class rs{constructor(){this.id=rs._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,t){if(e){t(ah.instance);for(const s of e)s instanceof Array?this.searchBlock(s,t):s.search(t);t(ch.instance)}}constEvaluate(e,t){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}rs._id=0;class ah extends rs{}ah.instance=new ah;class ch extends rs{}ch.instance=new ch;const m3=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class ft extends rs{constructor(){super()}}class gl extends ft{constructor(e,t,s,r,i,o){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=s,this.body=r,this.startLine=i,this.endLine=o}get astNodeType(){return"function"}search(e){if(this.attributes)for(const t of this.attributes)e(t);e(this);for(const t of this.args)e(t);this.searchBlock(this.body,e)}}class yP extends ft{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class _3 extends ft{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class B_ extends ft{constructor(e,t){super(),this.body=e,this.loopId=t}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class A3 extends ft{constructor(e,t,s,r){super(),this.init=e,this.condition=t,this.increment=s,this.body=r}get astNodeType(){return"for"}search(e){var t,s,r;(t=this.init)===null||t===void 0||t.search(e),(s=this.condition)===null||s===void 0||s.search(e),(r=this.increment)===null||r===void 0||r.search(e),this.searchBlock(this.body,e)}}class ur extends ft{constructor(e,t,s,r,i){super(),this.attributes=null,this.name=e,this.type=t,this.storage=s,this.access=r,this.value=i}get astNodeType(){return"var"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class PA extends ft{constructor(e,t,s){super(),this.attributes=null,this.name=e,this.type=t,this.value=s}get astNodeType(){return"override"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class nl extends ft{constructor(e,t,s,r,i){super(),this.attributes=null,this.name=e,this.type=t,this.storage=s,this.access=r,this.value=i}get astNodeType(){return"let"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class Pf extends ft{constructor(e,t,s,r,i){super(),this.attributes=null,this.name=e,this.type=t,this.storage=s,this.access=r,this.value=i}get astNodeType(){return"const"}constEvaluate(e,t){return this.value.constEvaluate(e,t)}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}var Ko,$c,G,P;(n=>{n.increment="++",n.decrement="--"})(Ko||(Ko={})),(n=>{n.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for IncrementOperator");return n[t]}})(Ko||(Ko={}));class y3 extends ft{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(n=>{n.assign="=",n.addAssign="+=",n.subtractAssin="-=",n.multiplyAssign="*=",n.divideAssign="/=",n.moduloAssign="%=",n.andAssign="&=",n.orAssign="|=",n.xorAssign="^=",n.shiftLeftAssign="<<=",n.shiftRightAssign=">>="})($c||($c={})),(n=>{n.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for AssignOperator");return t}})($c||($c={}));class b3 extends ft{constructor(e,t,s){super(),this.operator=e,this.variable=t,this.value=s}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class UA extends ft{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}isBuiltin(){return m3.has(this.name)}search(e){for(const t of this.args)t.search(e);e(this)}}class T3 extends ft{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}}class E3 extends ft{constructor(e,t){super(),this.condition=e,this.cases=t}get astNodeType(){return"switch"}search(e){e(this);for(const t of this.cases)t.search(e)}}class C3 extends ft{constructor(e,t,s,r){super(),this.condition=e,this.body=t,this.elseif=s,this.else=r}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class v3 extends ft{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class bP extends ft{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class TP extends ft{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class B3 extends ft{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}}class LA extends ft{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class EP extends ft{constructor(){super()}get astNodeType(){return"discard"}}class S3 extends ft{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class w3 extends ft{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class q extends ft{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let t=e[0];if(t.name==="f32")return t;for(let s=1;s<e.length;++s){const r=q._priority.get(t.name);q._priority.get(e[s].name)<r&&(t=e[s])}return t.name==="x32"?q.i32:t}getTypeName(){return this.name}}q.x32=new q("x32"),q.f32=new q("f32"),q.i32=new q("i32"),q.u32=new q("u32"),q.f16=new q("f16"),q.bool=new q("bool"),q.void=new q("void"),q._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class k1 extends q{constructor(e){super(e)}}class cr extends q{constructor(e,t,s,r){super(e),this.members=t,this.startLine=s,this.endLine=r}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}search(e){for(const t of this.members)e(t)}}class H extends q{constructor(e,t,s){super(e),this.format=t,this.access=s}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}H.vec2f=new H("vec2",q.f32,null),H.vec3f=new H("vec3",q.f32,null),H.vec4f=new H("vec4",q.f32,null),H.vec2i=new H("vec2",q.i32,null),H.vec3i=new H("vec3",q.i32,null),H.vec4i=new H("vec4",q.i32,null),H.vec2u=new H("vec2",q.u32,null),H.vec3u=new H("vec3",q.u32,null),H.vec4u=new H("vec4",q.u32,null),H.vec2h=new H("vec2",q.f16,null),H.vec3h=new H("vec3",q.f16,null),H.vec4h=new H("vec4",q.f16,null),H.vec2b=new H("vec2",q.bool,null),H.vec3b=new H("vec3",q.bool,null),H.vec4b=new H("vec4",q.bool,null),H.mat2x2f=new H("mat2x2",q.f32,null),H.mat2x3f=new H("mat2x3",q.f32,null),H.mat2x4f=new H("mat2x4",q.f32,null),H.mat3x2f=new H("mat3x2",q.f32,null),H.mat3x3f=new H("mat3x3",q.f32,null),H.mat3x4f=new H("mat3x4",q.f32,null),H.mat4x2f=new H("mat4x2",q.f32,null),H.mat4x3f=new H("mat4x3",q.f32,null),H.mat4x4f=new H("mat4x4",q.f32,null),H.mat2x2h=new H("mat2x2",q.f16,null),H.mat2x3h=new H("mat2x3",q.f16,null),H.mat2x4h=new H("mat2x4",q.f16,null),H.mat3x2h=new H("mat3x2",q.f16,null),H.mat3x3h=new H("mat3x3",q.f16,null),H.mat3x4h=new H("mat3x4",q.f16,null),H.mat4x2h=new H("mat4x2",q.f16,null),H.mat4x3h=new H("mat4x3",q.f16,null),H.mat4x4h=new H("mat4x4",q.f16,null),H.mat2x2i=new H("mat2x2",q.i32,null),H.mat2x3i=new H("mat2x3",q.i32,null),H.mat2x4i=new H("mat2x4",q.i32,null),H.mat3x2i=new H("mat3x2",q.i32,null),H.mat3x3i=new H("mat3x3",q.i32,null),H.mat3x4i=new H("mat3x4",q.i32,null),H.mat4x2i=new H("mat4x2",q.i32,null),H.mat4x3i=new H("mat4x3",q.i32,null),H.mat4x4i=new H("mat4x4",q.i32,null),H.mat2x2u=new H("mat2x2",q.u32,null),H.mat2x3u=new H("mat2x3",q.u32,null),H.mat2x4u=new H("mat2x4",q.u32,null),H.mat3x2u=new H("mat3x2",q.u32,null),H.mat3x3u=new H("mat3x3",q.u32,null),H.mat3x4u=new H("mat3x4",q.u32,null),H.mat4x2u=new H("mat4x2",q.u32,null),H.mat4x3u=new H("mat4x3",q.u32,null),H.mat4x4u=new H("mat4x4",q.u32,null);class Uf extends q{constructor(e,t,s,r){super(e),this.storage=t,this.type=s,this.access=r}get astNodeType(){return"pointer"}}class sl extends q{constructor(e,t,s,r){super(e),this.attributes=t,this.format=s,this.count=r}get astNodeType(){return"array"}get isArray(){return!0}}class Xc extends q{constructor(e,t,s){super(e),this.format=t,this.access=s}get astNodeType(){return"sampler"}}class vs extends rs{constructor(){super(),this.postfix=null}}class Gi extends vs{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class Ns extends vs{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const t of this.args)t.search(e)}constEvaluate(e,t){return t&&(t[0]=this.type),e.evalExpression(this,e.context)}}class kA extends vs{constructor(e,t){super(),this.cachedReturnValue=null,this.name=e,this.args=t}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return m3.has(this.name)}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){for(const t of this.args)t.search(e);e(this)}}class Dn extends vs{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,t){return e.evalExpression(this,e.context)}}class R3 extends vs{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}constEvaluate(e,t){if(this.initializer){const s=e.evalExpression(this.initializer,e.context);return s!==null&&this.postfix?s.getSubData(e,this.postfix,e.context):s}return null}search(e){this.initializer.search(e)}}class xt extends vs{constructor(e,t){super(),this.value=e,this.type=t}get astNodeType(){return"literalExpr"}constEvaluate(e,t){return t!==void 0&&(t[0]=this.type),this.value}get isScalar(){return this.value instanceof F}get isVector(){return this.value instanceof w||this.value instanceof Te}get scalarValue(){return this.value instanceof F?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof w||this.value instanceof Te?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class x3 extends vs{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class da extends vs{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class I3 extends vs{constructor(){super()}}class Ct extends I3{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class hs extends I3{constructor(e,t,s){super(),this.operator=e,this.left=t,this.right=s}get astNodeType(){return"binaryOp"}_getPromotedType(e,t){return e.name===t.name?e:e.name==="f32"||t.name==="f32"?q.f32:e.name==="u32"||t.name==="u32"?q.u32:q.i32}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class M3 extends rs{constructor(e){super(),this.body=e}search(e){e(this),this.searchBlock(this.body,e)}}class Lf extends vs{constructor(){super()}get astNodeType(){return"default"}}class O3 extends M3{constructor(e,t){super(t),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class D3 extends M3{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class H1 extends rs{constructor(e,t,s){super(),this.name=e,this.type=t,this.attributes=s}get astNodeType(){return"argument"}}class CP extends rs{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class G1 extends rs{constructor(e,t,s){super(),this.name=e,this.type=t,this.attributes=s}get astNodeType(){return"member"}}class N3 extends rs{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}}class ss{constructor(e,t){this.parent=null,this.typeInfo=e,this.parent=t,this.id=ss._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,t,s,r){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,t,s){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}}ss._id=0;class S_ extends ss{constructor(){super(new ts("void",null),null)}toString(){return"void"}}S_.void=new S_;class ko extends ss{constructor(e){super(new v_("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,t,s,r){this.reference.setDataValue(e,t,s,r)}getSubData(e,t,s){return t?this.reference.getSubData(e,t,s):this}toString(){return`&${this.reference.toString()}`}}class F extends ss{constructor(e,t,s=null){super(t,s),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!=0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",t)}clone(){if(this.data instanceof Float32Array)return new F(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new F(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new F(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,t,s,r){if(s)return void console.error("SetDataValue: Scalar data does not support postfix",s);if(!(t instanceof F))return void console.error("SetDataValue: Invalid value",t);let i=t.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?i=Math.floor(i):this.typeInfo.name==="bool"&&(i=i?1:0),this.data[0]=i}getSubData(e,t,s){return t?(console.error("getSubData: Scalar data does not support postfix",t),null):this}toString(){return`${this.value}`}}function vP(n,e,t){const s=e.length;return s===2?t==="f32"?new w(new Float32Array(e),n.getTypeInfo("vec2f")):t==="i32"||t==="bool"?new w(new Int32Array(e),n.getTypeInfo("vec2i")):t==="u32"?new w(new Uint32Array(e),n.getTypeInfo("vec2u")):t==="f16"?new w(new Float32Array(e),n.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${t}`),null):s===3?t==="f32"?new w(new Float32Array(e),n.getTypeInfo("vec3f")):t==="i32"||t==="bool"?new w(new Int32Array(e),n.getTypeInfo("vec3i")):t==="u32"?new w(new Uint32Array(e),n.getTypeInfo("vec3u")):t==="f16"?new w(new Float32Array(e),n.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${t}`),null):s===4?t==="f32"?new w(new Float32Array(e),n.getTypeInfo("vec4f")):t==="i32"||t==="bool"?new w(new Int32Array(e),n.getTypeInfo("vec4i")):t==="u32"?new w(new Uint32Array(e),n.getTypeInfo("vec4u")):t==="f16"?new w(new Float32Array(e),n.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${t}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}class w extends ss{constructor(e,t,s=null){if(super(t,s),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const r=this.typeInfo.name;r==="vec2f"||r==="vec3f"||r==="vec4f"?this.data=new Float32Array(e):r==="vec2i"||r==="vec3i"||r==="vec4i"?this.data=new Int32Array(e):r==="vec2u"||r==="vec3u"||r==="vec4u"?this.data=new Uint32Array(e):r==="vec2h"||r==="vec3h"||r==="vec4h"?this.data=new Float32Array(e):r==="vec2b"||r==="vec3b"||r==="vec4b"?this.data=new Int32Array(e):r==="vec2"||r==="vec3"||r==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${r}`)}}clone(){if(this.data instanceof Float32Array)return new w(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new w(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new w(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,t,s,r){s instanceof Gi?console.error("TODO: Set vector postfix"):t instanceof w?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,s){if(t===null)return this;let r=e.getTypeInfo("f32");if(this.typeInfo instanceof Hi)r=this.typeInfo.format||r;else{const o=this.typeInfo.name;o==="vec2f"||o==="vec3f"||o==="vec4f"?r=e.getTypeInfo("f32"):o==="vec2i"||o==="vec3i"||o==="vec4i"?r=e.getTypeInfo("i32"):o==="vec2b"||o==="vec3b"||o==="vec4b"?r=e.getTypeInfo("bool"):o==="vec2u"||o==="vec3u"||o==="vec4u"?r=e.getTypeInfo("u32"):o==="vec2h"||o==="vec3h"||o==="vec4h"?r=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${o}`)}let i=this;for(;t!==null&&i!==null;){if(t instanceof da){const o=t.index;let l=-1;if(o instanceof xt){if(!(o.value instanceof F))return console.error(`GetSubData: Invalid array index ${o.value}`),null;l=o.value.value}else{const f=e.evalExpression(o,s);if(!(f instanceof F))return console.error("GetSubData: Unknown index type",o),null;l=f.value}if(l<0||l>=i.data.length)return console.error("GetSubData: Index out of range",l),null;if(i.data instanceof Float32Array){const f=new Float32Array(i.data.buffer,i.data.byteOffset+4*l,1);return new F(f,r)}if(i.data instanceof Int32Array){const f=new Int32Array(i.data.buffer,i.data.byteOffset+4*l,1);return new F(f,r)}if(i.data instanceof Uint32Array){const f=new Uint32Array(i.data.buffer,i.data.byteOffset+4*l,1);return new F(f,r)}throw"GetSubData: Invalid data type"}if(!(t instanceof Gi))return console.error("GetSubData: Unknown postfix",t),null;{const o=t.value.toLowerCase();if(o.length===1){let f=0;if(o==="x"||o==="r")f=0;else if(o==="y"||o==="g")f=1;else if(o==="z"||o==="b")f=2;else{if(o!=="w"&&o!=="a")return console.error(`GetSubData: Unknown member ${o}`),null;f=3}if(this.data instanceof Float32Array){let h=new Float32Array(this.data.buffer,this.data.byteOffset+4*f,1);return new F(h,r,this)}if(this.data instanceof Int32Array){let h=new Int32Array(this.data.buffer,this.data.byteOffset+4*f,1);return new F(h,r,this)}if(this.data instanceof Uint32Array){let h=new Uint32Array(this.data.buffer,this.data.byteOffset+4*f,1);return new F(h,r,this)}}const l=[];for(const f of o)f==="x"||f==="r"?l.push(this.data[0]):f==="y"||f==="g"?l.push(this.data[1]):f==="z"||f==="b"?l.push(this.data[2]):f==="w"||f==="a"?l.push(this.data[3]):console.error(`GetDataValue: Unknown member ${f}`);i=vP(e,l,r.name)}t=t.postfix}return i}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class Te extends ss{constructor(e,t,s=null){super(t,s),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new Te(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,t,s,r){s instanceof Gi?console.error("TODO: Set matrix postfix"):t instanceof Te?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,s){if(t===null)return this;const r=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof Hi)this.typeInfo.format;else if(r.endsWith("f"))e.getTypeInfo("f32");else if(r.endsWith("i"))e.getTypeInfo("i32");else if(r.endsWith("u"))e.getTypeInfo("u32");else{if(!r.endsWith("h"))return console.error(`GetDataValue: Unknown type ${r}`),null;e.getTypeInfo("f16")}if(t instanceof da){const i=t.index;let o=-1;if(i instanceof xt){if(!(i.value instanceof F))return console.error(`GetDataValue: Invalid array index ${i.value}`),null;o=i.value.value}else{const h=e.evalExpression(i,s);if(!(h instanceof F))return console.error("GetDataValue: Unknown index type",i),null;o=h.value}if(o<0||o>=this.data.length)return console.error("GetDataValue: Index out of range",o),null;const l=r.endsWith("h")?"h":"f";let f;if(r==="mat2x2"||r==="mat2x2f"||r==="mat2x2h"||r==="mat3x2"||r==="mat3x2f"||r==="mat3x2h"||r==="mat4x2"||r==="mat4x2f"||r==="mat4x2h")f=new w(new Float32Array(this.data.buffer,this.data.byteOffset+2*o*4,2),e.getTypeInfo(`vec2${l}`));else if(r==="mat2x3"||r==="mat2x3f"||r==="mat2x3h"||r==="mat3x3"||r==="mat3x3f"||r==="mat3x3h"||r==="mat4x3"||r==="mat4x3f"||r==="mat4x3h")f=new w(new Float32Array(this.data.buffer,this.data.byteOffset+3*o*4,3),e.getTypeInfo(`vec3${l}`));else{if(r!=="mat2x4"&&r!=="mat2x4f"&&r!=="mat2x4h"&&r!=="mat3x4"&&r!=="mat3x4f"&&r!=="mat3x4h"&&r!=="mat4x4"&&r!=="mat4x4f"&&r!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${r}`),null;f=new w(new Float32Array(this.data.buffer,this.data.byteOffset+4*o*4,4),e.getTypeInfo(`vec4${l}`))}return t.postfix?f.getSubData(e,t.postfix,s):f}return console.error("GetDataValue: Invalid postfix",t),null}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class _t extends ss{constructor(e,t,s=0,r=null){super(t,r),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=s}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new _t(e.buffer,this.typeInfo,0,null)}setDataValue(e,t,s,r){if(t===null)return void console.log("setDataValue: NULL data.");let i=this.offset,o=this.typeInfo;for(;s;){if(s instanceof da)if(o instanceof ti){const l=s.index;if(l instanceof xt){if(!(l.value instanceof F))return void console.error(`SetDataValue: Invalid index type ${l.value}`);i+=l.value.value*o.stride}else{const f=e.evalExpression(l,r);if(!(f instanceof F))return void console.error("SetDataValue: Unknown index type",l);i+=f.value*o.stride}o=o.format}else console.error(`SetDataValue: Type ${o.getTypeName()} is not an array`);else{if(!(s instanceof Gi))return void console.error("SetDataValue: Unknown postfix type",s);{const l=s.value;if(o instanceof qr){let f=!1;for(const h of o.members)if(h.name===l){i+=h.offset,o=h.type,f=!0;break}if(!f)return void console.error(`SetDataValue: Member ${l} not found`)}else if(o instanceof ts){const f=o.getTypeName();let h=0;if(l==="x"||l==="r")h=0;else if(l==="y"||l==="g")h=1;else if(l==="z"||l==="b")h=2;else{if(l!=="w"&&l!=="a")return void console.error(`SetDataValue: Unknown member ${l}`);h=3}if(!(t instanceof F))return void console.error("SetDataValue: Invalid value",t);const g=t.value;return f==="vec2f"?void(new Float32Array(this.buffer,i,2)[h]=g):f==="vec3f"?void(new Float32Array(this.buffer,i,3)[h]=g):f==="vec4f"?void(new Float32Array(this.buffer,i,4)[h]=g):f==="vec2i"?void(new Int32Array(this.buffer,i,2)[h]=g):f==="vec3i"?void(new Int32Array(this.buffer,i,3)[h]=g):f==="vec4i"?void(new Int32Array(this.buffer,i,4)[h]=g):f==="vec2u"?void(new Uint32Array(this.buffer,i,2)[h]=g):f==="vec3u"?void(new Uint32Array(this.buffer,i,3)[h]=g):f==="vec4u"?void(new Uint32Array(this.buffer,i,4)[h]=g):void console.error(`SetDataValue: Type ${f} is not a struct`)}}}s=s.postfix}this.setData(e,t,o,i,r)}setData(e,t,s,r,i){const o=s.getTypeName();if(o!=="f32"&&o!=="f16")if(o!=="i32"&&o!=="atomic<i32>"&&o!=="x32")if(o!=="u32"&&o!=="atomic<u32>")if(o!=="bool")if(o!=="vec2f"&&o!=="vec2h")if(o!=="vec3f"&&o!=="vec3h")if(o!=="vec4f"&&o!=="vec4h")if(o!=="vec2i")if(o!=="vec3i")if(o!=="vec4i")if(o!=="vec2u")if(o!=="vec3u")if(o!=="vec4u")if(o!=="vec2b")if(o!=="vec3b")if(o!=="vec4b")if(o!=="mat2x2f"&&o!=="mat2x2h")if(o!=="mat2x3f"&&o!=="mat2x3h")if(o!=="mat2x4f"&&o!=="mat2x4h")if(o!=="mat3x2f"&&o!=="mat3x2h")if(o!=="mat3x3f"&&o!=="mat3x3h")if(o!=="mat3x4f"&&o!=="mat3x4h")if(o!=="mat4x2f"&&o!=="mat4x2h")if(o!=="mat4x3f"&&o!=="mat4x3h")if(o!=="mat4x4f"&&o!=="mat4x4h")if(t instanceof _t){if(s===t.typeInfo)return void new Uint8Array(this.buffer,r,t.buffer.byteLength).set(new Uint8Array(t.buffer));console.error("SetDataValue: Type mismatch",o,t.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${o}`);else{const l=new Float32Array(this.buffer,r,16);t instanceof Te?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3],l[4]=t.data[4],l[5]=t.data[5],l[6]=t.data[6],l[7]=t.data[7],l[8]=t.data[8],l[9]=t.data[9],l[10]=t.data[10],l[11]=t.data[11],l[12]=t.data[12],l[13]=t.data[13],l[14]=t.data[14],l[15]=t.data[15]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3],l[4]=t[4],l[5]=t[5],l[6]=t[6],l[7]=t[7],l[8]=t[8],l[9]=t[9],l[10]=t[10],l[11]=t[11],l[12]=t[12],l[13]=t[13],l[14]=t[14],l[15]=t[15])}else{const l=new Float32Array(this.buffer,r,12);t instanceof Te?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3],l[4]=t.data[4],l[5]=t.data[5],l[6]=t.data[6],l[7]=t.data[7],l[8]=t.data[8],l[9]=t.data[9],l[10]=t.data[10],l[11]=t.data[11]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3],l[4]=t[4],l[5]=t[5],l[6]=t[6],l[7]=t[7],l[8]=t[8],l[9]=t[9],l[10]=t[10],l[11]=t[11])}else{const l=new Float32Array(this.buffer,r,8);t instanceof Te?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3],l[4]=t.data[4],l[5]=t.data[5],l[6]=t.data[6],l[7]=t.data[7]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3],l[4]=t[4],l[5]=t[5],l[6]=t[6],l[7]=t[7])}else{const l=new Float32Array(this.buffer,r,12);t instanceof Te?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3],l[4]=t.data[4],l[5]=t.data[5],l[6]=t.data[6],l[7]=t.data[7],l[8]=t.data[8],l[9]=t.data[9],l[10]=t.data[10],l[11]=t.data[11]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3],l[4]=t[4],l[5]=t[5],l[6]=t[6],l[7]=t[7],l[8]=t[8],l[9]=t[9],l[10]=t[10],l[11]=t[11])}else{const l=new Float32Array(this.buffer,r,9);t instanceof Te?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3],l[4]=t.data[4],l[5]=t.data[5],l[6]=t.data[6],l[7]=t.data[7],l[8]=t.data[8]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3],l[4]=t[4],l[5]=t[5],l[6]=t[6],l[7]=t[7],l[8]=t[8])}else{const l=new Float32Array(this.buffer,r,6);t instanceof Te?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3],l[4]=t.data[4],l[5]=t.data[5]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3],l[4]=t[4],l[5]=t[5])}else{const l=new Float32Array(this.buffer,r,8);t instanceof Te?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3],l[4]=t.data[4],l[5]=t.data[5],l[6]=t.data[6],l[7]=t.data[7]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3],l[4]=t[4],l[5]=t[5],l[6]=t[6],l[7]=t[7])}else{const l=new Float32Array(this.buffer,r,6);t instanceof Te?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3],l[4]=t.data[4],l[5]=t.data[5]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3],l[4]=t[4],l[5]=t[5])}else{const l=new Float32Array(this.buffer,r,4);t instanceof Te?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3])}else{const l=new Uint32Array(this.buffer,r,4);t instanceof w?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3])}else{const l=new Uint32Array(this.buffer,r,3);t instanceof w?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2]):(l[0]=t[0],l[1]=t[1],l[2]=t[2])}else{const l=new Uint32Array(this.buffer,r,2);t instanceof w?(l[0]=t.data[0],l[1]=t.data[1]):(l[0]=t[0],l[1]=t[1])}else{const l=new Uint32Array(this.buffer,r,4);t instanceof w?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3])}else{const l=new Uint32Array(this.buffer,r,3);t instanceof w?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2]):(l[0]=t[0],l[1]=t[1],l[2]=t[2])}else{const l=new Uint32Array(this.buffer,r,2);t instanceof w?(l[0]=t.data[0],l[1]=t.data[1]):(l[0]=t[0],l[1]=t[1])}else{const l=new Int32Array(this.buffer,r,4);t instanceof w?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3])}else{const l=new Int32Array(this.buffer,r,3);t instanceof w?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2]):(l[0]=t[0],l[1]=t[1],l[2]=t[2])}else{const l=new Int32Array(this.buffer,r,2);t instanceof w?(l[0]=t.data[0],l[1]=t.data[1]):(l[0]=t[0],l[1]=t[1])}else{const l=new Float32Array(this.buffer,r,4);t instanceof w?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3])}else{const l=new Float32Array(this.buffer,r,3);t instanceof w?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2]):(l[0]=t[0],l[1]=t[1],l[2]=t[2])}else{const l=new Float32Array(this.buffer,r,2);t instanceof w?(l[0]=t.data[0],l[1]=t.data[1]):(l[0]=t[0],l[1]=t[1])}else t instanceof F&&(new Int32Array(this.buffer,r,1)[0]=t.value);else t instanceof F&&(new Uint32Array(this.buffer,r,1)[0]=t.value);else t instanceof F&&(new Int32Array(this.buffer,r,1)[0]=t.value);else t instanceof F&&(new Float32Array(this.buffer,r,1)[0]=t.value)}getSubData(e,t,s){var r,i,o;if(t===null)return this;let l=this.offset,f=this.typeInfo;for(;t;){if(t instanceof da){const g=t.index,m=g instanceof vs?e.evalExpression(g,s):g;let A=0;if(m instanceof F?A=m.value:typeof m=="number"?A=m:console.error("GetDataValue: Invalid index type",g),f instanceof ti)l+=A*f.stride,f=f.format;else{const y=f.getTypeName();y==="mat4x4"||y==="mat4x4f"||y==="mat4x4h"?(l+=16*A,f=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${f.getTypeName()} is not an array`)}}else{if(!(t instanceof Gi))return console.error("GetDataValue: Unknown postfix type",t),null;{const g=t.value;if(f instanceof qr){let m=!1;for(const A of f.members)if(A.name===g){l+=A.offset,f=A.type,m=!0;break}if(!m)return console.error(`GetDataValue: Member ${g} not found`),null}else if(f instanceof ts){const m=f.getTypeName();if(m==="vec2f"||m==="vec3f"||m==="vec4f"||m==="vec2i"||m==="vec3i"||m==="vec4i"||m==="vec2u"||m==="vec3u"||m==="vec4u"||m==="vec2b"||m==="vec3b"||m==="vec4b"||m==="vec2h"||m==="vec3h"||m==="vec4h"||m==="vec2"||m==="vec3"||m==="vec4"){if(g.length>0&&g.length<5){let A="f";const y=[];for(let E=0;E<g.length;++E){const v=g[E].toLowerCase();let S=0;if(v==="x"||v==="r")S=0;else if(v==="y"||v==="g")S=1;else if(v==="z"||v==="b")S=2;else{if(v!=="w"&&v!=="a")return console.error(`Unknown member ${g}`),null;S=3}if(g.length===1){if(m.endsWith("f"))return this.buffer.byteLength<l+4*S+4?(console.log("Insufficient buffer data"),null):new F(new Float32Array(this.buffer,l+4*S,1),e.getTypeInfo("f32"),this);if(m.endsWith("h"))return new F(new Float32Array(this.buffer,l+4*S,1),e.getTypeInfo("f16"),this);if(m.endsWith("i"))return new F(new Int32Array(this.buffer,l+4*S,1),e.getTypeInfo("i32"),this);if(m.endsWith("b"))return new F(new Int32Array(this.buffer,l+4*S,1),e.getTypeInfo("bool"),this);if(m.endsWith("u"))return new F(new Uint32Array(this.buffer,l+4*S,1),e.getTypeInfo("i32"),this)}if(m==="vec2f")y.push(new Float32Array(this.buffer,l,2)[S]);else if(m==="vec3f"){if(l+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const x=new Float32Array(this.buffer,l,3);y.push(x[S])}else if(m==="vec4f")y.push(new Float32Array(this.buffer,l,4)[S]);else if(m==="vec2i")A="i",y.push(new Int32Array(this.buffer,l,2)[S]);else if(m==="vec3i")A="i",y.push(new Int32Array(this.buffer,l,3)[S]);else if(m==="vec4i")A="i",y.push(new Int32Array(this.buffer,l,4)[S]);else if(m==="vec2u"){A="u";const x=new Uint32Array(this.buffer,l,2);y.push(x[S])}else m==="vec3u"?(A="u",y.push(new Uint32Array(this.buffer,l,3)[S])):m==="vec4u"&&(A="u",y.push(new Uint32Array(this.buffer,l,4)[S]))}return y.length===2?f=e.getTypeInfo(`vec2${A}`):y.length===3?f=e.getTypeInfo(`vec3${A}`):y.length===4?f=e.getTypeInfo(`vec4${A}`):console.error(`GetDataValue: Invalid vector length ${y.length}`),new w(y,f,null)}return console.error(`GetDataValue: Unknown member ${g}`),null}return console.error(`GetDataValue: Type ${m} is not a struct`),null}}}t=t.postfix}const h=f.getTypeName();return h==="f32"?new F(new Float32Array(this.buffer,l,1),f,this):h==="i32"?new F(new Int32Array(this.buffer,l,1),f,this):h==="u32"?new F(new Uint32Array(this.buffer,l,1),f,this):h==="vec2f"?new w(new Float32Array(this.buffer,l,2),f,this):h==="vec3f"?new w(new Float32Array(this.buffer,l,3),f,this):h==="vec4f"?new w(new Float32Array(this.buffer,l,4),f,this):h==="vec2i"?new w(new Int32Array(this.buffer,l,2),f,this):h==="vec3i"?new w(new Int32Array(this.buffer,l,3),f,this):h==="vec4i"?new w(new Int32Array(this.buffer,l,4),f,this):h==="vec2u"?new w(new Uint32Array(this.buffer,l,2),f,this):h==="vec3u"?new w(new Uint32Array(this.buffer,l,3),f,this):h==="vec4u"?new w(new Uint32Array(this.buffer,l,4),f,this):f instanceof Hi&&f.name==="atomic"?((r=f.format)===null||r===void 0?void 0:r.name)==="u32"?new F(new Uint32Array(this.buffer,l,1)[0],f.format,this):((i=f.format)===null||i===void 0?void 0:i.name)==="i32"?new F(new Int32Array(this.buffer,l,1)[0],f.format,this):(console.error(`GetDataValue: Invalid atomic format ${(o=f.format)===null||o===void 0?void 0:o.name}`),null):new _t(this.buffer,f,l,this)}toString(){let e="";if(this.typeInfo instanceof ti)if(this.typeInfo.format.name==="f32"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let s=1;s<t.length;++s)e+=`, ${t[s]}`}else if(this.typeInfo.format.name==="i32"){const t=new Int32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let s=1;s<t.length;++s)e+=`, ${t[s]}`}else if(this.typeInfo.format.name==="u32"){const t=new Uint32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let s=1;s<t.length;++s)e+=`, ${t[s]}`}else if(this.typeInfo.format.name==="vec2f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}]`;for(let s=1;s<t.length/2;++s)e+=`, [${t[2*s]}, ${t[2*s+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}]`;for(let s=4;s<t.length;s+=4)e+=`, [${t[s]}, ${t[s+1]}, ${t[s+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`;for(let s=4;s<t.length;s+=4)e+=`, [${t[s]}, ${t[s+1]}, ${t[s+2]}, ${t[s+3]}]`}else e="[...]";else this.typeInfo instanceof qr?e+="{...}":e="[...]";return e}}class lr extends ss{constructor(e,t,s,r){super(t,null),this.data=e,this.descriptor=s,this.view=r}clone(){return new lr(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,t;const s=this.descriptor.size;return s instanceof Array&&s.length>0?(e=s[0])!==null&&e!==void 0?e:0:s instanceof Object&&(t=s.width)!==null&&t!==void 0?t:0}get height(){var e,t;const s=this.descriptor.size;return s instanceof Array&&s.length>1?(e=s[1])!==null&&e!==void 0?e:0:s instanceof Object&&(t=s.height)!==null&&t!==void 0?t:0}get depthOrArrayLayers(){var e,t;const s=this.descriptor.size;return s instanceof Array&&s.length>2?(e=s[2])!==null&&e!==void 0?e:0:s instanceof Object&&(t=s.depthOrArrayLayers)!==null&&t!==void 0?t:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const t=[this.width,this.height,this.depthOrArrayLayers];for(let s=0;s<t.length;++s)t[s]=Math.max(1,t[s]>>e);return t}get texelByteSize(){const e=this.format,t=Yp[e];return t?t.isDepthStencil?4:t.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,t=Yp[e];return!!t&&t.isDepthStencil}getGpuSize(){const e=this.format,t=Yp[e],s=this.width;if(!e||s<=0||!t)return-1;const r=this.height,i=this.depthOrArrayLayers,o=this.dimension;return s/t.blockWidth*(o==="1d"?1:r/t.blockHeight)*t.bytesPerBlock*i}getPixel(e,t,s=0,r=0){const i=this.texelByteSize,o=this.bytesPerRow,l=this.height,f=this.data[r];return AP(new Uint8Array(f),e,t,s,r,l,o,i,this.format)}setPixel(e,t,s,r,i){const o=this.texelByteSize,l=this.bytesPerRow,f=this.height,h=this.data[r];(function(g,m,A,y,E,v,S,x,O,R){const D=y*(S>>=E)*(v>>=E)+A*S+m*x;switch(O){case"r8unorm":return void We(g,D,"8unorm",1,R);case"r8snorm":return void We(g,D,"8snorm",1,R);case"r8uint":return void We(g,D,"8uint",1,R);case"r8sint":return void We(g,D,"8sint",1,R);case"rg8unorm":return void We(g,D,"8unorm",2,R);case"rg8snorm":return void We(g,D,"8snorm",2,R);case"rg8uint":return void We(g,D,"8uint",2,R);case"rg8sint":return void We(g,D,"8sint",2,R);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void We(g,D,"8unorm",4,R);case"rgba8snorm":return void We(g,D,"8snorm",4,R);case"rgba8uint":return void We(g,D,"8uint",4,R);case"rgba8sint":return void We(g,D,"8sint",4,R);case"r16uint":return void We(g,D,"16uint",1,R);case"r16sint":return void We(g,D,"16sint",1,R);case"r16float":return void We(g,D,"16float",1,R);case"rg16uint":return void We(g,D,"16uint",2,R);case"rg16sint":return void We(g,D,"16sint",2,R);case"rg16float":return void We(g,D,"16float",2,R);case"rgba16uint":return void We(g,D,"16uint",4,R);case"rgba16sint":return void We(g,D,"16sint",4,R);case"rgba16float":return void We(g,D,"16float",4,R);case"r32uint":return void We(g,D,"32uint",1,R);case"r32sint":return void We(g,D,"32sint",1,R);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void We(g,D,"32float",1,R);case"rg32uint":return void We(g,D,"32uint",2,R);case"rg32sint":return void We(g,D,"32sint",2,R);case"rg32float":return void We(g,D,"32float",2,R);case"rgba32uint":return void We(g,D,"32uint",4,R);case"rgba32sint":return void We(g,D,"32sint",4,R);case"rgba32float":return void We(g,D,"32float",4,R);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(h),e,t,s,r,f,l,o,this.format,i)}}(n=>{n[n.token=0]="token",n[n.keyword=1]="keyword",n[n.reserved=2]="reserved"})(P||(P={}));class U{constructor(e,t,s){this.name=e,this.type=t,this.rule=s}toString(){return this.name}}class B{}G=B,B.none=new U("",P.reserved,""),B.eof=new U("EOF",P.token,""),B.reserved={asm:new U("asm",P.reserved,"asm"),bf16:new U("bf16",P.reserved,"bf16"),do:new U("do",P.reserved,"do"),enum:new U("enum",P.reserved,"enum"),f16:new U("f16",P.reserved,"f16"),f64:new U("f64",P.reserved,"f64"),handle:new U("handle",P.reserved,"handle"),i8:new U("i8",P.reserved,"i8"),i16:new U("i16",P.reserved,"i16"),i64:new U("i64",P.reserved,"i64"),mat:new U("mat",P.reserved,"mat"),premerge:new U("premerge",P.reserved,"premerge"),regardless:new U("regardless",P.reserved,"regardless"),typedef:new U("typedef",P.reserved,"typedef"),u8:new U("u8",P.reserved,"u8"),u16:new U("u16",P.reserved,"u16"),u64:new U("u64",P.reserved,"u64"),unless:new U("unless",P.reserved,"unless"),using:new U("using",P.reserved,"using"),vec:new U("vec",P.reserved,"vec"),void:new U("void",P.reserved,"void")},B.keywords={array:new U("array",P.keyword,"array"),atomic:new U("atomic",P.keyword,"atomic"),bool:new U("bool",P.keyword,"bool"),f32:new U("f32",P.keyword,"f32"),i32:new U("i32",P.keyword,"i32"),mat2x2:new U("mat2x2",P.keyword,"mat2x2"),mat2x3:new U("mat2x3",P.keyword,"mat2x3"),mat2x4:new U("mat2x4",P.keyword,"mat2x4"),mat3x2:new U("mat3x2",P.keyword,"mat3x2"),mat3x3:new U("mat3x3",P.keyword,"mat3x3"),mat3x4:new U("mat3x4",P.keyword,"mat3x4"),mat4x2:new U("mat4x2",P.keyword,"mat4x2"),mat4x3:new U("mat4x3",P.keyword,"mat4x3"),mat4x4:new U("mat4x4",P.keyword,"mat4x4"),ptr:new U("ptr",P.keyword,"ptr"),sampler:new U("sampler",P.keyword,"sampler"),sampler_comparison:new U("sampler_comparison",P.keyword,"sampler_comparison"),struct:new U("struct",P.keyword,"struct"),texture_1d:new U("texture_1d",P.keyword,"texture_1d"),texture_2d:new U("texture_2d",P.keyword,"texture_2d"),texture_2d_array:new U("texture_2d_array",P.keyword,"texture_2d_array"),texture_3d:new U("texture_3d",P.keyword,"texture_3d"),texture_cube:new U("texture_cube",P.keyword,"texture_cube"),texture_cube_array:new U("texture_cube_array",P.keyword,"texture_cube_array"),texture_multisampled_2d:new U("texture_multisampled_2d",P.keyword,"texture_multisampled_2d"),texture_storage_1d:new U("texture_storage_1d",P.keyword,"texture_storage_1d"),texture_storage_2d:new U("texture_storage_2d",P.keyword,"texture_storage_2d"),texture_storage_2d_array:new U("texture_storage_2d_array",P.keyword,"texture_storage_2d_array"),texture_storage_3d:new U("texture_storage_3d",P.keyword,"texture_storage_3d"),texture_depth_2d:new U("texture_depth_2d",P.keyword,"texture_depth_2d"),texture_depth_2d_array:new U("texture_depth_2d_array",P.keyword,"texture_depth_2d_array"),texture_depth_cube:new U("texture_depth_cube",P.keyword,"texture_depth_cube"),texture_depth_cube_array:new U("texture_depth_cube_array",P.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new U("texture_depth_multisampled_2d",P.keyword,"texture_depth_multisampled_2d"),texture_external:new U("texture_external",P.keyword,"texture_external"),u32:new U("u32",P.keyword,"u32"),vec2:new U("vec2",P.keyword,"vec2"),vec3:new U("vec3",P.keyword,"vec3"),vec4:new U("vec4",P.keyword,"vec4"),bitcast:new U("bitcast",P.keyword,"bitcast"),block:new U("block",P.keyword,"block"),break:new U("break",P.keyword,"break"),case:new U("case",P.keyword,"case"),continue:new U("continue",P.keyword,"continue"),continuing:new U("continuing",P.keyword,"continuing"),default:new U("default",P.keyword,"default"),diagnostic:new U("diagnostic",P.keyword,"diagnostic"),discard:new U("discard",P.keyword,"discard"),else:new U("else",P.keyword,"else"),enable:new U("enable",P.keyword,"enable"),fallthrough:new U("fallthrough",P.keyword,"fallthrough"),false:new U("false",P.keyword,"false"),fn:new U("fn",P.keyword,"fn"),for:new U("for",P.keyword,"for"),function:new U("function",P.keyword,"function"),if:new U("if",P.keyword,"if"),let:new U("let",P.keyword,"let"),const:new U("const",P.keyword,"const"),loop:new U("loop",P.keyword,"loop"),while:new U("while",P.keyword,"while"),private:new U("private",P.keyword,"private"),read:new U("read",P.keyword,"read"),read_write:new U("read_write",P.keyword,"read_write"),return:new U("return",P.keyword,"return"),requires:new U("requires",P.keyword,"requires"),storage:new U("storage",P.keyword,"storage"),switch:new U("switch",P.keyword,"switch"),true:new U("true",P.keyword,"true"),alias:new U("alias",P.keyword,"alias"),type:new U("type",P.keyword,"type"),uniform:new U("uniform",P.keyword,"uniform"),var:new U("var",P.keyword,"var"),override:new U("override",P.keyword,"override"),workgroup:new U("workgroup",P.keyword,"workgroup"),write:new U("write",P.keyword,"write"),r8unorm:new U("r8unorm",P.keyword,"r8unorm"),r8snorm:new U("r8snorm",P.keyword,"r8snorm"),r8uint:new U("r8uint",P.keyword,"r8uint"),r8sint:new U("r8sint",P.keyword,"r8sint"),r16uint:new U("r16uint",P.keyword,"r16uint"),r16sint:new U("r16sint",P.keyword,"r16sint"),r16float:new U("r16float",P.keyword,"r16float"),rg8unorm:new U("rg8unorm",P.keyword,"rg8unorm"),rg8snorm:new U("rg8snorm",P.keyword,"rg8snorm"),rg8uint:new U("rg8uint",P.keyword,"rg8uint"),rg8sint:new U("rg8sint",P.keyword,"rg8sint"),r32uint:new U("r32uint",P.keyword,"r32uint"),r32sint:new U("r32sint",P.keyword,"r32sint"),r32float:new U("r32float",P.keyword,"r32float"),rg16uint:new U("rg16uint",P.keyword,"rg16uint"),rg16sint:new U("rg16sint",P.keyword,"rg16sint"),rg16float:new U("rg16float",P.keyword,"rg16float"),rgba8unorm:new U("rgba8unorm",P.keyword,"rgba8unorm"),rgba8unorm_srgb:new U("rgba8unorm_srgb",P.keyword,"rgba8unorm_srgb"),rgba8snorm:new U("rgba8snorm",P.keyword,"rgba8snorm"),rgba8uint:new U("rgba8uint",P.keyword,"rgba8uint"),rgba8sint:new U("rgba8sint",P.keyword,"rgba8sint"),bgra8unorm:new U("bgra8unorm",P.keyword,"bgra8unorm"),bgra8unorm_srgb:new U("bgra8unorm_srgb",P.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new U("rgb10a2unorm",P.keyword,"rgb10a2unorm"),rg11b10float:new U("rg11b10float",P.keyword,"rg11b10float"),rg32uint:new U("rg32uint",P.keyword,"rg32uint"),rg32sint:new U("rg32sint",P.keyword,"rg32sint"),rg32float:new U("rg32float",P.keyword,"rg32float"),rgba16uint:new U("rgba16uint",P.keyword,"rgba16uint"),rgba16sint:new U("rgba16sint",P.keyword,"rgba16sint"),rgba16float:new U("rgba16float",P.keyword,"rgba16float"),rgba32uint:new U("rgba32uint",P.keyword,"rgba32uint"),rgba32sint:new U("rgba32sint",P.keyword,"rgba32sint"),rgba32float:new U("rgba32float",P.keyword,"rgba32float"),static_assert:new U("static_assert",P.keyword,"static_assert")},B.tokens={decimal_float_literal:new U("decimal_float_literal",P.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new U("hex_float_literal",P.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new U("int_literal",P.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new U("uint_literal",P.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new U("name",P.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new U("ident",P.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new U("and",P.token,"&"),and_and:new U("and_and",P.token,"&&"),arrow:new U("arrow ",P.token,"->"),attr:new U("attr",P.token,"@"),forward_slash:new U("forward_slash",P.token,"/"),bang:new U("bang",P.token,"!"),bracket_left:new U("bracket_left",P.token,"["),bracket_right:new U("bracket_right",P.token,"]"),brace_left:new U("brace_left",P.token,"{"),brace_right:new U("brace_right",P.token,"}"),colon:new U("colon",P.token,":"),comma:new U("comma",P.token,","),equal:new U("equal",P.token,"="),equal_equal:new U("equal_equal",P.token,"=="),not_equal:new U("not_equal",P.token,"!="),greater_than:new U("greater_than",P.token,">"),greater_than_equal:new U("greater_than_equal",P.token,">="),shift_right:new U("shift_right",P.token,">>"),less_than:new U("less_than",P.token,"<"),less_than_equal:new U("less_than_equal",P.token,"<="),shift_left:new U("shift_left",P.token,"<<"),modulo:new U("modulo",P.token,"%"),minus:new U("minus",P.token,"-"),minus_minus:new U("minus_minus",P.token,"--"),period:new U("period",P.token,"."),plus:new U("plus",P.token,"+"),plus_plus:new U("plus_plus",P.token,"++"),or:new U("or",P.token,"|"),or_or:new U("or_or",P.token,"||"),paren_left:new U("paren_left",P.token,"("),paren_right:new U("paren_right",P.token,")"),semicolon:new U("semicolon",P.token,";"),star:new U("star",P.token,"*"),tilde:new U("tilde",P.token,"~"),underscore:new U("underscore",P.token,"_"),xor:new U("xor",P.token,"^"),plus_equal:new U("plus_equal",P.token,"+="),minus_equal:new U("minus_equal",P.token,"-="),times_equal:new U("times_equal",P.token,"*="),division_equal:new U("division_equal",P.token,"/="),modulo_equal:new U("modulo_equal",P.token,"%="),and_equal:new U("and_equal",P.token,"&="),or_equal:new U("or_equal",P.token,"|="),xor_equal:new U("xor_equal",P.token,"^="),shift_right_equal:new U("shift_right_equal",P.token,">>="),shift_left_equal:new U("shift_left_equal",P.token,"<<=")},B.simpleTokens={"@":G.tokens.attr,"{":G.tokens.brace_left,"}":G.tokens.brace_right,":":G.tokens.colon,",":G.tokens.comma,"(":G.tokens.paren_left,")":G.tokens.paren_right,";":G.tokens.semicolon},B.literalTokens={"&":G.tokens.and,"&&":G.tokens.and_and,"->":G.tokens.arrow,"/":G.tokens.forward_slash,"!":G.tokens.bang,"[":G.tokens.bracket_left,"]":G.tokens.bracket_right,"=":G.tokens.equal,"==":G.tokens.equal_equal,"!=":G.tokens.not_equal,">":G.tokens.greater_than,">=":G.tokens.greater_than_equal,">>":G.tokens.shift_right,"<":G.tokens.less_than,"<=":G.tokens.less_than_equal,"<<":G.tokens.shift_left,"%":G.tokens.modulo,"-":G.tokens.minus,"--":G.tokens.minus_minus,".":G.tokens.period,"+":G.tokens.plus,"++":G.tokens.plus_plus,"|":G.tokens.or,"||":G.tokens.or_or,"*":G.tokens.star,"~":G.tokens.tilde,_:G.tokens.underscore,"^":G.tokens.xor,"+=":G.tokens.plus_equal,"-=":G.tokens.minus_equal,"*=":G.tokens.times_equal,"/=":G.tokens.division_equal,"%=":G.tokens.modulo_equal,"&=":G.tokens.and_equal,"|=":G.tokens.or_equal,"^=":G.tokens.xor_equal,">>=":G.tokens.shift_right_equal,"<<=":G.tokens.shift_left_equal},B.regexTokens={decimal_float_literal:G.tokens.decimal_float_literal,hex_float_literal:G.tokens.hex_float_literal,int_literal:G.tokens.int_literal,uint_literal:G.tokens.uint_literal,ident:G.tokens.ident},B.storage_class=[G.keywords.function,G.keywords.private,G.keywords.workgroup,G.keywords.uniform,G.keywords.storage],B.access_mode=[G.keywords.read,G.keywords.write,G.keywords.read_write],B.sampler_type=[G.keywords.sampler,G.keywords.sampler_comparison],B.sampled_texture_type=[G.keywords.texture_1d,G.keywords.texture_2d,G.keywords.texture_2d_array,G.keywords.texture_3d,G.keywords.texture_cube,G.keywords.texture_cube_array],B.multisampled_texture_type=[G.keywords.texture_multisampled_2d],B.storage_texture_type=[G.keywords.texture_storage_1d,G.keywords.texture_storage_2d,G.keywords.texture_storage_2d_array,G.keywords.texture_storage_3d],B.depth_texture_type=[G.keywords.texture_depth_2d,G.keywords.texture_depth_2d_array,G.keywords.texture_depth_cube,G.keywords.texture_depth_cube_array,G.keywords.texture_depth_multisampled_2d],B.texture_external_type=[G.keywords.texture_external],B.any_texture_type=[...G.sampled_texture_type,...G.multisampled_texture_type,...G.storage_texture_type,...G.depth_texture_type,...G.texture_external_type],B.texel_format=[G.keywords.r8unorm,G.keywords.r8snorm,G.keywords.r8uint,G.keywords.r8sint,G.keywords.r16uint,G.keywords.r16sint,G.keywords.r16float,G.keywords.rg8unorm,G.keywords.rg8snorm,G.keywords.rg8uint,G.keywords.rg8sint,G.keywords.r32uint,G.keywords.r32sint,G.keywords.r32float,G.keywords.rg16uint,G.keywords.rg16sint,G.keywords.rg16float,G.keywords.rgba8unorm,G.keywords.rgba8unorm_srgb,G.keywords.rgba8snorm,G.keywords.rgba8uint,G.keywords.rgba8sint,G.keywords.bgra8unorm,G.keywords.bgra8unorm_srgb,G.keywords.rgb10a2unorm,G.keywords.rg11b10float,G.keywords.rg32uint,G.keywords.rg32sint,G.keywords.rg32float,G.keywords.rgba16uint,G.keywords.rgba16sint,G.keywords.rgba16float,G.keywords.rgba32uint,G.keywords.rgba32sint,G.keywords.rgba32float],B.const_literal=[G.tokens.int_literal,G.tokens.uint_literal,G.tokens.decimal_float_literal,G.tokens.hex_float_literal,G.keywords.true,G.keywords.false],B.literal_or_ident=[G.tokens.ident,G.tokens.int_literal,G.tokens.uint_literal,G.tokens.decimal_float_literal,G.tokens.hex_float_literal,G.tokens.name],B.element_count_expression=[G.tokens.int_literal,G.tokens.uint_literal,G.tokens.ident],B.template_types=[G.keywords.vec2,G.keywords.vec3,G.keywords.vec4,G.keywords.mat2x2,G.keywords.mat2x3,G.keywords.mat2x4,G.keywords.mat3x2,G.keywords.mat3x3,G.keywords.mat3x4,G.keywords.mat4x2,G.keywords.mat4x3,G.keywords.mat4x4,G.keywords.atomic,G.keywords.bitcast,...G.any_texture_type],B.attribute_name=[G.tokens.ident,G.keywords.block,G.keywords.diagnostic],B.assignment_operators=[G.tokens.equal,G.tokens.plus_equal,G.tokens.minus_equal,G.tokens.times_equal,G.tokens.division_equal,G.tokens.modulo_equal,G.tokens.and_equal,G.tokens.or_equal,G.tokens.xor_equal,G.tokens.shift_right_equal,G.tokens.shift_left_equal],B.increment_operators=[G.tokens.plus_plus,G.tokens.minus_minus];class V1{constructor(e,t,s,r,i){this.type=e,this.lexeme=t,this.line=s,this.start=r,this.end=i}toString(){return this.lexeme}isTemplateType(){return B.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==B.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class BP{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new V1(B.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let o=1;for(;o>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),o--,o==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),o++)}return!0}}const t=B.simpleTokens[e];if(t)return this._addToken(t),!0;let s=B.none;const r=this._isAlpha(e),i=e==="_";if(this._isAlphaNumeric(e)){let o=this._peekAhead();for(;this._isAlphaNumeric(o);)e+=this._advance(),o=this._peekAhead()}if(r){const o=B.keywords[e];if(o)return this._addToken(o),!0}if(r||i)return this._addToken(B.tokens.ident),!0;for(;;){let o=this._findType(e);const l=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(l=="=")return this._current++,e+=l,this._addToken(B.tokens.minus_equal),!0;if(l=="-")return this._current++,e+=l,this._addToken(B.tokens.minus_minus),!0;const f=this._tokens.length-1;if((B.literal_or_ident.indexOf(this._tokens[f].type)!=-1||this._tokens[f].type==B.tokens.paren_right)&&l!=">")return this._addToken(o),!0}if(e==">"&&(l==">"||l=="=")){let f=!1,h=this._tokens.length-1;for(let g=0;g<5&&h>=0&&B.assignment_operators.indexOf(this._tokens[h].type)===-1;++g,--h)if(this._tokens[h].type===B.tokens.less_than){h>0&&this._tokens[h-1].isArrayOrTemplateType()&&(f=!0);break}if(f)return this._addToken(o),!0}if(o===B.none){let f=e,h=0;const g=2;for(let m=0;m<g;++m)if(f+=this._peekAhead(m),o=this._findType(f),o!==B.none){h=m;break}if(o===B.none)return s!==B.none&&(this._current--,this._addToken(s),!0);e=f,this._current+=h+1}if(s=o,this._isAtEnd())break;e+=this._advance()}return s!==B.none&&(this._addToken(s),!0)}_findType(e){for(const s in B.regexTokens){const r=B.regexTokens[s];if(this._match(e,r.rule))return r}return B.literalTokens[e]||B.none}_match(e,t){const s=t.exec(e);return s&&s.index==0&&s[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new V1(e,t,this._line,this._start,this._current))}}function ce(n){return Array.isArray(n)||(n==null?void 0:n.buffer)instanceof ArrayBuffer}const lh=new Float32Array(1),SP=new Uint32Array(lh.buffer),wP=new Uint32Array(lh.buffer),uh=new Int32Array(1),RP=new Float32Array(uh.buffer),xP=new Uint32Array(uh.buffer),fh=new Uint32Array(1),IP=new Float32Array(fh.buffer),MP=new Int32Array(fh.buffer);function j1(n,e,t){if(e===t)return n;if(e==="f32"){if(t==="i32"||t==="x32")return lh[0]=n,SP[0];if(t==="u32")return lh[0]=n,wP[0]}else if(e==="i32"||e==="x32"){if(t==="f32")return uh[0]=n,RP[0];if(t==="u32")return uh[0]=n,xP[0]}else if(e==="u32"){if(t==="f32")return fh[0]=n,IP[0];if(t==="i32"||t==="x32")return fh[0]=n,MP[0]}return console.error(`Unsupported cast from ${e} to ${t}`),n}class OP{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class rf{constructor(e,t){this.align=e,this.size=t}}class Gs{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new pP,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const t of e)t instanceof gl&&this._functions.set(t.name,new OP(t));for(const t of e)if(t instanceof cr){const s=this.getTypeInfo(t,null);s instanceof qr&&this.structs.push(s)}for(const t of e)if(t instanceof LA)this.aliases.push(this._getAliasInfo(t));else if(t instanceof PA){const s=t,r=this._getAttributeNum(s.attributes,"id",0),i=s.type!=null?this.getTypeInfo(s.type,s.attributes):null;this.overrides.push(new hP(s.name,i,s.attributes,r))}else if(this._isUniformVar(t)){const s=t,r=this._getAttributeNum(s.attributes,"group",0),i=this._getAttributeNum(s.attributes,"binding",0),o=this.getTypeInfo(s.type,s.attributes),l=new sf(s.name,o,r,i,s.attributes,Wr.Uniform,s.access);l.access||(l.access="read"),this.uniforms.push(l)}else if(this._isStorageVar(t)){const s=t,r=this._getAttributeNum(s.attributes,"group",0),i=this._getAttributeNum(s.attributes,"binding",0),o=this.getTypeInfo(s.type,s.attributes),l=this._isStorageTexture(o),f=new sf(s.name,o,r,i,s.attributes,l?Wr.StorageTexture:Wr.Storage,s.access);f.access||(f.access="read"),this.storage.push(f)}else if(this._isTextureVar(t)){const s=t,r=this._getAttributeNum(s.attributes,"group",0),i=this._getAttributeNum(s.attributes,"binding",0),o=this.getTypeInfo(s.type,s.attributes),l=this._isStorageTexture(o),f=new sf(s.name,o,r,i,s.attributes,l?Wr.StorageTexture:Wr.Texture,s.access);f.access||(f.access="read"),l?this.storage.push(f):this.textures.push(f)}else if(this._isSamplerVar(t)){const s=t,r=this._getAttributeNum(s.attributes,"group",0),i=this._getAttributeNum(s.attributes,"binding",0),o=this.getTypeInfo(s.type,s.attributes),l=new sf(s.name,o,r,i,s.attributes,Wr.Sampler,s.access);this.samplers.push(l)}for(const t of e)if(t instanceof gl){const s=this._getAttribute(t,"vertex"),r=this._getAttribute(t,"fragment"),i=this._getAttribute(t,"compute"),o=s||r||i,l=new gP(t.name,o==null?void 0:o.name,t.attributes);l.attributes=t.attributes,l.startLine=t.startLine,l.endLine=t.endLine,this.functions.push(l),this._functions.get(t.name).info=l,o&&(this._functions.get(t.name).inUse=!0,l.inUse=!0,l.resources=this._findResources(t,!!o),l.inputs=this._getInputs(t.args),l.outputs=this._getOutputs(t.returnType),this.entry[o.name].push(l)),l.arguments=t.args.map(f=>new dP(f.name,this.getTypeInfo(f.type,f.attributes),f.attributes)),l.returnType=t.returnType?this.getTypeInfo(t.returnType,t.attributes):null}for(const t of this._functions.values())t.info&&(t.info.inUse=t.inUse,this._addCalls(t.node,t.info.calls));for(const t of this._functions.values())t.node.search(s=>{var r,i,o;if(s instanceof N3){if(s.value)if(ce(s.value))for(const l of s.value)for(const f of this.overrides)l===f.name&&((r=t.info)===null||r===void 0||r.overrides.push(f));else for(const l of this.overrides)s.value===l.name&&((i=t.info)===null||i===void 0||i.overrides.push(l))}else if(s instanceof Dn)for(const l of this.overrides)s.name===l.name&&((o=t.info)===null||o===void 0||o.overrides.push(l))});for(const t of this.uniforms)this._markStructsInUse(t.type);for(const t of this.storage)this._markStructsInUse(t.type)}getStructInfo(e){for(const t of this.structs)if(t.name==e)return t;return null}getOverrideInfo(e){for(const t of this.overrides)if(t.name==e)return t;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var s;for(const r of e.calls){const i=(s=this._functions.get(r.name))===null||s===void 0?void 0:s.info;i&&t.add(i)}}findResource(e,t,s){if(s){for(const r of this.entry.compute)if(r.name===s){for(const i of r.resources)if(i.group==e&&i.binding==t)return i}for(const r of this.entry.vertex)if(r.name===s){for(const i of r.resources)if(i.group==e&&i.binding==t)return i}for(const r of this.entry.fragment)if(r.name===s){for(const i of r.resources)if(i.group==e&&i.binding==t)return i}}for(const r of this.uniforms)if(r.group==e&&r.binding==t)return r;for(const r of this.storage)if(r.group==e&&r.binding==t)return r;for(const r of this.textures)if(r.group==e&&r.binding==t)return r;for(const r of this.samplers)if(r.group==e&&r.binding==t)return r;return null}_findResource(e){for(const t of this.uniforms)if(t.name==e)return t;for(const t of this.storage)if(t.name==e)return t;for(const t of this.textures)if(t.name==e)return t;for(const t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){const t=this.getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){const s=[],r=this,i=[];return e.search(o=>{if(o instanceof ah)i.push({});else if(o instanceof ch)i.pop();else if(o instanceof ur){const l=o;t&&l.type!==null&&this._markStructsFromAST(l.type),i.length>0&&(i[i.length-1][l.name]=l)}else if(o instanceof Ns){const l=o;t&&l.type!==null&&this._markStructsFromAST(l.type)}else if(o instanceof nl){const l=o;t&&l.type!==null&&this._markStructsFromAST(l.type),i.length>0&&(i[i.length-1][l.name]=l)}else if(o instanceof Dn){const l=o;if(i.length>0&&i[i.length-1][l.name])return;const f=r._findResource(l.name);f&&s.push(f)}else if(o instanceof kA){const l=o,f=r._functions.get(l.name);f&&(t&&(f.inUse=!0),e.calls.add(f.node),f.resources===null&&(f.resources=r._findResources(f.node,t)),s.push(...f.resources))}else if(o instanceof UA){const l=o,f=r._functions.get(l.name);f&&(t&&(f.inUse=!0),e.calls.add(f.node),f.resources===null&&(f.resources=r._findResources(f.node,t)),s.push(...f.resources))}}),[...new Map(s.map(o=>[o.name,o])).values()]}getBindGroups(){const e=[];function t(s,r){s>=e.length&&(e.length=s+1),e[s]===void 0&&(e[s]=[]),r>=e[s].length&&(e[s].length=r+1)}for(const s of this.uniforms)t(s.group,s.binding),e[s.group][s.binding]=s;for(const s of this.storage)t(s.group,s.binding),e[s.group][s.binding]=s;for(const s of this.textures)t(s.group,s.binding),e[s.group][s.binding]=s;for(const s of this.samplers)t(s.group,s.binding),e[s.group][s.binding]=s;return e}_getOutputs(e,t=void 0){if(t===void 0&&(t=[]),e instanceof cr)this._getStructOutputs(e,t);else{const s=this._getOutputInfo(e);s!==null&&t.push(s)}return t}_getStructOutputs(e,t){for(const s of e.members)if(s.type instanceof cr)this._getStructOutputs(s.type,t);else{const r=this._getAttribute(s,"location")||this._getAttribute(s,"builtin");if(r!==null){const i=this.getTypeInfo(s.type,s.type.attributes),o=this._parseInt(r.value),l=new U1(s.name,i,r.name,o);t.push(l)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const s=this.getTypeInfo(e,e.attributes),r=this._parseInt(t.value);return new U1("",s,t.name,r)}return null}_getInputs(e,t=void 0){t===void 0&&(t=[]);for(const s of e)if(s.type instanceof cr)this._getStructInputs(s.type,t);else{const r=this._getInputInfo(s);r!==null&&t.push(r)}return t}_getStructInputs(e,t){for(const s of e.members)if(s.type instanceof cr)this._getStructInputs(s.type,t);else{const r=this._getInputInfo(s);r!==null&&t.push(r)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const s=this._getAttribute(e,"interpolation"),r=this.getTypeInfo(e.type,e.attributes),i=this._parseInt(t.value),o=new fP(e.name,r,t.name,i);return s!==null&&(o.interpolation=this._parseString(s.value)),o}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new uP(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const t of this.structs)if(t.name==e)return t;for(const t of this.aliases)if(t.name==e)return t.type;return null}getTypeInfo(e,t=null){if(this._types.has(e))return this._types.get(e);if(e instanceof Uf){const r=e.type?this.getTypeInfo(e.type,e.attributes):null,i=new v_(e.name,r,t);return this._types.set(e,i),this._updateTypeInfo(i),i}if(e instanceof sl){const r=e,i=r.format?this.getTypeInfo(r.format,r.attributes):null,o=new ti(r.name,t);return o.format=i,o.count=r.count,this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof cr){const r=e,i=new qr(r.name,t);i.startLine=r.startLine,i.endLine=r.endLine;for(const o of r.members){const l=this.getTypeInfo(o.type,o.attributes);i.members.push(new P1(o.name,l,o.attributes))}return this._types.set(e,i),this._updateTypeInfo(i),i}if(e instanceof Xc){const r=e,i=r.format instanceof q,o=r.format?i?this.getTypeInfo(r.format,null):new ts(r.format,null):null,l=new Hi(r.name,o,t,r.access);return this._types.set(e,l),this._updateTypeInfo(l),l}if(e instanceof H){const r=e,i=r.format?this.getTypeInfo(r.format,null):null,o=new Hi(r.name,i,t,r.access);return this._types.set(e,o),this._updateTypeInfo(o),o}const s=new ts(e.name,t);return this._types.set(e,s),this._updateTypeInfo(s),s}_updateTypeInfo(e){var t,s,r;const i=this._getTypeSize(e);if(e.size=(t=i==null?void 0:i.size)!==null&&t!==void 0?t:0,e instanceof ti&&e.format){const o=this._getTypeSize(e.format);e.stride=Math.max((s=o==null?void 0:o.size)!==null&&s!==void 0?s:0,(r=o==null?void 0:o.align)!==null&&r!==void 0?r:0),this._updateTypeInfo(e.format)}e instanceof v_&&this._updateTypeInfo(e.format),e instanceof qr&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let s=0,r=0,i=0,o=0;for(let l=0,f=e.members.length;l<f;++l){const h=e.members[l],g=this._getTypeSize(h);if(!g)continue;(t=this._getAlias(h.type.name))!==null&&t!==void 0||h.type;const m=g.align,A=g.size;s=this._roundUp(m,s+r),r=A,i=s,o=Math.max(o,m),h.offset=s,h.size=A,this._updateTypeInfo(h.type)}e.size=this._roundUp(o,i+r),e.align=o}_getTypeSize(e){var t,s;if(e==null)return null;const r=this._getAttributeNum(e.attributes,"size",0),i=this._getAttributeNum(e.attributes,"align",0);if(e instanceof P1&&(e=e.type),e instanceof ts){const o=this._getAlias(e.name);o!==null&&(e=o)}{const o=Gs._typeInfo[e.name];if(o!==void 0){const l=((t=e.format)===null||t===void 0?void 0:t.name)==="f16"?2:1;return new rf(Math.max(i,o.align/l),Math.max(r,o.size/l))}}{const o=Gs._typeInfo[e.name.substring(0,e.name.length-1)];if(o){const l=e.name[e.name.length-1]==="h"?2:1;return new rf(Math.max(i,o.align/l),Math.max(r,o.size/l))}}if(e instanceof ti){let o=e,l=8,f=8;const h=this._getTypeSize(o.format);return h!==null&&(f=h.size,l=h.align),f=o.count*this._getAttributeNum((s=e==null?void 0:e.attributes)!==null&&s!==void 0?s:null,"stride",this._roundUp(l,f)),r&&(f=r),new rf(Math.max(i,l),Math.max(r,f))}if(e instanceof qr){let o=0,l=0,f=0,h=0,g=0;for(const m of e.members){const A=this._getTypeSize(m.type);A!==null&&(o=Math.max(A.align,o),f=this._roundUp(A.align,f+h),h=A.size,g=f)}return l=this._roundUp(o,g+h),new rf(Math.max(i,o),Math.max(r,l))}return null}_isUniformVar(e){return e instanceof ur&&e.storage=="uniform"}_isStorageVar(e){return e instanceof ur&&e.storage=="storage"}_isTextureVar(e){return e instanceof ur&&e.type!==null&&Gs._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof ur&&e.type!==null&&Gs._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,t){const s=e;if(!s||!s.attributes)return null;const r=s.attributes;for(let i of r)if(i.name==t)return i;return null}_getAttributeNum(e,t,s){if(e===null)return s;for(let r of e)if(r.name==t){let i=r!==null&&r.value!==null?r.value:s;return i instanceof Array&&(i=i[0]),typeof i=="number"?i:typeof i=="string"?parseInt(i):s}return s}_roundUp(e,t){return Math.ceil(t/e)*e}}Gs._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},Gs._textureTypes=B.any_texture_type.map(n=>n.name),Gs._samplerTypes=B.sampler_type.map(n=>n.name);let HA=0;class GA{constructor(e,t,s){this.id=HA++,this.name=e,this.value=t,this.node=s}clone(){return new GA(this.name,this.value,this.node)}}class VA{constructor(e){this.id=HA++,this.name=e.name,this.node=e}clone(){return new VA(this.node)}}class jA{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=HA++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var t;return this.variables.has(e)?(t=this.variables.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var t;return this.functions.has(e)?(t=this.functions.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getFunction(e):null}createVariable(e,t,s){this.variables.set(e,new GA(e,t,s??null))}setVariable(e,t,s){const r=this.getVariable(e);r!==null?r.value=t:this.createVariable(e,t,s)}getVariableValue(e){var t;const s=this.getVariable(e);return(t=s==null?void 0:s.value)!==null&&t!==void 0?t:null}clone(){return new jA(this)}}class DP{evalExpression(e,t){return null}getTypeInfo(e){return null}getVariableName(e,t){return""}}class NP{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,t){const s=this.exec.evalExpression(e.args[0],t);let r=!0;if(s instanceof w)return s.data.forEach(i=>{i||(r=!1)}),new F(r?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof w){const r=s.data.some(i=>i);return new F(r?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,t){const s=this.exec.evalExpression(e.args[2],t);if(!(s instanceof F))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return s.value?this.exec.evalExpression(e.args[1],t):this.exec.evalExpression(e.args[0],t)}ArrayLength(e,t){let s=e.args[0];s instanceof Ct&&(s=s.right);const r=this.exec.evalExpression(s,t);if(r instanceof _t&&r.typeInfo.size===0){const i=r.typeInfo,o=r.buffer.byteLength/i.stride;return new F(o,this.getTypeInfo("u32"))}return new F(r.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof w)return new w(s.data.map(i=>Math.abs(i)),s.typeInfo);const r=s;return new F(Math.abs(r.value),r.typeInfo)}Acos(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof w)return new w(s.data.map(i=>Math.acos(i)),s.typeInfo);const r=s;return new F(Math.acos(r.value),s.typeInfo)}Acosh(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof w)return new w(s.data.map(i=>Math.acosh(i)),s.typeInfo);const r=s;return new F(Math.acosh(r.value),s.typeInfo)}Asin(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof w)return new w(s.data.map(i=>Math.asin(i)),s.typeInfo);const r=s;return new F(Math.asin(r.value),s.typeInfo)}Asinh(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof w)return new w(s.data.map(i=>Math.asinh(i)),s.typeInfo);const r=s;return new F(Math.asinh(r.value),s.typeInfo)}Atan(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof w)return new w(s.data.map(i=>Math.atan(i)),s.typeInfo);const r=s;return new F(Math.atan(r.value),s.typeInfo)}Atanh(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof w)return new w(s.data.map(i=>Math.atanh(i)),s.typeInfo);const r=s;return new F(Math.atanh(r.value),s.typeInfo)}Atan2(e,t){const s=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(s instanceof w&&r instanceof w)return new w(s.data.map((l,f)=>Math.atan2(l,r.data[f])),s.typeInfo);const i=s,o=r;return new F(Math.atan2(i.value,o.value),s.typeInfo)}Ceil(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof w)return new w(s.data.map(i=>Math.ceil(i)),s.typeInfo);const r=s;return new F(Math.ceil(r.value),s.typeInfo)}_clamp(e,t,s){return Math.min(Math.max(e,t),s)}Clamp(e,t){const s=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),i=this.exec.evalExpression(e.args[2],t);if(s instanceof w&&r instanceof w&&i instanceof w)return new w(s.data.map((h,g)=>this._clamp(h,r.data[g],i.data[g])),s.typeInfo);const o=s,l=r,f=i;return new F(this._clamp(o.value,l.value,f.value),s.typeInfo)}Cos(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof w)return new w(s.data.map(i=>Math.cos(i)),s.typeInfo);const r=s;return new F(Math.cos(r.value),s.typeInfo)}Cosh(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof w)return new w(s.data.map(i=>Math.cosh(i)),s.typeInfo);const r=s;return new F(Math.cos(r.value),s.typeInfo)}CountLeadingZeros(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof w)return new w(s.data.map(i=>Math.clz32(i)),s.typeInfo);const r=s;return new F(Math.clz32(r.value),s.typeInfo)}_countOneBits(e){let t=0;for(;e!==0;)1&e&&t++,e>>=1;return t}CountOneBits(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof w)return new w(s.data.map(i=>this._countOneBits(i)),s.typeInfo);const r=s;return new F(this._countOneBits(r.value),s.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let t=0;for(;!(1&e);)e>>=1,t++;return t}CountTrailingZeros(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof w)return new w(s.data.map(i=>this._countTrailingZeros(i)),s.typeInfo);const r=s;return new F(this._countTrailingZeros(r.value),s.typeInfo)}Cross(e,t){const s=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(s instanceof w&&r instanceof w){if(s.data.length!==3||r.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const i=s.data,o=r.data;return new w([i[1]*o[2]-o[1]*i[2],i[2]*o[0]-o[2]*i[0],i[0]*o[1]-o[0]*i[1]],s.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,t){const s=this.exec.evalExpression(e.args[0],t),r=180/Math.PI;return s instanceof w?new w(s.data.map(i=>i*r),s.typeInfo):new F(s.value*r,this.getTypeInfo("f32"))}Determinant(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof Te){const r=s.data,i=s.typeInfo.getTypeName(),o=i.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(i==="mat2x2"||i==="mat2x2f"||i==="mat2x2h")return new F(r[0]*r[3]-r[1]*r[2],o);if(i==="mat2x3"||i==="mat2x3f"||i==="mat2x3h")return new F(r[0]*(r[4]*r[8]-r[5]*r[7])-r[1]*(r[3]*r[8]-r[5]*r[6])+r[2]*(r[3]*r[7]-r[4]*r[6]),o);if(i==="mat2x4"||i==="mat2x4f"||i==="mat2x4h")console.error(`TODO: Determinant for ${i}`);else if(i==="mat3x2"||i==="mat3x2f"||i==="mat3x2h")console.error(`TODO: Determinant for ${i}`);else{if(i==="mat3x3"||i==="mat3x3f"||i==="mat3x3h")return new F(r[0]*(r[4]*r[8]-r[5]*r[7])-r[1]*(r[3]*r[8]-r[5]*r[6])+r[2]*(r[3]*r[7]-r[4]*r[6]),o);i==="mat3x4"||i==="mat3x4f"||i==="mat3x4h"||i==="mat4x2"||i==="mat4x2f"||i==="mat4x2h"||i==="mat4x3"||i==="mat4x3f"||i==="mat4x3h"?console.error(`TODO: Determinant for ${i}`):i!=="mat4x4"&&i!=="mat4x4f"&&i!=="mat4x4h"||console.error(`TODO: Determinant for ${i}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,t){const s=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(s instanceof w&&r instanceof w){let l=0;for(let f=0;f<s.data.length;++f)l+=(s.data[f]-r.data[f])*(s.data[f]-r.data[f]);return new F(Math.sqrt(l),this.getTypeInfo("f32"))}const i=s,o=r;return new F(Math.abs(i.value-o.value),s.typeInfo)}_dot(e,t){let s=0;for(let r=0;r<e.length;++r)s+=t[r]*e[r];return s}Dot(e,t){const s=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);return s instanceof w&&r instanceof w?new F(this._dot(s.data,r.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,t){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,t){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof w)return new w(s.data.map(i=>Math.exp(i)),s.typeInfo);const r=s;return new F(Math.exp(r.value),s.typeInfo)}Exp2(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof w)return new w(s.data.map(i=>Math.pow(2,i)),s.typeInfo);const r=s;return new F(Math.pow(2,r.value),s.typeInfo)}ExtractBits(e,t){const s=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),i=this.exec.evalExpression(e.args[2],t);if(r.typeInfo.name!=="u32"&&r.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(i.typeInfo.name!=="u32"&&i.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const o=r.value,l=i.value;if(s instanceof w)return new w(s.data.map(h=>h>>o&(1<<l)-1),s.typeInfo);if(s.typeInfo.name!=="i32"&&s.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const f=s.value;return new F(f>>o&(1<<l)-1,this.getTypeInfo("i32"))}FaceForward(e,t){const s=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),i=this.exec.evalExpression(e.args[2],t);if(s instanceof w&&r instanceof w&&i instanceof w){const o=this._dot(r.data,i.data);return new w(o<0?Array.from(s.data):s.data.map(l=>-l),s.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof w)return new w(s.data.map(i=>this._firstLeadingBit(i)),s.typeInfo);const r=s;return new F(this._firstLeadingBit(r.value),s.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof w)return new w(s.data.map(i=>this._firstTrailingBit(i)),s.typeInfo);const r=s;return new F(this._firstTrailingBit(r.value),s.typeInfo)}Floor(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof w)return new w(s.data.map(i=>Math.floor(i)),s.typeInfo);const r=s;return new F(Math.floor(r.value),s.typeInfo)}Fma(e,t){const s=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),i=this.exec.evalExpression(e.args[2],t);if(s instanceof w&&r instanceof w&&i instanceof w)return s.data.length!==r.data.length||s.data.length!==i.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new w(s.data.map((h,g)=>h*r.data[g]+i.data[g]),s.typeInfo);const o=s,l=r,f=i;return new F(o.value*l.value+f.value,o.typeInfo)}Fract(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof w)return new w(s.data.map(i=>i-Math.floor(i)),s.typeInfo);const r=s;return new F(r.value-Math.floor(r.value),s.typeInfo)}Frexp(e,t){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,t){const s=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),i=this.exec.evalExpression(e.args[2],t),o=this.exec.evalExpression(e.args[3],t);if(i.typeInfo.name!=="u32"&&i.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const l=i.value,f=(1<<o.value)-1<<l,h=~f;if(s instanceof w&&r instanceof w)return new w(s.data.map((A,y)=>A&h|r.data[y]<<l&f),s.typeInfo);const g=s.value,m=r.value;return new F(g&h|m<<l&f,s.typeInfo)}InverseSqrt(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof w)return new w(s.data.map(i=>1/Math.sqrt(i)),s.typeInfo);const r=s;return new F(1/Math.sqrt(r.value),s.typeInfo)}Ldexp(e,t){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof w){let i=0;return s.data.forEach(o=>{i+=o*o}),new F(Math.sqrt(i),this.getTypeInfo("f32"))}const r=s;return new F(Math.abs(r.value),s.typeInfo)}Log(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof w)return new w(s.data.map(i=>Math.log(i)),s.typeInfo);const r=s;return new F(Math.log(r.value),s.typeInfo)}Log2(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof w)return new w(s.data.map(i=>Math.log2(i)),s.typeInfo);const r=s;return new F(Math.log2(r.value),s.typeInfo)}Max(e,t){const s=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(s instanceof w&&r instanceof w)return new w(s.data.map((l,f)=>Math.max(l,r.data[f])),s.typeInfo);const i=s,o=r;return new F(Math.max(i.value,o.value),s.typeInfo)}Min(e,t){const s=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(s instanceof w&&r instanceof w)return new w(s.data.map((l,f)=>Math.min(l,r.data[f])),s.typeInfo);const i=s,o=r;return new F(Math.min(i.value,o.value),s.typeInfo)}Mix(e,t){const s=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),i=this.exec.evalExpression(e.args[2],t);if(s instanceof w&&r instanceof w&&i instanceof w)return new w(s.data.map((f,h)=>s.data[h]*(1-i.data[h])+r.data[h]*i.data[h]),s.typeInfo);const o=r,l=i;return new F(s.value*(1-l.value)+o.value*l.value,s.typeInfo)}Modf(e,t){const s=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(s instanceof w&&r instanceof w)return new w(s.data.map((o,l)=>o%r.data[l]),s.typeInfo);const i=r;return new F(s.value%i.value,s.typeInfo)}Normalize(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof w){const r=this.Length(e,t).value;return new w(s.data.map(i=>i/r),s.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,t){const s=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(s instanceof w&&r instanceof w)return new w(s.data.map((l,f)=>Math.pow(l,r.data[f])),s.typeInfo);const i=s,o=r;return new F(Math.pow(i.value,o.value),s.typeInfo)}QuantizeToF16(e,t){const s=this.exec.evalExpression(e.args[0],t);return s instanceof w?new w(s.data.map(r=>r),s.typeInfo):new F(s.value,s.typeInfo)}Radians(e,t){const s=this.exec.evalExpression(e.args[0],t);return s instanceof w?new w(s.data.map(r=>r*Math.PI/180),s.typeInfo):new F(s.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,t){let s=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(s instanceof w&&r instanceof w){const i=this._dot(s.data,r.data);return new w(s.data.map((o,l)=>o-2*i*r.data[l]),s.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,t){let s=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),i=this.exec.evalExpression(e.args[2],t);if(s instanceof w&&r instanceof w&&i instanceof F){const o=this._dot(r.data,s.data);return new w(s.data.map((l,f)=>{const h=1-i.value*i.value*(1-o*o);if(h<0)return 0;const g=Math.sqrt(h);return i.value*l-(i.value*o+g)*r.data[f]}),s.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,t){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof w)return new w(s.data.map(i=>Math.round(i)),s.typeInfo);const r=s;return new F(Math.round(r.value),s.typeInfo)}Saturate(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof w)return new w(s.data.map(i=>Math.min(Math.max(i,0),1)),s.typeInfo);const r=s;return new F(Math.min(Math.max(r.value,0),1),s.typeInfo)}Sign(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof w)return new w(s.data.map(i=>Math.sign(i)),s.typeInfo);const r=s;return new F(Math.sign(r.value),s.typeInfo)}Sin(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof w)return new w(s.data.map(i=>Math.sin(i)),s.typeInfo);const r=s;return new F(Math.sin(r.value),s.typeInfo)}Sinh(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof w)return new w(s.data.map(i=>Math.sinh(i)),s.typeInfo);const r=s;return new F(Math.sinh(r.value),s.typeInfo)}_smoothstep(e,t,s){const r=Math.min(Math.max((s-e)/(t-e),0),1);return r*r*(3-2*r)}SmoothStep(e,t){const s=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),i=this.exec.evalExpression(e.args[2],t);if(i instanceof w&&s instanceof w&&r instanceof w)return new w(i.data.map((h,g)=>this._smoothstep(s.data[g],r.data[g],h)),i.typeInfo);const o=s,l=r,f=i;return new F(this._smoothstep(o.value,l.value,f.value),i.typeInfo)}Sqrt(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof w)return new w(s.data.map(i=>Math.sqrt(i)),s.typeInfo);const r=s;return new F(Math.sqrt(r.value),s.typeInfo)}Step(e,t){const s=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(r instanceof w&&s instanceof w)return new w(r.data.map((o,l)=>o<s.data[l]?0:1),r.typeInfo);const i=s;return new F(r.value<i.value?0:1,i.typeInfo)}Tan(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof w)return new w(s.data.map(i=>Math.tan(i)),s.typeInfo);const r=s;return new F(Math.tan(r.value),s.typeInfo)}Tanh(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof w)return new w(s.data.map(i=>Math.tanh(i)),s.typeInfo);const r=s;return new F(Math.tanh(r.value),s.typeInfo)}_getTransposeType(e){const t=e.getTypeName();return t==="mat2x2f"||t==="mat2x2h"?e:t==="mat2x3f"?this.getTypeInfo("mat3x2f"):t==="mat2x3h"?this.getTypeInfo("mat3x2h"):t==="mat2x4f"?this.getTypeInfo("mat4x2f"):t==="mat2x4h"?this.getTypeInfo("mat4x2h"):t==="mat3x2f"?this.getTypeInfo("mat2x3f"):t==="mat3x2h"?this.getTypeInfo("mat2x3h"):t==="mat3x3f"||t==="mat3x3h"?e:t==="mat3x4f"?this.getTypeInfo("mat4x3f"):t==="mat3x4h"?this.getTypeInfo("mat4x3h"):t==="mat4x2f"?this.getTypeInfo("mat2x4f"):t==="mat4x2h"?this.getTypeInfo("mat2x4h"):t==="mat4x3f"?this.getTypeInfo("mat3x4f"):t==="mat4x3h"?this.getTypeInfo("mat3x4h"):(t==="mat4x4f"||t==="mat4x4h"||console.error(`Invalid matrix type ${t}`),e)}Transpose(e,t){const s=this.exec.evalExpression(e.args[0],t);if(!(s instanceof Te))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const r=this._getTransposeType(s.typeInfo);if(s.typeInfo.name==="mat2x2"||s.typeInfo.name==="mat2x2f"||s.typeInfo.name==="mat2x2h"){const i=s.data;return new Te([i[0],i[2],i[1],i[3]],r)}if(s.typeInfo.name==="mat2x3"||s.typeInfo.name==="mat2x3f"||s.typeInfo.name==="mat2x3h"){const i=s.data;return new Te([i[0],i[3],i[6],i[1],i[4],i[7]],r)}if(s.typeInfo.name==="mat2x4"||s.typeInfo.name==="mat2x4f"||s.typeInfo.name==="mat2x4h"){const i=s.data;return new Te([i[0],i[4],i[8],i[12],i[1],i[5],i[9],i[13]],r)}if(s.typeInfo.name==="mat3x2"||s.typeInfo.name==="mat3x2f"||s.typeInfo.name==="mat3x2h"){const i=s.data;return new Te([i[0],i[3],i[1],i[4],i[2],i[5]],r)}if(s.typeInfo.name==="mat3x3"||s.typeInfo.name==="mat3x3f"||s.typeInfo.name==="mat3x3h"){const i=s.data;return new Te([i[0],i[3],i[6],i[1],i[4],i[7],i[2],i[5],i[8]],r)}if(s.typeInfo.name==="mat3x4"||s.typeInfo.name==="mat3x4f"||s.typeInfo.name==="mat3x4h"){const i=s.data;return new Te([i[0],i[4],i[8],i[12],i[1],i[5],i[9],i[13],i[2],i[6],i[10],i[14]],r)}if(s.typeInfo.name==="mat4x2"||s.typeInfo.name==="mat4x2f"||s.typeInfo.name==="mat4x2h"){const i=s.data;return new Te([i[0],i[4],i[1],i[5],i[2],i[6]],r)}if(s.typeInfo.name==="mat4x3"||s.typeInfo.name==="mat4x3f"||s.typeInfo.name==="mat4x3h"){const i=s.data;return new Te([i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]],r)}if(s.typeInfo.name==="mat4x4"||s.typeInfo.name==="mat4x4f"||s.typeInfo.name==="mat4x4h"){const i=s.data;return new Te([i[0],i[4],i[8],i[12],i[1],i[5],i[9],i[13],i[2],i[6],i[10],i[14],i[3],i[7],i[11],i[15]],r)}return console.error(`Invalid matrix type ${s.typeInfo.name}`),null}Trunc(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof w)return new w(s.data.map(i=>Math.trunc(i)),s.typeInfo);const r=s;return new F(Math.trunc(r.value),s.typeInfo)}Dpdx(e,t){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,t){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,t){return console.error("TODO: dpdxFine"),null}Dpdy(e,t){return console.error("TODO: dpdy"),null}DpdyCoarse(e,t){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,t){return console.error("TODO: dpdyFine"),null}Fwidth(e,t){return console.error("TODO: fwidth"),null}FwidthCoarse(e,t){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,t){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,t){const s=e.args[0],r=e.args.length>1?this.exec.evalExpression(e.args[1],t).value:0;if(s instanceof Dn){const i=s.name,o=t.getVariableValue(i);if(o instanceof lr){if(r<0||r>=o.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const l=o.getMipLevelSize(r),f=o.dimension;return f==="1d"?new F(l[0],this.getTypeInfo("u32")):f==="3d"?new w(l,this.getTypeInfo("vec3u")):f==="2d"?new w(l.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${f} not found. Line ${e.line}`),null)}return console.error(`Texture ${i} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,t){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,t){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,t){const s=e.args[0],r=this.exec.evalExpression(e.args[1],t),i=e.args.length>2?this.exec.evalExpression(e.args[2],t).value:0;if(!(r instanceof w)||r.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(s instanceof Dn){const o=s.name,l=t.getVariableValue(o);if(l instanceof lr){const f=Math.floor(r.data[0]),h=Math.floor(r.data[1]);if(f<0||f>=l.width||h<0||h>=l.height)return console.error(`Texture ${o} out of bounds. Line ${e.line}`),null;const g=l.getPixel(f,h,0,i);return g===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new w(g,this.getTypeInfo("vec4f"))}return console.error(`Texture ${o} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,t){const s=e.args[0];if(s instanceof Dn){const r=s.name,i=t.getVariableValue(r);return i instanceof lr?new F(i.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${r} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,t){const s=e.args[0];if(s instanceof Dn){const r=s.name,i=t.getVariableValue(r);return i instanceof lr?new F(i.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${r} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,t){const s=e.args[0];if(s instanceof Dn){const r=s.name,i=t.getVariableValue(r);return i instanceof lr?new F(i.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${r} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,t){return console.error("TODO: textureSample"),null}TextureSampleBias(e,t){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,t){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,t){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,t){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,t){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,t){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,t){const s=e.args[0],r=this.exec.evalExpression(e.args[1],t),i=e.args.length===4?this.exec.evalExpression(e.args[2],t).value:0,o=e.args.length===4?this.exec.evalExpression(e.args[3],t).data:this.exec.evalExpression(e.args[2],t).data;if(o.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(r instanceof w)||r.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(s instanceof Dn){const l=s.name,f=t.getVariableValue(l);if(f instanceof lr){const h=f.getMipLevelSize(0),g=Math.floor(r.data[0]),m=Math.floor(r.data[1]);return g<0||g>=h[0]||m<0||m>=h[1]?(console.error(`Texture ${l} out of bounds. Line ${e.line}`),null):(f.setPixel(g,m,0,i,Array.from(o)),null)}return console.error(`Texture ${l} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,t){let s=e.args[0];s instanceof Ct&&(s=s.right);const r=this.exec.getVariableName(s,t);return t.getVariable(r).value.getSubData(this.exec,s.postfix,t)}AtomicStore(e,t){let s=e.args[0];s instanceof Ct&&(s=s.right);const r=this.exec.getVariableName(s,t),i=t.getVariable(r);let o=e.args[1];const l=this.exec.evalExpression(o,t),f=i.value.getSubData(this.exec,s.postfix,t);return f instanceof F&&l instanceof F&&(f.value=l.value),i.value instanceof _t&&i.value.setDataValue(this.exec,f,s.postfix,t),null}AtomicAdd(e,t){let s=e.args[0];s instanceof Ct&&(s=s.right);const r=this.exec.getVariableName(s,t),i=t.getVariable(r);let o=e.args[1];const l=this.exec.evalExpression(o,t),f=i.value.getSubData(this.exec,s.postfix,t),h=new F(f.value,f.typeInfo);return f instanceof F&&l instanceof F&&(f.value+=l.value),i.value instanceof _t&&i.value.setDataValue(this.exec,f,s.postfix,t),h}AtomicSub(e,t){let s=e.args[0];s instanceof Ct&&(s=s.right);const r=this.exec.getVariableName(s,t),i=t.getVariable(r);let o=e.args[1];const l=this.exec.evalExpression(o,t),f=i.value.getSubData(this.exec,s.postfix,t),h=new F(f.value,f.typeInfo);return f instanceof F&&l instanceof F&&(f.value-=l.value),i.value instanceof _t&&i.value.setDataValue(this.exec,f,s.postfix,t),h}AtomicMax(e,t){let s=e.args[0];s instanceof Ct&&(s=s.right);const r=this.exec.getVariableName(s,t),i=t.getVariable(r);let o=e.args[1];const l=this.exec.evalExpression(o,t),f=i.value.getSubData(this.exec,s.postfix,t),h=new F(f.value,f.typeInfo);return f instanceof F&&l instanceof F&&(f.value=Math.max(f.value,l.value)),i.value instanceof _t&&i.value.setDataValue(this.exec,f,s.postfix,t),h}AtomicMin(e,t){let s=e.args[0];s instanceof Ct&&(s=s.right);const r=this.exec.getVariableName(s,t),i=t.getVariable(r);let o=e.args[1];const l=this.exec.evalExpression(o,t),f=i.value.getSubData(this.exec,s.postfix,t),h=new F(f.value,f.typeInfo);return f instanceof F&&l instanceof F&&(f.value=Math.min(f.value,l.value)),i.value instanceof _t&&i.value.setDataValue(this.exec,f,s.postfix,t),h}AtomicAnd(e,t){let s=e.args[0];s instanceof Ct&&(s=s.right);const r=this.exec.getVariableName(s,t),i=t.getVariable(r);let o=e.args[1];const l=this.exec.evalExpression(o,t),f=i.value.getSubData(this.exec,s.postfix,t),h=new F(f.value,f.typeInfo);return f instanceof F&&l instanceof F&&(f.value=f.value&l.value),i.value instanceof _t&&i.value.setDataValue(this.exec,f,s.postfix,t),h}AtomicOr(e,t){let s=e.args[0];s instanceof Ct&&(s=s.right);const r=this.exec.getVariableName(s,t),i=t.getVariable(r);let o=e.args[1];const l=this.exec.evalExpression(o,t),f=i.value.getSubData(this.exec,s.postfix,t),h=new F(f.value,f.typeInfo);return f instanceof F&&l instanceof F&&(f.value=f.value|l.value),i.value instanceof _t&&i.value.setDataValue(this.exec,f,s.postfix,t),h}AtomicXor(e,t){let s=e.args[0];s instanceof Ct&&(s=s.right);const r=this.exec.getVariableName(s,t),i=t.getVariable(r);let o=e.args[1];const l=this.exec.evalExpression(o,t),f=i.value.getSubData(this.exec,s.postfix,t),h=new F(f.value,f.typeInfo);return f instanceof F&&l instanceof F&&(f.value=f.value^l.value),i.value instanceof _t&&i.value.setDataValue(this.exec,f,s.postfix,t),h}AtomicExchange(e,t){let s=e.args[0];s instanceof Ct&&(s=s.right);const r=this.exec.getVariableName(s,t),i=t.getVariable(r);let o=e.args[1];const l=this.exec.evalExpression(o,t),f=i.value.getSubData(this.exec,s.postfix,t),h=new F(f.value,f.typeInfo);return f instanceof F&&l instanceof F&&(f.value=l.value),i.value instanceof _t&&i.value.setDataValue(this.exec,f,s.postfix,t),h}AtomicCompareExchangeWeak(e,t){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,t){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,t){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,t){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,t){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,t){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,t){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,t){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,t){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,t){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,t){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,t){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,t){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,t){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,t){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,t){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,t){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,t){return null}TextureBarrier(e,t){return null}WorkgroupBarrier(e,t){return null}WorkgroupUniformLoad(e,t){return null}SubgroupAdd(e,t){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,t){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,t){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,t){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,t){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,t){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,t){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,t){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,t){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,t){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,t){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,t){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,t){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,t){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,t){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,t){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,t){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,t){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,t){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,t){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,t){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,t){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,t){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,t){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,t){return console.error("TODO: quadSwapY"),null}}const Kp={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},sn={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class Kt extends DP{constructor(e,t){var s;super(),this.ast=e??[],this.reflection=new Gs,this.reflection.updateAST(this.ast),this.context=(s=t==null?void 0:t.clone())!==null&&s!==void 0?s:new jA,this.builtins=new NP(this),this.typeInfo={bool:this.getTypeInfo(q.bool),i32:this.getTypeInfo(q.i32),u32:this.getTypeInfo(q.u32),f32:this.getTypeInfo(q.f32),f16:this.getTypeInfo(q.f16),vec2f:this.getTypeInfo(H.vec2f),vec2u:this.getTypeInfo(H.vec2u),vec2i:this.getTypeInfo(H.vec2i),vec2h:this.getTypeInfo(H.vec2h),vec3f:this.getTypeInfo(H.vec3f),vec3u:this.getTypeInfo(H.vec3u),vec3i:this.getTypeInfo(H.vec3i),vec3h:this.getTypeInfo(H.vec3h),vec4f:this.getTypeInfo(H.vec4f),vec4u:this.getTypeInfo(H.vec4u),vec4i:this.getTypeInfo(H.vec4i),vec4h:this.getTypeInfo(H.vec4h),mat2x2f:this.getTypeInfo(H.mat2x2f),mat2x3f:this.getTypeInfo(H.mat2x3f),mat2x4f:this.getTypeInfo(H.mat2x4f),mat3x2f:this.getTypeInfo(H.mat3x2f),mat3x3f:this.getTypeInfo(H.mat3x3f),mat3x4f:this.getTypeInfo(H.mat3x4f),mat4x2f:this.getTypeInfo(H.mat4x2f),mat4x3f:this.getTypeInfo(H.mat4x3f),mat4x4f:this.getTypeInfo(H.mat4x4f)}}getVariableValue(e){var t,s;const r=(s=(t=this.context.getVariable(e))===null||t===void 0?void 0:t.value)!==null&&s!==void 0?s:null;if(r===null)return null;if(r instanceof F)return r.value;if(r instanceof w||r instanceof Te)return Array.from(r.data);if(r instanceof _t&&r.typeInfo instanceof ti){if(r.typeInfo.format.name==="u32")return Array.from(new Uint32Array(r.buffer,r.offset,r.typeInfo.count));if(r.typeInfo.format.name==="i32")return Array.from(new Int32Array(r.buffer,r.offset,r.typeInfo.count));if(r.typeInfo.format.name==="f32")return Array.from(new Float32Array(r.buffer,r.offset,r.typeInfo.count))}return console.error(`Unsupported return variable type ${r.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,t,s,r){const i=this.context.clone();(r=r??{}).constants&&this._setOverrides(r.constants,i),this._execStatements(this.ast,i);const o=i.getFunction(e);if(!o)return void console.error(`Function ${e} not found`);if(typeof t=="number")t=[t,1,1];else{if(t.length===0)return void console.error("Invalid dispatch count");t.length===1?t=[t[0],1,1]:t.length===2?t=[t[0],t[1],1]:t.length>3&&(t=[t[0],t[1],t[2]])}const l=t[0],f=t[1],h=t[2],g=this.getTypeInfo("vec3u");i.setVariable("@num_workgroups",new w(t,g));for(const m in s)for(const A in s[m]){const y=s[m][A];i.variables.forEach(E=>{var v;const S=E.node;if(S!=null&&S.attributes){let x=null,O=null;for(const R of S.attributes)R.name==="binding"?x=R.value:R.name==="group"&&(O=R.value);if(A==x&&m==O)if(y.texture!==void 0&&y.descriptor!==void 0){const R=new lr(y.texture,this.getTypeInfo(S.type),y.descriptor,(v=y.texture.view)!==null&&v!==void 0?v:null);E.value=R}else y.uniform!==void 0?E.value=new _t(y.uniform,this.getTypeInfo(S.type)):E.value=new _t(y,this.getTypeInfo(S.type))}})}for(let m=0;m<h;++m)for(let A=0;A<f;++A)for(let y=0;y<l;++y)i.setVariable("@workgroup_id",new w([y,A,m],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(o,[y,A,m],i)}execStatement(e,t){if(e instanceof v3)return this.evalExpression(e.value,t);if(e instanceof S3){if(e.condition){const s=this.evalExpression(e.condition,t);if(!(s instanceof F))throw new Error("Invalid break-if condition");if(!s.value)return null}return Kt._breakObj}if(e instanceof w3)return Kt._continueObj;if(e instanceof nl)this._let(e,t);else if(e instanceof ur)this._var(e,t);else if(e instanceof Pf)this._const(e,t);else if(e instanceof gl)this._function(e,t);else{if(e instanceof C3)return this._if(e,t);if(e instanceof E3)return this._switch(e,t);if(e instanceof A3)return this._for(e,t);if(e instanceof _3)return this._while(e,t);if(e instanceof T3)return this._loop(e,t);if(e instanceof B_){const s=t.clone();return s.currentFunctionName=t.currentFunctionName,this._execStatements(e.body,s)}if(e instanceof b3)this._assign(e,t);else if(e instanceof y3)this._increment(e,t);else{if(e instanceof cr)return null;if(e instanceof PA){const s=e.name;t.getVariable(s)===null&&t.setVariable(s,new F(0,this.getTypeInfo("u32")))}else if(e instanceof UA)this._call(e,t);else{if(e instanceof B3||e instanceof LA)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,t){return e instanceof hs?this._evalBinaryOp(e,t):e instanceof xt?this._evalLiteral(e,t):e instanceof Dn?this._evalVariable(e,t):e instanceof kA?this._evalCall(e,t):e instanceof Ns?this._evalCreate(e,t):e instanceof R3?this._evalConst(e,t):e instanceof x3?this._evalBitcast(e,t):e instanceof Ct?this._evalUnaryOp(e,t):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var t;if(e instanceof q){const r=this.reflection.getTypeInfo(e);if(r!==null)return r}let s=(t=this.typeInfo[e])!==null&&t!==void 0?t:null;return s!==null||(s=this.reflection.getTypeInfoByName(e)),s}_setOverrides(e,t){for(const s in e){const r=e[s],i=this.reflection.getOverrideInfo(s);i!==null?(i.type===null&&(i.type=this.getTypeInfo("u32")),i.type.name==="u32"||i.type.name==="i32"||i.type.name==="f32"||i.type.name==="f16"?t.setVariable(s,new F(r,i.type)):i.type.name==="bool"?t.setVariable(s,new F(r?1:0,i.type)):i.type.name==="vec2"||i.type.name==="vec3"||i.type.name==="vec4"||i.type.name==="vec2f"||i.type.name==="vec3f"||i.type.name==="vec4f"||i.type.name==="vec2i"||i.type.name==="vec3i"||i.type.name==="vec4i"||i.type.name==="vec2u"||i.type.name==="vec3u"||i.type.name==="vec4u"||i.type.name==="vec2h"||i.type.name==="vec3h"||i.type.name==="vec4h"?t.setVariable(s,new w(r,i.type)):console.error(`Invalid constant type for ${s}`)):console.error(`Override ${s} does not exist in the shader.`)}}_dispatchWorkgroup(e,t,s){const r=[1,1,1];for(const g of e.node.attributes)if(g.name==="workgroup_size"){if(g.value.length>0){const m=s.getVariableValue(g.value[0]);r[0]=m instanceof F?m.value:parseInt(g.value[0])}if(g.value.length>1){const m=s.getVariableValue(g.value[1]);r[1]=m instanceof F?m.value:parseInt(g.value[1])}if(g.value.length>2){const m=s.getVariableValue(g.value[2]);r[2]=m instanceof F?m.value:parseInt(g.value[2])}}const i=this.getTypeInfo("vec3u"),o=this.getTypeInfo("u32");s.setVariable("@workgroup_size",new w(r,i));const l=r[0],f=r[1],h=r[2];for(let g=0,m=0;g<h;++g)for(let A=0;A<f;++A)for(let y=0;y<l;++y,++m){const E=[y,A,g],v=[y+t[0]*r[0],A+t[1]*r[1],g+t[2]*r[2]];s.setVariable("@local_invocation_id",new w(E,i)),s.setVariable("@global_invocation_id",new w(v,i)),s.setVariable("@local_invocation_index",new F(m,o)),this._dispatchExec(e,s)}}_dispatchExec(e,t){for(const s of e.node.args)for(const r of s.attributes)if(r.name==="builtin"){const i=`@${r.value}`,o=t.getVariable(i);o!==void 0&&t.variables.set(s.name,o)}this._execStatements(e.node.body,t)}getVariableName(e,t){for(;e instanceof Ct;)e=e.right;return e instanceof Dn?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,t){for(const s of e){if(s instanceof Array){const i=t.clone(),o=this._execStatements(s,i);if(o)return o;continue}const r=this.execStatement(s,t);if(r)return r}return null}_call(e,t){const s=t.clone();s.currentFunctionName=e.name;const r=t.getFunction(e.name);if(r){for(let i=0;i<r.node.args.length;++i){const o=r.node.args[i],l=this.evalExpression(e.args[i],s);s.setVariable(o.name,l,o)}this._execStatements(r.node.body,s)}else e.isBuiltin?this._callBuiltinFunction(e,s):this.getTypeInfo(e.name)&&this._evalCreate(e,t)}_increment(e,t){const s=this.getVariableName(e.variable,t),r=t.getVariable(s);r?e.operator==="++"?r.value instanceof F?r.value.value++:console.error(`Variable ${s} is not a scalar. Line ${e.line}`):e.operator==="--"?r.value instanceof F?r.value.value--:console.error(`Variable ${s} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${s} not found. Line ${e.line}`)}_getVariableData(e,t){if(e instanceof Dn){const s=this.getVariableName(e,t),r=t.getVariable(s);return r===null?(console.error(`Variable ${s} not found. Line ${e.line}`),null):r.value.getSubData(this,e.postfix,t)}if(e instanceof Ct){if(e.operator==="*"){const s=this._getVariableData(e.right,t);return s instanceof ko?s.reference.getSubData(this,e.postfix,t):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){const s=this._getVariableData(e.right,t);return new ko(s)}}return null}_assign(e,t){let s=null,r="<var>",i=null;if(e.variable instanceof Ct){const f=this._getVariableData(e.variable,t),h=this.evalExpression(e.value,t),g=e.operator;if(g==="="){if(f instanceof F||f instanceof w||f instanceof Te){if(h instanceof F||h instanceof w||h instanceof Te&&f.data.length===h.data.length)return void f.data.set(h.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(f instanceof _t&&h instanceof _t&&f.buffer.byteLength-f.offset>=h.buffer.byteLength-h.offset)return void(f.buffer.byteLength%4==0?new Uint32Array(f.buffer,f.offset,f.typeInfo.size/4).set(new Uint32Array(h.buffer,h.offset,h.typeInfo.size/4)):new Uint8Array(f.buffer,f.offset,f.typeInfo.size).set(new Uint8Array(h.buffer,h.offset,h.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(g==="+=")return f instanceof F||f instanceof w||f instanceof Te?h instanceof F||h instanceof w||h instanceof Te?void f.data.set(h.data.map((m,A)=>f.data[A]+m)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(g==="-=")return(f instanceof F||f instanceof w||f instanceof Te)&&(h instanceof F||h instanceof w||h instanceof Te)?void f.data.set(h.data.map((m,A)=>f.data[A]-m)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof Ct){if(e.variable.operator==="*"){r=this.getVariableName(e.variable.right,t);const f=t.getVariable(r);if(!(f&&f.value instanceof ko))return void console.error(`Variable ${r} is not a pointer. Line ${e.line}`);s=f.value.reference;let h=e.variable.postfix;if(!h){let g=e.variable.right;for(;g instanceof Ct;){if(g.postfix){h=g.postfix;break}g=g.right}}h&&(s=s.getSubData(this,h,t))}}else{i=e.variable.postfix,r=this.getVariableName(e.variable,t);const f=t.getVariable(r);if(f===null)return void console.error(`Variable ${r} not found. Line ${e.line}`);s=f.value}if(s instanceof ko&&(s=s.reference),s===null)return void console.error(`Variable ${r} not found. Line ${e.line}`);const o=this.evalExpression(e.value,t),l=e.operator;if(l==="=")if(s instanceof _t)s.setDataValue(this,o,i,t);else if(i){if(!(s instanceof w||s instanceof Te))return void console.error(`Variable ${r} is not a vector or matrix. Line ${e.line}`);if(i instanceof da){const f=this.evalExpression(i.index,t).value;if(s instanceof w){if(!(o instanceof F))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);s.data[f]=o.value}else{if(!(s instanceof Te))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);{const h=this.evalExpression(i.index,t).value;if(h<0)return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);if(!(o instanceof w))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);{const g=s.typeInfo.getTypeName();if(g==="mat2x2"||g==="mat2x2f"||g==="mat2x2h"){if(!(h<2&&o.data.length===2))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);s.data[2*h]=o.data[0],s.data[2*h+1]=o.data[1]}else if(g==="mat2x3"||g==="mat2x3f"||g==="mat2x3h"){if(!(h<2&&o.data.length===3))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);s.data[3*h]=o.data[0],s.data[3*h+1]=o.data[1],s.data[3*h+2]=o.data[2]}else if(g==="mat2x4"||g==="mat2x4f"||g==="mat2x4h"){if(!(h<2&&o.data.length===4))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);s.data[4*h]=o.data[0],s.data[4*h+1]=o.data[1],s.data[4*h+2]=o.data[2],s.data[4*h+3]=o.data[3]}else if(g==="mat3x2"||g==="mat3x2f"||g==="mat3x2h"){if(!(h<3&&o.data.length===2))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);s.data[2*h]=o.data[0],s.data[2*h+1]=o.data[1]}else if(g==="mat3x3"||g==="mat3x3f"||g==="mat3x3h"){if(!(h<3&&o.data.length===3))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);s.data[3*h]=o.data[0],s.data[3*h+1]=o.data[1],s.data[3*h+2]=o.data[2]}else if(g==="mat3x4"||g==="mat3x4f"||g==="mat3x4h"){if(!(h<3&&o.data.length===4))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);s.data[4*h]=o.data[0],s.data[4*h+1]=o.data[1],s.data[4*h+2]=o.data[2],s.data[4*h+3]=o.data[3]}else if(g==="mat4x2"||g==="mat4x2f"||g==="mat4x2h"){if(!(h<4&&o.data.length===2))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);s.data[2*h]=o.data[0],s.data[2*h+1]=o.data[1]}else if(g==="mat4x3"||g==="mat4x3f"||g==="mat4x3h"){if(!(h<4&&o.data.length===3))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);s.data[3*h]=o.data[0],s.data[3*h+1]=o.data[1],s.data[3*h+2]=o.data[2]}else{if(g!=="mat4x4"&&g!=="mat4x4f"&&g!=="mat4x4h")return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);if(!(h<4&&o.data.length===4))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);s.data[4*h]=o.data[0],s.data[4*h+1]=o.data[1],s.data[4*h+2]=o.data[2],s.data[4*h+3]=o.data[3]}}}}}else if(i instanceof Gi){const f=i.value;if(!(s instanceof w))return void console.error(`Invalid assignment to ${f}. Variable ${r} is not a vector. Line ${e.line}`);if(o instanceof F){if(f.length>1)return void console.error(`Invalid assignment to ${f} for variable ${r}. Line ${e.line}`);if(f==="x")s.data[0]=o.value;else if(f==="y"){if(s.data.length<2)return void console.error(`Invalid assignment to ${f} for variable ${r}. Line ${e.line}`);s.data[1]=o.value}else if(f==="z"){if(s.data.length<3)return void console.error(`Invalid assignment to ${f} for variable ${r}. Line ${e.line}`);s.data[2]=o.value}else if(f==="w"){if(s.data.length<4)return void console.error(`Invalid assignment to ${f} for variable ${r}. Line ${e.line}`);s.data[3]=o.value}}else{if(!(o instanceof w))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);if(f.length!==o.data.length)return void console.error(`Invalid assignment to ${f} for variable ${r}. Line ${e.line}`);for(let h=0;h<f.length;++h){const g=f[h];if(g==="x"||g==="r")s.data[0]=o.data[h];else if(g==="y"||g==="g"){if(o.data.length<2)return void console.error(`Invalid assignment to ${g} for variable ${r}. Line ${e.line}`);s.data[1]=o.data[h]}else if(g==="z"||g==="b"){if(o.data.length<3)return void console.error(`Invalid assignment to ${g} for variable ${r}. Line ${e.line}`);s.data[2]=o.data[h]}else{if(g!=="w"&&g!=="a")return void console.error(`Invalid assignment to ${g} for variable ${r}. Line ${e.line}`);if(o.data.length<4)return void console.error(`Invalid assignment to ${g} for variable ${r}. Line ${e.line}`);s.data[3]=o.data[h]}}}}}else s instanceof F&&o instanceof F?s.value=o.value:s instanceof w&&o instanceof w||s instanceof Te&&o instanceof Te?s.data.set(o.data):console.error(`Invalid assignment to ${r}. Line ${e.line}`);else{const f=s.getSubData(this,i,t);if(f instanceof w&&o instanceof F){const h=f.data,g=o.value;if(l==="+=")for(let m=0;m<h.length;++m)h[m]+=g;else if(l==="-=")for(let m=0;m<h.length;++m)h[m]-=g;else if(l==="*=")for(let m=0;m<h.length;++m)h[m]*=g;else if(l==="/=")for(let m=0;m<h.length;++m)h[m]/=g;else if(l==="%=")for(let m=0;m<h.length;++m)h[m]%=g;else if(l==="&=")for(let m=0;m<h.length;++m)h[m]&=g;else if(l==="|=")for(let m=0;m<h.length;++m)h[m]|=g;else if(l==="^=")for(let m=0;m<h.length;++m)h[m]^=g;else if(l==="<<=")for(let m=0;m<h.length;++m)h[m]<<=g;else if(l===">>=")for(let m=0;m<h.length;++m)h[m]>>=g;else console.error(`Invalid operator ${l}. Line ${e.line}`)}else if(f instanceof w&&o instanceof w){const h=f.data,g=o.data;if(h.length!==g.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(l==="+=")for(let m=0;m<h.length;++m)h[m]+=g[m];else if(l==="-=")for(let m=0;m<h.length;++m)h[m]-=g[m];else if(l==="*=")for(let m=0;m<h.length;++m)h[m]*=g[m];else if(l==="/=")for(let m=0;m<h.length;++m)h[m]/=g[m];else if(l==="%=")for(let m=0;m<h.length;++m)h[m]%=g[m];else if(l==="&=")for(let m=0;m<h.length;++m)h[m]&=g[m];else if(l==="|=")for(let m=0;m<h.length;++m)h[m]|=g[m];else if(l==="^=")for(let m=0;m<h.length;++m)h[m]^=g[m];else if(l==="<<=")for(let m=0;m<h.length;++m)h[m]<<=g[m];else if(l===">>=")for(let m=0;m<h.length;++m)h[m]>>=g[m];else console.error(`Invalid operator ${l}. Line ${e.line}`)}else{if(!(f instanceof F&&o instanceof F))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);l==="+="?f.value+=o.value:l==="-="?f.value-=o.value:l==="*="?f.value*=o.value:l==="/="?f.value/=o.value:l==="%="?f.value%=o.value:l==="&="?f.value&=o.value:l==="|="?f.value|=o.value:l==="^="?f.value^=o.value:l==="<<="?f.value<<=o.value:l===">>="?f.value>>=o.value:console.error(`Invalid operator ${l}. Line ${e.line}`)}s instanceof _t&&s.setDataValue(this,f,i,t)}}_function(e,t){const s=new VA(e);t.functions.set(e.name,s)}_const(e,t){let s=null;e.value!==null&&(s=this.evalExpression(e.value,t)),t.createVariable(e.name,s,e)}_let(e,t){let s=null;if(e.value!==null){if(s=this.evalExpression(e.value,t),s===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof Ct||(s=s.clone())}else{const r=e.type.name;if(r==="f32"||r==="i32"||r==="u32"||r==="bool"||r==="f16"||r==="vec2"||r==="vec3"||r==="vec4"||r==="vec2f"||r==="vec3f"||r==="vec4f"||r==="vec2i"||r==="vec3i"||r==="vec4i"||r==="vec2u"||r==="vec3u"||r==="vec4u"||r==="vec2h"||r==="vec3h"||r==="vec4h"||r==="vec2b"||r==="vec3b"||r==="vec4b"||r==="mat2x2"||r==="mat2x3"||r==="mat2x4"||r==="mat3x2"||r==="mat3x3"||r==="mat3x4"||r==="mat4x2"||r==="mat4x3"||r==="mat4x4"||r==="mat2x2f"||r==="mat2x3f"||r==="mat2x4f"||r==="mat3x2f"||r==="mat3x3f"||r==="mat3x4f"||r==="mat4x2f"||r==="mat4x3f"||r==="mat4x4f"||r==="mat2x2h"||r==="mat2x3h"||r==="mat2x4h"||r==="mat3x2h"||r==="mat3x3h"||r==="mat3x4h"||r==="mat4x2h"||r==="mat4x3h"||r==="mat4x4h"||r==="array"){const i=new Ns(e.type,[]);s=this._evalCreate(i,t)}}t.createVariable(e.name,s,e)}_var(e,t){let s=null;if(e.value!==null){if(s=this.evalExpression(e.value,t),s===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof Ct||(s=s.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const r=e.type.name;if(r==="f32"||r==="i32"||r==="u32"||r==="bool"||r==="f16"||r==="vec2"||r==="vec3"||r==="vec4"||r==="vec2f"||r==="vec3f"||r==="vec4f"||r==="vec2i"||r==="vec3i"||r==="vec4i"||r==="vec2u"||r==="vec3u"||r==="vec4u"||r==="vec2h"||r==="vec3h"||r==="vec4h"||r==="vec2b"||r==="vec3b"||r==="vec4b"||r==="mat2x2"||r==="mat2x3"||r==="mat2x4"||r==="mat3x2"||r==="mat3x3"||r==="mat3x4"||r==="mat4x2"||r==="mat4x3"||r==="mat4x4"||r==="mat2x2f"||r==="mat2x3f"||r==="mat2x4f"||r==="mat3x2f"||r==="mat3x3f"||r==="mat3x4f"||r==="mat4x2f"||r==="mat4x3f"||r==="mat4x4f"||r==="mat2x2h"||r==="mat2x3h"||r==="mat2x4h"||r==="mat3x2h"||r==="mat3x3h"||r==="mat3x4h"||r==="mat4x2h"||r==="mat4x3h"||r==="mat4x4h"||e.type instanceof sl||e.type instanceof cr||e.type instanceof H){const i=new Ns(e.type,[]);s=this._evalCreate(i,t)}}t.createVariable(e.name,s,e)}_switch(e,t){t=t.clone();const s=this.evalExpression(e.condition,t);if(!(s instanceof F))return console.error(`Invalid if condition. Line ${e.line}`),null;let r=null;for(const i of e.cases)if(i instanceof O3)for(const o of i.selectors){if(o instanceof Lf){r=i;continue}const l=this.evalExpression(o,t);if(!(l instanceof F))return console.error(`Invalid case selector. Line ${e.line}`),null;if(l.value===s.value)return this._execStatements(i.body,t)}else i instanceof D3&&(r=i);return r?this._execStatements(r.body,t):null}_if(e,t){t=t.clone();const s=this.evalExpression(e.condition,t);if(!(s instanceof F))return console.error(`Invalid if condition. Line ${e.line}`),null;if(s.value)return this._execStatements(e.body,t);for(const r of e.elseif){const i=this.evalExpression(r.condition,t);if(!(i instanceof F))return console.error(`Invalid if condition. Line ${e.line}`),null;if(i.value)return this._execStatements(r.body,t)}return e.else?this._execStatements(e.else,t):null}_getScalarValue(e){return e instanceof F?e.value:(console.error("Expected scalar value.",e),0)}_for(e,t){for(t=t.clone(),this.execStatement(e.init,t);this._getScalarValue(this.evalExpression(e.condition,t));){const s=this._execStatements(e.body,t);if(s===Kt._breakObj)break;if(s!==null&&s!==Kt._continueObj)return s;this.execStatement(e.increment,t)}return null}_loop(e,t){for(t=t.clone();;){const s=this._execStatements(e.body,t);if(s===Kt._breakObj)break;if(s===Kt._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,t)===Kt._breakObj)break}else if(s!==null)return s}return null}_while(e,t){for(t=t.clone();this._getScalarValue(this.evalExpression(e.condition,t));){const s=this._execStatements(e.body,t);if(s===Kt._breakObj)break;if(s!==Kt._continueObj&&s!==null)return s}return null}_evalBitcast(e,t){const s=this.evalExpression(e.value,t),r=e.type;if(s instanceof F){const i=j1(s.value,s.typeInfo.name,r.name);return new F(i,this.getTypeInfo(r))}if(s instanceof w){const i=s.typeInfo.getTypeName();let o="";if(i.endsWith("f"))o="f32";else if(i.endsWith("i"))o="i32";else if(i.endsWith("u"))o="u32";else if(i.endsWith("b"))o="bool";else{if(!i.endsWith("h"))return console.error(`Unknown vector type ${i}. Line ${e.line}`),null;o="f16"}const l=r.getTypeName();let f="";if(l.endsWith("f"))f="f32";else if(l.endsWith("i"))f="i32";else if(l.endsWith("u"))f="u32";else if(l.endsWith("b"))f="bool";else{if(!l.endsWith("h"))return console.error(`Unknown vector type ${f}. Line ${e.line}`),null;f="f16"}const h=function(g,m,A){if(m===A)return g;const y=new Array(g.length);for(let E=0;E<g.length;E++)y[E]=j1(g[E],m,A);return y}(Array.from(s.data),o,f);return new w(h,this.getTypeInfo(r))}return console.error(`TODO: bitcast for ${s.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,t){return t.getVariableValue(e.name).clone().getSubData(this,e.postfix,t)}_evalCreate(e,t){var s;if(e instanceof Ns){if(e.type===null)return S_.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,t);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,t);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,t)}}const r=e instanceof Ns?e.type.name:e.name,i=e instanceof Ns?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(i===null)return console.error(`Unknown type ${r}. Line ${e.line}`),null;if(i.size===0)return null;const o=new _t(new ArrayBuffer(i.size),i,0);if(i instanceof qr){if(e.args)for(let l=0;l<e.args.length;++l){const f=i.members[l],h=e.args[l],g=this.evalExpression(h,t);o.setData(this,g,f.type,f.offset,t)}}else if(i instanceof ti){let l=0;if(e.args)for(let f=0;f<e.args.length;++f){const h=e.args[f],g=this.evalExpression(h,t);i.format===null&&(((s=g.typeInfo)===null||s===void 0?void 0:s.name)==="x32"?i.format=this.getTypeInfo("i32"):i.format=g.typeInfo),o.setData(this,g,i.format,l,t),l+=i.stride}}else console.error(`Unknown type "${r}". Line ${e.line}`);return e instanceof Ns?o.getSubData(this,e.postfix,t):o}_evalLiteral(e,t){const s=this.getTypeInfo(e.type),r=s.name;return r==="x32"||r==="u32"||r==="f32"||r==="f16"||r==="i32"||r==="bool"?new F(e.scalarValue,s):r==="vec2"||r==="vec3"||r==="vec4"||r==="vec2f"||r==="vec3f"||r==="vec4f"||r==="vec2h"||r==="vec3h"||r==="vec4h"||r==="vec2i"||r==="vec3i"||r==="vec4i"||r==="vec2u"||r==="vec3u"||r==="vec4u"?this._callConstructorVec(e,t):r==="mat2x2"||r==="mat2x3"||r==="mat2x4"||r==="mat3x2"||r==="mat3x3"||r==="mat3x4"||r==="mat4x2"||r==="mat4x3"||r==="mat4x4"||r==="mat2x2f"||r==="mat2x3f"||r==="mat2x4f"||r==="mat3x2f"||r==="mat3x3f"||r==="mat3x4f"||r==="mat4x2f"||r==="mat4x3f"||r==="mat4x4f"||r==="mat2x2h"||r==="mat2x3h"||r==="mat2x4h"||r==="mat3x2h"||r==="mat3x3h"||r==="mat3x4h"||r==="mat4x2h"||r==="mat4x3h"||r==="mat4x4h"?this._callConstructorMatrix(e,t):e.value}_evalVariable(e,t){const s=t.getVariableValue(e.name);return s===null?s:s.getSubData(this,e.postfix,t)}_maxFormatTypeInfo(e){let t=e[0];if(t.name==="f32")return t;for(let s=1;s<e.length;++s){const r=Kt._priority.get(t.name);Kt._priority.get(e[s].name)<r&&(t=e[s])}return t.name==="x32"?this.getTypeInfo("i32"):t}_evalUnaryOp(e,t){const s=this.evalExpression(e.right,t);if(e.operator==="&")return new ko(s);if(e.operator==="*")return s instanceof ko?s.reference.getSubData(this,e.postfix,t):(console.error(`Invalid dereference. Line ${e.line}`),null);const r=s instanceof F?s.value:s instanceof w?Array.from(s.data):null;switch(e.operator){case"+":{if(ce(r)){const l=r.map((f,h)=>+f);return new w(l,s.typeInfo)}const i=r,o=this._maxFormatTypeInfo([s.typeInfo,s.typeInfo]);return new F(+i,o)}case"-":{if(ce(r)){const l=r.map((f,h)=>-f);return new w(l,s.typeInfo)}const i=r,o=this._maxFormatTypeInfo([s.typeInfo,s.typeInfo]);return new F(-i,o)}case"!":{if(ce(r)){const l=r.map((f,h)=>f?0:1);return new w(l,s.typeInfo)}const i=r,o=this._maxFormatTypeInfo([s.typeInfo,s.typeInfo]);return new F(i?0:1,o)}case"~":{if(ce(r)){const l=r.map((f,h)=>~f);return new w(l,s.typeInfo)}const i=r,o=this._maxFormatTypeInfo([s.typeInfo,s.typeInfo]);return new F(~i,o)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,t){const s=this.evalExpression(e.left,t),r=this.evalExpression(e.right,t),i=s instanceof F?s.value:s instanceof w||s instanceof Te?Array.from(s.data):null,o=r instanceof F?r.value:r instanceof w||r instanceof Te?Array.from(r.data):null;switch(e.operator){case"+":{if(ce(i)&&ce(o)){const g=i,m=o;if(g.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const A=g.map((y,E)=>y+m[E]);return new w(A,s.typeInfo)}if(ce(i)){const g=o,m=i.map((A,y)=>A+g);return new w(m,s.typeInfo)}if(ce(o)){const g=i,m=o.map((A,y)=>g+A);return new w(m,r.typeInfo)}const l=i,f=o,h=this._maxFormatTypeInfo([s.typeInfo,r.typeInfo]);return new F(l+f,h)}case"-":{if(ce(i)&&ce(o)){const g=i,m=o;if(g.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const A=g.map((y,E)=>y-m[E]);return new w(A,s.typeInfo)}if(ce(i)){const g=o,m=i.map((A,y)=>A-g);return new w(m,s.typeInfo)}if(ce(o)){const g=i,m=o.map((A,y)=>g-A);return new w(m,r.typeInfo)}const l=i,f=o,h=this._maxFormatTypeInfo([s.typeInfo,r.typeInfo]);return new F(l-f,h)}case"*":{if(ce(i)&&ce(o)){const g=i,m=o;if(s instanceof Te&&r instanceof Te){const A=function(S,x,O,R){if(sn[x.name]===void 0||sn[R.name]===void 0)return null;const D=sn[x.name][0],z=sn[x.name][1],J=sn[R.name][0];if(D!==sn[R.name][1])return null;const ie=new Array(J*z);for(let re=0;re<z;re++)for(let ee=0;ee<J;ee++){let le=0;for(let fe=0;fe<D;fe++)le+=S[fe*z+re]*O[ee*D+fe];ie[re*J+ee]=le}return ie}(g,s.typeInfo,m,r.typeInfo);if(A===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const y=sn[r.typeInfo.name][0],E=sn[s.typeInfo.name][1],v=this.getTypeInfo(`mat${y}x${E}f`);return new Te(A,v)}if(s instanceof Te&&r instanceof w){const A=function(y,E,v,S){if(sn[E.name]===void 0||Kp[S.name]===void 0)return null;const x=sn[E.name][0],O=sn[E.name][1];if(x!==v.length)return null;const R=new Array(O);for(let D=0;D<O;D++){let z=0;for(let J=0;J<x;J++)z+=y[J*O+D]*v[J];R[D]=z}return R}(g,s.typeInfo,m,r.typeInfo);return A===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new w(A,r.typeInfo)}if(s instanceof w&&r instanceof Te){const A=function(y,E,v,S){if(Kp[E.name]===void 0||sn[S.name]===void 0)return null;const x=sn[S.name][0],O=sn[S.name][1];if(O!==y.length)return null;const R=[];for(let D=0;D<x;D++){let z=0;for(let J=0;J<O;J++)z+=y[J]*v[J*x+D];R[D]=z}return R}(g,s.typeInfo,m,r.typeInfo);return A===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new w(A,s.typeInfo)}{if(g.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const A=g.map((y,E)=>y*m[E]);return new w(A,s.typeInfo)}}if(ce(i)){const g=o,m=i.map((A,y)=>A*g);return s instanceof Te?new Te(m,s.typeInfo):new w(m,s.typeInfo)}if(ce(o)){const g=i,m=o.map((A,y)=>g*A);return r instanceof Te?new Te(m,r.typeInfo):new w(m,r.typeInfo)}const l=i,f=o,h=this._maxFormatTypeInfo([s.typeInfo,r.typeInfo]);return new F(l*f,h)}case"%":{if(ce(i)&&ce(o)){const g=i,m=o;if(g.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const A=g.map((y,E)=>y%m[E]);return new w(A,s.typeInfo)}if(ce(i)){const g=o,m=i.map((A,y)=>A%g);return new w(m,s.typeInfo)}if(ce(o)){const g=i,m=o.map((A,y)=>g%A);return new w(m,r.typeInfo)}const l=i,f=o,h=this._maxFormatTypeInfo([s.typeInfo,r.typeInfo]);return new F(l%f,h)}case"/":{if(ce(i)&&ce(o)){const g=i,m=o;if(g.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const A=g.map((y,E)=>y/m[E]);return new w(A,s.typeInfo)}if(ce(i)){const g=o,m=i.map((A,y)=>A/g);return new w(m,s.typeInfo)}if(ce(o)){const g=i,m=o.map((A,y)=>g/A);return new w(m,r.typeInfo)}const l=i,f=o,h=this._maxFormatTypeInfo([s.typeInfo,r.typeInfo]);return new F(l/f,h)}case"&":{if(ce(i)&&ce(o)){const g=i,m=o;if(g.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const A=g.map((y,E)=>y&m[E]);return new w(A,s.typeInfo)}if(ce(i)){const g=o,m=i.map((A,y)=>A&g);return new w(m,s.typeInfo)}if(ce(o)){const g=i,m=o.map((A,y)=>g&A);return new w(m,r.typeInfo)}const l=i,f=o,h=this._maxFormatTypeInfo([s.typeInfo,r.typeInfo]);return new F(l&f,h)}case"|":{if(ce(i)&&ce(o)){const g=i,m=o;if(g.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const A=g.map((y,E)=>y|m[E]);return new w(A,s.typeInfo)}if(ce(i)){const g=o,m=i.map((A,y)=>A|g);return new w(m,s.typeInfo)}if(ce(o)){const g=i,m=o.map((A,y)=>g|A);return new w(m,r.typeInfo)}const l=i,f=o,h=this._maxFormatTypeInfo([s.typeInfo,r.typeInfo]);return new F(l|f,h)}case"^":{if(ce(i)&&ce(o)){const g=i,m=o;if(g.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const A=g.map((y,E)=>y^m[E]);return new w(A,s.typeInfo)}if(ce(i)){const g=o,m=i.map((A,y)=>A^g);return new w(m,s.typeInfo)}if(ce(o)){const g=i,m=o.map((A,y)=>g^A);return new w(m,r.typeInfo)}const l=i,f=o,h=this._maxFormatTypeInfo([s.typeInfo,r.typeInfo]);return new F(l^f,h)}case"<<":{if(ce(i)&&ce(o)){const g=i,m=o;if(g.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const A=g.map((y,E)=>y<<m[E]);return new w(A,s.typeInfo)}if(ce(i)){const g=o,m=i.map((A,y)=>A<<g);return new w(m,s.typeInfo)}if(ce(o)){const g=i,m=o.map((A,y)=>g<<A);return new w(m,r.typeInfo)}const l=i,f=o,h=this._maxFormatTypeInfo([s.typeInfo,r.typeInfo]);return new F(l<<f,h)}case">>":{if(ce(i)&&ce(o)){const g=i,m=o;if(g.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const A=g.map((y,E)=>y>>m[E]);return new w(A,s.typeInfo)}if(ce(i)){const g=o,m=i.map((A,y)=>A>>g);return new w(m,s.typeInfo)}if(ce(o)){const g=i,m=o.map((A,y)=>g>>A);return new w(m,r.typeInfo)}const l=i,f=o,h=this._maxFormatTypeInfo([s.typeInfo,r.typeInfo]);return new F(l>>f,h)}case">":if(ce(i)&&ce(o)){const l=i,f=o;if(l.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=l.map((g,m)=>g>f[m]?1:0);return new w(h,s.typeInfo)}if(ce(i)){const l=o,f=i.map((h,g)=>h>l?1:0);return new w(f,s.typeInfo)}if(ce(o)){const l=i,f=o.map((h,g)=>l>h?1:0);return new w(f,r.typeInfo)}return new F(i>o?1:0,this.getTypeInfo("bool"));case"<":if(ce(i)&&ce(o)){const l=i,f=o;if(l.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=l.map((g,m)=>g<f[m]?1:0);return new w(h,s.typeInfo)}if(ce(i)){const l=o,f=i.map((h,g)=>h<l?1:0);return new w(f,s.typeInfo)}if(ce(o)){const l=i,f=o.map((h,g)=>l<h?1:0);return new w(f,r.typeInfo)}return new F(i<o?1:0,this.getTypeInfo("bool"));case"==":if(ce(i)&&ce(o)){const l=i,f=o;if(l.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=l.map((g,m)=>g===f[m]?1:0);return new w(h,s.typeInfo)}if(ce(i)){const l=o,f=i.map((h,g)=>h==l?1:0);return new w(f,s.typeInfo)}if(ce(o)){const l=i,f=o.map((h,g)=>l==h?1:0);return new w(f,r.typeInfo)}return new F(i===o?1:0,this.getTypeInfo("bool"));case"!=":if(ce(i)&&ce(o)){const l=i,f=o;if(l.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=l.map((g,m)=>g!==f[m]?1:0);return new w(h,s.typeInfo)}if(ce(i)){const l=o,f=i.map((h,g)=>h!==l?1:0);return new w(f,s.typeInfo)}if(ce(o)){const l=i,f=o.map((h,g)=>l!==h?1:0);return new w(f,r.typeInfo)}return new F(i!==o?1:0,this.getTypeInfo("bool"));case">=":if(ce(i)&&ce(o)){const l=i,f=o;if(l.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=l.map((g,m)=>g>=f[m]?1:0);return new w(h,s.typeInfo)}if(ce(i)){const l=o,f=i.map((h,g)=>h>=l?1:0);return new w(f,s.typeInfo)}if(ce(o)){const l=i,f=o.map((h,g)=>l>=h?1:0);return new w(f,r.typeInfo)}return new F(i>=o?1:0,this.getTypeInfo("bool"));case"<=":if(ce(i)&&ce(o)){const l=i,f=o;if(l.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=l.map((g,m)=>g<=f[m]?1:0);return new w(h,s.typeInfo)}if(ce(i)){const l=o,f=i.map((h,g)=>h<=l?1:0);return new w(f,s.typeInfo)}if(ce(o)){const l=i,f=o.map((h,g)=>l<=h?1:0);return new w(f,r.typeInfo)}return new F(i<=o?1:0,this.getTypeInfo("bool"));case"&&":if(ce(i)&&ce(o)){const l=i,f=o;if(l.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=l.map((g,m)=>g&&f[m]?1:0);return new w(h,s.typeInfo)}if(ce(i)){const l=o,f=i.map((h,g)=>h&&l?1:0);return new w(f,s.typeInfo)}if(ce(o)){const l=i,f=o.map((h,g)=>l&&h?1:0);return new w(f,r.typeInfo)}return new F(i&&o?1:0,this.getTypeInfo("bool"));case"||":if(ce(i)&&ce(o)){const l=i,f=o;if(l.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=l.map((g,m)=>g||f[m]?1:0);return new w(h,s.typeInfo)}if(ce(i)){const l=o,f=i.map((h,g)=>h||l?1:0);return new w(f,s.typeInfo)}if(ce(o)){const l=i,f=o.map((h,g)=>l||h?1:0);return new w(f,r.typeInfo)}return new F(i||o?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,t){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const s=t.clone();s.currentFunctionName=e.name;const r=t.getFunction(e.name);if(!r)return e.isBuiltin?this._callBuiltinFunction(e,s):this.getTypeInfo(e.name)?this._evalCreate(e,t):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let i=0;i<r.node.args.length;++i){const o=r.node.args[i],l=this.evalExpression(e.args[i],s);s.createVariable(o.name,l,o)}return this._execStatements(r.node.body,s)}_callBuiltinFunction(e,t){switch(e.name){case"all":return this.builtins.All(e,t);case"any":return this.builtins.Any(e,t);case"select":return this.builtins.Select(e,t);case"arrayLength":return this.builtins.ArrayLength(e,t);case"abs":return this.builtins.Abs(e,t);case"acos":return this.builtins.Acos(e,t);case"acosh":return this.builtins.Acosh(e,t);case"asin":return this.builtins.Asin(e,t);case"asinh":return this.builtins.Asinh(e,t);case"atan":return this.builtins.Atan(e,t);case"atanh":return this.builtins.Atanh(e,t);case"atan2":return this.builtins.Atan2(e,t);case"ceil":return this.builtins.Ceil(e,t);case"clamp":return this.builtins.Clamp(e,t);case"cos":return this.builtins.Cos(e,t);case"cosh":return this.builtins.Cosh(e,t);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,t);case"countOneBits":return this.builtins.CountOneBits(e,t);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,t);case"cross":return this.builtins.Cross(e,t);case"degrees":return this.builtins.Degrees(e,t);case"determinant":return this.builtins.Determinant(e,t);case"distance":return this.builtins.Distance(e,t);case"dot":return this.builtins.Dot(e,t);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,t);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,t);case"exp":return this.builtins.Exp(e,t);case"exp2":return this.builtins.Exp2(e,t);case"extractBits":return this.builtins.ExtractBits(e,t);case"faceForward":return this.builtins.FaceForward(e,t);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,t);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,t);case"floor":return this.builtins.Floor(e,t);case"fma":return this.builtins.Fma(e,t);case"fract":return this.builtins.Fract(e,t);case"frexp":return this.builtins.Frexp(e,t);case"insertBits":return this.builtins.InsertBits(e,t);case"inverseSqrt":return this.builtins.InverseSqrt(e,t);case"ldexp":return this.builtins.Ldexp(e,t);case"length":return this.builtins.Length(e,t);case"log":return this.builtins.Log(e,t);case"log2":return this.builtins.Log2(e,t);case"max":return this.builtins.Max(e,t);case"min":return this.builtins.Min(e,t);case"mix":return this.builtins.Mix(e,t);case"modf":return this.builtins.Modf(e,t);case"normalize":return this.builtins.Normalize(e,t);case"pow":return this.builtins.Pow(e,t);case"quantizeToF16":return this.builtins.QuantizeToF16(e,t);case"radians":return this.builtins.Radians(e,t);case"reflect":return this.builtins.Reflect(e,t);case"refract":return this.builtins.Refract(e,t);case"reverseBits":return this.builtins.ReverseBits(e,t);case"round":return this.builtins.Round(e,t);case"saturate":return this.builtins.Saturate(e,t);case"sign":return this.builtins.Sign(e,t);case"sin":return this.builtins.Sin(e,t);case"sinh":return this.builtins.Sinh(e,t);case"smoothStep":return this.builtins.SmoothStep(e,t);case"sqrt":return this.builtins.Sqrt(e,t);case"step":return this.builtins.Step(e,t);case"tan":return this.builtins.Tan(e,t);case"tanh":return this.builtins.Tanh(e,t);case"transpose":return this.builtins.Transpose(e,t);case"trunc":return this.builtins.Trunc(e,t);case"dpdx":return this.builtins.Dpdx(e,t);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,t);case"dpdxFine":return this.builtins.DpdxFine(e,t);case"dpdy":return this.builtins.Dpdy(e,t);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,t);case"dpdyFine":return this.builtins.DpdyFine(e,t);case"fwidth":return this.builtins.Fwidth(e,t);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,t);case"fwidthFine":return this.builtins.FwidthFine(e,t);case"textureDimensions":return this.builtins.TextureDimensions(e,t);case"textureGather":return this.builtins.TextureGather(e,t);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,t);case"textureLoad":return this.builtins.TextureLoad(e,t);case"textureNumLayers":return this.builtins.TextureNumLayers(e,t);case"textureNumLevels":return this.builtins.TextureNumLevels(e,t);case"textureNumSamples":return this.builtins.TextureNumSamples(e,t);case"textureSample":return this.builtins.TextureSample(e,t);case"textureSampleBias":return this.builtins.TextureSampleBias(e,t);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,t);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,t);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,t);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,t);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,t);case"textureStore":return this.builtins.TextureStore(e,t);case"atomicLoad":return this.builtins.AtomicLoad(e,t);case"atomicStore":return this.builtins.AtomicStore(e,t);case"atomicAdd":return this.builtins.AtomicAdd(e,t);case"atomicSub":return this.builtins.AtomicSub(e,t);case"atomicMax":return this.builtins.AtomicMax(e,t);case"atomicMin":return this.builtins.AtomicMin(e,t);case"atomicAnd":return this.builtins.AtomicAnd(e,t);case"atomicOr":return this.builtins.AtomicOr(e,t);case"atomicXor":return this.builtins.AtomicXor(e,t);case"atomicExchange":return this.builtins.AtomicExchange(e,t);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,t);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,t);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,t);case"pack4xI8":return this.builtins.Pack4xI8(e,t);case"pack4xU8":return this.builtins.Pack4xU8(e,t);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,t);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,t);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,t);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,t);case"pack2x16float":return this.builtins.Pack2x16float(e,t);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,t);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,t);case"unpack4xI8":return this.builtins.Unpack4xI8(e,t);case"unpack4xU8":return this.builtins.Unpack4xU8(e,t);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,t);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,t);case"unpack2x16float":return this.builtins.Unpack2x16float(e,t);case"storageBarrier":return this.builtins.StorageBarrier(e,t);case"textureBarrier":return this.builtins.TextureBarrier(e,t);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,t);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,t);case"subgroupAdd":return this.builtins.SubgroupAdd(e,t);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,t);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,t);case"subgroupAll":return this.builtins.SubgroupAll(e,t);case"subgroupAnd":return this.builtins.SubgroupAnd(e,t);case"subgroupAny":return this.builtins.SubgroupAny(e,t);case"subgroupBallot":return this.builtins.SubgroupBallot(e,t);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,t);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,t);case"subgroupElect":return this.builtins.SubgroupElect(e,t);case"subgroupMax":return this.builtins.SubgroupMax(e,t);case"subgroupMin":return this.builtins.SubgroupMin(e,t);case"subgroupMul":return this.builtins.SubgroupMul(e,t);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,t);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,t);case"subgroupOr":return this.builtins.SubgroupOr(e,t);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,t);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,t);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,t);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,t);case"subgroupXor":return this.builtins.SubgroupXor(e,t);case"quadBroadcast":return this.builtins.QuadBroadcast(e,t);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,t);case"quadSwapX":return this.builtins.QuadSwapX(e,t);case"quadSwapY":return this.builtins.QuadSwapY(e,t)}const s=t.getFunction(e.name);if(s){const r=t.clone();for(let i=0;i<s.node.args.length;++i){const o=s.node.args[i],l=this.evalExpression(e.args[i],r);r.setVariable(o.name,l,o)}return this._execStatements(s.node.body,r)}return null}_callConstructorValue(e,t){if(!e.args||e.args.length===0)return new F(0,this.getTypeInfo(e.type));const s=this.evalExpression(e.args[0],t);return s.typeInfo=this.getTypeInfo(e.type),s.getSubData(this,e.postfix,t).clone()}_callConstructorVec(e,t){const s=this.getTypeInfo(e.type),r=e.type.getTypeName(),i=Kp[r];if(i===void 0)return console.error(`Invalid vec constructor ${r}. Line ${e.line}`),null;const o=[];if(e instanceof xt)if(e.isVector){const l=e.vectorValue;for(const f of l)o.push(f)}else o.push(e.scalarValue);else if(e.args)for(const l of e.args){const f=this.evalExpression(l,t);if(f instanceof w){const h=f.data;for(let g=0;g<h.length;++g){let m=h[g];o.push(m)}}else if(f instanceof F){let h=f.value;o.push(h)}}if(e.type instanceof H&&e.type.format===null&&(e.type.format=H.f32),o.length===0){const l=new Array(i).fill(0);return new w(l,s).getSubData(this,e.postfix,t)}if(o.length===1)for(;o.length<i;)o.push(o[0]);return o.length<i?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new w(o.length>i?o.slice(0,i):o,s).getSubData(this,e.postfix,t)}_callConstructorMatrix(e,t){const s=this.getTypeInfo(e.type),r=e.type.getTypeName(),i=sn[r];if(i===void 0)return console.error(`Invalid matrix constructor ${r}. Line ${e.line}`),null;const o=[];if(e instanceof xt)if(e.isVector){const l=e.vectorValue;for(const f of l)o.push(f)}else o.push(e.scalarValue);else if(e.args)for(const l of e.args){const f=this.evalExpression(l,t);f instanceof w?o.push(...f.data):f instanceof F?o.push(f.value):f instanceof Te&&o.push(...f.data)}if(s instanceof Hi&&s.format===null&&(s.format=this.getTypeInfo("f32")),o.length===0){const l=new Array(i[2]).fill(0);return new Te(l,s).getSubData(this,e.postfix,t)}return o.length!==i[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new Te(o,s).getSubData(this,e.postfix,t)}}Kt._breakObj=new ss(new ts("BREAK",null),null),Kt._continueObj=new ss(new ts("CONTINUE",null),null),Kt._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class FP{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class PP{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new FP,this._exec=new Kt,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const t=[];for(;!this._isAtEnd();){const s=this._global_decl_or_directive();if(!s)break;t.push(s)}if(this._deferArrayCountEval.length>0){for(const s of this._deferArrayCountEval){const r=s.arrayType,i=s.countNode;if(i instanceof Dn){const o=i.name,l=this._context.constants.get(o);if(l)try{const f=l.constEvaluate(this._exec);r.count=f}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const s of t)s.search(r=>{r instanceof G1||r instanceof Uf?r.type=this._forwardType(r.type):r instanceof sl?r.format=this._forwardType(r.format):r instanceof ur||r instanceof nl||r instanceof Pf?r.type=this._forwardType(r.type):r instanceof gl?r.returnType=this._forwardType(r.returnType):r instanceof H1&&(r.type=this._forwardType(r.type))});return t}_forwardType(e){if(e instanceof k1){const t=this._getType(e.name);if(t)return t}else e instanceof Uf?e.type=this._forwardType(e.type):e instanceof sl&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){const t=new BP(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,t){return e.line=t??this._currentLine,e}_error(e,t){return{token:e,message:t,toString:()=>`${t}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==B.eof}_match(e){if(e instanceof U)return!!this._check(e)&&(this._advance(),!0);for(let t=0,s=e.length;t<s;++t){const r=e[t];if(this._check(r))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),`${t}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){const s=t.type;let r=!1;for(const i of e){if(s===i)return!0;i===B.tokens.name&&(r=!0)}if(r){const i=B.tokens.name.rule.exec(t.lexeme);if(i&&i.index==0&&i[0]==t.lexeme)return!0}return!1}if(t.type===e)return!0;if(e===B.tokens.name){const s=B.tokens.name.rule.exec(t.lexeme);return s&&s.index==0&&s[0]==t.lexeme}return!1}_advance(){var e,t;return this._currentLine=(t=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&t!==void 0?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(B.tokens.semicolon)&&!this._isAtEnd(););if(this._match(B.keywords.alias)){const t=this._type_alias();return this._consume(B.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(B.keywords.diagnostic)){const t=this._diagnostic();return this._consume(B.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(B.keywords.requires)){const t=this._requires_directive();return this._consume(B.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(B.keywords.enable)){const t=this._enable_directive();return this._consume(B.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}const e=this._attribute();if(this._check(B.keywords.var)){const t=this._global_variable_decl();return t!=null&&(t.attributes=e),this._consume(B.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(B.keywords.override)){const t=this._override_variable_decl();return t!=null&&(t.attributes=e),this._consume(B.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(B.keywords.let)){const t=this._global_let_decl();return t!=null&&(t.attributes=e),this._consume(B.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(B.keywords.const)){const t=this._global_const_decl();return t!=null&&(t.attributes=e),this._consume(B.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(B.keywords.struct)){const t=this._struct_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}if(this._check(B.keywords.fn)){const t=this._function_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}return null}_function_decl(){if(!this._match(B.keywords.fn))return null;const e=this._currentLine,t=this._consume(B.tokens.ident,"Expected function name.").toString();this._consume(B.tokens.paren_left,"Expected '(' for function arguments.");const s=[];if(!this._check(B.tokens.paren_right))do{if(this._check(B.tokens.paren_right))break;const l=this._attribute(),f=this._consume(B.tokens.name,"Expected argument name.").toString();this._consume(B.tokens.colon,"Expected ':' for argument type.");const h=this._attribute(),g=this._type_decl();g!=null&&(g.attributes=h,s.push(this._updateNode(new H1(f,g,l))))}while(this._match(B.tokens.comma));this._consume(B.tokens.paren_right,"Expected ')' after function arguments.");let r=null;if(this._match(B.tokens.arrow)){const l=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=l)}const i=this._compound_statement(),o=this._currentLine;return this._updateNode(new gl(t,s,r,i,e,o),e)}_compound_statement(){const e=[];for(this._consume(B.tokens.brace_left,"Expected '{' for block.");!this._check(B.tokens.brace_right);){const t=this._statement();t!==null&&e.push(t)}return this._consume(B.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(B.tokens.semicolon)&&!this._isAtEnd(););if(this._check(B.tokens.attr)&&this._attribute(),this._check(B.keywords.if))return this._if_statement();if(this._check(B.keywords.switch))return this._switch_statement();if(this._check(B.keywords.loop))return this._loop_statement();if(this._check(B.keywords.for))return this._for_statement();if(this._check(B.keywords.while))return this._while_statement();if(this._check(B.keywords.continuing))return this._continuing_statement();if(this._check(B.keywords.static_assert))return this._static_assert_statement();if(this._check(B.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(B.keywords.return))e=this._return_statement();else if(this._check([B.keywords.var,B.keywords.let,B.keywords.const]))e=this._variable_statement();else if(this._match(B.keywords.discard))e=this._updateNode(new EP);else if(this._match(B.keywords.break)){const t=this._updateNode(new S3);if(this._currentLoop.length>0){const s=this._currentLoop[this._currentLoop.length-1];t.loopId=s.id}e=t,this._check(B.keywords.if)&&(this._advance(),t.condition=this._optional_paren_expression())}else if(this._match(B.keywords.continue)){const t=this._updateNode(new w3);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${t.line}`);{const s=this._currentLoop[this._currentLoop.length-1];t.loopId=s.id}e=t}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(B.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(B.keywords.static_assert))return null;const e=this._currentLine,t=this._optional_paren_expression();return this._updateNode(new yP(t),e)}_while_statement(){if(!this._match(B.keywords.while))return null;const e=this._updateNode(new _3(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(B.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(B.keywords.continuing))return null;const t=this._currentLine,s=this._compound_statement();return this._updateNode(new B_(s,e),t)}_for_statement(){if(!this._match(B.keywords.for))return null;this._consume(B.tokens.paren_left,"Expected '('.");const e=this._updateNode(new A3(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(B.tokens.semicolon)?null:this._for_init(),this._consume(B.tokens.semicolon,"Expected ';'."),e.condition=this._check(B.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(B.tokens.semicolon,"Expected ';'."),e.increment=this._check(B.tokens.paren_right)?null:this._for_increment(),this._consume(B.tokens.paren_right,"Expected ')'."),this._check(B.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(B.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(B.tokens.equal)&&(t=this._short_circuit_or_expression()),this._updateNode(new ur(e.name,e.type,e.storage,e.access,t),e.line)}if(this._match(B.keywords.let)){const e=this._currentLine,t=this._consume(B.tokens.name,"Expected name for let.").toString();let s=null;if(this._match(B.tokens.colon)){const i=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=i)}this._consume(B.tokens.equal,"Expected '=' for let.");const r=this._short_circuit_or_expression();return this._updateNode(new nl(t,s,null,null,r),e)}if(this._match(B.keywords.const)){const e=this._currentLine,t=this._consume(B.tokens.name,"Expected name for const.").toString();let s=null;if(this._match(B.tokens.colon)){const i=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=i)}this._consume(B.tokens.equal,"Expected '=' for const.");const r=this._short_circuit_or_expression();return s===null&&r instanceof xt&&(s=r.type),this._updateNode(new Pf(t,s,null,null,r),e)}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(t==null)return null;if(!this._check(B.increment_operators))return this._current=e,null;const s=this._consume(B.increment_operators,"Expected increment operator");return this._updateNode(new y3(s.type===B.tokens.plus_plus?Ko.increment:Ko.decrement,t))}_assignment_statement(){let e=null;const t=this._currentLine;if(this._check(B.tokens.brace_right))return null;let s=this._match(B.tokens.underscore);if(s||(e=this._unary_expression()),!s&&e==null)return null;const r=this._consume(B.assignment_operators,"Expected assignment operator."),i=this._short_circuit_or_expression();return this._updateNode(new b3($c.parse(r.lexeme),e,i),t)}_func_call_statement(){if(!this._check(B.tokens.ident))return null;const e=this._currentLine,t=this._current,s=this._consume(B.tokens.ident,"Expected function name."),r=this._argument_expression_list();return r===null?(this._current=t,null):this._updateNode(new UA(s.lexeme,r),e)}_loop_statement(){if(!this._match(B.keywords.loop))return null;this._check(B.tokens.attr)&&this._attribute(),this._consume(B.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new T3([],null));this._currentLoop.push(e);let t=this._statement();for(;t!==null;){if(Array.isArray(t))for(let s of t)e.body.push(s);else e.body.push(t);if(t instanceof B_){e.continuing=t;break}t=this._statement()}return this._currentLoop.pop(),this._consume(B.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(B.keywords.switch))return null;const e=this._updateNode(new E3(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(B.tokens.attr)&&this._attribute(),this._consume(B.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(B.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let t=!1;for(;this._check([B.keywords.default,B.keywords.case]);){if(this._match(B.keywords.case)){const s=this._case_selectors();for(const i of s)if(i instanceof Lf){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");t=!0;break}this._match(B.tokens.colon),this._check(B.tokens.attr)&&this._attribute(),this._consume(B.tokens.brace_left,"Exected '{' for switch case.");const r=this._case_body();this._consume(B.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new O3(s,r)))}if(this._match(B.keywords.default)){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(B.tokens.colon),this._check(B.tokens.attr)&&this._attribute(),this._consume(B.tokens.brace_left,"Exected '{' for switch default.");const s=this._case_body();this._consume(B.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new D3(s)))}}return e}_case_selectors(){const e=[];for(this._match(B.keywords.default)?e.push(this._updateNode(new Lf)):e.push(this._shift_expression());this._match(B.tokens.comma);)this._match(B.keywords.default)?e.push(this._updateNode(new Lf)):e.push(this._shift_expression());return e}_case_body(){if(this._match(B.keywords.fallthrough))return this._consume(B.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const t=this._case_body();return t.length==0?e:[...e,t[0]]}_if_statement(){if(!this._match(B.keywords.if))return null;const e=this._currentLine,t=this._optional_paren_expression();this._check(B.tokens.attr)&&this._attribute();const s=this._compound_statement();let r=[];this._match_elseif()&&(this._check(B.tokens.attr)&&this._attribute(),r=this._elseif_statement(r));let i=null;return this._match(B.keywords.else)&&(this._check(B.tokens.attr)&&this._attribute(),i=this._compound_statement()),this._updateNode(new C3(t,s,r,i),e)}_match_elseif(){return this._tokens[this._current].type===B.keywords.else&&this._tokens[this._current+1].type===B.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const t=this._optional_paren_expression(),s=this._compound_statement();return e.push(this._updateNode(new CP(t,s))),this._match_elseif()&&(this._check(B.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(B.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new v3(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(B.tokens.or_or);)e=this._updateNode(new hs(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(B.tokens.and_and);)e=this._updateNode(new hs(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(B.tokens.or);)e=this._updateNode(new hs(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(B.tokens.xor);)e=this._updateNode(new hs(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(B.tokens.and);)e=this._updateNode(new hs(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([B.tokens.equal_equal,B.tokens.not_equal])?this._updateNode(new hs(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([B.tokens.less_than,B.tokens.greater_than,B.tokens.less_than_equal,B.tokens.greater_than_equal]);)e=this._updateNode(new hs(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([B.tokens.shift_left,B.tokens.shift_right]);)e=this._updateNode(new hs(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([B.tokens.plus,B.tokens.minus]);)e=this._updateNode(new hs(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([B.tokens.star,B.tokens.forward_slash,B.tokens.modulo]);)e=this._updateNode(new hs(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([B.tokens.minus,B.tokens.bang,B.tokens.tilde,B.tokens.star,B.tokens.and])?this._updateNode(new Ct(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(B.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(B.tokens.bracket_right,"Expected ']'.");const t=this._updateNode(new da(e)),s=this._postfix_expression();return s&&(t.postfix=s),t}if(this._match(B.tokens.period)){const e=this._consume(B.tokens.name,"Expected member name."),t=this._postfix_expression(),s=this._updateNode(new Gi(e.lexeme));return t&&(s.postfix=t),s}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const t=this._getStruct(e);if(t!==null)return t;switch(e){case"void":return q.void;case"bool":return q.bool;case"i32":return q.i32;case"u32":return q.u32;case"f32":return q.f32;case"f16":return q.f16;case"vec2f":return H.vec2f;case"vec3f":return H.vec3f;case"vec4f":return H.vec4f;case"vec2i":return H.vec2i;case"vec3i":return H.vec3i;case"vec4i":return H.vec4i;case"vec2u":return H.vec2u;case"vec3u":return H.vec3u;case"vec4u":return H.vec4u;case"vec2h":return H.vec2h;case"vec3h":return H.vec3h;case"vec4h":return H.vec4h;case"mat2x2f":return H.mat2x2f;case"mat2x3f":return H.mat2x3f;case"mat2x4f":return H.mat2x4f;case"mat3x2f":return H.mat3x2f;case"mat3x3f":return H.mat3x3f;case"mat3x4f":return H.mat3x4f;case"mat4x2f":return H.mat4x2f;case"mat4x3f":return H.mat4x3f;case"mat4x4f":return H.mat4x4f;case"mat2x2h":return H.mat2x2h;case"mat2x3h":return H.mat2x3h;case"mat2x4h":return H.mat2x4h;case"mat3x2h":return H.mat3x2h;case"mat3x3h":return H.mat3x3h;case"mat3x4h":return H.mat3x4h;case"mat4x2h":return H.mat4x2h;case"mat4x3h":return H.mat4x3h;case"mat4x4h":return H.mat4x4h;case"mat2x2i":return H.mat2x2i;case"mat2x3i":return H.mat2x3i;case"mat2x4i":return H.mat2x4i;case"mat3x2i":return H.mat3x2i;case"mat3x3i":return H.mat3x3i;case"mat3x4i":return H.mat3x4i;case"mat4x2i":return H.mat4x2i;case"mat4x3i":return H.mat4x3i;case"mat4x4i":return H.mat4x4i;case"mat2x2u":return H.mat2x2u;case"mat2x3u":return H.mat2x3u;case"mat2x4u":return H.mat2x4u;case"mat3x2u":return H.mat3x2u;case"mat3x3u":return H.mat3x3u;case"mat3x4u":return H.mat3x4u;case"mat4x2u":return H.mat4x2u;case"mat4x3u":return H.mat4x3u;case"mat4x4u":return H.mat4x4u}return null}_validateTypeRange(e,t){if(t.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(t.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(B.tokens.ident)){const s=this._previous().toString();if(this._check(B.tokens.paren_left)){const r=this._argument_expression_list(),i=this._getType(s);return i!==null?this._updateNode(new Ns(i,r)):this._updateNode(new kA(s,r))}if(this._context.constants.has(s)){const r=this._context.constants.get(s);return this._updateNode(new R3(s,r.value))}return this._updateNode(new Dn(s))}if(this._match(B.tokens.int_literal)){const s=this._previous().toString();let r=s.endsWith("i")||s.endsWith("i")?q.i32:s.endsWith("u")||s.endsWith("U")?q.u32:q.x32;const i=parseInt(s);return this._validateTypeRange(i,r),this._updateNode(new xt(new F(i,this._exec.getTypeInfo(r)),r))}if(this._match(B.tokens.uint_literal)){const s=parseInt(this._previous().toString());return this._validateTypeRange(s,q.u32),this._updateNode(new xt(new F(s,this._exec.getTypeInfo(q.u32)),q.u32))}if(this._match([B.tokens.decimal_float_literal,B.tokens.hex_float_literal])){let s=this._previous().toString(),r=s.endsWith("h");r&&(s=s.substring(0,s.length-1));const i=parseFloat(s);this._validateTypeRange(i,r?q.f16:q.f32);const o=r?q.f16:q.f32;return this._updateNode(new xt(new F(i,this._exec.getTypeInfo(o)),o))}if(this._match([B.keywords.true,B.keywords.false])){let s=this._previous().toString()===B.keywords.true.rule;return this._updateNode(new xt(new F(s?1:0,this._exec.getTypeInfo(q.bool)),q.bool))}if(this._check(B.tokens.paren_left))return this._paren_expression();if(this._match(B.keywords.bitcast)){this._consume(B.tokens.less_than,"Expected '<'.");const s=this._type_decl();this._consume(B.tokens.greater_than,"Expected '>'.");const r=this._paren_expression();return this._updateNode(new x3(s,r))}const e=this._type_decl(),t=this._argument_expression_list();return this._updateNode(new Ns(e,t))}_argument_expression_list(){if(!this._match(B.tokens.paren_left))return null;const e=[];do{if(this._check(B.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(B.tokens.comma));return this._consume(B.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(B.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(B.tokens.paren_right),e}_paren_expression(){this._consume(B.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(B.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(B.keywords.struct))return null;const e=this._currentLine,t=this._consume(B.tokens.ident,"Expected name for struct.").toString();this._consume(B.tokens.brace_left,"Expected '{' for struct body.");const s=[];for(;!this._check(B.tokens.brace_right);){const o=this._attribute(),l=this._consume(B.tokens.name,"Expected variable name.").toString();this._consume(B.tokens.colon,"Expected ':' for struct member type.");const f=this._attribute(),h=this._type_decl();h!=null&&(h.attributes=f),this._check(B.tokens.brace_right)?this._match(B.tokens.comma):this._consume(B.tokens.comma,"Expected ',' for struct member."),s.push(this._updateNode(new G1(l,h,o)))}this._consume(B.tokens.brace_right,"Expected '}' after struct body.");const r=this._currentLine,i=this._updateNode(new cr(t,s,e,r),e);return this._context.structs.set(t,i),i}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(B.tokens.equal)){const t=this._const_expression();e.value=t}if(e.type!==null&&e.value instanceof xt){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof xt&&(e.type=e.value.type.name==="x32"?q.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(B.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(B.keywords.const))return null;const t=this._consume(B.tokens.name,"Expected variable name"),s=this._currentLine;let r=null;if(this._match(B.tokens.colon)){const f=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=f)}let i=null;this._consume(B.tokens.equal,"const declarations require an assignment");const o=this._short_circuit_or_expression();try{let f=[q.f32],h=o.constEvaluate(this._exec,f);h instanceof F&&this._validateTypeRange(h.value,f[0]),f[0]instanceof H&&f[0].format===null&&h.typeInfo instanceof Hi&&h.typeInfo.format!==null&&(h.typeInfo.format.name==="f16"?f[0].format=q.f16:h.typeInfo.format.name==="f32"?f[0].format=q.f32:h.typeInfo.format.name==="i32"?f[0].format=q.i32:h.typeInfo.format.name==="u32"?f[0].format=q.u32:h.typeInfo.format.name==="bool"?f[0].format=q.bool:console.error(`TODO: impelement template format type ${h.typeInfo.format.name}`)),i=this._updateNode(new xt(h,f[0])),this._exec.context.setVariable(t.toString(),h)}catch{i=o}if(r!==null&&i instanceof xt){if(i.type.name!=="x32"&&r.getTypeName()!==i.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${i.type.name} to ${r.name}. Line:${this._currentLine}`);i.type=r,i.isScalar&&this._validateTypeRange(i.scalarValue,i.type)}else r===null&&i instanceof xt&&(r=(e=i==null?void 0:i.type)!==null&&e!==void 0?e:q.f32,r===q.x32&&(r=q.i32));const l=this._updateNode(new Pf(t.toString(),r,"","",i),s);return this._context.constants.set(l.name,l),l}_global_let_decl(){if(!this._match(B.keywords.let))return null;const e=this._currentLine,t=this._consume(B.tokens.name,"Expected variable name");let s=null;if(this._match(B.tokens.colon)){const i=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=i)}let r=null;if(this._match(B.tokens.equal)&&(r=this._const_expression()),s!==null&&r instanceof xt){if(r.type.name!=="x32"&&s.getTypeName()!==r.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${r.type.name} to ${s.name}. Line:${this._currentLine}`);r.type=s}else s===null&&r instanceof xt&&(s=r.type.name==="x32"?q.i32:r.type);return r instanceof xt&&r.isScalar&&this._validateTypeRange(r.scalarValue,s),this._updateNode(new nl(t.toString(),s,"","",r),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(B.keywords.var))return null;const e=this._currentLine;let t="",s="";this._match(B.tokens.less_than)&&(t=this._consume(B.storage_class,"Expected storage_class.").toString(),this._match(B.tokens.comma)&&(s=this._consume(B.access_mode,"Expected access_mode.").toString()),this._consume(B.tokens.greater_than,"Expected '>'."));const r=this._consume(B.tokens.name,"Expected variable name");let i=null;if(this._match(B.tokens.colon)){const o=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=o)}return this._updateNode(new ur(r.toString(),i,t,s,null),e)}_override_decl(){if(!this._match(B.keywords.override))return null;const e=this._consume(B.tokens.name,"Expected variable name");let t=null;if(this._match(B.tokens.colon)){const s=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=s)}return this._updateNode(new PA(e.toString(),t,null))}_diagnostic(){this._consume(B.tokens.paren_left,"Expected '('");const e=this._consume(B.tokens.ident,"Expected severity control name.");this._consume(B.tokens.comma,"Expected ','");let t=this._consume(B.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(B.tokens.period)&&(t+=`.${this._consume(B.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(B.tokens.paren_right,"Expected ')'"),this._updateNode(new B3(e.toString(),t))}_enable_directive(){const e=this._consume(B.tokens.ident,"identity expected.");return this._updateNode(new bP(e.toString()))}_requires_directive(){const e=[this._consume(B.tokens.ident,"identity expected.").toString()];for(;this._match(B.tokens.comma);){const t=this._consume(B.tokens.ident,"identity expected.");e.push(t.toString())}return this._updateNode(new TP(e))}_type_alias(){const e=this._consume(B.tokens.ident,"identity expected.");this._consume(B.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(t===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const s=this._updateNode(new LA(e.toString(),t));return this._context.aliases.set(s.name,s),s}_type_decl(){if(this._check([B.tokens.ident,...B.texel_format,B.keywords.bool,B.keywords.f32,B.keywords.i32,B.keywords.u32])){const s=this._advance().toString();if(this._context.structs.has(s))return this._context.structs.get(s);if(this._context.aliases.has(s))return this._context.aliases.get(s).type;if(!this._getType(s)){const r=this._updateNode(new k1(s));return this._forwardTypeCount++,r}return this._updateNode(new q(s))}let e=this._texture_sampler_types();if(e)return e;if(this._check(B.template_types)){let s=this._advance().toString(),r=null,i=null;return this._match(B.tokens.less_than)&&(r=this._type_decl(),i=null,this._match(B.tokens.comma)&&(i=this._consume(B.access_mode,"Expected access_mode for pointer").toString()),this._consume(B.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new H(s,r,i))}if(this._match(B.keywords.ptr)){let s=this._previous().toString();this._consume(B.tokens.less_than,"Expected '<' for pointer.");const r=this._consume(B.storage_class,"Expected storage_class for pointer");this._consume(B.tokens.comma,"Expected ',' for pointer.");const i=this._type_decl();let o=null;return this._match(B.tokens.comma)&&(o=this._consume(B.access_mode,"Expected access_mode for pointer").toString()),this._consume(B.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new Uf(s,r.toString(),i,o))}const t=this._attribute();if(this._match(B.keywords.array)){let s=null,r=-1;const i=this._previous();let o=null;if(this._match(B.tokens.less_than)){s=this._type_decl(),this._context.aliases.has(s.name)&&(s=this._context.aliases.get(s.name).type);let f="";if(this._match(B.tokens.comma)){o=this._shift_expression();try{f=o.constEvaluate(this._exec).toString(),o=null}catch{f="1"}}this._consume(B.tokens.greater_than,"Expected '>' for array."),r=f?parseInt(f):0}const l=this._updateNode(new sl(i.toString(),t,s,r));return o&&this._deferArrayCountEval.push({arrayType:l,countNode:o}),l}return null}_texture_sampler_types(){if(this._match(B.sampler_type))return this._updateNode(new Xc(this._previous().toString(),null,null));if(this._match(B.depth_texture_type))return this._updateNode(new Xc(this._previous().toString(),null,null));if(this._match(B.sampled_texture_type)||this._match(B.multisampled_texture_type)){const e=this._previous();this._consume(B.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(B.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Xc(e.toString(),t,null))}if(this._match(B.storage_texture_type)){const e=this._previous();this._consume(B.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(B.texel_format,"Invalid texel format.").toString();this._consume(B.tokens.comma,"Expected ',' after texel format.");const s=this._consume(B.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(B.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Xc(e.toString(),t,s))}return null}_attribute(){let e=[];for(;this._match(B.tokens.attr);){const t=this._consume(B.attribute_name,"Expected attribute name"),s=this._updateNode(new N3(t.toString(),null));if(this._match(B.tokens.paren_left)){if(s.value=this._consume(B.literal_or_ident,"Expected attribute value").toString(),this._check(B.tokens.comma)){this._advance();do{const r=this._consume(B.literal_or_ident,"Expected attribute value").toString();s.value instanceof Array||(s.value=[s.value]),s.value.push(r)}while(this._match(B.tokens.comma))}this._consume(B.tokens.paren_right,"Expected ')'")}e.push(s)}return e.length==0?null:e}}class UP extends Gs{constructor(e){super(),e&&this.update(e)}update(e){const t=new PP().parse(e);this.updateAST(t)}}function LP(n){var i;const e={attributes:[],bindings:[]};let t;try{t=kP(n)}catch(o){return te.error(o.message)(),e}for(const o of t.uniforms){const l=[];for(const f of((i=o.type)==null?void 0:i.members)||[])l.push({name:f.name,type:z1(f.type)});e.bindings.push({type:"uniform",name:o.name,group:o.group,location:o.binding,members:l})}for(const o of t.textures)e.bindings.push({type:"texture",name:o.name,group:o.group,location:o.binding});for(const o of t.samplers)e.bindings.push({type:"sampler",name:o.name,group:o.group,location:o.binding});const s=t.entry.vertex[0],r=(s==null?void 0:s.inputs.length)||0;for(let o=0;o<r;o++){const l=s.inputs[o];if(l.locationType==="location"){const f=z1(l.type);e.attributes.push({name:l.name,location:Number(l.location),type:f})}}return e}function z1(n){return n.format?`${n.name}<${n.format.name}>`:n.name}function kP(n){try{return new UP(n)}catch(e){if(e instanceof Error)throw e;let t="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(t+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(t+=e.token.line||""),new Error(t,{cause:e})}}const HP=1/Math.PI*180,GP=1/180*Math.PI,VP={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...VP}};const Ot=globalThis.mathgl.config;function jP(n,{precision:e=Ot.precision}={}){return n=JP(n),`${parseFloat(n.toPrecision(e))}`}function si(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}function zP(n){return XP(n)}function $P(n){return gs(n)}function XP(n,e){return zA(n,t=>t*GP,e)}function gs(n,e){return zA(n,t=>t*HP,e)}function Wn(n,e,t){return zA(n,s=>Math.max(e,Math.min(t,s)))}function hh(n,e,t){return si(n)?n.map((s,r)=>hh(s,e[r],t)):t*e+(1-t)*n}function Ts(n,e,t){const s=Ot.EPSILON;t&&(Ot.EPSILON=t);try{if(n===e)return!0;if(si(n)&&si(e)){if(n.length!==e.length)return!1;for(let r=0;r<n.length;++r)if(!Ts(n[r],e[r]))return!1;return!0}return n&&n.equals?n.equals(e):e&&e.equals?e.equals(n):typeof n=="number"&&typeof e=="number"?Math.abs(n-e)<=Ot.EPSILON*Math.max(1,Math.abs(n),Math.abs(e)):!1}finally{Ot.EPSILON=s}}function JP(n){return Math.round(n/Ot.EPSILON)*Ot.EPSILON}function WP(n){return n.clone?n.clone():new Array(n.length)}function zA(n,e,t){if(si(n)){const s=n;t=t||WP(s);for(let r=0;r<t.length&&r<s.length;++r){const i=typeof n=="number"?n:n[r];t[r]=e(i,r,t)}return t}return e(n)}class $A extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,t=0){for(let s=0;s<this.ELEMENTS;++s)this[s]=e[s+t];return this.check()}toArray(e=[],t=0){for(let s=0;s<this.ELEMENTS;++s)e[t+s]=this[s];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:si(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Ot)}formatString(e){let t="";for(let s=0;s<this.ELEMENTS;++s)t+=(s>0?", ":"")+jP(this[s],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!Ts(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,s){if(s===void 0)return this.lerp(this,e,t);for(let r=0;r<this.ELEMENTS;++r){const i=e[r],o=typeof t=="number"?t:t[r];this[r]=i+s*(o-i)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let s=0;s<this.ELEMENTS;++s)this[s]=Math.min(Math.max(this[s],e[s]),t[s]);return this.check()}add(...e){for(const t of e)for(let s=0;s<this.ELEMENTS;++s)this[s]+=t[s];return this.check()}subtract(...e){for(const t of e)for(let s=0;s<this.ELEMENTS;++s)this[s]-=t[s];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(Ot.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let s=0;s<this.ELEMENTS;++s)this[s]=Math.min(Math.max(this[s],e),t);return this.check()}get elements(){return this}}function YP(n,e){if(n.length!==e)return!1;for(let t=0;t<n.length;++t)if(!Number.isFinite(n[t]))return!1;return!0}function Je(n){if(!Number.isFinite(n))throw new Error(`Invalid number ${JSON.stringify(n)}`);return n}function rl(n,e,t=""){if(Ot.debug&&!YP(n,e))throw new Error(`math.gl: ${t} some fields set to invalid numbers'`);return n}function ps(n,e){if(!n)throw new Error(`math.gl assertion ${e}`)}class XA extends $A{get x(){return this[0]}set x(e){this[0]=Je(e)}get y(){return this[1]}set y(e){this[1]=Je(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let s=0;s<this.ELEMENTS;++s){const r=this[s]-e[s];t+=r*r}return Je(t)}dot(e){let t=0;for(let s=0;s<this.ELEMENTS;++s)t+=this[s]*e[s];return Je(t)}normalize(){const e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(const t of e)for(let s=0;s<this.ELEMENTS;++s)this[s]*=t[s];return this.check()}divide(...e){for(const t of e)for(let s=0;s<this.ELEMENTS;++s)this[s]/=t[s];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return ps(e>=0&&e<this.ELEMENTS,"index is out of range"),Je(this[e])}setComponent(e,t){return ps(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}const il=1e-6;let Cs=typeof Float32Array<"u"?Float32Array:Array;function KP(){const n=new Cs(2);return Cs!=Float32Array&&(n[0]=0,n[1]=0),n}function $1(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n}function qP(n,e){return n[0]=-e[0],n[1]=-e[1],n}function F3(n,e,t,s){const r=e[0],i=e[1];return n[0]=r+s*(t[0]-r),n[1]=i+s*(t[1]-i),n}function QP(n,e,t){const s=e[0],r=e[1];return n[0]=t[0]*s+t[2]*r,n[1]=t[1]*s+t[3]*r,n}function ZP(n,e,t){const s=e[0],r=e[1];return n[0]=t[0]*s+t[2]*r+t[4],n[1]=t[1]*s+t[3]*r+t[5],n}function P3(n,e,t){const s=e[0],r=e[1];return n[0]=t[0]*s+t[3]*r+t[6],n[1]=t[1]*s+t[4]*r+t[7],n}function U3(n,e,t){const s=e[0],r=e[1];return n[0]=t[0]*s+t[4]*r+t[12],n[1]=t[1]*s+t[5]*r+t[13],n}(function(){const n=KP();return function(e,t,s,r,i,o){let l,f;for(t||(t=2),s||(s=0),r?f=Math.min(r*t+s,e.length):f=e.length,l=s;l<f;l+=t)n[0]=e[l],n[1]=e[l+1],i(n,n,o),e[l]=n[0],e[l+1]=n[1];return e}})();function L3(n,e,t){const s=e[0],r=e[1],i=t[3]*s+t[7]*r||1;return n[0]=(t[0]*s+t[4]*r)/i,n[1]=(t[1]*s+t[5]*r)/i,n}function k3(n,e,t){const s=e[0],r=e[1],i=e[2],o=t[3]*s+t[7]*r+t[11]*i||1;return n[0]=(t[0]*s+t[4]*r+t[8]*i)/o,n[1]=(t[1]*s+t[5]*r+t[9]*i)/o,n[2]=(t[2]*s+t[6]*r+t[10]*i)/o,n}function eU(n,e,t){const s=e[0],r=e[1];return n[0]=t[0]*s+t[2]*r,n[1]=t[1]*s+t[3]*r,n[2]=e[2],n}function tU(n,e,t){const s=e[0],r=e[1];return n[0]=t[0]*s+t[2]*r,n[1]=t[1]*s+t[3]*r,n[2]=e[2],n[3]=e[3],n}function H3(n,e,t){const s=e[0],r=e[1],i=e[2];return n[0]=t[0]*s+t[3]*r+t[6]*i,n[1]=t[1]*s+t[4]*r+t[7]*i,n[2]=t[2]*s+t[5]*r+t[8]*i,n[3]=e[3],n}class Ra extends XA{constructor(e=0,t=0){super(2),si(e)&&arguments.length===1?this.copy(e):(Ot.debug&&(Je(e),Je(t)),this[0]=e,this[1]=t)}set(e,t){return this[0]=e,this[1]=t,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this.check()}fromObject(e){return Ot.debug&&(Je(e.x),Je(e.y)),this[0]=e.x,this[1]=e.y,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return U3(this,this,e),this.check()}transformAsVector(e){return L3(this,this,e),this.check()}transformByMatrix3(e){return P3(this,this,e),this.check()}transformByMatrix2x3(e){return ZP(this,this,e),this.check()}transformByMatrix2(e){return QP(this,this,e),this.check()}}function G3(){const n=new Cs(3);return Cs!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function V3(n){const e=n[0],t=n[1],s=n[2];return Math.sqrt(e*e+t*t+s*s)}function X1(n,e,t){const s=new Cs(3);return s[0]=n,s[1]=e,s[2]=t,s}function nU(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}function sU(n){const e=n[0],t=n[1],s=n[2];return e*e+t*t+s*s}function rU(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function iU(n,e){const t=e[0],s=e[1],r=e[2];let i=t*t+s*s+r*r;return i>0&&(i=1/Math.sqrt(i)),n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n}function JA(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function kf(n,e,t){const s=e[0],r=e[1],i=e[2],o=t[0],l=t[1],f=t[2];return n[0]=r*f-i*l,n[1]=i*o-s*f,n[2]=s*l-r*o,n}function oU(n,e,t,s){const r=e[0],i=e[1],o=e[2];return n[0]=r+s*(t[0]-r),n[1]=i+s*(t[1]-i),n[2]=o+s*(t[2]-o),n}function WA(n,e,t){const s=e[0],r=e[1],i=e[2];let o=t[3]*s+t[7]*r+t[11]*i+t[15];return o=o||1,n[0]=(t[0]*s+t[4]*r+t[8]*i+t[12])/o,n[1]=(t[1]*s+t[5]*r+t[9]*i+t[13])/o,n[2]=(t[2]*s+t[6]*r+t[10]*i+t[14])/o,n}function j3(n,e,t){const s=e[0],r=e[1],i=e[2];return n[0]=s*t[0]+r*t[3]+i*t[6],n[1]=s*t[1]+r*t[4]+i*t[7],n[2]=s*t[2]+r*t[5]+i*t[8],n}function z3(n,e,t){const s=t[0],r=t[1],i=t[2],o=t[3],l=e[0],f=e[1],h=e[2];let g=r*h-i*f,m=i*l-s*h,A=s*f-r*l,y=r*A-i*m,E=i*g-s*A,v=s*m-r*g;const S=o*2;return g*=S,m*=S,A*=S,y*=2,E*=2,v*=2,n[0]=l+g+y,n[1]=f+m+E,n[2]=h+A+v,n}function aU(n,e,t,s){const r=[],i=[];return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],i[0]=r[0],i[1]=r[1]*Math.cos(s)-r[2]*Math.sin(s),i[2]=r[1]*Math.sin(s)+r[2]*Math.cos(s),n[0]=i[0]+t[0],n[1]=i[1]+t[1],n[2]=i[2]+t[2],n}function cU(n,e,t,s){const r=[],i=[];return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],i[0]=r[2]*Math.sin(s)+r[0]*Math.cos(s),i[1]=r[1],i[2]=r[2]*Math.cos(s)-r[0]*Math.sin(s),n[0]=i[0]+t[0],n[1]=i[1]+t[1],n[2]=i[2]+t[2],n}function lU(n,e,t,s){const r=[],i=[];return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],i[0]=r[0]*Math.cos(s)-r[1]*Math.sin(s),i[1]=r[0]*Math.sin(s)+r[1]*Math.cos(s),i[2]=r[2],n[0]=i[0]+t[0],n[1]=i[1]+t[1],n[2]=i[2]+t[2],n}function uU(n,e){const t=n[0],s=n[1],r=n[2],i=e[0],o=e[1],l=e[2],f=Math.sqrt((t*t+s*s+r*r)*(i*i+o*o+l*l)),h=f&&JA(n,e)/f;return Math.acos(Math.min(Math.max(h,-1),1))}const $3=nU,X3=V3,qp=sU;(function(){const n=G3();return function(e,t,s,r,i,o){let l,f;for(t||(t=3),s||(s=0),r?f=Math.min(r*t+s,e.length):f=e.length,l=s;l<f;l+=t)n[0]=e[l],n[1]=e[l+1],n[2]=e[l+2],i(n,n,o),e[l]=n[0],e[l+1]=n[1],e[l+2]=n[2];return e}})();const Qp=[0,0,0];let of;class L extends XA{static get ZERO(){return of||(of=new L(0,0,0),Object.freeze(of)),of}constructor(e=0,t=0,s=0){super(-0,-0,-0),arguments.length===1&&si(e)?this.copy(e):(Ot.debug&&(Je(e),Je(t),Je(s)),this[0]=e,this[1]=t,this[2]=s)}set(e,t,s){return this[0]=e,this[1]=t,this[2]=s,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Ot.debug&&(Je(e.x),Je(e.y),Je(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Je(e)}angle(e){return uU(this,e)}cross(e){return kf(this,this,e),this.check()}rotateX({radians:e,origin:t=Qp}){return aU(this,this,t,e),this.check()}rotateY({radians:e,origin:t=Qp}){return cU(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=Qp}){return lU(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return WA(this,this,e),this.check()}transformAsVector(e){return k3(this,this,e),this.check()}transformByMatrix3(e){return j3(this,this,e),this.check()}transformByMatrix2(e){return eU(this,this,e),this.check()}transformByQuaternion(e){return z3(this,this,e),this.check()}}let af;class YA extends XA{static get ZERO(){return af||(af=new YA(0,0,0,0),Object.freeze(af)),af}constructor(e=0,t=0,s=0,r=0){super(-0,-0,-0,-0),si(e)&&arguments.length===1?this.copy(e):(Ot.debug&&(Je(e),Je(t),Je(s),Je(r)),this[0]=e,this[1]=t,this[2]=s,this[3]=r)}set(e,t,s,r){return this[0]=e,this[1]=t,this[2]=s,this[3]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return Ot.debug&&(Je(e.x),Je(e.y),Je(e.z),Je(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=Je(e)}get w(){return this[3]}set w(e){this[3]=Je(e)}transform(e){return WA(this,this,e),this.check()}transformByMatrix3(e){return H3(this,this,e),this.check()}transformByMatrix2(e){return tU(this,this,e),this.check()}transformByQuaternion(e){return z3(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class J3 extends $A{toString(){let e="[";if(Ot.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let s=0;s<this.RANK;++s)e+=` ${this[s*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,s){return this[t*this.RANK+e]=Je(s),this}getColumn(e,t=new Array(this.RANK).fill(-0)){const s=e*this.RANK;for(let r=0;r<this.RANK;++r)t[r]=this[s+r];return t}setColumn(e,t){const s=e*this.RANK;for(let r=0;r<this.RANK;++r)this[s+r]=t[r];return this}}function fU(){const n=new Cs(9);return Cs!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function hU(n,e){if(n===e){const t=e[1],s=e[2],r=e[5];n[1]=e[3],n[2]=e[6],n[3]=t,n[5]=e[7],n[6]=s,n[7]=r}else n[0]=e[0],n[1]=e[3],n[2]=e[6],n[3]=e[1],n[4]=e[4],n[5]=e[7],n[6]=e[2],n[7]=e[5],n[8]=e[8];return n}function dU(n,e){const t=e[0],s=e[1],r=e[2],i=e[3],o=e[4],l=e[5],f=e[6],h=e[7],g=e[8],m=g*o-l*h,A=-g*i+l*f,y=h*i-o*f;let E=t*m+s*A+r*y;return E?(E=1/E,n[0]=m*E,n[1]=(-g*s+r*h)*E,n[2]=(l*s-r*o)*E,n[3]=A*E,n[4]=(g*t-r*f)*E,n[5]=(-l*t+r*i)*E,n[6]=y*E,n[7]=(-h*t+s*f)*E,n[8]=(o*t-s*i)*E,n):null}function gU(n){const e=n[0],t=n[1],s=n[2],r=n[3],i=n[4],o=n[5],l=n[6],f=n[7],h=n[8];return e*(h*i-o*f)+t*(-h*r+o*l)+s*(f*r-i*l)}function J1(n,e,t){const s=e[0],r=e[1],i=e[2],o=e[3],l=e[4],f=e[5],h=e[6],g=e[7],m=e[8],A=t[0],y=t[1],E=t[2],v=t[3],S=t[4],x=t[5],O=t[6],R=t[7],D=t[8];return n[0]=A*s+y*o+E*h,n[1]=A*r+y*l+E*g,n[2]=A*i+y*f+E*m,n[3]=v*s+S*o+x*h,n[4]=v*r+S*l+x*g,n[5]=v*i+S*f+x*m,n[6]=O*s+R*o+D*h,n[7]=O*r+R*l+D*g,n[8]=O*i+R*f+D*m,n}function pU(n,e,t){const s=e[0],r=e[1],i=e[2],o=e[3],l=e[4],f=e[5],h=e[6],g=e[7],m=e[8],A=t[0],y=t[1];return n[0]=s,n[1]=r,n[2]=i,n[3]=o,n[4]=l,n[5]=f,n[6]=A*s+y*o+h,n[7]=A*r+y*l+g,n[8]=A*i+y*f+m,n}function mU(n,e,t){const s=e[0],r=e[1],i=e[2],o=e[3],l=e[4],f=e[5],h=e[6],g=e[7],m=e[8],A=Math.sin(t),y=Math.cos(t);return n[0]=y*s+A*o,n[1]=y*r+A*l,n[2]=y*i+A*f,n[3]=y*o-A*s,n[4]=y*l-A*r,n[5]=y*f-A*i,n[6]=h,n[7]=g,n[8]=m,n}function W1(n,e,t){const s=t[0],r=t[1];return n[0]=s*e[0],n[1]=s*e[1],n[2]=s*e[2],n[3]=r*e[3],n[4]=r*e[4],n[5]=r*e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n}function _U(n,e){const t=e[0],s=e[1],r=e[2],i=e[3],o=t+t,l=s+s,f=r+r,h=t*o,g=s*o,m=s*l,A=r*o,y=r*l,E=r*f,v=i*o,S=i*l,x=i*f;return n[0]=1-m-E,n[3]=g-x,n[6]=A+S,n[1]=g+x,n[4]=1-h-E,n[7]=y-v,n[2]=A-S,n[5]=y+v,n[8]=1-h-m,n}var w_;(function(n){n[n.COL0ROW0=0]="COL0ROW0",n[n.COL0ROW1=1]="COL0ROW1",n[n.COL0ROW2=2]="COL0ROW2",n[n.COL1ROW0=3]="COL1ROW0",n[n.COL1ROW1=4]="COL1ROW1",n[n.COL1ROW2=5]="COL1ROW2",n[n.COL2ROW0=6]="COL2ROW0",n[n.COL2ROW1=7]="COL2ROW1",n[n.COL2ROW2=8]="COL2ROW2"})(w_||(w_={}));const AU=Object.freeze([1,0,0,0,1,0,0,0,1]);class at extends J3{static get IDENTITY(){return bU()}static get ZERO(){return yU()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return w_}constructor(e,...t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):t.length>0?this.copy([e,...t]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(AU)}fromObject(e){return this.check()}fromQuaternion(e){return _U(this,e),this.check()}set(e,t,s,r,i,o,l,f,h){return this[0]=e,this[1]=t,this[2]=s,this[3]=r,this[4]=i,this[5]=o,this[6]=l,this[7]=f,this[8]=h,this.check()}setRowMajor(e,t,s,r,i,o,l,f,h){return this[0]=e,this[1]=r,this[2]=l,this[3]=t,this[4]=i,this[5]=f,this[6]=s,this[7]=o,this[8]=h,this.check()}determinant(){return gU(this)}transpose(){return hU(this,this),this.check()}invert(){return dU(this,this),this.check()}multiplyLeft(e){return J1(this,e,this),this.check()}multiplyRight(e){return J1(this,this,e),this.check()}rotate(e){return mU(this,this,e),this.check()}scale(e){return Array.isArray(e)?W1(this,this,e):W1(this,this,[e,e]),this.check()}translate(e){return pU(this,this,e),this.check()}transform(e,t){let s;switch(e.length){case 2:s=P3(t||[-0,-0],e,this);break;case 3:s=j3(t||[-0,-0,-0],e,this);break;case 4:s=H3(t||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return rl(s,e.length),s}transformVector(e,t){return this.transform(e,t)}transformVector2(e,t){return this.transform(e,t)}transformVector3(e,t){return this.transform(e,t)}}let cf,lf=null;function yU(){return cf||(cf=new at([0,0,0,0,0,0,0,0,0]),Object.freeze(cf)),cf}function bU(){return lf||(lf=new at,Object.freeze(lf)),lf}function TU(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function EU(n,e){if(n===e){const t=e[1],s=e[2],r=e[3],i=e[6],o=e[7],l=e[11];n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=t,n[6]=e[9],n[7]=e[13],n[8]=s,n[9]=i,n[11]=e[14],n[12]=r,n[13]=o,n[14]=l}else n[0]=e[0],n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=e[1],n[5]=e[5],n[6]=e[9],n[7]=e[13],n[8]=e[2],n[9]=e[6],n[10]=e[10],n[11]=e[14],n[12]=e[3],n[13]=e[7],n[14]=e[11],n[15]=e[15];return n}function R_(n,e){const t=e[0],s=e[1],r=e[2],i=e[3],o=e[4],l=e[5],f=e[6],h=e[7],g=e[8],m=e[9],A=e[10],y=e[11],E=e[12],v=e[13],S=e[14],x=e[15],O=t*l-s*o,R=t*f-r*o,D=t*h-i*o,z=s*f-r*l,J=s*h-i*l,ie=r*h-i*f,re=g*v-m*E,ee=g*S-A*E,le=g*x-y*E,fe=m*S-A*v,ye=m*x-y*v,ke=A*x-y*S;let me=O*ke-R*ye+D*fe+z*le-J*ee+ie*re;return me?(me=1/me,n[0]=(l*ke-f*ye+h*fe)*me,n[1]=(r*ye-s*ke-i*fe)*me,n[2]=(v*ie-S*J+x*z)*me,n[3]=(A*J-m*ie-y*z)*me,n[4]=(f*le-o*ke-h*ee)*me,n[5]=(t*ke-r*le+i*ee)*me,n[6]=(S*D-E*ie-x*R)*me,n[7]=(g*ie-A*D+y*R)*me,n[8]=(o*ye-l*le+h*re)*me,n[9]=(s*le-t*ye-i*re)*me,n[10]=(E*J-v*D+x*O)*me,n[11]=(m*D-g*J-y*O)*me,n[12]=(l*ee-o*fe-f*re)*me,n[13]=(t*fe-s*ee+r*re)*me,n[14]=(v*R-E*z-S*O)*me,n[15]=(g*z-m*R+A*O)*me,n):null}function CU(n){const e=n[0],t=n[1],s=n[2],r=n[3],i=n[4],o=n[5],l=n[6],f=n[7],h=n[8],g=n[9],m=n[10],A=n[11],y=n[12],E=n[13],v=n[14],S=n[15],x=e*o-t*i,O=e*l-s*i,R=t*l-s*o,D=h*E-g*y,z=h*v-m*y,J=g*v-m*E,ie=e*J-t*z+s*D,re=i*J-o*z+l*D,ee=h*R-g*O+m*x,le=y*R-E*O+v*x;return f*ie-r*re+S*ee-A*le}function Ui(n,e,t){const s=e[0],r=e[1],i=e[2],o=e[3],l=e[4],f=e[5],h=e[6],g=e[7],m=e[8],A=e[9],y=e[10],E=e[11],v=e[12],S=e[13],x=e[14],O=e[15];let R=t[0],D=t[1],z=t[2],J=t[3];return n[0]=R*s+D*l+z*m+J*v,n[1]=R*r+D*f+z*A+J*S,n[2]=R*i+D*h+z*y+J*x,n[3]=R*o+D*g+z*E+J*O,R=t[4],D=t[5],z=t[6],J=t[7],n[4]=R*s+D*l+z*m+J*v,n[5]=R*r+D*f+z*A+J*S,n[6]=R*i+D*h+z*y+J*x,n[7]=R*o+D*g+z*E+J*O,R=t[8],D=t[9],z=t[10],J=t[11],n[8]=R*s+D*l+z*m+J*v,n[9]=R*r+D*f+z*A+J*S,n[10]=R*i+D*h+z*y+J*x,n[11]=R*o+D*g+z*E+J*O,R=t[12],D=t[13],z=t[14],J=t[15],n[12]=R*s+D*l+z*m+J*v,n[13]=R*r+D*f+z*A+J*S,n[14]=R*i+D*h+z*y+J*x,n[15]=R*o+D*g+z*E+J*O,n}function dh(n,e,t){const s=t[0],r=t[1],i=t[2];let o,l,f,h,g,m,A,y,E,v,S,x;return e===n?(n[12]=e[0]*s+e[4]*r+e[8]*i+e[12],n[13]=e[1]*s+e[5]*r+e[9]*i+e[13],n[14]=e[2]*s+e[6]*r+e[10]*i+e[14],n[15]=e[3]*s+e[7]*r+e[11]*i+e[15]):(o=e[0],l=e[1],f=e[2],h=e[3],g=e[4],m=e[5],A=e[6],y=e[7],E=e[8],v=e[9],S=e[10],x=e[11],n[0]=o,n[1]=l,n[2]=f,n[3]=h,n[4]=g,n[5]=m,n[6]=A,n[7]=y,n[8]=E,n[9]=v,n[10]=S,n[11]=x,n[12]=o*s+g*r+E*i+e[12],n[13]=l*s+m*r+v*i+e[13],n[14]=f*s+A*r+S*i+e[14],n[15]=h*s+y*r+x*i+e[15]),n}function KA(n,e,t){const s=t[0],r=t[1],i=t[2];return n[0]=e[0]*s,n[1]=e[1]*s,n[2]=e[2]*s,n[3]=e[3]*s,n[4]=e[4]*r,n[5]=e[5]*r,n[6]=e[6]*r,n[7]=e[7]*r,n[8]=e[8]*i,n[9]=e[9]*i,n[10]=e[10]*i,n[11]=e[11]*i,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function vU(n,e,t,s){let r=s[0],i=s[1],o=s[2],l=Math.sqrt(r*r+i*i+o*o),f,h,g,m,A,y,E,v,S,x,O,R,D,z,J,ie,re,ee,le,fe,ye,ke,me,Oe;return l<il?null:(l=1/l,r*=l,i*=l,o*=l,h=Math.sin(t),f=Math.cos(t),g=1-f,m=e[0],A=e[1],y=e[2],E=e[3],v=e[4],S=e[5],x=e[6],O=e[7],R=e[8],D=e[9],z=e[10],J=e[11],ie=r*r*g+f,re=i*r*g+o*h,ee=o*r*g-i*h,le=r*i*g-o*h,fe=i*i*g+f,ye=o*i*g+r*h,ke=r*o*g+i*h,me=i*o*g-r*h,Oe=o*o*g+f,n[0]=m*ie+v*re+R*ee,n[1]=A*ie+S*re+D*ee,n[2]=y*ie+x*re+z*ee,n[3]=E*ie+O*re+J*ee,n[4]=m*le+v*fe+R*ye,n[5]=A*le+S*fe+D*ye,n[6]=y*le+x*fe+z*ye,n[7]=E*le+O*fe+J*ye,n[8]=m*ke+v*me+R*Oe,n[9]=A*ke+S*me+D*Oe,n[10]=y*ke+x*me+z*Oe,n[11]=E*ke+O*me+J*Oe,e!==n&&(n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n)}function W3(n,e,t){const s=Math.sin(t),r=Math.cos(t),i=e[4],o=e[5],l=e[6],f=e[7],h=e[8],g=e[9],m=e[10],A=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=i*r+h*s,n[5]=o*r+g*s,n[6]=l*r+m*s,n[7]=f*r+A*s,n[8]=h*r-i*s,n[9]=g*r-o*s,n[10]=m*r-l*s,n[11]=A*r-f*s,n}function BU(n,e,t){const s=Math.sin(t),r=Math.cos(t),i=e[0],o=e[1],l=e[2],f=e[3],h=e[8],g=e[9],m=e[10],A=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=i*r-h*s,n[1]=o*r-g*s,n[2]=l*r-m*s,n[3]=f*r-A*s,n[8]=i*s+h*r,n[9]=o*s+g*r,n[10]=l*s+m*r,n[11]=f*s+A*r,n}function Y3(n,e,t){const s=Math.sin(t),r=Math.cos(t),i=e[0],o=e[1],l=e[2],f=e[3],h=e[4],g=e[5],m=e[6],A=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=i*r+h*s,n[1]=o*r+g*s,n[2]=l*r+m*s,n[3]=f*r+A*s,n[4]=h*r-i*s,n[5]=g*r-o*s,n[6]=m*r-l*s,n[7]=A*r-f*s,n}function SU(n,e){const t=e[0],s=e[1],r=e[2],i=e[4],o=e[5],l=e[6],f=e[8],h=e[9],g=e[10];return n[0]=Math.sqrt(t*t+s*s+r*r),n[1]=Math.sqrt(i*i+o*o+l*l),n[2]=Math.sqrt(f*f+h*h+g*g),n}function wU(n,e){const t=e[0],s=e[1],r=e[2],i=e[3],o=t+t,l=s+s,f=r+r,h=t*o,g=s*o,m=s*l,A=r*o,y=r*l,E=r*f,v=i*o,S=i*l,x=i*f;return n[0]=1-m-E,n[1]=g+x,n[2]=A-S,n[3]=0,n[4]=g-x,n[5]=1-h-E,n[6]=y+v,n[7]=0,n[8]=A+S,n[9]=y-v,n[10]=1-h-m,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function RU(n,e,t,s,r,i,o){const l=1/(t-e),f=1/(r-s),h=1/(i-o);return n[0]=i*2*l,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=i*2*f,n[6]=0,n[7]=0,n[8]=(t+e)*l,n[9]=(r+s)*f,n[10]=(o+i)*h,n[11]=-1,n[12]=0,n[13]=0,n[14]=o*i*2*h,n[15]=0,n}function xU(n,e,t,s,r){const i=1/Math.tan(e/2);if(n[0]=i/t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=i,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,r!=null&&r!==1/0){const o=1/(s-r);n[10]=(r+s)*o,n[14]=2*r*s*o}else n[10]=-1,n[14]=-2*s;return n}const IU=xU;function MU(n,e,t,s,r,i,o){const l=1/(e-t),f=1/(s-r),h=1/(i-o);return n[0]=-2*l,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*f,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*h,n[11]=0,n[12]=(e+t)*l,n[13]=(r+s)*f,n[14]=(o+i)*h,n[15]=1,n}const OU=MU;function DU(n,e,t,s){let r,i,o,l,f,h,g,m,A,y;const E=e[0],v=e[1],S=e[2],x=s[0],O=s[1],R=s[2],D=t[0],z=t[1],J=t[2];return Math.abs(E-D)<il&&Math.abs(v-z)<il&&Math.abs(S-J)<il?TU(n):(m=E-D,A=v-z,y=S-J,r=1/Math.sqrt(m*m+A*A+y*y),m*=r,A*=r,y*=r,i=O*y-R*A,o=R*m-x*y,l=x*A-O*m,r=Math.sqrt(i*i+o*o+l*l),r?(r=1/r,i*=r,o*=r,l*=r):(i=0,o=0,l=0),f=A*l-y*o,h=y*i-m*l,g=m*o-A*i,r=Math.sqrt(f*f+h*h+g*g),r?(r=1/r,f*=r,h*=r,g*=r):(f=0,h=0,g=0),n[0]=i,n[1]=f,n[2]=m,n[3]=0,n[4]=o,n[5]=h,n[6]=A,n[7]=0,n[8]=l,n[9]=g,n[10]=y,n[11]=0,n[12]=-(i*E+o*v+l*S),n[13]=-(f*E+h*v+g*S),n[14]=-(m*E+A*v+y*S),n[15]=1,n)}function NU(){const n=new Cs(4);return Cs!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function FU(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n}function qA(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n}function PU(n){const e=n[0],t=n[1],s=n[2],r=n[3];return Math.sqrt(e*e+t*t+s*s+r*r)}function UU(n){const e=n[0],t=n[1],s=n[2],r=n[3];return e*e+t*t+s*s+r*r}function LU(n,e){const t=e[0],s=e[1],r=e[2],i=e[3];let o=t*t+s*s+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),n[0]=t*o,n[1]=s*o,n[2]=r*o,n[3]=i*o,n}function kU(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]*e[3]}function HU(n,e,t,s){const r=e[0],i=e[1],o=e[2],l=e[3];return n[0]=r+s*(t[0]-r),n[1]=i+s*(t[1]-i),n[2]=o+s*(t[2]-o),n[3]=l+s*(t[3]-l),n}function xa(n,e,t){const s=e[0],r=e[1],i=e[2],o=e[3];return n[0]=t[0]*s+t[4]*r+t[8]*i+t[12]*o,n[1]=t[1]*s+t[5]*r+t[9]*i+t[13]*o,n[2]=t[2]*s+t[6]*r+t[10]*i+t[14]*o,n[3]=t[3]*s+t[7]*r+t[11]*i+t[15]*o,n}function GU(n,e,t){const s=e[0],r=e[1],i=e[2],o=t[0],l=t[1],f=t[2],h=t[3],g=h*s+l*i-f*r,m=h*r+f*s-o*i,A=h*i+o*r-l*s,y=-o*s-l*r-f*i;return n[0]=g*h+y*-o+m*-f-A*-l,n[1]=m*h+y*-l+A*-o-g*-f,n[2]=A*h+y*-f+g*-l-m*-o,n[3]=e[3],n}(function(){const n=NU();return function(e,t,s,r,i,o){let l,f;for(t||(t=4),s||(s=0),r?f=Math.min(r*t+s,e.length):f=e.length,l=s;l<f;l+=t)n[0]=e[l],n[1]=e[l+1],n[2]=e[l+2],n[3]=e[l+3],i(n,n,o),e[l]=n[0],e[l+1]=n[1],e[l+2]=n[2],e[l+3]=n[3];return e}})();var x_;(function(n){n[n.COL0ROW0=0]="COL0ROW0",n[n.COL0ROW1=1]="COL0ROW1",n[n.COL0ROW2=2]="COL0ROW2",n[n.COL0ROW3=3]="COL0ROW3",n[n.COL1ROW0=4]="COL1ROW0",n[n.COL1ROW1=5]="COL1ROW1",n[n.COL1ROW2=6]="COL1ROW2",n[n.COL1ROW3=7]="COL1ROW3",n[n.COL2ROW0=8]="COL2ROW0",n[n.COL2ROW1=9]="COL2ROW1",n[n.COL2ROW2=10]="COL2ROW2",n[n.COL2ROW3=11]="COL2ROW3",n[n.COL3ROW0=12]="COL3ROW0",n[n.COL3ROW1=13]="COL3ROW1",n[n.COL3ROW2=14]="COL3ROW2",n[n.COL3ROW3=15]="COL3ROW3"})(x_||(x_={}));const VU=45*Math.PI/180,jU=1,Zp=.1,em=500,zU=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class we extends J3{static get IDENTITY(){return XU()}static get ZERO(){return $U()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return x_}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,s,r,i,o,l,f,h,g,m,A,y,E,v,S){return this[0]=e,this[1]=t,this[2]=s,this[3]=r,this[4]=i,this[5]=o,this[6]=l,this[7]=f,this[8]=h,this[9]=g,this[10]=m,this[11]=A,this[12]=y,this[13]=E,this[14]=v,this[15]=S,this.check()}setRowMajor(e,t,s,r,i,o,l,f,h,g,m,A,y,E,v,S){return this[0]=e,this[1]=i,this[2]=h,this[3]=y,this[4]=t,this[5]=o,this[6]=g,this[7]=E,this[8]=s,this[9]=l,this[10]=m,this[11]=v,this[12]=r,this[13]=f,this[14]=A,this[15]=S,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(zU)}fromObject(e){return this.check()}fromQuaternion(e){return wU(this,e),this.check()}frustum(e){const{left:t,right:s,bottom:r,top:i,near:o=Zp,far:l=em}=e;return l===1/0?JU(this,t,s,r,i,o):RU(this,t,s,r,i,o,l),this.check()}lookAt(e){const{eye:t,center:s=[0,0,0],up:r=[0,1,0]}=e;return DU(this,t,s,r),this.check()}ortho(e){const{left:t,right:s,bottom:r,top:i,near:o=Zp,far:l=em}=e;return OU(this,t,s,r,i,o,l),this.check()}orthographic(e){const{fovy:t=VU,aspect:s=jU,focalDistance:r=1,near:i=Zp,far:o=em}=e;Y1(t);const l=t/2,f=r*Math.tan(l),h=f*s;return this.ortho({left:-h,right:h,bottom:-f,top:f,near:i,far:o})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:s=1,near:r=.1,far:i=500}=e;return Y1(t),IU(this,t,s,r,i),this.check()}determinant(){return CU(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const s=this.getScale(t),r=1/s[0],i=1/s[1],o=1/s[2];return e[0]=this[0]*r,e[1]=this[1]*i,e[2]=this[2]*o,e[3]=0,e[4]=this[4]*r,e[5]=this[5]*i,e[6]=this[6]*o,e[7]=0,e[8]=this[8]*r,e[9]=this[9]*i,e[10]=this[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const s=this.getScale(t),r=1/s[0],i=1/s[1],o=1/s[2];return e[0]=this[0]*r,e[1]=this[1]*i,e[2]=this[2]*o,e[3]=this[4]*r,e[4]=this[5]*i,e[5]=this[6]*o,e[6]=this[8]*r,e[7]=this[9]*i,e[8]=this[10]*o,e}transpose(){return EU(this,this),this.check()}invert(){return R_(this,this),this.check()}multiplyLeft(e){return Ui(this,e,this),this.check()}multiplyRight(e){return Ui(this,this,e),this.check()}rotateX(e){return W3(this,this,e),this.check()}rotateY(e){return BU(this,this,e),this.check()}rotateZ(e){return Y3(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return vU(this,this,e,t),this.check()}scale(e){return KA(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return dh(this,this,e),this.check()}transform(e,t){return e.length===4?(t=xa(t||[-0,-0,-0,-0],e,this),rl(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:s}=e;let r;switch(s){case 2:r=U3(t||[-0,-0],e,this);break;case 3:r=WA(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return rl(r,e.length),r}transformAsVector(e,t){let s;switch(e.length){case 2:s=L3(t||[-0,-0],e,this);break;case 3:s=k3(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return rl(s,e.length),s}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,s){return this.identity().translate([e,t,s])}}let uf,ff;function $U(){return uf||(uf=new we([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(uf)),uf}function XU(){return ff||(ff=new we,Object.freeze(ff)),ff}function Y1(n){if(n>Math.PI*2)throw Error("expected radians")}function JU(n,e,t,s,r,i){const o=2*i/(t-e),l=2*i/(r-s),f=(t+e)/(t-e),h=(r+s)/(r-s),g=-1,m=-1,A=-2*i;return n[0]=o,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=l,n[6]=0,n[7]=0,n[8]=f,n[9]=h,n[10]=g,n[11]=m,n[12]=0,n[13]=0,n[14]=A,n[15]=0,n}function K1(){const n=new Cs(4);return Cs!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function WU(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function K3(n,e,t){t=t*.5;const s=Math.sin(t);return n[0]=s*e[0],n[1]=s*e[1],n[2]=s*e[2],n[3]=Math.cos(t),n}function q1(n,e,t){const s=e[0],r=e[1],i=e[2],o=e[3],l=t[0],f=t[1],h=t[2],g=t[3];return n[0]=s*g+o*l+r*h-i*f,n[1]=r*g+o*f+i*l-s*h,n[2]=i*g+o*h+s*f-r*l,n[3]=o*g-s*l-r*f-i*h,n}function YU(n,e,t){t*=.5;const s=e[0],r=e[1],i=e[2],o=e[3],l=Math.sin(t),f=Math.cos(t);return n[0]=s*f+o*l,n[1]=r*f+i*l,n[2]=i*f-r*l,n[3]=o*f-s*l,n}function KU(n,e,t){t*=.5;const s=e[0],r=e[1],i=e[2],o=e[3],l=Math.sin(t),f=Math.cos(t);return n[0]=s*f-i*l,n[1]=r*f+o*l,n[2]=i*f+s*l,n[3]=o*f-r*l,n}function qU(n,e,t){t*=.5;const s=e[0],r=e[1],i=e[2],o=e[3],l=Math.sin(t),f=Math.cos(t);return n[0]=s*f+r*l,n[1]=r*f-s*l,n[2]=i*f+o*l,n[3]=o*f-i*l,n}function QU(n,e){const t=e[0],s=e[1],r=e[2];return n[0]=t,n[1]=s,n[2]=r,n[3]=Math.sqrt(Math.abs(1-t*t-s*s-r*r)),n}function Hf(n,e,t,s){const r=e[0],i=e[1],o=e[2],l=e[3];let f=t[0],h=t[1],g=t[2],m=t[3],A,y,E,v,S;return A=r*f+i*h+o*g+l*m,A<0&&(A=-A,f=-f,h=-h,g=-g,m=-m),1-A>il?(y=Math.acos(A),S=Math.sin(y),E=Math.sin((1-s)*y)/S,v=Math.sin(s*y)/S):(E=1-s,v=s),n[0]=E*r+v*f,n[1]=E*i+v*h,n[2]=E*o+v*g,n[3]=E*l+v*m,n}function ZU(n,e){const t=e[0],s=e[1],r=e[2],i=e[3],o=t*t+s*s+r*r+i*i,l=o?1/o:0;return n[0]=-t*l,n[1]=-s*l,n[2]=-r*l,n[3]=i*l,n}function eL(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n}function q3(n,e){const t=e[0]+e[4]+e[8];let s;if(t>0)s=Math.sqrt(t+1),n[3]=.5*s,s=.5/s,n[0]=(e[5]-e[7])*s,n[1]=(e[6]-e[2])*s,n[2]=(e[1]-e[3])*s;else{let r=0;e[4]>e[0]&&(r=1),e[8]>e[r*3+r]&&(r=2);const i=(r+1)%3,o=(r+2)%3;s=Math.sqrt(e[r*3+r]-e[i*3+i]-e[o*3+o]+1),n[r]=.5*s,s=.5/s,n[3]=(e[i*3+o]-e[o*3+i])*s,n[i]=(e[i*3+r]+e[r*3+i])*s,n[o]=(e[o*3+r]+e[r*3+o])*s}return n}const tL=FU,nL=qA,sL=kU,rL=HU,iL=PU,oL=UU,Q3=LU,aL=function(){const n=G3(),e=X1(1,0,0),t=X1(0,1,0);return function(s,r,i){const o=JA(r,i);return o<-.999999?(kf(n,e,r),X3(n)<1e-6&&kf(n,t,r),iU(n,n),K3(s,n,Math.PI),s):o>.999999?(s[0]=0,s[1]=0,s[2]=0,s[3]=1,s):(kf(n,r,i),s[0]=n[0],s[1]=n[1],s[2]=n[2],s[3]=1+o,Q3(s,s))}}();(function(){const n=K1(),e=K1();return function(t,s,r,i,o,l){return Hf(n,s,o,l),Hf(e,r,i,l),Hf(t,n,e,2*l*(1-l)),t}})();(function(){const n=fU();return function(e,t,s,r){return n[0]=s[0],n[3]=s[1],n[6]=s[2],n[1]=r[0],n[4]=r[1],n[7]=r[2],n[2]=-t[0],n[5]=-t[1],n[8]=-t[2],Q3(e,q3(e,n))}})();const cL=[0,0,0,1];class ga extends $A{constructor(e=0,t=0,s=0,r=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,t,s,r)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,t,s,r){return this[0]=e,this[1]=t,this[2]=s,this[3]=r,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return q3(this,e),this.check()}fromAxisRotation(e,t){return K3(this,e,t),this.check()}identity(){return WU(this),this.check()}setAxisAngle(e,t){return this.fromAxisRotation(e,t)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=Je(e)}get y(){return this[1]}set y(e){this[1]=Je(e)}get z(){return this[2]}set z(e){this[2]=Je(e)}get w(){return this[3]}set w(e){this[3]=Je(e)}len(){return iL(this)}lengthSquared(){return oL(this)}dot(e){return sL(this,e)}rotationTo(e,t){return aL(this,e,t),this.check()}add(e){return tL(this,this,e),this.check()}calculateW(){return QU(this,this),this.check()}conjugate(){return eL(this,this),this.check()}invert(){return ZU(this,this),this.check()}lerp(e,t,s){return s===void 0?this.lerp(this,e,t):(rL(this,e,t,s),this.check())}multiplyRight(e){return q1(this,this,e),this.check()}multiplyLeft(e){return q1(this,e,this),this.check()}normalize(){const e=this.len(),t=e>0?1/e:0;return this[0]=this[0]*t,this[1]=this[1]*t,this[2]=this[2]*t,this[3]=this[3]*t,e===0&&(this[3]=1),this.check()}rotateX(e){return YU(this,this,e),this.check()}rotateY(e){return KU(this,this,e),this.check()}rotateZ(e){return qU(this,this,e),this.check()}scale(e){return nL(this,this,e),this.check()}slerp(e,t,s){let r,i,o;switch(arguments.length){case 1:({start:r=cL,target:i,ratio:o}=e);break;case 2:r=this,i=e,o=t;break;default:r=e,i=t,o=s}return Hf(this,r,i,o),this.check()}transformVector4(e,t=new YA){return GU(t,e,this),rl(t,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,t){return this.setAxisAngle(e,t)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const lL=.1,uL=1e-12,Z3=1e-15,fL=1e-20;function e2(n,e=[],t=0){const s=Math.fround(n),r=n-s;return e[t]=s,e[t+1]=r,e}function hL(n){return n-Math.fround(n)}function dL(n){const e=new Float32Array(32);for(let t=0;t<4;++t)for(let s=0;s<4;++s){const r=t*4+s;e2(n[s*4+t],e,r*2)}return e}const gL=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,pL={name:"fp32",vs:gL},mL=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,_L={ONE:1},AL={name:"fp64arithmetic",vs:mL,defaultUniforms:_L,uniformTypes:{ONE:"f32"},fp64ify:e2,fp64LowPart:hL,fp64ifyMatrix4:dL},yL=[0,1,1,1],bL=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,TL=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,Q1={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:yL},vs:bL,fs:TL,getUniforms:EL};function EL(n={},e){const t={};if(n.highlightedObjectColor!==void 0)if(n.highlightedObjectColor===null)t.isHighlightActive=!1;else{t.isHighlightActive=!0;const s=n.highlightedObjectColor.slice(0,3);t.highlightedObjectColor=s}if(n.highlightColor){const s=Array.from(n.highlightColor,r=>r/255);Number.isFinite(s[3])||(s[3]=1),t.highlightColor=s}return n.isActive!==void 0&&(t.isActive=!!n.isActive,t.isAttribute=!!n.isAttribute),n.useFloatColors!==void 0&&(t.useFloatColors=!!n.useFloatColors),t}const Z1=`precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`,CL=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  pointLightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`,t2=3,vL=255;var pl;(function(n){n[n.POINT=0]="POINT",n[n.DIRECTIONAL=1]="DIRECTIONAL"})(pl||(pl={}));const oa={props:{},uniforms:{},name:"lighting",defines:{MAX_LIGHTS:t2},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientLightColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:pl.POINT,directionalLightCount:0,pointLightCount:0,ambientLightColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:CL,vs:Z1,fs:Z1,getUniforms:BL};function BL(n,e={}){if(n=n&&{...n},!n)return{...oa.defaultUniforms};n.lights&&(n={...n,...wL(n.lights),lights:void 0});const{ambientLight:t,pointLights:s,directionalLights:r}=n||{};if(!(t||s&&s.length>0||r&&r.length>0))return{...oa.defaultUniforms,enabled:0};const o={...oa.defaultUniforms,...e,...SL({ambientLight:t,pointLights:s,directionalLights:r})};return n.enabled!==void 0&&(o.enabled=n.enabled?1:0),o}function SL({ambientLight:n,pointLights:e=[],directionalLights:t=[]}){const s={};s.ambientLightColor=tm(n);let r=0;for(const i of e){s.lightType=pl.POINT;const o=r;s[`lightColor${o}`]=tm(i),s[`lightPosition${o}`]=i.position,s[`lightAttenuation${o}`]=i.attenuation||[1,0,0],r++}for(const i of t){s.lightType=pl.DIRECTIONAL;const o=r;s[`lightColor${o}`]=tm(i),s[`lightDirection${o}`]=i.direction,r++}return r>t2&&te.warn("MAX_LIGHTS exceeded")(),s.directionalLightCount=t.length,s.pointLightCount=e.length,s}function wL(n){var t,s;const e={pointLights:[],directionalLights:[]};for(const r of n||[])switch(r.type){case"ambient":e.ambientLight=r;break;case"directional":(t=e.directionalLights)==null||t.push(r);break;case"point":(s=e.pointLights)==null||s.push(r);break}return e}function tm(n={}){const{color:e=[0,0,0],intensity:t=1}=n;return e.map(s=>s*t/vL)}const n2=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,s2=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`,r2=`struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> phongMaterial : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, phongMaterial.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * phongMaterial.diffuse * surfaceColor + specular * phongMaterial.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = phongMaterial.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`,i2={props:{},name:"gouraudMaterial",vs:s2.replace("phongMaterial","gouraudMaterial"),fs:n2.replace("phongMaterial","gouraudMaterial"),source:r2.replaceAll("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:1},dependencies:[oa],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(n){const e={...n};return e.specularColor&&(e.specularColor=e.specularColor.map(t=>t/255)),{...i2.defaultUniforms,...e}}},o2={name:"phongMaterial",dependencies:[oa],source:r2,vs:n2,fs:s2,defines:{LIGHTING_FRAGMENT:1},uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(n){const e={...n};return e.specularColor&&(e.specularColor=e.specularColor.map(t=>t/255)),{...o2.defaultUniforms,...e}}},RL=`out vec3 pbr_vPosition;
out vec2 pbr_vUV;

#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
out mat3 pbr_vTBN;
# else
out vec3 pbr_vNormal;
# endif
#endif

void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
  vec4 pos = pbrProjection.modelMatrix * position;
  pbr_vPosition = vec3(pos.xyz) / pos.w;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
  vec3 normalW = normalize(vec3(pbrProjection.normalMatrix * vec4(normal.xyz, 0.0)));
  vec3 tangentW = normalize(vec3(pbrProjection.modelMatrix * vec4(tangent.xyz, 0.0)));
  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
  pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else // HAS_TANGENTS != 1
  pbr_vNormal = normalize(vec3(pbrProjection.modelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif

#ifdef HAS_UV
  pbr_vUV = uv;
#else
  pbr_vUV = vec2(0.,0.);
#endif
}
`,xL=`precision highp float;

uniform pbrMaterialUniforms {
  // Material is unlit
  bool unlit;

  // Base color map
  bool baseColorMapEnabled;
  vec4 baseColorFactor;

  bool normalMapEnabled;  
  float normalScale; // #ifdef HAS_NORMALMAP

  bool emissiveMapEnabled;
  vec3 emissiveFactor; // #ifdef HAS_EMISSIVEMAP

  vec2 metallicRoughnessValues;
  bool metallicRoughnessMapEnabled;

  bool occlusionMapEnabled;
  float occlusionStrength; // #ifdef HAS_OCCLUSIONMAP
  
  bool alphaCutoffEnabled;
  float alphaCutoff; // #ifdef ALPHA_CUTOFF
  
  // IBL
  bool IBLenabled;
  vec2 scaleIBLAmbient; // #ifdef USE_IBL
  
  // debugging flags used for shader output of intermediate PBR variables
  // #ifdef PBR_DEBUG
  vec4 scaleDiffBaseMR;
  vec4 scaleFGDSpec;
  // #endif
} pbrMaterial;

// Samplers
#ifdef HAS_BASECOLORMAP
uniform sampler2D pbr_baseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D pbr_normalSampler;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D pbr_emissiveSampler;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D pbr_metallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D pbr_occlusionSampler;
#endif
#ifdef USE_IBL
uniform samplerCube pbr_diffuseEnvSampler;
uniform samplerCube pbr_specularEnvSampler;
uniform sampler2D pbr_brdfLUT;
#endif

// Inputs from vertex shader

in vec3 pbr_vPosition;
in vec2 pbr_vUV;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
in mat3 pbr_vTBN;
#else
in vec3 pbr_vNormal;
#endif
#endif

// Encapsulate the various inputs used by the various functions in the shading equation
// We store values in this struct to simplify the integration of alternative implementations
// of the shading terms, outlined in the Readme.MD Appendix.
struct PBRInfo {
  float NdotL;                  // cos angle between normal and light direction
  float NdotV;                  // cos angle between normal and view direction
  float NdotH;                  // cos angle between normal and half vector
  float LdotH;                  // cos angle between light direction and half vector
  float VdotH;                  // cos angle between view direction and half vector
  float perceptualRoughness;    // roughness value, as authored by the model creator (input to shader)
  float metalness;              // metallic value at the surface
  vec3 reflectance0;            // full reflectance color (normal incidence angle)
  vec3 reflectance90;           // reflectance color at grazing angle
  float alphaRoughness;         // roughness mapped to a more linear change in the roughness (proposed by [2])
  vec3 diffuseColor;            // color contribution from diffuse lighting
  vec3 specularColor;           // color contribution from specular lighting
  vec3 n;                       // normal at surface point
  vec3 v;                       // vector from surface point to camera
};

const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;

vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else // SRGB_FAST_APPROXIMATION
  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif //SRGB_FAST_APPROXIMATION
  return vec4(linOut,srgbIn.w);;
#else //MANUAL_SRGB
  return srgbIn;
#endif //MANUAL_SRGB
}

// Find the normal for this fragment, pulling either from a predefined normal map
// or from the interpolated mesh normal and tangent attributes.
vec3 getNormal()
{
  // Retrieve the tangent space matrix
#ifndef HAS_TANGENTS
  vec3 pos_dx = dFdx(pbr_vPosition);
  vec3 pos_dy = dFdy(pbr_vPosition);
  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
  vec3 ng = normalize(pbr_vNormal);
#else
  vec3 ng = cross(pos_dx, pos_dy);
#endif

  t = normalize(t - ng * dot(ng, t));
  vec3 b = normalize(cross(ng, t));
  mat3 tbn = mat3(t, b, ng);
#else // HAS_TANGENTS
  mat3 tbn = pbr_vTBN;
#endif

#ifdef HAS_NORMALMAP
  vec3 n = texture(pbr_normalSampler, pbr_vUV).rgb;
  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(pbrMaterial.normalScale, pbrMaterial.normalScale, 1.0)));
#else
  // The tbn matrix is linearly interpolated, so we need to re-normalize
  vec3 n = normalize(tbn[2].xyz);
#endif

  return n;
}

// Calculation of the lighting contribution from an optional Image Based Light source.
// Precomputed Environment Maps are required uniform inputs and are computed as outlined in [1].
// See our README.md on Environment Maps [3] for additional discussion.
#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInfo, vec3 n, vec3 reflection)
{
  float mipCount = 9.0; // resolution of 512x512
  float lod = (pbrInfo.perceptualRoughness * mipCount);
  // retrieve a scale and bias to F0. See [1], Figure 3
  vec3 brdf = SRGBtoLINEAR(texture(pbr_brdfLUT,
    vec2(pbrInfo.NdotV, 1.0 - pbrInfo.perceptualRoughness))).rgb;
  vec3 diffuseLight = SRGBtoLINEAR(texture(pbr_diffuseEnvSampler, n)).rgb;

#ifdef USE_TEX_LOD
  vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection, lod)).rgb;
#else
  vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection)).rgb;
#endif

  vec3 diffuse = diffuseLight * pbrInfo.diffuseColor;
  vec3 specular = specularLight * (pbrInfo.specularColor * brdf.x + brdf.y);

  // For presentation, this allows us to disable IBL terms
  diffuse *= pbrMaterial.scaleIBLAmbient.x;
  specular *= pbrMaterial.scaleIBLAmbient.y;

  return diffuse + specular;
}
#endif

// Basic Lambertian diffuse
// Implementation from Lambert's Photometria https://archive.org/details/lambertsphotome00lambgoog
// See also [1], Equation 1
vec3 diffuse(PBRInfo pbrInfo)
{
  return pbrInfo.diffuseColor / M_PI;
}

// The following equation models the Fresnel reflectance term of the spec equation (aka F())
// Implementation of fresnel from [4], Equation 15
vec3 specularReflection(PBRInfo pbrInfo)
{
  return pbrInfo.reflectance0 +
    (pbrInfo.reflectance90 - pbrInfo.reflectance0) *
    pow(clamp(1.0 - pbrInfo.VdotH, 0.0, 1.0), 5.0);
}

// This calculates the specular geometric attenuation (aka G()),
// where rougher material will reflect less light back to the viewer.
// This implementation is based on [1] Equation 4, and we adopt their modifications to
// alphaRoughness as input as originally proposed in [2].
float geometricOcclusion(PBRInfo pbrInfo)
{
  float NdotL = pbrInfo.NdotL;
  float NdotV = pbrInfo.NdotV;
  float r = pbrInfo.alphaRoughness;

  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
  return attenuationL * attenuationV;
}

// The following equation(s) model the distribution of microfacet normals across
// the area being drawn (aka D())
// Implementation from "Average Irregularity Representation of a Roughened Surface
// for Ray Reflection" by T. S. Trowbridge, and K. P. Reitz
// Follows the distribution function recommended in the SIGGRAPH 2013 course notes
// from EPIC Games [1], Equation 3.
float microfacetDistribution(PBRInfo pbrInfo)
{
  float roughnessSq = pbrInfo.alphaRoughness * pbrInfo.alphaRoughness;
  float f = (pbrInfo.NdotH * roughnessSq - pbrInfo.NdotH) * pbrInfo.NdotH + 1.0;
  return roughnessSq / (M_PI * f * f);
}

void PBRInfo_setAmbientLight(inout PBRInfo pbrInfo) {
  pbrInfo.NdotL = 1.0;
  pbrInfo.NdotH = 0.0;
  pbrInfo.LdotH = 0.0;
  pbrInfo.VdotH = 1.0;
}

void PBRInfo_setDirectionalLight(inout PBRInfo pbrInfo, vec3 lightDirection) {
  vec3 n = pbrInfo.n;
  vec3 v = pbrInfo.v;
  vec3 l = normalize(lightDirection);             // Vector from surface point to light
  vec3 h = normalize(l+v);                        // Half vector between both l and v

  pbrInfo.NdotL = clamp(dot(n, l), 0.001, 1.0);
  pbrInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
  pbrInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
  pbrInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
}

void PBRInfo_setPointLight(inout PBRInfo pbrInfo, PointLight pointLight) {
  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
  PBRInfo_setDirectionalLight(pbrInfo, light_direction);
}

vec3 calculateFinalColor(PBRInfo pbrInfo, vec3 lightColor) {
  // Calculate the shading terms for the microfacet specular shading model
  vec3 F = specularReflection(pbrInfo);
  float G = geometricOcclusion(pbrInfo);
  float D = microfacetDistribution(pbrInfo);

  // Calculation of analytical lighting contribution
  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInfo);
  vec3 specContrib = F * G * D / (4.0 * pbrInfo.NdotL * pbrInfo.NdotV);
  // Obtain final intensity as reflectance (BRDF) scaled by the energy of the light (cosine law)
  return pbrInfo.NdotL * lightColor * (diffuseContrib + specContrib);
}

vec4 pbr_filterColor(vec4 colorUnused)
{
  // The albedo may be defined from a base texture or a flat color
#ifdef HAS_BASECOLORMAP
  vec4 baseColor = SRGBtoLINEAR(texture(pbr_baseColorSampler, pbr_vUV)) * pbrMaterial.baseColorFactor;
#else
  vec4 baseColor = pbrMaterial.baseColorFactor;
#endif

#ifdef ALPHA_CUTOFF
  if (baseColor.a < pbrMaterial.alphaCutoff) {
    discard;
  }
#endif

  vec3 color = vec3(0, 0, 0);

  if(pbrMaterial.unlit){
    color.rgb = baseColor.rgb;
  }
  else{
    // Metallic and Roughness material properties are packed together
    // In glTF, these factors can be specified by fixed scalar values
    // or from a metallic-roughness map
    float perceptualRoughness = pbrMaterial.metallicRoughnessValues.y;
    float metallic = pbrMaterial.metallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP
    // Roughness is stored in the 'g' channel, metallic is stored in the 'b' channel.
    // This layout intentionally reserves the 'r' channel for (optional) occlusion map data
    vec4 mrSample = texture(pbr_metallicRoughnessSampler, pbr_vUV);
    perceptualRoughness = mrSample.g * perceptualRoughness;
    metallic = mrSample.b * metallic;
#endif
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);
    // Roughness is authored as perceptual roughness; as is convention,
    // convert to material roughness by squaring the perceptual roughness [2].
    float alphaRoughness = perceptualRoughness * perceptualRoughness;

    vec3 f0 = vec3(0.04);
    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
    diffuseColor *= 1.0 - metallic;
    vec3 specularColor = mix(f0, baseColor.rgb, metallic);

    // Compute reflectance.
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);

    // For typical incident reflectance range (between 4% to 100%) set the grazing
    // reflectance to 100% for typical fresnel effect.
    // For very low reflectance range on highly diffuse objects (below 4%),
    // incrementally reduce grazing reflecance to 0%.
    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
    vec3 specularEnvironmentR0 = specularColor.rgb;
    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

    vec3 n = getNormal();                          // normal at surface point
    vec3 v = normalize(pbrProjection.camera - pbr_vPosition);  // Vector from surface point to camera

    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
    vec3 reflection = -normalize(reflect(v, n));

    PBRInfo pbrInfo = PBRInfo(
      0.0, // NdotL
      NdotV,
      0.0, // NdotH
      0.0, // LdotH
      0.0, // VdotH
      perceptualRoughness,
      metallic,
      specularEnvironmentR0,
      specularEnvironmentR90,
      alphaRoughness,
      diffuseColor,
      specularColor,
      n,
      v
    );


#ifdef USE_LIGHTS
    // Apply ambient light
    PBRInfo_setAmbientLight(pbrInfo);
    color += calculateFinalColor(pbrInfo, lighting.ambientColor);

    // Apply directional light
    for(int i = 0; i < lighting.directionalLightCount; i++) {
      if (i < lighting.directionalLightCount) {
        PBRInfo_setDirectionalLight(pbrInfo, lighting_getDirectionalLight(i).direction);
        color += calculateFinalColor(pbrInfo, lighting_getDirectionalLight(i).color);
      }
    }

    // Apply point light
    for(int i = 0; i < lighting.pointLightCount; i++) {
      if (i < lighting.pointLightCount) {
        PBRInfo_setPointLight(pbrInfo, lighting_getPointLight(i));
        float attenuation = getPointLightAttenuation(lighting_getPointLight(i), distance(lighting_getPointLight(i).position, pbr_vPosition));
        color += calculateFinalColor(pbrInfo, lighting_getPointLight(i).color / attenuation);
      }
    }
#endif

    // Calculate lighting contribution from image based lighting source (IBL)
#ifdef USE_IBL
    if (pbrMaterial.IBLenabled) {
      color += getIBLContribution(pbrInfo, n, reflection);
    }
#endif

 // Apply optional PBR terms for additional (optional) shading
#ifdef HAS_OCCLUSIONMAP
    if (pbrMaterial.occlusionMapEnabled) {
      float ao = texture(pbr_occlusionSampler, pbr_vUV).r;
      color = mix(color, color * ao, pbrMaterial.occlusionStrength);
    }
#endif

#ifdef HAS_EMISSIVEMAP
    if (pbrMaterial.emissiveMapEnabled) {
      vec3 emissive = SRGBtoLINEAR(texture(pbr_emissiveSampler, pbr_vUV)).rgb * pbrMaterial.emissiveFactor;
      color += emissive;
    }
#endif

    // This section uses mix to override final color for reference app visualization
    // of various parameters in the lighting equation.
#ifdef PBR_DEBUG
    // TODO: Figure out how to debug multiple lights

    // color = mix(color, F, pbr_scaleFGDSpec.x);
    // color = mix(color, vec3(G), pbr_scaleFGDSpec.y);
    // color = mix(color, vec3(D), pbr_scaleFGDSpec.z);
    // color = mix(color, specContrib, pbr_scaleFGDSpec.w);

    // color = mix(color, diffuseContrib, pbr_scaleDiffBaseMR.x);
    color = mix(color, baseColor.rgb, pbrMaterial.scaleDiffBaseMR.y);
    color = mix(color, vec3(metallic), pbrMaterial.scaleDiffBaseMR.z);
    color = mix(color, vec3(perceptualRoughness), pbrMaterial.scaleDiffBaseMR.w);
#endif

  }

  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,eC=`uniform pbrProjectionUniforms {
  mat4 modelViewProjectionMatrix;
  mat4 modelMatrix;
  mat4 normalMatrix;
  vec3 camera;
} pbrProjection;
`,IL={name:"pbrProjection",vs:eC,fs:eC,getUniforms:n=>n,uniformTypes:{modelViewProjectionMatrix:"mat4x4<f32>",modelMatrix:"mat4x4<f32>",normalMatrix:"mat4x4<f32>",camera:"vec3<i32>"}},QA={props:{},uniforms:{},name:"pbrMaterial",dependencies:[oa,IL],vs:RL,fs:xL,defines:{LIGHTING_FRAGMENT:1},getUniforms:n=>n,uniformTypes:{unlit:"i32",baseColorMapEnabled:"i32",baseColorFactor:"vec4<f32>",normalMapEnabled:"i32",normalScale:"f32",emissiveMapEnabled:"i32",emissiveFactor:"vec3<f32>",metallicRoughnessValues:"vec2<f32>",metallicRoughnessMapEnabled:"i32",occlusionMapEnabled:"i32",occlusionStrength:"f32",alphaCutoffEnabled:"i32",alphaCutoff:"f32",IBLenabled:"i32",scaleIBLAmbient:"vec2<f32>",scaleDiffBaseMR:"vec4<f32>",scaleFGDSpec:"vec4<f32>"}},tC=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,ML={name:"layer",vs:tC,fs:tC,getUniforms:n=>({opacity:Math.pow(n.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},OL=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,a2="#define SMOOTH_EDGE_RADIUS 0.5",DL=`${a2}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,NL=`${a2}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,c2={name:"geometry",source:OL,vs:DL,fs:NL},FL=25;var St;(function(n){n[n.Start=1]="Start",n[n.Move=2]="Move",n[n.End=4]="End",n[n.Cancel=8]="Cancel"})(St||(St={}));var It;(function(n){n[n.None=0]="None",n[n.Left=1]="Left",n[n.Right=2]="Right",n[n.Up=4]="Up",n[n.Down=8]="Down",n[n.Horizontal=3]="Horizontal",n[n.Vertical=12]="Vertical",n[n.All=15]="All"})(It||(It={}));var ve;(function(n){n[n.Possible=1]="Possible",n[n.Began=2]="Began",n[n.Changed=4]="Changed",n[n.Ended=8]="Ended",n[n.Recognized=8]="Recognized",n[n.Cancelled=16]="Cancelled",n[n.Failed=32]="Failed"})(ve||(ve={}));const PL="compute",UL="auto",I_="manipulation",Gf="none",M_="pan-x",O_="pan-y";function LL(n){if(n.includes(Gf))return Gf;const e=n.includes(M_),t=n.includes(O_);return e&&t?Gf:e||t?e?M_:O_:n.includes(I_)?I_:UL}class kL{constructor(e,t){this.actions="",this.manager=e,this.set(t)}set(e){e===PL&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const t of this.manager.recognizers)t.options.enable&&(e=e.concat(t.getTouchAction()));return LL(e.join(" "))}}function gh(n){return n.trim().split(/\s+/g)}function nm(n,e,t){if(n)for(const s of gh(e))n.addEventListener(s,t,!1)}function sm(n,e,t){if(n)for(const s of gh(e))n.removeEventListener(s,t,!1)}function nC(n){return(n.ownerDocument||n).defaultView}function HL(n,e){let t=n;for(;t;){if(t===e)return!0;t=t.parentNode}return!1}function l2(n){const e=n.length;if(e===1)return{x:Math.round(n[0].clientX),y:Math.round(n[0].clientY)};let t=0,s=0,r=0;for(;r<e;)t+=n[r].clientX,s+=n[r].clientY,r++;return{x:Math.round(t/e),y:Math.round(s/e)}}function sC(n){const e=[];let t=0;for(;t<n.pointers.length;)e[t]={clientX:Math.round(n.pointers[t].clientX),clientY:Math.round(n.pointers[t].clientY)},t++;return{timeStamp:Date.now(),pointers:e,center:l2(e),deltaX:n.deltaX,deltaY:n.deltaY}}function u2(n,e){const t=e.x-n.x,s=e.y-n.y;return Math.sqrt(t*t+s*s)}function rC(n,e){const t=e.clientX-n.clientX,s=e.clientY-n.clientY;return Math.sqrt(t*t+s*s)}function VL(n,e){const t=e.x-n.x,s=e.y-n.y;return Math.atan2(s,t)*180/Math.PI}function iC(n,e){const t=e.clientX-n.clientX,s=e.clientY-n.clientY;return Math.atan2(s,t)*180/Math.PI}function f2(n,e){return n===e?It.None:Math.abs(n)>=Math.abs(e)?n<0?It.Left:It.Right:e<0?It.Up:It.Down}function jL(n,e){const t=e.center;let s=n.offsetDelta,r=n.prevDelta;const i=n.prevInput;return(e.eventType===St.Start||(i==null?void 0:i.eventType)===St.End)&&(r=n.prevDelta={x:(i==null?void 0:i.deltaX)||0,y:(i==null?void 0:i.deltaY)||0},s=n.offsetDelta={x:t.x,y:t.y}),{deltaX:r.x+(t.x-s.x),deltaY:r.y+(t.y-s.y)}}function h2(n,e,t){return{x:e/n||0,y:t/n||0}}function zL(n,e){return rC(e[0],e[1])/rC(n[0],n[1])}function $L(n,e){return iC(e[1],e[0])-iC(n[1],n[0])}function XL(n,e){const t=n.lastInterval||e,s=e.timeStamp-t.timeStamp;let r,i,o,l;if(e.eventType!==St.Cancel&&(s>FL||t.velocity===void 0)){const f=e.deltaX-t.deltaX,h=e.deltaY-t.deltaY,g=h2(s,f,h);i=g.x,o=g.y,r=Math.abs(g.x)>Math.abs(g.y)?g.x:g.y,l=f2(f,h),n.lastInterval=e}else r=t.velocity,i=t.velocityX,o=t.velocityY,l=t.direction;e.velocity=r,e.velocityX=i,e.velocityY=o,e.direction=l}function JL(n,e){const{session:t}=n,{pointers:s}=e,{length:r}=s;t.firstInput||(t.firstInput=sC(e)),r>1&&!t.firstMultiple?t.firstMultiple=sC(e):r===1&&(t.firstMultiple=!1);const{firstInput:i,firstMultiple:o}=t,l=o?o.center:i.center,f=e.center=l2(s);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-i.timeStamp,e.angle=VL(l,f),e.distance=u2(l,f);const{deltaX:h,deltaY:g}=jL(t,e);e.deltaX=h,e.deltaY=g,e.offsetDirection=f2(e.deltaX,e.deltaY);const m=h2(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=m.x,e.overallVelocityY=m.y,e.overallVelocity=Math.abs(m.x)>Math.abs(m.y)?m.x:m.y,e.scale=o?zL(o.pointers,s):1,e.rotation=o?$L(o.pointers,s):0,e.maxPointers=t.prevInput?e.pointers.length>t.prevInput.maxPointers?e.pointers.length:t.prevInput.maxPointers:e.pointers.length;let A=n.element;return HL(e.srcEvent.target,A)&&(A=e.srcEvent.target),e.target=A,XL(t,e),e}function WL(n,e,t){const s=t.pointers.length,r=t.changedPointers.length,i=e&St.Start&&s-r===0,o=e&(St.End|St.Cancel)&&s-r===0;t.isFirst=!!i,t.isFinal=!!o,i&&(n.session={}),t.eventType=e;const l=JL(n,t);n.emit("hammer.input",l),n.recognize(l),n.session.prevInput=l}let YL=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=t=>{this.manager.options.enable&&this.handler(t)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,t){WL(this.manager,e,t)}init(){nm(this.element,this.evEl,this.domHandler),nm(this.target,this.evTarget,this.domHandler),nm(nC(this.element),this.evWin,this.domHandler)}destroy(){sm(this.element,this.evEl,this.domHandler),sm(this.target,this.evTarget,this.domHandler),sm(nC(this.element),this.evWin,this.domHandler)}};const KL={pointerdown:St.Start,pointermove:St.Move,pointerup:St.End,pointercancel:St.Cancel,pointerout:St.Cancel},qL="pointerdown",QL="pointermove pointerup pointercancel";class ZL extends YL{constructor(e){super(e),this.evEl=qL,this.evWin=QL,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:t}=this;let s=!1;const r=KL[e.type],i=e.pointerType,o=i==="touch";let l=t.findIndex(f=>f.pointerId===e.pointerId);r&St.Start&&(e.buttons||o)?l<0&&(t.push(e),l=t.length-1):r&(St.End|St.Cancel)&&(s=!0),!(l<0)&&(t[l]=e,this.callback(r,{pointers:t,changedPointers:[e],eventType:r,pointerType:i,srcEvent:e}),s&&t.splice(l,1))}}const e4=["","webkit","Moz","MS","ms","o"];function t4(n,e){const t=e[0].toUpperCase()+e.slice(1);for(const s of e4){const r=s?s+t:e;if(r in n)return r}}const n4=1,oC=2,aC={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class s4{constructor(e,t){this.options={...aC,...t,cssProps:{...aC.cssProps,...t.cssProps},inputTarget:t.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new ZL(this),this.touchAction=new kL(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?oC:n4}recognize(e){const{session:t}=this;if(t.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let s;const{recognizers:r}=this;let{curRecognizer:i}=t;(!i||i&&i.state&ve.Recognized)&&(i=t.curRecognizer=null);let o=0;for(;o<r.length;)s=r[o],t.stopped!==oC&&(!i||s===i||s.canRecognizeWith(i))?s.recognize(e):s.reset(),!i&&s.state&(ve.Began|ve.Changed|ve.Ended)&&(i=t.curRecognizer=s),o++}get(e){const{recognizers:t}=this;for(let s=0;s<t.length;s++)if(t[s].options.event===e)return t[s];return null}add(e){if(Array.isArray(e)){for(const s of e)this.add(s);return this}const t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const s of e)this.remove(s);return this}const t=typeof e=="string"?this.get(e):e;if(t){const{recognizers:s}=this,r=s.indexOf(t);r!==-1&&(s.splice(r,1),this.touchAction.update())}return this}on(e,t){if(!e||!t)return;const{handlers:s}=this;for(const r of gh(e))s[r]=s[r]||[],s[r].push(t)}off(e,t){if(!e)return;const{handlers:s}=this;for(const r of gh(e))t?s[r]&&s[r].splice(s[r].indexOf(t),1):delete s[r]}emit(e,t){const s=this.handlers[e]&&this.handlers[e].slice();if(!s||!s.length)return;const r=t;r.type=e,r.preventDefault=function(){t.srcEvent.preventDefault()};let i=0;for(;i<s.length;)s[i](r),i++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:t}=this;if(t){for(const[s,r]of Object.entries(this.options.cssProps)){const i=t4(t.style,s);e?(this.oldCssProps[i]=t.style[i],t.style[i]=r):t.style[i]=this.oldCssProps[i]||""}e||(this.oldCssProps={})}}}let r4=1;function i4(){return r4++}function cC(n){return n&ve.Cancelled?"cancel":n&ve.Ended?"end":n&ve.Changed?"move":n&ve.Began?"start":""}class d2{constructor(e){this.options=e,this.id=i4(),this.state=ve.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const r of e)this.recognizeWith(r);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{simultaneous:s}=this;return s[t.id]||(s[t.id]=t,t.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const s of e)this.dropRecognizeWith(s);return this}let t;return typeof e=="string"?t=this.manager.get(e):t=e,t&&delete this.simultaneous[t.id],this}requireFailure(e){if(Array.isArray(e)){for(const r of e)this.requireFailure(r);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{requireFail:s}=this;return s.indexOf(t)===-1&&(s.push(t),t.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const s of e)this.dropRequireFailure(s);return this}let t;if(typeof e=="string"?t=this.manager.get(e):t=e,t){const s=this.requireFail.indexOf(t);s>-1&&this.requireFail.splice(s,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:t}=this;t<ve.Ended&&this.manager.emit(this.options.event+cC(t),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),t>=ve.Ended&&this.manager.emit(this.options.event+cC(t),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=ve.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(ve.Failed|ve.Possible)))return!1;e++}return!0}recognize(e){const t={...e};if(!this.options.enable){this.reset(),this.state=ve.Failed;return}this.state&(ve.Recognized|ve.Cancelled|ve.Failed)&&(this.state=ve.Possible),this.state=this.process(t),this.state&(ve.Began|ve.Changed|ve.Ended|ve.Cancelled)&&this.tryEmit(t)}getEventNames(){return[this.options.event]}reset(){}}class g2 extends d2{attrTest(e){const t=this.options.pointers;return t===0||e.pointers.length===t}process(e){const{state:t}=this,{eventType:s}=e,r=t&(ve.Began|ve.Changed),i=this.attrTest(e);return r&&(s&St.Cancel||!i)?t|ve.Cancelled:r||i?s&St.End?t|ve.Ended:t&ve.Began?t|ve.Changed:ve.Began:ve.Failed}}class lC extends d2{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[I_]}process(e){const{options:t}=this,s=e.pointers.length===t.pointers,r=e.distance<t.threshold,i=e.deltaTime<t.time;if(this.reset(),e.eventType&St.Start&&this.count===0)return this.failTimeout();if(r&&i&&s){if(e.eventType!==St.End)return this.failTimeout();const o=this.pTime?e.timeStamp-this.pTime<t.interval:!0,l=!this.pCenter||u2(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!l||!o?this.count=1:this.count+=1,this._input=e,this.count%t.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=ve.Recognized,this.tryEmit(this._input)},t.interval),ve.Began):ve.Recognized}return ve.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=ve.Failed},this.options.interval),ve.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===ve.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const o4=["","start","move","end","cancel","up","down","left","right"];class uC extends g2{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:It.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,t=[];return e&It.Horizontal&&t.push(O_),e&It.Vertical&&t.push(M_),t}getEventNames(){return o4.map(e=>this.options.event+e)}directionTest(e){const{options:t}=this;let s=!0,{distance:r}=e,{direction:i}=e;const o=e.deltaX,l=e.deltaY;return i&t.direction||(t.direction&It.Horizontal?(i=o===0?It.None:o<0?It.Left:It.Right,s=o!==this.pX,r=Math.abs(e.deltaX)):(i=l===0?It.None:l<0?It.Up:It.Down,s=l!==this.pY,r=Math.abs(e.deltaY))),e.direction=i,s&&r>t.threshold&&!!(i&t.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&ve.Began)||!(this.state&ve.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const t=It[e.direction].toLowerCase();t&&(e.additionalEvent=this.options.event+t),super.emit(e)}}const a4=["","start","move","end","cancel","in","out"];class c4 extends g2{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[Gf]}getEventNames(){return a4.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&ve.Began))}emit(e){if(e.scale!==1){const t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}super.emit(e)}}class qh{constructor(e,t,s){this.element=e,this.callback=t,this.options=s}}const l4=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",u4=l4.indexOf("firefox")!==-1,fC=4.000244140625,f4=40,h4=.25;class d4 extends qh{constructor(e,t,s){super(e,t,{enable:!0,...s}),this.handleEvent=r=>{if(!this.options.enable)return;let i=r.deltaY;globalThis.WheelEvent&&(u4&&r.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(i/=globalThis.devicePixelRatio),r.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(i*=f4)),i!==0&&i%fC===0&&(i=Math.floor(i/fC)),r.shiftKey&&i&&(i=i*h4),this.callback({type:"wheel",center:{x:r.clientX,y:r.clientY},delta:-i,srcEvent:r,pointerType:"mouse",target:r.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,t){e==="wheel"&&(this.options.enable=t)}}const hC=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class g4 extends qh{constructor(e,t,s){super(e,t,{enable:!0,...s}),this.handleEvent=i=>{this.handleOverEvent(i),this.handleOutEvent(i),this.handleEnterEvent(i),this.handleLeaveEvent(i),this.handleMoveEvent(i)},this.pressed=!1;const{enable:r}=this.options;this.enableMoveEvent=r,this.enableLeaveEvent=r,this.enableEnterEvent=r,this.enableOutEvent=r,this.enableOverEvent=r,hC.forEach(i=>e.addEventListener(i,this.handleEvent))}destroy(){hC.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){switch(e){case"pointermove":this.enableMoveEvent=t;break;case"pointerover":this.enableOverEvent=t;break;case"pointerout":this.enableOutEvent=t;break;case"pointerenter":this.enableEnterEvent=t;break;case"pointerleave":this.enableLeaveEvent=t;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const dC=["keydown","keyup"];class p4 extends qh{constructor(e,t,s){super(e,t,{enable:!0,tabIndex:0,...s}),this.handleEvent=r=>{const i=r.target||r.srcElement;i.tagName==="INPUT"&&i.type==="text"||i.tagName==="TEXTAREA"||(this.enableDownEvent&&r.type==="keydown"&&this.callback({type:"keydown",srcEvent:r,key:r.key,target:r.target}),this.enableUpEvent&&r.type==="keyup"&&this.callback({type:"keyup",srcEvent:r,key:r.key,target:r.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",dC.forEach(r=>e.addEventListener(r,this.handleEvent))}destroy(){dC.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e==="keydown"&&(this.enableDownEvent=t),e==="keyup"&&(this.enableUpEvent=t)}}class m4 extends qh{constructor(e,t,s){super(e,t,s),this.handleEvent=r=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:r.clientX,y:r.clientY},srcEvent:r,pointerType:"mouse",target:r.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e==="contextmenu"&&(this.options.enable=t)}}const gC=1,D_=2,pC=4,_4={pointerdown:gC,pointermove:D_,pointerup:pC,mousedown:gC,mousemove:D_,mouseup:pC},A4=0,y4=1,b4=2,T4=1,E4=2,C4=4;function v4(n){const e=_4[n.srcEvent.type];if(!e)return null;const{buttons:t,button:s}=n.srcEvent;let r=!1,i=!1,o=!1;return e===D_?(r=!!(t&T4),i=!!(t&C4),o=!!(t&E4)):(r=s===A4,i=s===y4,o=s===b4),{leftButton:r,middleButton:i,rightButton:o}}function B4(n,e){const t=n.center;if(!t)return null;const s=e.getBoundingClientRect(),r=s.width/e.offsetWidth||1,i=s.height/e.offsetHeight||1,o={x:(t.x-s.left-e.clientLeft)/r,y:(t.y-s.top-e.clientTop)/i};return{center:t,offsetCenter:o}}const S4={srcElement:"root",priority:0};class w4{constructor(e,t){this.handleEvent=s=>{if(this.isEmpty())return;const r=this._normalizeEvent(s);let i=s.srcEvent.target;for(;i&&i!==r.rootElement;){if(this._emit(r,i),r.handled)return;i=i.parentNode}this._emit(r,"root")},this.eventManager=e,this.recognizerName=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,s,r=!1,i=!1){const{handlers:o,handlersByElement:l}=this,f={...S4,...s};let h=l.get(f.srcElement);h||(h=[],l.set(f.srcElement,h));const g={type:e,handler:t,srcElement:f.srcElement,priority:f.priority};r&&(g.once=!0),i&&(g.passive=!0),o.push(g),this._active=this._active||!g.passive;let m=h.length-1;for(;m>=0&&!(h[m].priority>=g.priority);)m--;h.splice(m+1,0,g)}remove(e,t){const{handlers:s,handlersByElement:r}=this;for(let i=s.length-1;i>=0;i--){const o=s[i];if(o.type===e&&o.handler===t){s.splice(i,1);const l=r.get(o.srcElement);l.splice(l.indexOf(o),1),l.length===0&&r.delete(o.srcElement)}}this._active=s.some(i=>!i.passive)}_emit(e,t){const s=this.handlersByElement.get(t);if(s){let r=!1;const i=()=>{e.handled=!0},o=()=>{e.handled=!0,r=!0},l=[];for(let f=0;f<s.length;f++){const{type:h,handler:g,once:m}=s[f];if(g({...e,type:h,stopPropagation:i,stopImmediatePropagation:o}),m&&l.push(s[f]),r)break}for(let f=0;f<l.length;f++){const{type:h,handler:g}=l[f];this.remove(h,g)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...v4(e),...B4(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}function R4(n){if("recognizer"in n)return n;let e;const t=Array.isArray(n)?[...n]:[n];if(typeof t[0]=="function"){const s=t.shift(),r=t.shift()||{};e=new s(r)}else e=t.shift();return{recognizer:e,recognizeWith:typeof t[0]=="string"?[t[0]]:t[0],requireFailure:typeof t[1]=="string"?[t[1]]:t[1]}}class x4{constructor(e=null,t={}){if(this._onBasicInput=s=>{this.manager.emit(s.srcEvent.type,s)},this._onOtherEvent=s=>{this.manager.emit(s.type,s)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...t},this.events=new Map,this.element=e,!!e){this.manager=new s4(e,this.options);for(const s of this.options.recognizers){const{recognizer:r,recognizeWith:i,requireFailure:o}=R4(s);this.manager.add(r),i&&r.recognizeWith(i),o&&r.requireFailure(o)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new d4(e,this._onOtherEvent,{enable:!1}),this.moveInput=new g4(e,this._onOtherEvent,{enable:!1}),this.keyInput=new p4(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new m4(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,t,s){this._addEventHandler(e,t,s,!1)}once(e,t,s){this._addEventHandler(e,t,s,!0)}watch(e,t,s){this._addEventHandler(e,t,s,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){var i,o,l,f;const{manager:s}=this;if(!s)return;const r=s.get(e);r&&(r.set({enable:t}),s.touchAction.update()),(i=this.wheelInput)==null||i.enableEventType(e,t),(o=this.moveInput)==null||o.enableEventType(e,t),(l=this.keyInput)==null||l.enableEventType(e,t),(f=this.contextmenuInput)==null||f.enableEventType(e,t)}_addEventHandler(e,t,s,r,i){if(typeof e!="string"){s=t;for(const[h,g]of Object.entries(e))this._addEventHandler(h,g,s,r,i);return}const{manager:o,events:l}=this;if(!o)return;let f=l.get(e);if(!f){const h=this._getRecognizerName(e)||e;f=new w4(this,h),l.set(e,f),o&&o.on(e,f.handleEvent)}f.add(e,t,s,r,i),f.isEmpty()||this._toggleRecognizer(f.recognizerName,!0)}_removeEventHandler(e,t){if(typeof e!="string"){for(const[i,o]of Object.entries(e))this._removeEventHandler(i,o);return}const{events:s}=this,r=s.get(e);if(r&&(r.remove(e,t),r.isEmpty())){const{recognizerName:i}=r;let o=!1;for(const l of s.values())if(l.recognizerName===i&&!l.isEmpty()){o=!0;break}o||this._toggleRecognizer(i,!1)}}_getRecognizerName(e){var t;return(t=this.manager.recognizers.find(s=>s.getEventNames().includes(e)))==null?void 0:t.options.event}}const Me={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Me,"IDENTITY",{get:()=>(Ve.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Nn={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},ml={common:0,meters:1,pixels:2},N_={click:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},mC={multipan:[uC,{threshold:10,direction:It.Vertical,pointers:2}],pinch:[c4,{},null,["multipan"]],pan:[uC,{threshold:1},["pinch"],["multipan"]],dblclick:[lC,{event:"dblclick",taps:2}],click:[lC,{event:"click"},null,["dblclick"]]};function I4(n,e){if(n===e)return!0;if(Array.isArray(n)){const t=n.length;if(!e||e.length!==t)return!1;for(let s=0;s<t;s++)if(n[s]!==e[s])return!1;return!0}return!1}function Il(n){let e={},t;return s=>{for(const r in s)if(!I4(s[r],e[r])){t=n(s),e=s;break}return t}}const _C=[0,0,0,0],M4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],p2=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],O4=[0,0,0],m2=[0,0,0],D4=Il(P4);function _2(n,e,t=m2){t.length<3&&(t=[t[0],t[1],0]);let s=t,r,i=!0;switch(e===Me.LNGLAT_OFFSETS||e===Me.METER_OFFSETS?r=t:r=n.isGeospatial?[Math.fround(n.longitude),Math.fround(n.latitude),0]:null,n.projectionMode){case Nn.WEB_MERCATOR:(e===Me.LNGLAT||e===Me.CARTESIAN)&&(r=[0,0,0],i=!1);break;case Nn.WEB_MERCATOR_AUTO_OFFSET:e===Me.LNGLAT?s=r:e===Me.CARTESIAN&&(s=[Math.fround(n.center[0]),Math.fround(n.center[1]),0],r=n.unprojectPosition(s),s[0]-=t[0],s[1]-=t[1],s[2]-=t[2]);break;case Nn.IDENTITY:s=n.position.map(Math.fround),s[2]=s[2]||0;break;case Nn.GLOBE:i=!1,r=null;break;default:i=!1}return{geospatialOrigin:r,shaderCoordinateOrigin:s,offsetMode:i}}function N4(n,e,t){const{viewMatrixUncentered:s,projectionMatrix:r}=n;let{viewMatrix:i,viewProjectionMatrix:o}=n,l=_C,f=_C,h=n.cameraPosition;const{geospatialOrigin:g,shaderCoordinateOrigin:m,offsetMode:A}=_2(n,e,t);return A&&(f=n.projectPosition(g||m),h=[h[0]-f[0],h[1]-f[1],h[2]-f[2]],f[3]=1,l=xa([],f,o),i=s||i,o=Ui([],r,i),o=Ui([],o,M4)),{viewMatrix:i,viewProjectionMatrix:o,projectionCenter:l,originCommon:f,cameraPosCommon:h,shaderCoordinateOrigin:m,geospatialOrigin:g}}function F4({viewport:n,devicePixelRatio:e=1,modelMatrix:t=null,coordinateSystem:s=Me.DEFAULT,coordinateOrigin:r=m2,autoWrapLongitude:i=!1}){s===Me.DEFAULT&&(s=n.isGeospatial?Me.LNGLAT:Me.CARTESIAN);const o=D4({viewport:n,devicePixelRatio:e,coordinateSystem:s,coordinateOrigin:r});return o.wrapLongitude=i,o.modelMatrix=t||p2,o}function P4({viewport:n,devicePixelRatio:e,coordinateSystem:t,coordinateOrigin:s}){const{projectionCenter:r,viewProjectionMatrix:i,originCommon:o,cameraPosCommon:l,shaderCoordinateOrigin:f,geospatialOrigin:h}=N4(n,t,s),g=n.getDistanceScales(),m=[n.width*e,n.height*e],A=xa([],[0,0,-n.focalDistance,1],n.projectionMatrix)[3]||1,y={coordinateSystem:t,projectionMode:n.projectionMode,coordinateOrigin:f,commonOrigin:o.slice(0,3),center:r,pseudoMeters:!!n._pseudoMeters,viewportSize:m,devicePixelRatio:e,focalDistance:A,commonUnitsPerMeter:g.unitsPerMeter,commonUnitsPerWorldUnit:g.unitsPerMeter,commonUnitsPerWorldUnit2:O4,scale:n.scale,wrapLongitude:!1,viewProjectionMatrix:i,modelMatrix:p2,cameraPosition:l};if(h){const E=n.getDistanceScales(h);switch(t){case Me.METER_OFFSETS:y.commonUnitsPerWorldUnit=E.unitsPerMeter,y.commonUnitsPerWorldUnit2=E.unitsPerMeter2;break;case Me.LNGLAT:case Me.LNGLAT_OFFSETS:n._pseudoMeters||(y.commonUnitsPerMeter=E.unitsPerMeter),y.commonUnitsPerWorldUnit=E.unitsPerDegree,y.commonUnitsPerWorldUnit2=E.unitsPerDegree2;break;case Me.CARTESIAN:y.commonUnitsPerWorldUnit=[1,1,E.unitsPerMeter[2]],y.commonUnitsPerWorldUnit2=[0,0,E.unitsPerMeter2[2]];break}}return y}const U4=Object.keys(Me).map(n=>`const COORDINATE_SYSTEM_${n}: i32 = ${Me[n]};`).join(""),L4=Object.keys(Nn).map(n=>`const PROJECTION_MODE_${n}: i32 = ${Nn[n]};`).join(""),k4=Object.keys(ml).map(n=>`const UNIT_${n.toUpperCase()}: i32 = ${ml[n]};`).join(""),H4=`${U4}
${L4}
${k4}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,G4=`${H4}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the zaxis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,V4=Object.keys(Me).map(n=>`const int COORDINATE_SYSTEM_${n} = ${Me[n]};`).join(""),j4=Object.keys(Nn).map(n=>`const int PROJECTION_MODE_${n} = ${Nn[n]};`).join(""),z4=Object.keys(ml).map(n=>`const int UNIT_${n.toUpperCase()} = ${ml[n]};`).join(""),$4=`${V4}
${j4}
${z4}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,X4={};function J4(n=X4){return"viewport"in n?F4(n):{}}const ZA={name:"project",dependencies:[pL,c2],source:G4,vs:$4,getUniforms:J4,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},W4=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,Y4=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,ey={name:"project32",dependencies:[ZA],source:W4,vs:Y4};function K4(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function aa(n,e){const t=xa([],e,n);return qA(t,t,1/t[3]),t}function AC(n,e){const t=n%e;return t<0?e+t:t}function F_(n,e,t){return n<e?e:n>t?t:n}function q4(n){return Math.log(n)*Math.LOG2E}const ty=Math.log2||q4;function pr(n,e){if(!n)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const _s=Math.PI,A2=_s/4,ns=_s/180,P_=180/_s,pa=512,ph=4003e4,Qr=85.051129,Q4=1.5;function Z4(n){return ty(n)}function _l(n){const[e,t]=n;pr(Number.isFinite(e)),pr(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude");const s=e*ns,r=t*ns,i=pa*(s+_s)/(2*_s),o=pa*(_s+Math.log(Math.tan(A2+r*.5)))/(2*_s);return[i,o]}function ma(n){const[e,t]=n,s=e/pa*(2*_s)-_s,r=2*(Math.atan(Math.exp(t/pa*(2*_s)-_s))-A2);return[s*P_,r*P_]}function e6(n){const{latitude:e}=n;pr(Number.isFinite(e));const t=Math.cos(e*ns);return Z4(ph*t)-9}function Vf(n){const e=Math.cos(n*ns);return pa/ph/e}function U_(n){const{latitude:e,longitude:t,highPrecision:s=!1}=n;pr(Number.isFinite(e)&&Number.isFinite(t));const r=pa,i=Math.cos(e*ns),o=r/360,l=o/i,f=r/ph/i,h={unitsPerMeter:[f,f,f],metersPerUnit:[1/f,1/f,1/f],unitsPerDegree:[o,l,f],degreesPerUnit:[1/o,1/l,1/f]};if(s){const g=ns*Math.tan(e*ns)/i,m=o*g/2,A=r/ph*g,y=A/l*f;h.unitsPerDegree2=[0,m,A],h.unitsPerMeter2=[y,0,y]}return h}function y2(n,e){const[t,s,r]=n,[i,o,l]=e,{unitsPerMeter:f,unitsPerMeter2:h}=U_({longitude:t,latitude:s,highPrecision:!0}),g=_l(n);g[0]+=i*(f[0]+h[0]*o),g[1]+=o*(f[1]+h[1]*o);const m=ma(g),A=(r||0)+(l||0);return Number.isFinite(r)||Number.isFinite(l)?[m[0],m[1],A]:m}function t6(n){const{height:e,pitch:t,bearing:s,altitude:r,scale:i,center:o}=n,l=K4();dh(l,l,[0,0,-r]),W3(l,l,-t*ns),Y3(l,l,s*ns);const f=i/e;return KA(l,l,[f,f,f]),o&&dh(l,l,rU([],o)),l}function n6(n){const{width:e,height:t,altitude:s,pitch:r=0,offset:i,center:o,scale:l,nearZMultiplier:f=1,farZMultiplier:h=1}=n;let{fovy:g=Al(Q4)}=n;s!==void 0&&(g=Al(s));const m=g*ns,A=r*ns,y=ny(g);let E=y;o&&(E+=o[2]*l/Math.cos(A)/t);const v=m*(.5+(i?i[1]:0)/t),S=Math.sin(v)*E/Math.sin(F_(Math.PI/2-A-v,.01,Math.PI-.01)),x=Math.sin(A)*S+E,O=E*10,R=Math.min(x*h,O);return{fov:m,aspect:e/t,focalDistance:y,near:f,far:R}}function Al(n){return 2*Math.atan(.5/n)*P_}function ny(n){return .5/Math.tan(.5*n*ns)}function b2(n,e){const[t,s,r=0]=n;return pr(Number.isFinite(t)&&Number.isFinite(s)&&Number.isFinite(r)),aa(e,[t,s,r,1])}function sy(n,e,t=0){const[s,r,i]=n;if(pr(Number.isFinite(s)&&Number.isFinite(r),"invalid pixel coordinate"),Number.isFinite(i))return aa(e,[s,r,i,1]);const o=aa(e,[s,r,0,1]),l=aa(e,[s,r,1,1]),f=o[2],h=l[2],g=f===h?0:((t||0)-f)/(h-f);return F3([],o,l,g)}function s6(n){const{width:e,height:t,bounds:s,minExtent:r=0,maxZoom:i=24,offset:o=[0,0]}=n,[[l,f],[h,g]]=s,m=r6(n.padding),A=_l([l,F_(g,-Qr,Qr)]),y=_l([h,F_(f,-Qr,Qr)]),E=[Math.max(Math.abs(y[0]-A[0]),r),Math.max(Math.abs(y[1]-A[1]),r)],v=[e-m.left-m.right-Math.abs(o[0])*2,t-m.top-m.bottom-Math.abs(o[1])*2];pr(v[0]>0&&v[1]>0);const S=v[0]/E[0],x=v[1]/E[1],O=(m.right-m.left)/2/S,R=(m.top-m.bottom)/2/x,D=[(y[0]+A[0])/2+O,(y[1]+A[1])/2+R],z=ma(D),J=Math.min(i,ty(Math.abs(Math.min(S,x))));return pr(Number.isFinite(J)),{longitude:z[0],latitude:z[1],zoom:J}}function r6(n=0){return typeof n=="number"?{top:n,bottom:n,left:n,right:n}:(pr(Number.isFinite(n.top)&&Number.isFinite(n.bottom)&&Number.isFinite(n.left)&&Number.isFinite(n.right)),n)}const yC=Math.PI/180;function i6(n,e=0){const{width:t,height:s,unproject:r}=n,i={targetZ:e},o=r([0,s],i),l=r([t,s],i);let f,h;const g=n.fovy?.5*n.fovy*yC:Math.atan(.5/n.altitude),m=(90-n.pitch)*yC;return g>m-.01?(f=bC(n,0,e),h=bC(n,t,e)):(f=r([0,0],i),h=r([t,0],i)),[o,l,h,f]}function bC(n,e,t){const{pixelUnprojectionMatrix:s}=n,r=aa(s,[e,0,1,1]),i=aa(s,[e,n.height,1,1]),l=(t*n.distanceScales.unitsPerMeter[2]-r[2])/(i[2]-r[2]),f=F3([],r,i,l),h=ma(f);return h.push(t),h}const TC=512;function o6(n){const{width:e,height:t,pitch:s=0}=n;let{longitude:r,latitude:i,zoom:o,bearing:l=0}=n;(r<-180||r>180)&&(r=AC(r+180,360)-180),(l<-180||l>180)&&(l=AC(l+180,360)-180);const f=ty(t/TC);if(o<=f)o=f,i=0;else{const h=t/2/Math.pow(2,o),g=ma([0,h])[1];if(i<g)i=g;else{const m=ma([0,TC-h])[1];i>m&&(i=m)}}return{width:e,height:t,longitude:r,latitude:i,zoom:o,pitch:s,bearing:l}}const T2=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,a6=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,c6=`
${T2}
${a6}
`,l6=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,u6=`
${T2}
${l6}
`,f6=Il(m6),h6=Il(_6),d6=[0,0,0,1],g6=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function p6(n,e){const[t,s,r]=n,i=sy([t,s,r],e);return Number.isFinite(r)?i:[i[0],i[1],0]}function m6({viewport:n,center:e}){return new we(n.viewProjectionMatrix).invert().transform(e)}function _6({viewport:n,shadowMatrices:e}){const t=[],s=n.pixelUnprojectionMatrix,r=n.isGeospatial?void 0:1,i=[[0,0,r],[n.width,0,r],[0,n.height,r],[n.width,n.height,r],[0,0,-1],[n.width,0,-1],[0,n.height,-1],[n.width,n.height,-1]].map(o=>p6(o,s));for(const o of e){const l=o.clone().translate(new L(n.center).negate()),f=i.map(g=>l.transform(g)),h=new we().ortho({left:Math.min(...f.map(g=>g[0])),right:Math.max(...f.map(g=>g[0])),bottom:Math.min(...f.map(g=>g[1])),top:Math.max(...f.map(g=>g[1])),near:Math.min(...f.map(g=>-g[2])),far:Math.max(...f.map(g=>-g[2]))});t.push(h.multiplyRight(o))}return t}function A6(n){const{shadowEnabled:e=!0,project:t}=n;if(!e||!t||!n.shadowMatrices||!n.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:n.dummyShadowMap,shadow_uShadowMap1:n.dummyShadowMap};const s=ZA.getUniforms(t),r=f6({viewport:t.viewport,center:s.center}),i=[],o=h6({shadowMatrices:n.shadowMatrices,viewport:t.viewport}).slice();for(let f=0;f<n.shadowMatrices.length;f++){const h=o[f],g=h.clone().translate(new L(t.viewport.center).negate());s.coordinateSystem===Me.LNGLAT&&s.projectionMode===Nn.WEB_MERCATOR?(o[f]=g,i[f]=r):(o[f]=h.clone().multiplyRight(g6),i[f]=g.transform(r))}const l={drawShadowMap:!!n.drawToShadowMap,useShadowMap:n.shadowMaps?n.shadowMaps.length>0:!1,color:n.shadowColor||d6,lightId:n.shadowLightId||0,lightCount:n.shadowMatrices.length,shadow_uShadowMap0:n.dummyShadowMap,shadow_uShadowMap1:n.dummyShadowMap};for(let f=0;f<o.length;f++)l[`viewProjectionMatrix${f}`]=o[f],l[`projectCenter${f}`]=i[f];for(let f=0;f<2;f++)l[`shadow_uShadowMap${f}`]=n.shadowMaps&&n.shadowMaps[f]||n.dummyShadowMap;return l}const EC={name:"shadow",dependencies:[ZA],vs:c6,fs:u6,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:A6,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},ry={...Q1,defaultUniforms:{...Q1.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},y6=[c2],b6=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],T6=[];function E6(n){const e=eh.getDefaultShaderAssembler();for(const s of y6)e.addDefaultModule(s);const t=n==="glsl"?b6:T6;for(const s of t)e.addShaderHook(s);return e}const C6=[255,255,255],v6=1;let B6=0;class S6{constructor(e={}){this.type="ambient";const{color:t=C6}=e,{intensity:s=v6}=e;this.id=e.id||`ambient-${B6++}`,this.color=t,this.intensity=s}}const w6=[255,255,255],R6=1,x6=[0,0,-1];let I6=0;class CC{constructor(e={}){this.type="directional";const{color:t=w6}=e,{intensity:s=R6}=e,{direction:r=x6}=e,{_shadow:i=!1}=e;this.id=e.id||`directional-${I6++}`,this.color=t,this.intensity=s,this.type="directional",this.direction=new L(r).normalize().toArray(),this.shadow=i}getProjectedLight(e){return this}}class M6{constructor(e,t={id:"pass"}){const{id:s}=t;this.id=s,this.device=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class iy extends M6{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[t,s]=this.device.canvasContext.getDrawingBufferSize(),r=e.clearCanvas??!0,i=e.clearColor??(r?[0,0,0,0]:!1),o=r?1:!1,l=r?0:!1,f=e.colorMask??15,h={viewport:[0,0,t,s]};e.colorMask&&(h.colorMask=f),e.scissorRect&&(h.scissorRect=e.scissorRect);const g=this.device.beginRenderPass({framebuffer:e.target,parameters:h,clearColor:i,clearDepth:o,clearStencil:l});try{return this._drawLayers(g,e)}finally{g.end(),this.device.submit()}}_drawLayers(e,t){const{target:s,shaderModuleProps:r,viewports:i,views:o,onViewportActive:l,clearStack:f=!0}=t;t.pass=t.pass||"unknown",f&&(this._lastRenderIndex=-1);const h=[];for(const g of i){const m=o&&o[g.id];l==null||l(g);const A=this._getDrawLayerParams(g,t),y=g.subViewports||[g];for(const E of y){const v=this._drawLayersInViewport(e,{target:s,shaderModuleProps:r,viewport:E,view:m,pass:t.pass,layers:t.layers},A);h.push(v)}}return h}_getDrawLayerParams(e,{layers:t,pass:s,isPicking:r=!1,layerFilter:i,cullRect:o,effects:l,shaderModuleProps:f},h=!1){var E;const g=[],m=E2(this._lastRenderIndex+1),A={layer:t[0],viewport:e,isPicking:r,renderPass:s,cullRect:o},y={};for(let v=0;v<t.length;v++){const S=t[v],x=this._shouldDrawLayer(S,A,i,y),O={shouldDrawLayer:x};x&&!h&&(O.shouldDrawLayer=!0,O.layerRenderIndex=m(S,x),O.shaderModuleProps=this._getShaderModuleProps(S,l,s,f),O.layerParameters={...(E=S.context.deck)==null?void 0:E.props.parameters,...this.getLayerParameters(S,v,e)}),g[v]=O}return g}_drawLayersInViewport(e,{layers:t,shaderModuleProps:s,pass:r,target:i,viewport:o,view:l},f){const h=O6(this.device,{shaderModuleProps:s,target:i,viewport:o});if(l&&l.props.clear){const m=l.props.clear===!0?{color:!0,depth:!0}:l.props.clear;this.device.beginRenderPass({framebuffer:i,parameters:{viewport:h,scissorRect:h},clearColor:m.color?[0,0,0,0]:!1,clearDepth:m.depth?1:!1}).end()}const g={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:h});for(let m=0;m<t.length;m++){const A=t[m],y=f[m],{shouldDrawLayer:E}=y;if(E&&A.props.pickable&&g.pickableCount++,A.isComposite&&g.compositeCount++,A.isDrawable&&y.shouldDrawLayer){const{layerRenderIndex:v,shaderModuleProps:S,layerParameters:x}=y;g.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,v),S.project&&(S.project.viewport=o),A.context.renderPass=e;try{A._drawLayer({renderPass:e,shaderModuleProps:S,uniforms:{layerIndex:v},parameters:x})}catch(O){A.raiseError(O,`drawing ${A} to ${r}`)}}}return g}shouldDrawLayer(e){return!0}getShaderModuleProps(e,t,s){return null}getLayerParameters(e,t,s){return e.props.parameters}_shouldDrawLayer(e,t,s,r){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let o=e.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(t))return!1;t.layer=o,o=o.parent}if(s){const l=t.layer.id;if(l in r||(r[l]=s(t)),!r[l])return!1}return e.activateViewport(t.viewport),!0}_getShaderModuleProps(e,t,s,r){var f,h;const i=this.device.canvasContext.cssToDeviceRatio(),o=((f=e.internalState)==null?void 0:f.propsInTransition)||e.props,l={layer:o,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:i,modelMatrix:o.modelMatrix,coordinateSystem:o.coordinateSystem,coordinateOrigin:o.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(t)for(const g of t)vC(l,(h=g.getShaderModuleProps)==null?void 0:h.call(g,e,l));return vC(l,this.getShaderModuleProps(e,t,l),r)}}function E2(n=0,e={}){const t={},s=(r,i)=>{const o=r.props._offset,l=r.id,f=r.parent&&r.parent.id;let h;if(f&&!(f in e)&&s(r.parent,!1),f in t){const g=t[f]=t[f]||E2(e[f],e);h=g(r,i),t[l]=g}else Number.isFinite(o)?(h=o+(e[f]||0),t[l]=null):h=n;return i&&h>=n&&(n=h+1),e[l]=h,h};return s}function O6(n,{shaderModuleProps:e,target:t,viewport:s}){var f;const r=((f=e==null?void 0:e.project)==null?void 0:f.devicePixelRatio)??n.canvasContext.cssToDeviceRatio(),[,i]=n.canvasContext.getDrawingBufferSize(),o=t?t.height:i,l=s;return[l.x*r,o-(l.y+l.height)*r,l.width*r,l.height*r]}function vC(n,...e){for(const t of e)if(t)for(const s in t)n[s]?Object.assign(n[s],t[s]):n[s]=t[s];return n}class D6 extends iy{constructor(e,t){super(e,t);const s=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),r=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[s],depthStencilAttachment:r})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const t=this.fbo,s=this.device.canvasContext.cssToDeviceRatio(),r=e.viewports[0],i=r.width*s,o=r.height*s,l=[1,1,1,1];(i!==t.width||o!==t.height)&&t.resize({width:i,height:o}),super.render({...e,clearColor:l,target:t,pass:"shadow"})}getLayerParameters(e,t,s){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,t,s){return{shadow:{project:s.project,drawToShadowMap:!0}}}}const N6={color:[255,255,255],intensity:1},BC=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],F6=[0,0,0,200/255];class C2{constructor(e={}){this.id="lighting-effect",this.shadowColor=F6,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:t,deck:s}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(t),s._addDefaultShaderModule(EC),this.dummyShadowMap=t.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const t in e){const s=e[t];switch(s.type){case"ambient":this.ambientLight=s;break;case"directional":this.directionalLights.push(s);break;case"point":this.pointLights.push(s);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(t=>t.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:t,viewports:s,onViewportActive:r,views:i}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let o=0;o<this.shadowPasses.length;o++)this.shadowPasses[o].render({layers:e,layerFilter:t,viewports:s,onViewportActive:r,views:i,shaderModuleProps:{shadow:{shadowLightId:o,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,t){const s=this.shadow?{project:t.project,shadowMaps:this.shadowPasses.map(o=>o.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},r={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(o=>o.getProjectedLight({layer:e})),pointLights:this.pointLights.map(o=>o.getProjectedLight({layer:e}))},i=e.props.material;return{shadow:s,lighting:r,phongMaterial:i,gouraudMaterial:i}}cleanup(e){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(EC))}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const s=new we().lookAt({eye:new L(t.direction).negate()});e.push(s)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const s=new D6(e);this.shadowPasses[t]=s}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:s}=this;!e&&t.length===0&&s.length===0&&(this.ambientLight=new S6(N6),this.directionalLights.push(new CC(BC[0]),new CC(BC[1])))}}class P6{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:s=1,type:r,padding:i=0,copy:o=!1,initialize:l=!1,maxCount:f}){const h=r||e&&e.constructor||Float32Array,g=t*s+i;if(ArrayBuffer.isView(e)){if(g<=e.length)return e;if(g*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new h(e.buffer,0,g)}let m=1/0;f&&(m=f*s+i);const A=this._allocate(h,g,l,m);return e&&o?A.set(e):l||A.fill(0,0,4),this._release(e),A}release(e){this._release(e)}_allocate(e,t,s,r){let i=Math.max(Math.ceil(t*this.opts.overAlloc),1);i>r&&(i=r);const o=this._pool,l=e.BYTES_PER_ELEMENT*i,f=o.findIndex(h=>h.byteLength>=l);if(f>=0){const h=new e(o.splice(f,1)[0],0,i);return s&&h.fill(0),h}return new e(i)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:s}=e,{byteLength:r}=s,i=t.findIndex(o=>o.byteLength>=r);i<0?t.push(s):(i>0||t.length<this.opts.poolSize)&&t.splice(i,0,s),t.length>this.opts.poolSize&&t.shift()}}const yl=new P6;function Jc(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function U6(n,e){const t=n%e;return t<0?e+t:t}function L6(n){return[n[12],n[13],n[14]]}function k6(n){return{left:Ho(n[3]+n[0],n[7]+n[4],n[11]+n[8],n[15]+n[12]),right:Ho(n[3]-n[0],n[7]-n[4],n[11]-n[8],n[15]-n[12]),bottom:Ho(n[3]+n[1],n[7]+n[5],n[11]+n[9],n[15]+n[13]),top:Ho(n[3]-n[1],n[7]-n[5],n[11]-n[9],n[15]-n[13]),near:Ho(n[3]+n[2],n[7]+n[6],n[11]+n[10],n[15]+n[14]),far:Ho(n[3]-n[2],n[7]-n[6],n[11]-n[10],n[15]-n[14])}}const SC=new L;function Ho(n,e,t,s){SC.set(n,e,t);const r=SC.len();return{distance:s/r,normal:new L(-n/r,-e/r,-t/r)}}function H6(n){return n-Math.fround(n)}let Dc;function rm(n,e){const{size:t=1,startIndex:s=0}=e,r=e.endIndex!==void 0?e.endIndex:n.length,i=(r-s)/t;Dc=yl.allocate(Dc,i,{type:Float32Array,size:t*2});let o=s,l=0;for(;o<r;){for(let f=0;f<t;f++){const h=n[o++];Dc[l+f]=h,Dc[l+f+t]=H6(h)}l+=t*2}return Dc.subarray(0,i*t*2)}function G6(n){let e=null,t=!1;for(const s of n)s&&(e?(t||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],t=!0),e[0][0]=Math.min(e[0][0],s[0][0]),e[0][1]=Math.min(e[0][1],s[0][1]),e[1][0]=Math.max(e[1][0],s[1][0]),e[1][1]=Math.max(e[1][1],s[1][1])):e=s);return e}const V6=Math.PI/180,j6=Jc(),wC=[0,0,0],z6={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function $6({width:n,height:e,orthographic:t,fovyRadians:s,focalDistance:r,padding:i,near:o,far:l}){const f=n/e,h=t?new we().orthographic({fovy:s,aspect:f,focalDistance:r,near:o,far:l}):new we().perspective({fovy:s,aspect:f,near:o,far:l});if(i){const{left:g=0,right:m=0,top:A=0,bottom:y=0}=i,E=Wn((g+n-m)/2,0,n)-n/2,v=Wn((A+e-y)/2,0,e)-e/2;h[8]-=E*2/n,h[9]+=v*2/e}return h}class Ia{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||z6,this.focalDistance=e.focalDistance||1,this.position=e.position||wC,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:s}=e;this.isGeospatial=Number.isFinite(s)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Nn.WEB_MERCATOR:Nn.WEB_MERCATOR_AUTO_OFFSET:Nn.IDENTITY}equals(e){return e instanceof Ia?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Ts(e.projectionMatrix,this.projectionMatrix)&&Ts(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:t=!0}={}){const s=this.projectPosition(e),r=b2(s,this.pixelProjectionMatrix),[i,o]=r,l=t?o:this.height-o;return e.length===2?[i,l]:[i,l,r[2]]}unproject(e,{topLeft:t=!0,targetZ:s}={}){const[r,i,o]=e,l=t?i:this.height-i,f=s&&s*this.distanceScales.unitsPerMeter[2],h=sy([r,l,o],this.pixelUnprojectionMatrix,f),[g,m,A]=this.unprojectPosition(h);return Number.isFinite(o)?[g,m,A]:Number.isFinite(s)?[g,m,s]:[g,m]}projectPosition(e){const[t,s]=this.projectFlat(e),r=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[t,s,r]}unprojectPosition(e){const[t,s]=this.unprojectFlat(e),r=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[t,s,r]}projectFlat(e){if(this.isGeospatial){const t=_l(e);return t[1]=Wn(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?ma(e):e}getBounds(e={}){const t={targetZ:e.z||0},s=this.unproject([0,0],t),r=this.unproject([this.width,0],t),i=this.unproject([0,this.height],t),o=this.unproject([this.width,this.height],t);return[Math.min(s[0],r[0],i[0],o[0]),Math.min(s[1],r[1],i[1],o[1]),Math.max(s[0],r[0],i[0],o[0]),Math.max(s[1],r[1],i[1],o[1])]}getDistanceScales(e){return e&&this.isGeospatial?U_({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:s=1,height:r=1}){return e<this.x+this.width&&this.x<e+s&&t<this.y+this.height&&this.y<t+r}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,k6(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,t){return null}_initProps(e){const t=e.longitude,s=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=e6({latitude:s})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||U_({latitude:s,longitude:t}));const r=Math.pow(2,this.zoom);this.scale=r;const{position:i,modelMatrix:o}=e;let l=wC;if(i&&(l=o?new we(o).transformAsVector(i,[]):i),this.isGeospatial){const f=this.projectPosition([t,s,0]);this.center=new L(l).scale(this.distanceScales.unitsPerMeter).add(f)}else this.center=this.projectPosition(l)}_initMatrices(e){const{viewMatrix:t=j6,projectionMatrix:s=null,orthographic:r=!1,fovyRadians:i,fovy:o=75,near:l=.1,far:f=1e3,padding:h=null,focalDistance:g=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=new we().multiplyRight(t).translate(new L(this.center).negate()),this.projectionMatrix=s||$6({width:this.width,height:this.height,orthographic:r,fovyRadians:i||o*V6,focalDistance:g,padding:h,near:l,far:f});const m=Jc();Ui(m,m,this.projectionMatrix),Ui(m,m,this.viewMatrix),this.viewProjectionMatrix=m,this.viewMatrixInverse=R_([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=L6(this.viewMatrixInverse);const A=Jc(),y=Jc();KA(A,A,[this.width/2,-this.height/2,1]),dh(A,A,[1,-1,0]),Ui(y,A,this.viewProjectionMatrix),this.pixelProjectionMatrix=y,this.pixelUnprojectionMatrix=R_(Jc(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Ve.warn("Pixel project matrix not invertible")()}}Ia.displayName="Viewport";class Vi extends Ia{constructor(e={}){const{latitude:t=0,longitude:s=0,zoom:r=0,pitch:i=0,bearing:o=0,nearZMultiplier:l=.1,farZMultiplier:f=1.01,nearZ:h,farZ:g,orthographic:m=!1,projectionMatrix:A,repeat:y=!1,worldOffset:E=0,position:v,padding:S,legacyMeterSizes:x=!1}=e;let{width:O,height:R,altitude:D=1.5}=e;const z=Math.pow(2,r);O=O||1,R=R||1;let J,ie=null;if(A)D=A[5]/2,J=Al(D);else{e.fovy?(J=e.fovy,D=ny(J)):J=Al(D);let ee;if(S){const{top:le=0,bottom:fe=0}=S;ee=[0,Wn((le+R-fe)/2,0,R)-R/2]}ie=n6({width:O,height:R,scale:z,center:v&&[0,0,v[2]*Vf(t)],offset:ee,pitch:i,fovy:J,nearZMultiplier:l,farZMultiplier:f}),Number.isFinite(h)&&(ie.near=h),Number.isFinite(g)&&(ie.far=g)}let re=t6({height:R,pitch:i,bearing:o,scale:z,altitude:D});E&&(re=new we().translate([512*E,0,0]).multiplyLeft(re)),super({...e,width:O,height:R,viewMatrix:re,longitude:s,latitude:t,zoom:r,...ie,fovy:J,focalDistance:D}),this.latitude=t,this.longitude=s,this.zoom=r,this.pitch=i,this.bearing=o,this.altitude=D,this.fovy=J,this.orthographic=m,this._subViewports=y?[]:null,this._pseudoMeters=x,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),s=Math.ceil((e[2]-180)/360);for(let r=t;r<=s;r++){const i=r?new Vi({...this,worldOffset:r}):this;this._subViewports.push(i)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,s]=this.projectFlat(e),r=(e[2]||0)*Vf(e[1]);return[t,s,r]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,s]=this.unprojectFlat(e),r=(e[2]||0)/Vf(s);return[t,s,r]}addMetersToLngLat(e,t){return y2(e,t)}panByPosition(e,t){const s=sy(t,this.pixelUnprojectionMatrix),r=this.projectFlat(e),i=$1([],r,qP([],s)),o=$1([],this.center,i),[l,f]=this.unprojectFlat(o);return{longitude:l,latitude:f}}getBounds(e={}){const t=i6(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){const{width:s,height:r}=this,{longitude:i,latitude:o,zoom:l}=s6({width:s,height:r,bounds:e,...t});return new Vi({width:s,height:r,longitude:i,latitude:o,zoom:l})}}Vi.displayName="WebMercatorViewport";const RC=[0,0,0];function im(n,e,t=!1){const s=e.projectPosition(n);if(t&&e instanceof Vi){const[r,i,o=0]=n,l=e.getDistanceScales([r,i]);s[2]=o*l.unitsPerMeter[2]}return s}function X6(n){const{viewport:e,modelMatrix:t,coordinateOrigin:s}=n;let{coordinateSystem:r,fromCoordinateSystem:i,fromCoordinateOrigin:o}=n;return r===Me.DEFAULT&&(r=e.isGeospatial?Me.LNGLAT:Me.CARTESIAN),i===void 0&&(i=r),o===void 0&&(o=s),{viewport:e,coordinateSystem:r,coordinateOrigin:s,modelMatrix:t,fromCoordinateSystem:i,fromCoordinateOrigin:o}}function v2(n,{viewport:e,modelMatrix:t,coordinateSystem:s,coordinateOrigin:r,offsetMode:i}){let[o,l,f=0]=n;switch(t&&([o,l,f]=xa([],[o,l,f,1],t)),s){case Me.LNGLAT:return im([o,l,f],e,i);case Me.LNGLAT_OFFSETS:return im([o+r[0],l+r[1],f+(r[2]||0)],e,i);case Me.METER_OFFSETS:return im(y2(r,[o,l,f]),e,i);case Me.CARTESIAN:default:return e.isGeospatial?[o+r[0],l+r[1],f+r[2]]:e.projectPosition([o,l,f])}}function J6(n,e){const{viewport:t,coordinateSystem:s,coordinateOrigin:r,modelMatrix:i,fromCoordinateSystem:o,fromCoordinateOrigin:l}=X6(e),{autoOffset:f=!0}=e,{geospatialOrigin:h=RC,shaderCoordinateOrigin:g=RC,offsetMode:m=!1}=f?_2(t,s,r):{},A=v2(n,{viewport:t,modelMatrix:i,coordinateSystem:o,coordinateOrigin:l,offsetMode:m});if(m){const y=t.projectPosition(h||g);$3(A,A,y)}return A}let W6=1,Y6=1;class B2{constructor(){b(this,"time",0);b(this,"channels",new Map);b(this,"animations",new Map);b(this,"playing",!1);b(this,"lastEngineTime",-1)}addChannel(e){const{delay:t=0,duration:s=Number.POSITIVE_INFINITY,rate:r=1,repeat:i=1}=e,o=W6++,l={time:0,delay:t,duration:s,rate:r,repeat:i};return this._setChannelTime(l,this.time),this.channels.set(o,l),o}removeChannel(e){this.channels.delete(e);for(const[t,s]of this.animations)s.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return t===void 0?!1:this.time>=t.delay+t.duration*t.repeat}getTime(e){if(e===void 0)return this.time;const t=this.channels.get(e);return t===void 0?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const r of t)this._setChannelTime(r,this.time);const s=this.animations.values();for(const r of s){const{animation:i,channel:o}=r;i.setTime(this.getTime(o))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const s=Y6++;return this.animations.set(s,{animation:e,channel:t}),e.setTime(this.getTime(t)),s}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const s=t-e.delay,r=e.duration*e.repeat;s>=r?e.time=e.duration*e.rate:(e.time=Math.max(0,s)%e.duration,e.time*=e.rate)}}function K6(n){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(n):setTimeout(n,1e3/60)}function q6(n){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(n):clearTimeout(n)}let Q6=0;const Z6={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:n=>console.error(n),stats:m_.stats.get(`animation-loop-${Q6++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class e8{constructor(e){b(this,"device",null);b(this,"canvas",null);b(this,"props");b(this,"animationProps",null);b(this,"timeline",null);b(this,"stats");b(this,"cpuTime");b(this,"gpuTime");b(this,"frameRate");b(this,"display");b(this,"needsRedraw","initialized");b(this,"_initialized",!1);b(this,"_running",!1);b(this,"_animationFrameId",null);b(this,"_nextFramePromise",null);b(this,"_resolveNextFrame",null);b(this,"_cpuStartTime",0);b(this,"_error",null);if(this.props={...Z6,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:t=!0}=this.props;this.stats=e.stats||new wa({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:t}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(e){var s,r;if(this.props.onError(e),this._error=Error(),((r=(s=this.device)==null?void 0:s.canvasContext)==null?void 0:r.canvas)instanceof HTMLCanvasElement){const i=document.createElement("h1");i.innerHTML=e.message,i.style.position="absolute",i.style.top="20%",i.style.left="10px",i.style.color="black",i.style.backgroundColor="red",document.body.appendChild(i)}}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const t=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(t),t}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=K6(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(q6(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){var t;if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),(t=this.device)==null||t.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var t,s;const e=(s=(t=this.device)==null?void 0:t.canvasContext)==null?void 0:s.canvas;if(!this.device||!e)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:e,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:t,aspect:s}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),s!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=s,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((e=this.device.canvasContext)==null?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);const s=this.props.onAddHTML(t);s&&(t.innerHTML=s)}}_getSizeAndAspect(){var i,o,l,f;if(!this.device)return{width:1,height:1,aspect:1};const[e,t]=((o=(i=this.device)==null?void 0:i.canvasContext)==null?void 0:o.getPixelSize())||[1,1];let s=1;const r=(f=(l=this.device)==null?void 0:l.canvasContext)==null?void 0:f.canvas;return r&&r.clientHeight?s=r.clientWidth/r.clientHeight:e>0&&t>0&&(s=e/t),{width:e,height:t,aspect:s}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e,t;this.props.autoResizeDrawingBuffer&&((t=(e=this.device)==null?void 0:e.canvasContext)==null||t.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}const om={};function Ml(n="id"){om[n]=om[n]||1;const e=om[n]++;return`${n}-${e}`}class xC{constructor(e){b(this,"id");b(this,"userData",{});b(this,"topology");b(this,"bufferLayout",[]);b(this,"vertexCount");b(this,"indices");b(this,"attributes");if(this.id=e.id||Ml("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&ut.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){var e;(e=this.indices)==null||e.destroy();for(const t of Object.values(this.attributes))t.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function t8(n,e){if(e instanceof xC)return e;const t=n8(n,e),{attributes:s,bufferLayout:r}=s8(n,e);return new xC({topology:e.topology||"triangle-list",bufferLayout:r,vertexCount:e.vertexCount,indices:t,attributes:s})}function n8(n,e){if(!e.indices)return;const t=e.indices.value;return n.createBuffer({usage:ut.INDEX,data:t})}function s8(n,e){const t=[],s={};for(const[i,o]of Object.entries(e.attributes)){let l=i;switch(i){case"POSITION":l="positions";break;case"NORMAL":l="normals";break;case"TEXCOORD_0":l="texCoords";break;case"COLOR_0":l="colors";break}if(o){s[l]=n.createBuffer({data:o.value,id:`${i}-buffer`});const{value:f,size:h,normalized:g}=o;t.push({name:l,format:cP(f,h,g)})}}const r=e._calculateVertexCount(e.attributes,e.indices);return{attributes:s,bufferLayout:t,vertexCount:r}}const zh=class zh{constructor(e){b(this,"device");b(this,"destroyPolicy");b(this,"_hashCounter",0);b(this,"_hashes",{});b(this,"_renderPipelineCache",{});b(this,"_computePipelineCache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new zh(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const t={...ha.defaultProps,...e},s=this._hashRenderPipeline(t);if(!this._renderPipelineCache[s]){const r=this.device.createRenderPipeline({...t,id:t.id?`${t.id}-cached`:void 0});r.hash=s,this._renderPipelineCache[s]={pipeline:r,useCount:0}}return this._renderPipelineCache[s].useCount++,this._renderPipelineCache[s].pipeline}createComputePipeline(e){const t={...ih.defaultProps,...e},s=this._hashComputePipeline(t);if(!this._computePipelineCache[s]){const r=this.device.createComputePipeline({...t,id:t.id?`${t.id}-cached`:void 0});r.hash=s,this._computePipelineCache[s]={pipeline:r,useCount:0}}return this._computePipelineCache[s].useCount++,this._computePipelineCache[s].pipeline}release(e){const t=e.hash,s=e instanceof ih?this._computePipelineCache:this._renderPipelineCache;s[t].useCount--,s[t].useCount===0&&this.destroyPolicy==="unused"&&(s[t].pipeline.destroy(),delete s[t])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const t=e.vs?this._getHash(e.vs.source):0,s=e.fs?this._getHash(e.fs.source):0,r="-",i=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${t}/${s}V${r}BL${i}`;default:const o=this._getHash(JSON.stringify(e.parameters));return`${t}/${s}V${r}T${e.topology}P${o}BL${i}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};b(zh,"defaultProps",{...ha.defaultProps});let L_=zh;const $h=class $h{constructor(e){b(this,"device");b(this,"destroyPolicy");b(this,"_cache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultShaderFactory(e){var t;return(t=e._lumaData).defaultShaderFactory||(t.defaultShaderFactory=new $h(e)),e._lumaData.defaultShaderFactory}createShader(e){const t=this._hashShader(e);let s=this._cache[t];if(!s){const r=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=s={shader:r,useCount:0}}return s.useCount++,s.shader}release(e){const t=this._hashShader(e),s=this._cache[t];s&&(s.useCount--,s.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[t],s.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};b($h,"defaultProps",{...nh.defaultProps});let k_=$h;function r8(n,e){var r;const t={},s="Values";if(n.attributes.length===0&&!((r=n.varyings)!=null&&r.length))return{"No attributes or varyings":{[s]:"N/A"}};for(const i of n.attributes)if(i){const o=`${i.location} ${i.name}: ${i.type}`;t[`in ${o}`]={[s]:i.stepMode||"vertex"}}for(const i of n.varyings||[]){const o=`${i.location} ${i.name}`;t[`out ${o}`]={[s]:JSON.stringify(i)}}return t}let Ut=null,Si=null;function i8(n,{id:e,minimap:t,opaque:s,top:r="0",left:i="0",rgbaScale:o=1}){Ut||(Ut=document.createElement("canvas"),Ut.id=e,Ut.title=e,Ut.style.zIndex="100",Ut.style.position="absolute",Ut.style.top=r,Ut.style.left=i,Ut.style.border="blue 5px solid",Ut.style.transform="scaleY(-1)",document.body.appendChild(Ut),Si=Ut.getContext("2d")),(Ut.width!==n.width||Ut.height!==n.height)&&(Ut.width=n.width/2,Ut.height=n.height/2,Ut.style.width="400px",Ut.style.height="400px");const l=n.device.readPixelsToArrayWebGL(n),f=Si==null?void 0:Si.createImageData(n.width,n.height);if(f){for(let g=0;g<l.length;g+=4)f.data[0+g+0]=l[g+0]*o,f.data[0+g+1]=l[g+1]*o,f.data[0+g+2]=l[g+2]*o,f.data[0+g+3]=s?255:l[g+3]*o;Si==null||Si.putImageData(f,0,0)}}function H_(n,e,t){if(n===e)return!0;if(!t||!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let s=0;s<n.length;s++)if(!H_(n[s],e[s],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const s=Object.keys(n),r=Object.keys(e);if(s.length!==r.length)return!1;for(const i of s)if(!e.hasOwnProperty(i)||!H_(n[i],e[i],t-1))return!1;return!0}return!1}function o8(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function a8(n){return Array.isArray(n)?n.length===0||typeof n[0]=="number":!1}function S2(n){return o8(n)||a8(n)}function c8(n){return S2(n)||typeof n=="number"||typeof n=="boolean"}function w2(n){const e={bindings:{},uniforms:{}};return Object.keys(n).forEach(t=>{const s=n[t];c8(s)?e.uniforms[t]=s:e.bindings[t]=s}),e}class l8{constructor(e,t){b(this,"options",{disableWarnings:!1});b(this,"modules");b(this,"moduleUniforms");b(this,"moduleBindings");Object.assign(this.options,t);const s=DA(Object.values(e).filter(r=>r.dependencies));for(const r of s)e[r.name]=r;te.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[r,i]of Object.entries(e))this._addModule(i),i.name&&r!==i.name&&!this.options.disableWarnings&&te.warn(`Module name: ${r} vs ${i.name}`)()}destroy(){}setProps(e){var t;for(const s of Object.keys(e)){const r=s,i=e[r]||{},o=this.modules[r];if(!o){this.options.disableWarnings||te.warn(`Module ${s} not found`)();continue}const l=this.moduleUniforms[r],f=this.moduleBindings[r],h=((t=o.getUniforms)==null?void 0:t.call(o,i,l))||i,{uniforms:g,bindings:m}=w2(h);this.moduleUniforms[r]={...l,...g},this.moduleBindings[r]={...f,...m}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){var t;const e={};for(const[s,r]of Object.entries(this.moduleUniforms))for(const[i,o]of Object.entries(r))e[`${s}.${i}`]={type:(t=this.modules[s].uniformTypes)==null?void 0:t[i],value:String(o)};return e}_addModule(e){const t=e.name;this.moduleUniforms[t]=e.defaultUniforms||{},this.moduleBindings[t]={}}}let u8="";async function f8(n,e){const t=new Image;return t.crossOrigin="anonymous",t.src=n.startsWith("http")?n:u8+n,await t.decode(),e?await createImageBitmap(t,e):await createImageBitmap(t)}class am{constructor(e,t){b(this,"device");b(this,"id");b(this,"texture");b(this,"sampler");b(this,"view");b(this,"ready");b(this,"isReady",!1);b(this,"destroyed",!1);b(this,"resolveReady",()=>{});b(this,"rejectReady",()=>{});this.device=e,this.id=t.id||Ml("async-texture"),typeof(t==null?void 0:t.data)=="string"&&t.dimension==="2d"&&(t={...t,data:f8(t.data)}),this.ready=new Promise((s,r)=>{this.resolveReady=()=>{this.isReady=!0,s()},this.rejectReady=r}),this.initAsync(t)}get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}async initAsync(e){const t=e.data;let s;try{s=await R2(t)}catch(i){this.rejectReady(i)}if(this.destroyed)return;const r={...e,data:s};this.texture=this.device.createTexture(r),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0,this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const t=this.texture;this.texture=t.clone(e),t.destroy()}return!0}}async function R2(n){if(n=await n,Array.isArray(n))return await Promise.all(n.map(R2));if(n&&typeof n=="object"&&n.constructor===Object){const e=n,t=await Promise.all(Object.values(e)),s=Object.keys(e),r={};for(let i=0;i<s.length;i++)r[s[i]]=t[i];return r}return n}const wi=2,h8=1e4,Xh=class Xh{constructor(e,t){b(this,"device");b(this,"id");b(this,"source");b(this,"vs");b(this,"fs");b(this,"pipelineFactory");b(this,"shaderFactory");b(this,"userData",{});b(this,"parameters");b(this,"topology");b(this,"bufferLayout");b(this,"isInstanced");b(this,"instanceCount",0);b(this,"vertexCount");b(this,"indexBuffer",null);b(this,"bufferAttributes",{});b(this,"constantAttributes",{});b(this,"bindings",{});b(this,"uniforms",{});b(this,"vertexArray");b(this,"transformFeedback",null);b(this,"pipeline");b(this,"shaderInputs");b(this,"_uniformStore");b(this,"_attributeInfos",{});b(this,"_gpuGeometry",null);b(this,"_getModuleUniforms");b(this,"props");b(this,"_pipelineNeedsUpdate","newly created");b(this,"_needsRedraw","initializing");b(this,"_destroyed",!1);b(this,"_lastDrawTimestamp",-1);b(this,"_lastLogTime",0);b(this,"_logOpen",!1);b(this,"_drawCount",0);var f,h,g,m;this.props={...Xh.defaultProps,...t},t=this.props,this.id=t.id||Ml("model"),this.device=e,Object.assign(this.userData,t.userData);const s=Object.fromEntries(((f=this.props.modules)==null?void 0:f.map(A=>[A.name,A]))||[]),r=t.shaderInputs||new l8(s,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(r);const i=g8(e),o=(((h=this.props.modules)==null?void 0:h.length)>0?this.props.modules:(g=this.shaderInputs)==null?void 0:g.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:A,getUniforms:y}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:i,...this.props,modules:o});this.source=A,this._getModuleUniforms=y,(m=this.props).shaderLayout||(m.shaderLayout=LP(this.source))}else{const{vs:A,fs:y,getUniforms:E}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:i,...this.props,modules:o});this.vs=A,this.fs=y,this._getModuleUniforms=E}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&this.setGeometry(t.geometry),this.pipelineFactory=t.pipelineFactory||L_.getDefaultPipelineFactory(this.device),this.shaderFactory=t.shaderFactory||k_.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in t&&(this.isInstanced=t.isInstanced),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.vertexCount&&this.setVertexCount(t.vertexCount),t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.uniforms&&this.setUniformsWebGL(t.uniforms),t.moduleSettings&&this.updateModuleSettingsWebGL(t.moduleSettings),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const t=this._areBindingsLoading();if(t)return te.info(wi,`>>> DRAWING ABORTED ${this.id}: ${t} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let s;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const r=this._getBindings();this.pipeline.setBindings(r,{disableWarnings:this.props.disableWarnings}),G_(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:i}=this.vertexArray,o=i?i.byteLength/(i.indexType==="uint32"?4:2):void 0;s=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:o,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),s?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",s}setGeometry(e){var s;(s=this._gpuGeometry)==null||s.destroy();const t=e&&t8(this.device,e);if(t){this.setTopology(t.topology||"triangle-list");const r=new Wp(this.bufferLayout);this.bufferLayout=r.mergeBufferLayouts(t.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(t)}this._gpuGeometry=t}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const t=new Wp(this.bufferLayout);this.bufferLayout=this._gpuGeometry?t.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){H_(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new aP(this.shaderInputs.modules);for(const[t,s]of Object.entries(this.shaderInputs.modules))if(d8(s)){const r=this._uniformStore.getManagedUniformBuffer(this.device,t);this.bindings[`${t}Uniforms`]=r}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){const s=(t==null?void 0:t.disableWarnings)??this.props.disableWarnings;e.indices&&te.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=lP(this.pipeline.shaderLayout,this.bufferLayout);const r=new Wp(this.bufferLayout);for(const[i,o]of Object.entries(e)){const l=r.getBufferLayout(i);if(!l){s||te.warn(`Model(${this.id}): Missing layout for buffer "${i}".`)();continue}const f=r.getAttributeNamesForBuffer(l);let h=!1;for(const g of f){const m=this._attributeInfos[g];if(m){const A=this.device.type==="webgpu"?r.getBufferIndex(m.bufferName):m.location;this.vertexArray.setBuffer(A,o),h=!0}}!h&&!s&&te.warn(`Model(${this.id}): Ignoring buffer "${o.id}" for unknown attribute "${i}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(const[s,r]of Object.entries(e)){const i=this._attributeInfos[s];i?this.vertexArray.setConstantWebGL(i.location,r):((t==null?void 0:t.disableWarnings)??this.props.disableWarnings)||te.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${s}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){this.setUniformsWebGL(e)}setUniformsWebGL(e){G_(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(e){const{bindings:t,uniforms:s}=w2(this._getModuleUniforms(e));Object.assign(this.bindings,t),Object.assign(this.uniforms,s),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof am&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[t,s]of Object.entries(this.bindings))s instanceof am?s.isReady&&(e[t]=s.texture):e[t]=s;return e}_getBindingsUpdateTimestamp(){let e=0;for(const t of Object.values(this.bindings))t instanceof th?e=Math.max(e,t.texture.updateTimestamp):t instanceof ut||t instanceof dt?e=Math.max(e,t.updateTimestamp):t instanceof am?e=t.texture?Math.max(e,t.texture.updateTimestamp):1/0:t instanceof sh||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const t={...e.attributes};for(const[s]of Object.entries(t))!this.pipeline.shaderLayout.attributes.find(r=>r.name===s)&&s!=="positions"&&delete t[s];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(te.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const s=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let r=null;this.source?r=s:this.fs&&(r=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:s,fs:r}),this._attributeInfos=u3(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_logDrawCallStart(){const e=te.level>3?0:h8;te.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,te.group(wi,`>>> DRAWING MODEL ${this.id}`,{collapsed:te.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=r8(this.pipeline.shaderLayout,this.id);te.table(wi,e)();const t=this.shaderInputs.getDebugTable();for(const[r,i]of Object.entries(this.uniforms))t[r]={value:i};te.table(wi,t)();const s=this._getAttributeDebugTable();te.table(wi,this._attributeInfos)(),te.table(wi,s)(),te.groupEnd(wi)(),this._logOpen=!1}}_logFramebuffer(e){const t=this.device.props.debugFramebuffers;if(this._drawCount++,!t)return;const s=e.props.framebuffer;s&&i8(s,{id:s.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[t,s]of Object.entries(this._attributeInfos)){const r=this.vertexArray.attributes[s.location];e[s.location]={name:t,type:s.shaderType,values:r?this._getBufferOrConstantValues(r,s.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:t}=this.vertexArray,s=t.indexType==="uint32"?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:s.toString()}}return e}_getBufferOrConstantValues(e,t){const s=d3(t);return(e instanceof ut?new s(e.debugData):e).toString()}};b(Xh,"defaultProps",{...ha.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:eh.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let ri=Xh;function d8(n){return!!(n.uniformTypes&&!G_(n.uniformTypes))}function g8(n){return{type:n.type,shaderLanguage:n.info.shadingLanguage,shaderLanguageVersion:n.info.shadingLanguageVersion,gpu:n.info.gpu,features:n.features}}function G_(n){for(const e in n)return!1;return!0}const dl=class dl{constructor(e,t=dl.defaultProps){b(this,"device");b(this,"model");b(this,"transformFeedback");if(!dl.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new ri(this.device,{id:t.id||"buffer-transform-model",fs:t.fs||uF(),topology:t.topology||"point-list",varyings:t.outputs||t.varyings,...t}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:t.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var t;return((t=e==null?void 0:e.info)==null?void 0:t.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e!=null&&e.inputBuffers&&this.model.setAttributes(e.inputBuffers),e!=null&&e.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const t=this.getBuffer(e);if(!t)throw new Error("BufferTransform#getBuffer");if(t instanceof ut)return t.readAsync();const{buffer:s,byteOffset:r=0,byteLength:i=s.byteLength}=t;return s.readAsync(r,i)}};b(dl,"defaultProps",{...ri.defaultProps,outputs:void 0,feedbackBuffers:void 0});let bl=dl;class ca{constructor(e){b(this,"id");b(this,"topology");b(this,"vertexCount");b(this,"indices");b(this,"attributes");b(this,"userData",{});const{attributes:t={},indices:s=null,vertexCount:r=null}=e;this.id=e.id||Ml("geometry"),this.topology=e.topology,s&&(this.indices=ArrayBuffer.isView(s)?{value:s,size:1}:s),this.attributes={};for(const[i,o]of Object.entries(t)){const l=ArrayBuffer.isView(o)?{value:o}:o;if(!ArrayBuffer.isView(l.value))throw new Error(`${this._print(i)}: must be typed array or object with value as typed array`);if((i==="POSITION"||i==="positions")&&!l.size&&(l.size=3),i==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=l}else this.attributes[i]=l}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=r||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let s=1/0;for(const r of Object.values(e)){const{value:i,size:o,constant:l}=r;!l&&i&&o!==void 0&&o>=1&&(s=Math.min(s,i.length/o))}return s}}class mh{constructor(e={}){b(this,"id");b(this,"matrix",new we);b(this,"display",!0);b(this,"position",new L);b(this,"rotation",new L);b(this,"scale",new L(1,1,1));b(this,"userData",{});b(this,"props",{});const{id:t}=e;this.id=t||Ml(this.constructor.name),this._setScenegraphNodeProps(e)}getBounds(){return null}destroy(){}delete(){this.destroy()}setProps(e){return this._setScenegraphNodeProps(e),this}toString(){return`{type: ScenegraphNode, id: ${this.id})}`}setPosition(e){return this.position=e,this}setRotation(e){return this.rotation=e,this}setScale(e){return this.scale=e,this}setMatrix(e,t=!0){t?this.matrix.copy(e):this.matrix=e}setMatrixComponents(e){const{position:t,rotation:s,scale:r,update:i=!0}=e;return t&&this.setPosition(t),s&&this.setRotation(s),r&&this.setScale(r),i&&this.updateMatrix(),this}updateMatrix(){const e=this.position,t=this.rotation,s=this.scale;return this.matrix.identity(),this.matrix.translate(e),this.matrix.rotateXYZ(t),this.matrix.scale(s),this}update(e={}){const{position:t,rotation:s,scale:r}=e;return t&&this.setPosition(t),s&&this.setRotation(s),r&&this.setScale(r),this.updateMatrix(),this}getCoordinateUniforms(e,t){t=t||this.matrix;const s=new we(e).multiplyRight(t),r=s.invert(),i=r.transpose();return{viewMatrix:e,modelMatrix:t,objectMatrix:t,worldMatrix:s,worldInverseMatrix:r,worldInverseTransposeMatrix:i}}_setScenegraphNodeProps(e){"position"in e&&this.setPosition(e.position),"rotation"in e&&this.setRotation(e.rotation),"scale"in e&&this.setScale(e.scale),"matrix"in e&&this.setMatrix(e.matrix),Object.assign(this.props,e)}}class la extends mh{constructor(t={}){t=Array.isArray(t)?{children:t}:t;const{children:s=[]}=t;te.assert(s.every(r=>r instanceof mh),"every child must an instance of ScenegraphNode");super(t);b(this,"children");this.children=s}getBounds(){const t=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((s,{worldMatrix:r})=>{const i=s.getBounds();if(!i)return;const[o,l]=i,f=new L(o).add(l).divide([2,2,2]);r.transformAsPoint(f,f);const h=new L(l).subtract(o).divide([2,2,2]);r.transformAsVector(h,h);for(let g=0;g<8;g++){const m=new L(g&1?-1:1,g&2?-1:1,g&4?-1:1).multiply(h).add(f);for(let A=0;A<3;A++)t[0][A]=Math.min(t[0][A],m[A]),t[1][A]=Math.max(t[1][A],m[A])}}),Number.isFinite(t[0][0])?t:null}destroy(){this.children.forEach(t=>t.destroy()),this.removeAll(),super.destroy()}add(...t){for(const s of t)Array.isArray(s)?this.add(...s):this.children.push(s);return this}remove(t){const s=this.children,r=s.indexOf(t);return r>-1&&s.splice(r,1),this}removeAll(){return this.children=[],this}traverse(t,{worldMatrix:s=new we}={}){const r=new we(s).multiplyRight(this.matrix);for(const i of this.children)i instanceof la?i.traverse(t,{worldMatrix:r}):t(i,{worldMatrix:r})}}class V_ extends mh{constructor(t){super(t);b(this,"model");b(this,"bounds",null);b(this,"managedResources");this.model=t.model,this.managedResources=t.managedResources||[],this.bounds=t.bounds||null,this.setProps(t)}destroy(){this.model&&(this.model.destroy(),this.model=null),this.managedResources.forEach(t=>t.destroy()),this.managedResources=[]}getBounds(){return this.bounds}draw(t){return this.model.draw(t)}}const p8={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class x2 extends iy{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:s,viewports:r,onViewportActive:i,pickingFBO:o,deviceRect:{x:l,y:f,width:h,height:g},cullRect:m,effects:A,pass:y="picking",pickZ:E,shaderModuleProps:v}){this.pickZ=E;const S=this._resetColorEncoder(E),x=[l,f,h,g],O=super.render({target:o,layers:e,layerFilter:t,views:s,viewports:r,onViewportActive:i,cullRect:m,effects:A==null?void 0:A.filter(D=>D.useInPicking),pass:y,isPicking:!0,shaderModuleProps:v,clearColor:[0,0,0,0],colorMask:15,scissorRect:x});return this._colorEncoderState=null,{decodePickingColor:S&&_8.bind(null,S),stats:O}}shouldDrawLayer(e){const{pickable:t,operation:s}=e.props;return t&&s.includes("draw")||s.includes("terrain")||s.includes("mask")}getShaderModuleProps(e,t,s){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,t,s){const r={...e.props.parameters},{pickable:i,operation:o}=e.props;return!this._colorEncoderState||o.includes("terrain")?r.blend=!1:i&&o.includes("draw")&&(Object.assign(r,p8),r.blend=!0,r.blendColor=m8(this._colorEncoderState,e,s)),r}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function m8(n,e,t){const{byLayer:s,byAlpha:r}=n;let i,o=s.get(e);return o?(o.viewports.push(t),i=o.a):(i=s.size+1,i<=255?(o={a:i,layer:e,viewports:[t]},s.set(e,o),r[i]=o):(Ve.warn("Too many pickable layers, only picking the first 255")(),i=0)),[0,0,0,i/255]}function _8(n,e){const t=n.byAlpha[e[3]];return t&&{pickedLayer:t.layer,pickedViewports:t.viewports,pickedObjectIndex:t.layer.decodePickingColor(e)}}const Jo={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},_h=Symbol.for("component"),ni=Symbol.for("propTypes"),cm=Symbol.for("deprecatedProps"),ua=Symbol.for("asyncPropDefaults"),ji=Symbol.for("asyncPropOriginal"),Zr=Symbol.for("asyncPropResolved");function _a(n,e=()=>!0){return Array.isArray(n)?I2(n,e,[]):e(n)?[n]:[]}function I2(n,e,t){let s=-1;for(;++s<n.length;){const r=n[s];Array.isArray(r)?I2(r,e,t):e(r)&&t.push(r)}return t}function A8({target:n,source:e,start:t=0,count:s=1}){const r=e.length,i=s*r;let o=0;for(let l=t;o<r;o++)n[l++]=e[o];for(;o<i;)o<i-o?(n.copyWithin(t+o,t,t+o),o*=2):(n.copyWithin(t+o,t,t+i-o),o=i);return n}class y8{constructor(e,t,s){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=s,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;const s=++this._loadCount;let r=e;typeof e=="string"&&(r=zs(e)),r instanceof Promise?(this.isLoaded=!1,this._loader=r.then(i=>{this._loadCount===s&&(this.isLoaded=!0,this._error=void 0,this._content=i)}).catch(i=>{this._loadCount===s&&(this.isLoaded=!0,this._error=i||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const i of this._subscribers)i.onChange(this.getData())}}class b8{constructor(e){var t;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(t=e.device)==null?void 0:t.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:t,forceUpdate:s=!1,persistent:r=!0}){let i=this._resources[e];i?i.setData(t,s):(i=new y8(e,t,this._context),this._resources[e]=i),i.persistent=r}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const t=this._consumers[e];if(t){for(const s in t){const r=t[s],i=this._resources[r.resourceId];i&&i.unsubscribe(r)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:s,requestId:r="default"}){const{_resources:i,protocol:o}=this;e.startsWith(o)&&(e=e.replace(o,""),i[e]||this.add({resourceId:e,data:null,persistent:!1}));const l=i[e];if(this._track(s,r,l,t),l)return l.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,s,r){const i=this._consumers,o=i[e]=i[e]||{};let l=o[t];const f=l&&l.resourceId&&this._resources[l.resourceId];f&&(f.unsubscribe(l),this.prune()),s&&(l?(l.onChange=r,l.resourceId=s.id):l={onChange:r,resourceId:s.id},o[t]=l,s.subscribe(l))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];!t.persistent&&!t.inUse()&&(t.delete(),delete this._resources[e])}}}const T8="layerManager.setLayers",E8="layerManager.activateViewport";class C8{constructor(e,t){var l;this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=f=>{qt(E8,this,f),f&&(this.context.viewport=f)};const{deck:s,stats:r,viewport:i,timeline:o}=t||{};this.layers=[],this.resourceManager=new b8({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:s,shaderAssembler:E6(((l=e==null?void 0:e.info)==null?void 0:l.shadingLanguage)||"glsl"),defaultShaderModules:[ML],renderPass:void 0,stats:r||new wa({id:"deck.gl"}),viewport:i||new Ia({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new B2,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const s of this.layers){const r=s.getNeedsRedraw(e);t=t||r}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(t=>e.find(s=>t.id.indexOf(s)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){qt(T8,this,t,e),this._lastRenderedLayers=e;const s=_a(e,Boolean);for(const r of s)r.context=this.context;this._updateLayers(this.layers,s)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:t}=this.context;t.find(s=>s.name===e.name)||(t.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:t}=this.context,s=t.findIndex(r=>r.name===e.name);s>=0&&(t.splice(s,1),this._defaultShaderModulesChanged=!0)}_handleError(e,t,s){s.raiseError(t,`${e} of ${s}`)}_updateLayers(e,t){const s={};for(const o of e)s[o.id]?Ve.warn(`Multiple old layers with same id ${o.id}`)():s[o.id]=o;if(this._defaultShaderModulesChanged){for(const o of e)o.setNeedsUpdate(),o.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const r=[];this._updateSublayersRecursively(t,s,r),this._finalizeOldLayers(s);let i=!1;for(const o of r)if(o.hasUniformTransition()){i=`Uniform transition in ${o}`;break}this._needsUpdate=i,this.layers=r}_updateSublayersRecursively(e,t,s){for(const r of e){r.context=this.context;const i=t[r.id];i===null&&Ve.warn(`Multiple new layers with same id ${r.id}`)(),t[r.id]=null;let o=null;try{this._debug&&i!==r&&r.validateProps(),i?(this._transferLayerState(i,r),this._updateLayer(r)):this._initializeLayer(r),s.push(r),o=r.isComposite?r.getSubLayers():null}catch(l){this._handleError("matching",l,r)}o&&this._updateSublayersRecursively(o,t,s)}}_finalizeOldLayers(e){for(const t in e){const s=e[t];s&&this._finalizeLayer(s)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Jo.INITIALIZED}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=Jo.MATCHED,t!==e&&(e.lifecycle=Jo.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=Jo.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Jo.FINALIZED}catch(t){this._handleError("finalization",t,e)}}}function As(n,e,t){if(n===e)return!0;if(!t||!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let s=0;s<n.length;s++)if(!As(n[s],e[s],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const s=Object.keys(n),r=Object.keys(e);if(s.length!==r.length)return!1;for(const i of s)if(!e.hasOwnProperty(i)||!As(n[i],e[i],t-1))return!1;return!0}return!1}class v8{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){const t=typeof e=="string"?this.getView(e):e,s=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(s):s}getViewport(e){return this._viewportMap[e]}unproject(e,t){const s=this.getViewports(),r={x:e[0],y:e[1]};for(let i=s.length-1;i>=0;--i){const o=s[i];if(o.containsPixel(r)){const l=e.slice();return l[0]-=o.x,l[1]-=o.y,o.unproject(l,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=_a(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!As(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):Ve.warn("missing `viewState` or `initialViewState`")()}_createController(e,t){const s=t.type;return new s({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:i=>{var o;return(o=this.getView(e.id))==null?void 0:o.makeViewport({viewState:i,width:this.width,height:this.height})}})}_updateController(e,t,s,r){const i=e.controller;if(i&&s){const o={...t,...i,id:e.id,x:s.x,y:s.y,width:s.width,height:s.height};return(!r||r.constructor!==i.type)&&(r=this._createController(e,o)),r&&r.setProps(o),r}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let s=!1;for(let r=e.length;r--;){const i=e[r],o=this.getViewState(i),l=i.makeViewport({viewState:o,width:this.width,height:this.height});let f=t[i.id];const h=!!i.controller;h&&!f&&(s=!0),(s||!h)&&f&&(f.finalize(),f=null),this.controllers[i.id]=this._updateController(i,o,l,f),l&&this._viewports.unshift(l)}for(const r in t){const i=t[r];i&&!this.controllers[r]&&i.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length?!0:e.some((s,r)=>!e[r].equals(t[r]))}}const B8=/([0-9]+\.?[0-9]*)(%|px)/;function Vr(n){switch(typeof n){case"number":return{position:n,relative:!1};case"string":const e=B8.exec(n);if(e&&e.length>=3){const t=e[2]==="%",s=parseFloat(e[1]);return{position:t?s/100:s,relative:t}}default:throw new Error(`Could not parse position string ${n}`)}}function jr(n,e){return n.relative?Math.round(n.position*e):n.position}class M2{constructor(e){const{id:t,x:s=0,y:r=0,width:i="100%",height:o="100%",padding:l=null}=e;this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Vr(s),this._y=Vr(r),this._width=Vr(i),this._height=Vr(o),this._padding=l&&{left:Vr(l.left||0),right:Vr(l.right||0),top:Vr(l.top||0),bottom:Vr(l.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&As(this.props,e.props,2)}makeViewport({width:e,height:t,viewState:s}){s=this.filterViewState(s);const r=this.getDimensions({width:e,height:t});if(!r.height||!r.width)return null;const i=this.getViewportType(s);return new i({...s,...this.props,...r})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const s in this.props.viewState)s!=="id"&&(t[s]=this.props.viewState[s]);return t}return e}getDimensions({width:e,height:t}){const s={x:jr(this._x,e),y:jr(this._y,t),width:jr(this._width,e),height:jr(this._height,t)};return this._padding&&(s.padding={left:jr(this._padding.left,e),top:jr(this._padding.top,t),right:jr(this._padding.right,e),bottom:jr(this._padding.bottom,t)}),s}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Qh{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var t,s;this.cancel(),this.settings=e,this._inProgress=!0,(s=(t=this.settings).onStart)==null||s.call(t,this)}end(){var e,t;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(t=(e=this.settings).onEnd)==null||t.call(e,this))}cancel(){var e,t;this._inProgress&&((t=(e=this.settings).onInterrupt)==null||t.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,t;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:s,settings:r}=this;this._handle=s.addChannel({delay:s.getTime(),duration:r.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(t=(e=this.settings).onUpdate)==null||t.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const IC=()=>{},j_={BREAK:1,SNAP_TO_END:2,IGNORE:3},S8=n=>n,w8=j_.BREAK;class R8{constructor(e){this._onTransitionUpdate=t=>{const{time:s,settings:{interpolator:r,startProps:i,endProps:o,duration:l,easing:f}}=t,h=f(s/l),g=r.interpolateProps(i,o,h);this.propsInTransition=this.getControllerState({...this.props,...g}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Qh(e.timeline),this.onViewStateChange=e.onViewStateChange||IC,this.onStateChange=e.onStateChange||IC}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const s=this.props;if(this.props=e,!s||this._shouldIgnoreViewportChange(s,e))return!1;if(this._isTransitionEnabled(e)){let r=s;if(this.transition.inProgress){const{interruption:i,endProps:o}=this.transition.settings;r={...s,...i===j_.SNAP_TO_END?o:this.propsInTransition||s}}this._triggerTransition(r,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:s}=e;return(t>0||t==="auto")&&!!s}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===j_.IGNORE||this._isUpdateDueToCurrentTransition(t):this._isTransitionEnabled(t)?t.transitionInterpolator.arePropsEqual(e,t):!0}_triggerTransition(e,t){const s=this.getControllerState(e),r=this.getControllerState(t).shortestPathFrom(s),i=t.transitionInterpolator,o=i.getDuration?i.getDuration(e,t):t.transitionDuration;if(o===0)return;const l=i.initializeProps(e,r);this.propsInTransition={};const f={duration:o,easing:t.transitionEasing||S8,interpolator:i,interruption:t.transitionInterruption||w8,startProps:l.start,endProps:l.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(f),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(t)}}}function Mt(n,e){if(!n)throw new Error(e||"deck.gl: assertion failed.")}class x8{constructor(e){const{compare:t,extract:s,required:r}=e;this._propsToCompare=t,this._propsToExtract=s||t,this._requiredProps=r}arePropsEqual(e,t){for(const s of this._propsToCompare)if(!(s in e)||!(s in t)||!Ts(e[s],t[s]))return!1;return!0}initializeProps(e,t){const s={},r={};for(const i of this._propsToExtract)(i in e||i in t)&&(s[i]=e[i],r[i]=t[i]);return this._checkRequiredProps(s),this._checkRequiredProps(r),{start:s,end:r}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const s=e[t];Mt(Number.isFinite(s)||Array.isArray(s),`${t} is required for transition`)})}}const I8=["longitude","latitude","zoom","bearing","pitch"],M8=["longitude","latitude","zoom"];class oy extends x8{constructor(e={}){const t=Array.isArray(e)?e:e.transitionProps,s=Array.isArray(e)?{}:e;s.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:I8,required:M8},super(s.transitionProps),this.opts=s}initializeProps(e,t){const s=super.initializeProps(e,t),{makeViewport:r,around:i}=this.opts;if(r&&i){const o=r(e),l=r(t),f=o.unproject(i);s.start.around=i,Object.assign(s.end,{around:l.project(f),aroundPosition:f,width:t.width,height:t.height})}return s}interpolateProps(e,t,s){const r={};for(const i of this._propsToExtract)r[i]=hh(e[i]||0,t[i]||0,s);if(t.aroundPosition&&this.opts.makeViewport){const i=this.opts.makeViewport({...t,...r});Object.assign(r,i.panByPosition(t.aroundPosition,hh(e.around,t.around,s)))}return r}}const zr={transitionDuration:0},O8=300,hf=n=>1-(1-n)*(1-n),Go={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},Ri={};class O2{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new R8({...e,getControllerState:t=>new this.ControllerState(t),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const t in this._events)this._events[t]&&((e=this.eventManager)==null||e.off(t,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return t?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return t?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return t?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:s}=this.props,{offsetCenter:r}=e;return[r.x-t,r.y-s]}isPointInBounds(e,t){const{width:s,height:r}=this.props;if(t&&t.handled)return!1;const i=e[0]>=0&&e[0]<=s&&e[1]>=0&&e[1]<=r;return i&&t&&t.stopPropagation(),i}isFunctionKeyPressed(e){const{srcEvent:t}=e;return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:t===!0?O8:0;const{scrollZoom:s=!0,dragPan:r=!0,dragRotate:i=!0,doubleClickZoom:o=!0,touchZoom:l=!0,touchRotate:f=!1,keyboard:h=!0}=e,g=!!this.onViewStateChange;this.toggleEvents(Go.WHEEL,g&&s),this.toggleEvents(Go.PAN,g),this.toggleEvents(Go.PINCH,g&&(l||f)),this.toggleEvents(Go.MULTI_PAN,g&&f),this.toggleEvents(Go.DOUBLE_CLICK,g&&o),this.toggleEvents(Go.KEYBOARD,g&&h),this.scrollZoom=s,this.dragPan=r,this.dragRotate=i,this.doubleClickZoom=o,this.touchZoom=l,this.touchRotate=f,this.keyboard=h}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(s=>{this._events[s]!==t&&(this._events[s]=t,t?this.eventManager.on(s,this.handleEvent):this.eventManager.off(s,this.handleEvent))})}updateViewport(e,t=null,s={}){const r={...e.getViewportProps(),...t},i=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(s),i){const o=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:r,interactionState:this._interactionState,oldViewState:o,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let s=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(s=!s);const r=this.controllerState[s?"panStart":"rotateStart"]({pos:t});return this._panMove=s,this.updateViewport(r,zr,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),s=this.controllerState.pan({pos:t});return this.updateViewport(s,zr,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const s=this.getCenter(e),r=[s[0]+e.velocityX*t/2,s[1]+e.velocityY*t/2],i=this.controllerState.pan({pos:r}).panEnd();this.updateViewport(i,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:hf},{isDragging:!1,isPanning:!0})}else{const s=this.controllerState.panEnd();this.updateViewport(s,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),s=this.controllerState.rotate({pos:t});return this.updateViewport(s,zr,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const s=this.getCenter(e),r=[s[0]+e.velocityX*t/2,s[1]+e.velocityY*t/2],i=this.controllerState.rotate({pos:r}).rotateEnd();this.updateViewport(i,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:hf},{isDragging:!1,isRotating:!0})}else{const s=this.controllerState.rotateEnd();this.updateViewport(s,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:s=.01,smooth:r=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:i}=e;let o=2/(1+Math.exp(-Math.abs(i*s)));i<0&&o!==0&&(o=1/o);const l=this.controllerState.zoom({pos:t,scale:o});return this.updateViewport(l,{...this._getTransitionProps({around:t}),transitionDuration:r?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const s=this.controllerState.rotateStart({pos:t});return this.updateViewport(s,zr,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const s=this.controllerState.rotate({pos:t});return this.updateViewport(s,zr,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const s=this.getCenter(e),r=[s[0],s[1]+=e.velocityY*t/2],i=this.controllerState.rotate({pos:r});this.updateViewport(i,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:hf},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const s=this.controllerState.rotateEnd();this.updateViewport(s,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const s=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return Ri._startPinchRotation=e.rotation,Ri._lastPinchEvent=e,this.updateViewport(s,zr,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:s}=e,r=this.getCenter(e);t=t.zoom({pos:r,scale:s})}if(this.touchRotate){const{rotation:s}=e;t=t.rotate({deltaAngleX:Ri._startPinchRotation-s})}return this.updateViewport(t,zr,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Ri._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:s}=Ri;if(this.touchZoom&&t&&s&&e.scale!==s.scale){const r=this.getCenter(e);let i=this.controllerState.rotateEnd();const o=Math.log2(e.scale),l=(o-Math.log2(s.scale))/(e.deltaTime-s.deltaTime),f=Math.pow(2,o+l*t/2);i=i.zoom({pos:r,scale:f}).zoomEnd(),this.updateViewport(i,{...this._getTransitionProps({around:r}),transitionDuration:t,transitionEasing:hf},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const r=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Ri._startPinchRotation=null,Ri._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const s=this.isFunctionKeyPressed(e),r=this.controllerState.zoom({pos:t,scale:s?.5:2});return this.updateViewport(r,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:s,moveSpeed:r,rotateSpeedX:i,rotateSpeedY:o}=this.keyboard===!0?{}:this.keyboard,{controllerState:l}=this;let f;const h={};switch(e.srcEvent.code){case"Minus":f=t?l.zoomOut(s).zoomOut(s):l.zoomOut(s),h.isZooming=!0;break;case"Equal":f=t?l.zoomIn(s).zoomIn(s):l.zoomIn(s),h.isZooming=!0;break;case"ArrowLeft":t?(f=l.rotateLeft(i),h.isRotating=!0):(f=l.moveLeft(r),h.isPanning=!0);break;case"ArrowRight":t?(f=l.rotateRight(i),h.isRotating=!0):(f=l.moveRight(r),h.isPanning=!0);break;case"ArrowUp":t?(f=l.rotateUp(o),h.isRotating=!0):(f=l.moveUp(r),h.isPanning=!0);break;case"ArrowDown":t?(f=l.rotateDown(o),h.isRotating=!0):(f=l.moveDown(r),h.isPanning=!0);break;default:return!1}return this.updateViewport(f,this._getTransitionProps(),h),!0}_getTransitionProps(e){const{transition:t}=this;return!t||!t.transitionInterpolator?zr:e?{...t,transitionInterpolator:new oy({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t}}class D8{constructor(e,t){this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}const MC=5,N8=1.2;class D2 extends D8{constructor(e){const{width:t,height:s,latitude:r,longitude:i,zoom:o,bearing:l=0,pitch:f=0,altitude:h=1.5,position:g=[0,0,0],maxZoom:m=20,minZoom:A=0,maxPitch:y=60,minPitch:E=0,startPanLngLat:v,startZoomLngLat:S,startRotatePos:x,startBearing:O,startPitch:R,startZoom:D,normalize:z=!0}=e;Mt(Number.isFinite(i)),Mt(Number.isFinite(r)),Mt(Number.isFinite(o)),super({width:t,height:s,latitude:r,longitude:i,zoom:o,bearing:l,pitch:f,altitude:h,maxZoom:m,minZoom:A,maxPitch:y,minPitch:E,normalize:z,position:g},{startPanLngLat:v,startZoomLngLat:S,startRotatePos:x,startBearing:O,startPitch:R,startZoom:D}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){const s=this.getState().startPanLngLat||this._unproject(t);if(!s)return this;const i=this.makeViewport(this.getViewportProps()).panByPosition(s,e);return this._getUpdatedState(i)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:s=0}){const{startRotatePos:r,startBearing:i,startPitch:o}=this.getState();if(!r||i===void 0||o===void 0)return this;let l;return e?l=this._getNewRotation(e,r,o,i):l={bearing:i+t,pitch:o+s},this._getUpdatedState(l)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:s}){let{startZoom:r,startZoomLngLat:i}=this.getState();if(i||(r=this.getViewportProps().zoom,i=this._unproject(t)||this._unproject(e)),!i)return this;const{maxZoom:o,minZoom:l}=this.getViewportProps();let f=r+Math.log2(s);f=Wn(f,l,o);const h=this.makeViewport({...this.getViewportProps(),zoom:f});return this._getUpdatedState({zoom:f,...h.panByPosition(i,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),s={...this.getViewportProps()},{bearing:r,longitude:i}=s;return Math.abs(r-t.bearing)>180&&(s.bearing=r<0?r+360:r-360),Math.abs(i-t.longitude)>180&&(s.longitude=i<0?i+360:i-360),s}applyConstraints(e){const{maxZoom:t,minZoom:s,zoom:r}=e;e.zoom=Wn(r,s,t);const{maxPitch:i,minPitch:o,pitch:l}=e;e.pitch=Wn(l,o,i);const{normalize:f=!0}=e;return f&&Object.assign(e,o6(e)),e}_zoomFromCenter(e){const{width:t,height:s}=this.getViewportProps();return this.zoom({pos:[t/2,s/2],scale:e})}_panFromCenter(e){const{width:t,height:s}=this.getViewportProps();return this.pan({startPos:[t/2,s/2],pos:[t/2+e[0],s/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,s,r){const i=e[0]-t[0],o=e[1]-t[1],l=e[1],f=t[1],{width:h,height:g}=this.getViewportProps(),m=i/h;let A=0;o>0?Math.abs(g-f)>MC&&(A=o/(f-g)*N8):o<0&&f>MC&&(A=1-l/f),A=Wn(A,-1,1);const{minPitch:y,maxPitch:E}=this.getViewportProps(),v=r+180*m;let S=s;return A>0?S=s+A*(E-s):A<0&&(S=s-A*(y-s)),{pitch:S,bearing:v}}}class F8 extends O2{constructor(){super(...arguments),this.ControllerState=D2,this.transition={transitionDuration:300,transitionInterpolator:new oy({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class ay extends M2{constructor(e={}){super(e)}getViewportType(){return Vi}get ControllerType(){return F8}}ay.displayName="MapView";const P8=new C2;function U8(n,e){const t=n.order??1/0,s=e.order??1/0;return t-s}class L8{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find(s=>s.id===e.id)){const s=t.findIndex(r=>U8(r,e)>0);s<0?t.push(e):t.splice(s,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(As(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const r of this.effects)t[r.id]=r;const s=[];for(const r of e){const i=t[r.id];let o=r;i&&i!==r?i.setProps?(i.setProps(r.props),o=i):i.cleanup(this._context):i||r.setup(this._context),s.push(o),delete t[r.id]}for(const r in t)t[r].cleanup(this._context);this.effects=s,this._resolvedEffects=s.concat(this._defaultEffects),e.some(r=>r instanceof C2)||this._resolvedEffects.push(P8),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class k8 extends iy{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}const H8="deckRenderer.renderLayers";class G8{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new k8(e),this.pickLayersPass=new x2(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,s={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};s.effects&&this._preRender(s.effects,s);const r=this.lastPostProcessEffect?this.renderBuffers[0]:s.target;this.lastPostProcessEffect&&(s.clearColor=[0,0,0,0],s.clearCanvas=!0);const i=t.render({...s,target:r});s.effects&&this._postRender(s.effects,s),this.renderCount++,qt(H8,this,i,e)}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const s of e)t.preRenderStats[s.id]=s.preRender(t),s.postRender&&(this.lastPostProcessEffect=s.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,t=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(s=>{const r=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${s}`,colorAttachments:[r]}))});for(const s of e)s.resize(t)}_postRender(e,t){const{renderBuffers:s}=this,r={...t,inputBuffer:s[0],swapBuffer:s[1]};for(const i of e)if(i.postRender){r.target=i.id===this.lastPostProcessEffect?t.target:void 0;const o=i.postRender(r);r.inputBuffer=o,r.swapBuffer=o===s[0]?s[1]:s[0]}}}const V8={pickedColor:null,pickedObjectIndex:-1};function j8({pickedColors:n,decodePickingColor:e,deviceX:t,deviceY:s,deviceRadius:r,deviceRect:i}){const{x:o,y:l,width:f,height:h}=i;let g=r*r,m=-1,A=0;for(let y=0;y<h;y++){const E=y+l-s,v=E*E;if(v>g)A+=4*f;else for(let S=0;S<f;S++){if(n[A+3]-1>=0){const O=S+o-t,R=O*O+v;R<=g&&(g=R,m=A)}A+=4}}if(m>=0){const y=n.slice(m,m+4),E=e(y);if(E){const v=Math.floor(m/4/f),S=m/4-v*f;return{...E,pickedColor:y,pickedX:o+S,pickedY:l+v}}Ve.error("Picked non-existent layer. Is picking buffer corrupt?")()}return V8}function z8({pickedColors:n,decodePickingColor:e}){const t=new Map;if(n){for(let s=0;s<n.length;s+=4)if(n[s+3]-1>=0){const i=n.slice(s,s+4),o=i.join(",");if(!t.has(o)){const l=e(i);l?t.set(o,{...l,color:i}):Ve.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(t.values())}function N2({pickInfo:n,viewports:e,pixelRatio:t,x:s,y:r,z:i}){let o=e[0];e.length>1&&(o=X8((n==null?void 0:n.pickedViewports)||e,{x:s,y:r}));let l;if(o){const f=[s-o.x,r-o.y];i!==void 0&&(f[2]=i),l=o.unproject(f)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:s,y:r,pixel:[s,r],coordinate:l,devicePixel:n&&"pickedX"in n?[n.pickedX,n.pickedY]:void 0,pixelRatio:t}}function $8(n){const{pickInfo:e,lastPickedInfo:t,mode:s,layers:r}=n,{pickedColor:i,pickedLayer:o,pickedObjectIndex:l}=e,f=o?[o]:[];if(s==="hover"){const m=t.index,A=t.layerId,y=o?o.props.id:null;if(y!==A||l!==m){if(y!==A){const E=r.find(v=>v.props.id===A);E&&f.unshift(E)}t.layerId=y,t.index=l,t.info=null}}const h=N2(n),g=new Map;return g.set(null,h),f.forEach(m=>{let A={...h};m===o&&(A.color=i,A.index=l,A.picked=!0),A=F2({layer:m,info:A,mode:s});const y=A.layer;m===o&&s==="hover"&&(t.info=A),g.set(y.id,A),s==="hover"&&y.updateAutoHighlight(A)}),g}function F2({layer:n,info:e,mode:t}){for(;n&&e;){const s=e.layer||null;e.sourceLayer=s,e.layer=n,e=n.getPickingInfo({info:e,mode:t,sourceLayer:s}),n=n.parent}return e}function X8(n,e){for(let t=n.length-1;t>=0;t--){const s=n[t];if(s.containsPixel(e))return s}return n[0]}class J8{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new x2(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:s,viewports:r},i=this.lastPickedInfo.info){const o=i&&i.layer&&i.layer.id,l=i&&i.viewport&&i.viewport.id,f=o?s.find(A=>A.id===o):null,h=l&&r.find(A=>A.id===l)||r[0],g=h&&h.unproject([e-h.x,t-h.y]);return{...i,...{x:e,y:t,viewport:h,coordinate:g,layer:f}}}_resizeBuffer(){var t,s;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const r=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=r}const{canvas:e}=this.device.getDefaultCanvasContext();(t=this.pickingFBO)==null||t.resize({width:e.width,height:e.height}),(s=this.depthFBO)==null||s.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const t=e.filter(s=>this.pickLayersPass.shouldDrawLayer(s)&&!s.isComposite);return t.length?t:null}_pickClosestObject({layers:e,views:t,viewports:s,x:r,y:i,radius:o=0,depth:l=1,mode:f="query",unproject3D:h,onViewportActive:g,effects:m}){const A=this.device.canvasContext.cssToDeviceRatio(),y=this._getPickable(e);if(!y||s.length===0)return{result:[],emptyInfo:N2({viewports:s,x:r,y:i,pixelRatio:A})};this._resizeBuffer();const E=this.device.canvasContext.cssToDevicePixels([r,i],!0),v=[E.x+Math.floor(E.width/2),E.y+Math.floor(E.height/2)],S=Math.round(o*A),{width:x,height:O}=this.pickingFBO,R=this._getPickingRect({deviceX:v[0],deviceY:v[1],deviceRadius:S,deviceWidth:x,deviceHeight:O}),D={x:r-o,y:i-o,width:o*2+1,height:o*2+1};let z;const J=[],ie=new Set;for(let re=0;re<l;re++){let ee;if(R){const fe=this._drawAndSample({layers:y,views:t,viewports:s,onViewportActive:g,deviceRect:R,cullRect:D,effects:m,pass:`picking:${f}`});ee=j8({...fe,deviceX:v[0],deviceY:v[1],deviceRadius:S,deviceRect:R})}else ee={pickedColor:null,pickedObjectIndex:-1};let le;if(ee.pickedLayer&&h&&this.depthFBO){const{pickedColors:fe}=this._drawAndSample({layers:[ee.pickedLayer],views:t,viewports:s,onViewportActive:g,deviceRect:{x:ee.pickedX,y:ee.pickedY,width:1,height:1},cullRect:D,effects:m,pass:`picking:${f}:z`},!0);fe[3]&&(le=fe[0])}ee.pickedLayer&&re+1<l&&(ie.add(ee.pickedLayer),ee.pickedLayer.disablePickingIndex(ee.pickedObjectIndex)),z=$8({pickInfo:ee,lastPickedInfo:this.lastPickedInfo,mode:f,layers:y,viewports:s,x:r,y:i,z:le,pixelRatio:A});for(const fe of z.values())fe.layer&&J.push(fe);if(!ee.pickedColor)break}for(const re of ie)re.restorePickingColors();return{result:J,emptyInfo:z.get(null)}}_pickVisibleObjects({layers:e,views:t,viewports:s,x:r,y:i,width:o=1,height:l=1,mode:f="query",maxObjects:h=null,onViewportActive:g,effects:m}){const A=this._getPickable(e);if(!A||s.length===0)return[];this._resizeBuffer();const y=this.device.canvasContext.cssToDeviceRatio(),E=this.device.canvasContext.cssToDevicePixels([r,i],!0),v=E.x,S=E.y+E.height,x=this.device.canvasContext.cssToDevicePixels([r+o,i+l],!0),O=x.x+x.width,R=x.y,D={x:v,y:R,width:O-v,height:S-R},z=this._drawAndSample({layers:A,views:t,viewports:s,onViewportActive:g,deviceRect:D,cullRect:{x:r,y:i,width:o,height:l},effects:m,pass:`picking:${f}`}),J=z8(z),ie=new Map,re=[],ee=Number.isFinite(h);for(let le=0;le<J.length&&!(ee&&re.length>=h);le++){const fe=J[le];let ye={color:fe.pickedColor,layer:null,index:fe.pickedObjectIndex,picked:!0,x:r,y:i,pixelRatio:y};ye=F2({layer:fe.pickedLayer,info:ye,mode:f});const ke=ye.layer.id;ie.has(ke)||ie.set(ke,new Set);const me=ie.get(ke),Oe=ye.object??ye.index;me.has(Oe)||(me.add(Oe),re.push(ye))}return re}_drawAndSample({layers:e,views:t,viewports:s,onViewportActive:r,deviceRect:i,cullRect:o,effects:l,pass:f},h=!1){const g=h?this.depthFBO:this.pickingFBO,m={layers:e,layerFilter:this.layerFilter,views:t,viewports:s,onViewportActive:r,pickingFBO:g,deviceRect:i,cullRect:o,effects:l,pass:f,pickZ:h,preRenderStats:{},isPicking:!0};for(const O of l)O.useInPicking&&(m.preRenderStats[O.id]=O.preRender(m));const{decodePickingColor:A}=this.pickLayersPass.render(m),{x:y,y:E,width:v,height:S}=i,x=new(h?Float32Array:Uint8Array)(v*S*4);return this.device.readPixelsToArrayWebGL(g,{sourceX:y,sourceY:E,sourceWidth:v,sourceHeight:S,target:x}),{pickedColors:x,decodePickingColor:A}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:s,deviceWidth:r,deviceHeight:i}){const o=Math.max(0,e-s),l=Math.max(0,t-s),f=Math.min(r,e+s+1)-o,h=Math.min(i,t+s+1)-l;return f<=0||h<=0?null:{x:o,y:l,width:f,height:h}}}const W8={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},Y8="top-left",OC="__root";class K8{constructor({deck:e,parentElement:t}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=t}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!As(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(t=>t.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const t={};for(const s of this.resolvedWidgets)t[s.id]=s;this.resolvedWidgets.length=0;for(const s of this.defaultWidgets)t[s.id]=null,this.resolvedWidgets.push(s);for(let s of e){const r=t[s.id];r?r.viewId!==s.viewId||r.placement!==s.placement?(this._remove(r),this._add(s)):s!==r&&(r.setProps(s.props),s=r):this._add(s),t[s.id]=null,this.resolvedWidgets.push(s)}for(const s in t){const r=t[s];r&&this._remove(r)}this.widgets=e}_add(e){const{viewId:t=null,placement:s=Y8}=e,r=e.onAdd({deck:this.deck,viewId:t});r&&this._getContainer(t,s).append(r),e._element=r}_remove(e){var t;(t=e.onRemove)==null||t.call(e),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,t){var o;const s=e||OC;let r=this.containers[s];r||(r=document.createElement("div"),r.style.pointerEvents="none",r.style.position="absolute",r.style.overflow="hidden",(o=this.parentElement)==null||o.append(r),this.containers[s]=r);let i=r.querySelector(`.${t}`);return i||(i=document.createElement("div"),i.className=t,i.style.position="absolute",i.style.zIndex="2",Object.assign(i.style,W8[t]),r.append(i)),i}_updateContainers(){const e=this.deck.width,t=this.deck.height;for(const s in this.containers){const r=this.lastViewports[s]||null,i=s===OC||r,o=this.containers[s];i?(o.style.display="block",o.style.left=`${r?r.x:0}px`,o.style.top=`${r?r.y:0}px`,o.style.width=`${r?r.width:e}px`,o.style.height=`${r?r.height:t}px`):o.style.display="none"}}onRedraw({viewports:e,layers:t}){var r,i;const s=e.reduce((o,l)=>(o[l.id]=l,o),{});for(const o of this.getWidgets()){const{viewId:l}=o;if(l){const f=s[l];f&&(o.onViewportChange&&o.onViewportChange(f),(r=o.onRedraw)==null||r.call(o,{viewports:[f],layers:t}))}else{if(o.onViewportChange)for(const f of e)o.onViewportChange(f);(i=o.onRedraw)==null||i.call(o,{viewports:e,layers:t})}}this.lastViewports=s,this._updateContainers()}onHover(e,t){var s,r;for(const i of this.getWidgets()){const{viewId:o}=i;(!o||o===((s=e.viewport)==null?void 0:s.id))&&((r=i.onHover)==null||r.call(i,e,t))}}onEvent(e,t){var r,i;const s=N_[t.type];if(s)for(const o of this.getWidgets()){const{viewId:l}=o;(!l||l===((r=e.viewport)==null?void 0:r.id))&&((i=o[s])==null||i.call(o,e,t))}}}const q8={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class Q8{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const t=document.createElement("div");return t.className="deck-tooltip",Object.assign(t.style,q8),this.deck=e,this.element=t,t}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var t;this.isVisible&&e.id===((t=this.lastViewport)==null?void 0:t.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:t}=this,s=t&&t.props.getTooltip;if(!s)return;const r=s(e);this.lastViewport=e.viewport,this.setTooltip(r,e.x,e.y)}setTooltip(e,t,s){const r=this.element;if(r){if(typeof e=="string")r.innerText=e;else if(e)e.text&&(r.innerText=e.text),e.html&&(r.innerHTML=e.html),e.className&&(r.className=e.className);else{this.isVisible=!1,r.style.display="none";return}this.isVisible=!0,r.style.display="block",r.style.transform=`translate(${t}px, ${s}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(r.style,e.style)}}}var qo;(function(n){n[n.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",n[n.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",n[n.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",n[n.POINTS=0]="POINTS",n[n.LINES=1]="LINES",n[n.LINE_LOOP=2]="LINE_LOOP",n[n.LINE_STRIP=3]="LINE_STRIP",n[n.TRIANGLES=4]="TRIANGLES",n[n.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",n[n.TRIANGLE_FAN=6]="TRIANGLE_FAN",n[n.ZERO=0]="ZERO",n[n.ONE=1]="ONE",n[n.SRC_COLOR=768]="SRC_COLOR",n[n.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",n[n.SRC_ALPHA=770]="SRC_ALPHA",n[n.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",n[n.DST_ALPHA=772]="DST_ALPHA",n[n.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",n[n.DST_COLOR=774]="DST_COLOR",n[n.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",n[n.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",n[n.CONSTANT_COLOR=32769]="CONSTANT_COLOR",n[n.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",n[n.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",n[n.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",n[n.FUNC_ADD=32774]="FUNC_ADD",n[n.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",n[n.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",n[n.BLEND_EQUATION=32777]="BLEND_EQUATION",n[n.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",n[n.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",n[n.BLEND_DST_RGB=32968]="BLEND_DST_RGB",n[n.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",n[n.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",n[n.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",n[n.BLEND_COLOR=32773]="BLEND_COLOR",n[n.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",n[n.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",n[n.LINE_WIDTH=2849]="LINE_WIDTH",n[n.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",n[n.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",n[n.CULL_FACE_MODE=2885]="CULL_FACE_MODE",n[n.FRONT_FACE=2886]="FRONT_FACE",n[n.DEPTH_RANGE=2928]="DEPTH_RANGE",n[n.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",n[n.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",n[n.DEPTH_FUNC=2932]="DEPTH_FUNC",n[n.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",n[n.STENCIL_FUNC=2962]="STENCIL_FUNC",n[n.STENCIL_FAIL=2964]="STENCIL_FAIL",n[n.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",n[n.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",n[n.STENCIL_REF=2967]="STENCIL_REF",n[n.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",n[n.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",n[n.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",n[n.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",n[n.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",n[n.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",n[n.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",n[n.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",n[n.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",n[n.VIEWPORT=2978]="VIEWPORT",n[n.SCISSOR_BOX=3088]="SCISSOR_BOX",n[n.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",n[n.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",n[n.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",n[n.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",n[n.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",n[n.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",n[n.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",n[n.RED_BITS=3410]="RED_BITS",n[n.GREEN_BITS=3411]="GREEN_BITS",n[n.BLUE_BITS=3412]="BLUE_BITS",n[n.ALPHA_BITS=3413]="ALPHA_BITS",n[n.DEPTH_BITS=3414]="DEPTH_BITS",n[n.STENCIL_BITS=3415]="STENCIL_BITS",n[n.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",n[n.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",n[n.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",n[n.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",n[n.SAMPLES=32937]="SAMPLES",n[n.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",n[n.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",n[n.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",n[n.VENDOR=7936]="VENDOR",n[n.RENDERER=7937]="RENDERER",n[n.VERSION=7938]="VERSION",n[n.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",n[n.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",n[n.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",n[n.STATIC_DRAW=35044]="STATIC_DRAW",n[n.STREAM_DRAW=35040]="STREAM_DRAW",n[n.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",n[n.ARRAY_BUFFER=34962]="ARRAY_BUFFER",n[n.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",n[n.BUFFER_SIZE=34660]="BUFFER_SIZE",n[n.BUFFER_USAGE=34661]="BUFFER_USAGE",n[n.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",n[n.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",n[n.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",n[n.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",n[n.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",n[n.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",n[n.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",n[n.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",n[n.CULL_FACE=2884]="CULL_FACE",n[n.FRONT=1028]="FRONT",n[n.BACK=1029]="BACK",n[n.FRONT_AND_BACK=1032]="FRONT_AND_BACK",n[n.BLEND=3042]="BLEND",n[n.DEPTH_TEST=2929]="DEPTH_TEST",n[n.DITHER=3024]="DITHER",n[n.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",n[n.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",n[n.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",n[n.SCISSOR_TEST=3089]="SCISSOR_TEST",n[n.STENCIL_TEST=2960]="STENCIL_TEST",n[n.NO_ERROR=0]="NO_ERROR",n[n.INVALID_ENUM=1280]="INVALID_ENUM",n[n.INVALID_VALUE=1281]="INVALID_VALUE",n[n.INVALID_OPERATION=1282]="INVALID_OPERATION",n[n.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",n[n.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",n[n.CW=2304]="CW",n[n.CCW=2305]="CCW",n[n.DONT_CARE=4352]="DONT_CARE",n[n.FASTEST=4353]="FASTEST",n[n.NICEST=4354]="NICEST",n[n.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",n[n.BYTE=5120]="BYTE",n[n.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",n[n.SHORT=5122]="SHORT",n[n.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",n[n.INT=5124]="INT",n[n.UNSIGNED_INT=5125]="UNSIGNED_INT",n[n.FLOAT=5126]="FLOAT",n[n.DOUBLE=5130]="DOUBLE",n[n.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",n[n.ALPHA=6406]="ALPHA",n[n.RGB=6407]="RGB",n[n.RGBA=6408]="RGBA",n[n.LUMINANCE=6409]="LUMINANCE",n[n.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",n[n.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",n[n.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",n[n.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",n[n.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",n[n.VERTEX_SHADER=35633]="VERTEX_SHADER",n[n.COMPILE_STATUS=35713]="COMPILE_STATUS",n[n.DELETE_STATUS=35712]="DELETE_STATUS",n[n.LINK_STATUS=35714]="LINK_STATUS",n[n.VALIDATE_STATUS=35715]="VALIDATE_STATUS",n[n.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",n[n.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",n[n.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",n[n.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",n[n.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",n[n.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",n[n.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",n[n.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",n[n.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",n[n.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",n[n.SHADER_TYPE=35663]="SHADER_TYPE",n[n.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",n[n.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",n[n.NEVER=512]="NEVER",n[n.LESS=513]="LESS",n[n.EQUAL=514]="EQUAL",n[n.LEQUAL=515]="LEQUAL",n[n.GREATER=516]="GREATER",n[n.NOTEQUAL=517]="NOTEQUAL",n[n.GEQUAL=518]="GEQUAL",n[n.ALWAYS=519]="ALWAYS",n[n.KEEP=7680]="KEEP",n[n.REPLACE=7681]="REPLACE",n[n.INCR=7682]="INCR",n[n.DECR=7683]="DECR",n[n.INVERT=5386]="INVERT",n[n.INCR_WRAP=34055]="INCR_WRAP",n[n.DECR_WRAP=34056]="DECR_WRAP",n[n.NEAREST=9728]="NEAREST",n[n.LINEAR=9729]="LINEAR",n[n.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",n[n.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",n[n.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",n[n.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",n[n.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",n[n.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",n[n.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",n[n.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",n[n.TEXTURE_2D=3553]="TEXTURE_2D",n[n.TEXTURE=5890]="TEXTURE",n[n.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",n[n.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",n[n.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",n[n.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",n[n.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",n[n.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",n[n.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",n[n.TEXTURE0=33984]="TEXTURE0",n[n.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",n[n.REPEAT=10497]="REPEAT",n[n.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",n[n.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",n[n.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",n[n.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",n[n.FLOAT_VEC2=35664]="FLOAT_VEC2",n[n.FLOAT_VEC3=35665]="FLOAT_VEC3",n[n.FLOAT_VEC4=35666]="FLOAT_VEC4",n[n.INT_VEC2=35667]="INT_VEC2",n[n.INT_VEC3=35668]="INT_VEC3",n[n.INT_VEC4=35669]="INT_VEC4",n[n.BOOL=35670]="BOOL",n[n.BOOL_VEC2=35671]="BOOL_VEC2",n[n.BOOL_VEC3=35672]="BOOL_VEC3",n[n.BOOL_VEC4=35673]="BOOL_VEC4",n[n.FLOAT_MAT2=35674]="FLOAT_MAT2",n[n.FLOAT_MAT3=35675]="FLOAT_MAT3",n[n.FLOAT_MAT4=35676]="FLOAT_MAT4",n[n.SAMPLER_2D=35678]="SAMPLER_2D",n[n.SAMPLER_CUBE=35680]="SAMPLER_CUBE",n[n.LOW_FLOAT=36336]="LOW_FLOAT",n[n.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",n[n.HIGH_FLOAT=36338]="HIGH_FLOAT",n[n.LOW_INT=36339]="LOW_INT",n[n.MEDIUM_INT=36340]="MEDIUM_INT",n[n.HIGH_INT=36341]="HIGH_INT",n[n.FRAMEBUFFER=36160]="FRAMEBUFFER",n[n.RENDERBUFFER=36161]="RENDERBUFFER",n[n.RGBA4=32854]="RGBA4",n[n.RGB5_A1=32855]="RGB5_A1",n[n.RGB565=36194]="RGB565",n[n.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",n[n.STENCIL_INDEX=6401]="STENCIL_INDEX",n[n.STENCIL_INDEX8=36168]="STENCIL_INDEX8",n[n.DEPTH_STENCIL=34041]="DEPTH_STENCIL",n[n.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",n[n.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",n[n.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",n[n.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",n[n.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",n[n.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",n[n.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",n[n.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",n[n.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",n[n.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",n[n.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",n[n.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",n[n.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",n[n.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",n[n.NONE=0]="NONE",n[n.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",n[n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",n[n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",n[n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",n[n.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",n[n.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",n[n.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",n[n.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",n[n.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",n[n.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",n[n.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",n[n.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",n[n.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",n[n.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",n[n.READ_BUFFER=3074]="READ_BUFFER",n[n.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",n[n.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",n[n.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",n[n.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",n[n.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",n[n.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",n[n.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",n[n.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",n[n.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",n[n.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",n[n.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",n[n.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",n[n.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",n[n.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",n[n.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",n[n.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",n[n.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",n[n.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",n[n.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",n[n.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",n[n.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",n[n.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",n[n.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",n[n.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",n[n.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",n[n.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",n[n.RED=6403]="RED",n[n.RGB8=32849]="RGB8",n[n.RGBA8=32856]="RGBA8",n[n.RGB10_A2=32857]="RGB10_A2",n[n.TEXTURE_3D=32879]="TEXTURE_3D",n[n.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",n[n.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",n[n.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",n[n.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",n[n.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",n[n.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",n[n.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",n[n.SRGB=35904]="SRGB",n[n.SRGB8=35905]="SRGB8",n[n.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",n[n.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",n[n.RGBA32F=34836]="RGBA32F",n[n.RGB32F=34837]="RGB32F",n[n.RGBA16F=34842]="RGBA16F",n[n.RGB16F=34843]="RGB16F",n[n.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",n[n.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",n[n.R11F_G11F_B10F=35898]="R11F_G11F_B10F",n[n.RGB9_E5=35901]="RGB9_E5",n[n.RGBA32UI=36208]="RGBA32UI",n[n.RGB32UI=36209]="RGB32UI",n[n.RGBA16UI=36214]="RGBA16UI",n[n.RGB16UI=36215]="RGB16UI",n[n.RGBA8UI=36220]="RGBA8UI",n[n.RGB8UI=36221]="RGB8UI",n[n.RGBA32I=36226]="RGBA32I",n[n.RGB32I=36227]="RGB32I",n[n.RGBA16I=36232]="RGBA16I",n[n.RGB16I=36233]="RGB16I",n[n.RGBA8I=36238]="RGBA8I",n[n.RGB8I=36239]="RGB8I",n[n.RED_INTEGER=36244]="RED_INTEGER",n[n.RGB_INTEGER=36248]="RGB_INTEGER",n[n.RGBA_INTEGER=36249]="RGBA_INTEGER",n[n.R8=33321]="R8",n[n.RG8=33323]="RG8",n[n.R16F=33325]="R16F",n[n.R32F=33326]="R32F",n[n.RG16F=33327]="RG16F",n[n.RG32F=33328]="RG32F",n[n.R8I=33329]="R8I",n[n.R8UI=33330]="R8UI",n[n.R16I=33331]="R16I",n[n.R16UI=33332]="R16UI",n[n.R32I=33333]="R32I",n[n.R32UI=33334]="R32UI",n[n.RG8I=33335]="RG8I",n[n.RG8UI=33336]="RG8UI",n[n.RG16I=33337]="RG16I",n[n.RG16UI=33338]="RG16UI",n[n.RG32I=33339]="RG32I",n[n.RG32UI=33340]="RG32UI",n[n.R8_SNORM=36756]="R8_SNORM",n[n.RG8_SNORM=36757]="RG8_SNORM",n[n.RGB8_SNORM=36758]="RGB8_SNORM",n[n.RGBA8_SNORM=36759]="RGBA8_SNORM",n[n.RGB10_A2UI=36975]="RGB10_A2UI",n[n.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",n[n.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",n[n.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",n[n.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",n[n.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",n[n.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",n[n.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",n[n.HALF_FLOAT=5131]="HALF_FLOAT",n[n.RG=33319]="RG",n[n.RG_INTEGER=33320]="RG_INTEGER",n[n.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",n[n.CURRENT_QUERY=34917]="CURRENT_QUERY",n[n.QUERY_RESULT=34918]="QUERY_RESULT",n[n.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",n[n.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",n[n.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",n[n.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",n[n.DRAW_BUFFER0=34853]="DRAW_BUFFER0",n[n.DRAW_BUFFER1=34854]="DRAW_BUFFER1",n[n.DRAW_BUFFER2=34855]="DRAW_BUFFER2",n[n.DRAW_BUFFER3=34856]="DRAW_BUFFER3",n[n.DRAW_BUFFER4=34857]="DRAW_BUFFER4",n[n.DRAW_BUFFER5=34858]="DRAW_BUFFER5",n[n.DRAW_BUFFER6=34859]="DRAW_BUFFER6",n[n.DRAW_BUFFER7=34860]="DRAW_BUFFER7",n[n.DRAW_BUFFER8=34861]="DRAW_BUFFER8",n[n.DRAW_BUFFER9=34862]="DRAW_BUFFER9",n[n.DRAW_BUFFER10=34863]="DRAW_BUFFER10",n[n.DRAW_BUFFER11=34864]="DRAW_BUFFER11",n[n.DRAW_BUFFER12=34865]="DRAW_BUFFER12",n[n.DRAW_BUFFER13=34866]="DRAW_BUFFER13",n[n.DRAW_BUFFER14=34867]="DRAW_BUFFER14",n[n.DRAW_BUFFER15=34868]="DRAW_BUFFER15",n[n.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",n[n.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",n[n.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",n[n.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",n[n.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",n[n.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",n[n.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",n[n.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",n[n.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",n[n.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",n[n.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",n[n.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",n[n.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",n[n.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",n[n.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",n[n.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",n[n.SAMPLER_3D=35679]="SAMPLER_3D",n[n.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",n[n.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",n[n.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",n[n.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",n[n.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",n[n.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",n[n.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",n[n.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",n[n.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",n[n.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",n[n.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",n[n.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",n[n.MAX_SAMPLES=36183]="MAX_SAMPLES",n[n.SAMPLER_BINDING=35097]="SAMPLER_BINDING",n[n.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",n[n.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",n[n.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",n[n.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",n[n.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",n[n.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",n[n.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",n[n.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",n[n.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",n[n.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",n[n.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",n[n.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",n[n.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",n[n.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",n[n.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",n[n.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",n[n.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",n[n.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",n[n.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",n[n.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",n[n.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",n[n.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",n[n.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",n[n.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",n[n.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",n[n.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",n[n.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",n[n.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",n[n.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",n[n.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",n[n.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",n[n.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",n[n.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",n[n.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",n[n.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",n[n.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",n[n.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",n[n.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",n[n.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",n[n.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",n[n.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",n[n.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",n[n.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",n[n.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",n[n.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",n[n.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",n[n.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",n[n.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",n[n.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",n[n.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",n[n.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",n[n.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",n[n.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",n[n.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",n[n.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",n[n.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",n[n.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",n[n.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",n[n.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",n[n.UNIFORM_TYPE=35383]="UNIFORM_TYPE",n[n.UNIFORM_SIZE=35384]="UNIFORM_SIZE",n[n.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",n[n.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",n[n.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",n[n.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",n[n.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",n[n.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",n[n.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",n[n.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",n[n.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",n[n.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",n[n.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",n[n.OBJECT_TYPE=37138]="OBJECT_TYPE",n[n.SYNC_CONDITION=37139]="SYNC_CONDITION",n[n.SYNC_STATUS=37140]="SYNC_STATUS",n[n.SYNC_FLAGS=37141]="SYNC_FLAGS",n[n.SYNC_FENCE=37142]="SYNC_FENCE",n[n.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",n[n.UNSIGNALED=37144]="UNSIGNALED",n[n.SIGNALED=37145]="SIGNALED",n[n.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",n[n.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",n[n.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",n[n.WAIT_FAILED=37149]="WAIT_FAILED",n[n.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",n[n.COLOR=6144]="COLOR",n[n.DEPTH=6145]="DEPTH",n[n.STENCIL=6146]="STENCIL",n[n.MIN=32775]="MIN",n[n.MAX=32776]="MAX",n[n.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",n[n.STREAM_READ=35041]="STREAM_READ",n[n.STREAM_COPY=35042]="STREAM_COPY",n[n.STATIC_READ=35045]="STATIC_READ",n[n.STATIC_COPY=35046]="STATIC_COPY",n[n.DYNAMIC_READ=35049]="DYNAMIC_READ",n[n.DYNAMIC_COPY=35050]="DYNAMIC_COPY",n[n.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",n[n.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",n[n.INVALID_INDEX=4294967295]="INVALID_INDEX",n[n.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",n[n.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",n[n.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",n[n.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",n[n.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",n[n.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",n[n.R16_EXT=33322]="R16_EXT",n[n.RG16_EXT=33324]="RG16_EXT",n[n.RGB16_EXT=32852]="RGB16_EXT",n[n.RGBA16_EXT=32859]="RGBA16_EXT",n[n.R16_SNORM_EXT=36760]="R16_SNORM_EXT",n[n.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",n[n.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",n[n.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",n[n.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",n[n.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",n[n.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",n[n.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",n[n.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",n[n.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",n[n.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",n[n.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",n[n.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",n[n.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",n[n.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",n[n.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",n[n.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",n[n.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",n[n.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",n[n.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",n[n.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",n[n.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",n[n.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",n[n.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",n[n.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",n[n.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",n[n.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",n[n.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",n[n.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",n[n.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",n[n.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",n[n.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",n[n.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",n[n.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",n[n.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",n[n.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",n[n.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",n[n.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",n[n.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",n[n.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",n[n.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",n[n.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",n[n.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",n[n.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",n[n.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",n[n.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",n[n.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",n[n.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",n[n.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",n[n.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",n[n.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",n[n.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",n[n.LINE_WEBGL=6913]="LINE_WEBGL",n[n.FILL_WEBGL=6914]="FILL_WEBGL",n[n.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",n[n.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",n[n.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",n[n.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",n[n.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",n[n.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",n[n.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",n[n.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",n[n.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",n[n.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",n[n.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",n[n.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",n[n.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",n[n.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",n[n.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",n[n.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",n[n.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",n[n.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",n[n.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",n[n.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",n[n.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",n[n.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",n[n.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",n[n.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(qo||(qo={}));const cy={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Et=(n,e,t)=>e?n.enable(t):n.disable(t),DC=(n,e,t)=>n.hint(t,e),Rn=(n,e,t)=>n.pixelStorei(t,e),NC=(n,e,t)=>{const s=t===36006?36009:36008;return n.bindFramebuffer(s,e)},Nc=(n,e,t)=>{const r={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[t];n.bindBuffer(r,e)};function lm(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}const Z8={3042:Et,32773:(n,e)=>n.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(n,e)=>n.clearColor(...e),3107:(n,e)=>n.colorMask(...e),2884:Et,2885:(n,e)=>n.cullFace(e),2929:Et,2931:(n,e)=>n.clearDepth(e),2932:(n,e)=>n.depthFunc(e),2928:(n,e)=>n.depthRange(...e),2930:(n,e)=>n.depthMask(e),3024:Et,35723:DC,35725:(n,e)=>n.useProgram(e),36007:(n,e)=>n.bindRenderbuffer(36161,e),36389:(n,e)=>{var t;return(t=n.bindTransformFeedback)==null?void 0:t.call(n,36386,e)},34229:(n,e)=>n.bindVertexArray(e),36006:NC,36010:NC,34964:Nc,36662:Nc,36663:Nc,35053:Nc,35055:Nc,2886:(n,e)=>n.frontFace(e),33170:DC,2849:(n,e)=>n.lineWidth(e),32823:Et,32824:"polygonOffset",10752:"polygonOffset",35977:Et,32926:Et,32928:Et,32938:"sampleCoverage",32939:"sampleCoverage",3089:Et,3088:(n,e)=>n.scissor(...e),2960:Et,2961:(n,e)=>n.clearStencil(e),2968:(n,e)=>n.stencilMaskSeparate(1028,e),36005:(n,e)=>n.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(n,e)=>n.viewport(...e),34383:Et,10754:Et,12288:Et,12289:Et,12290:Et,12291:Et,12292:Et,12293:Et,12294:Et,12295:Et,3333:Rn,3317:Rn,37440:Rn,37441:Rn,37443:Rn,3330:Rn,3332:Rn,3331:Rn,3314:Rn,32878:Rn,3316:Rn,3315:Rn,32877:Rn,framebuffer:(n,e)=>{const t=e&&"handle"in e?e.handle:e;return n.bindFramebuffer(36160,t)},blend:(n,e)=>e?n.enable(3042):n.disable(3042),blendColor:(n,e)=>n.blendColor(...e),blendEquation:(n,e)=>{const t=typeof e=="number"?[e,e]:e;n.blendEquationSeparate(...t)},blendFunc:(n,e)=>{const t=(e==null?void 0:e.length)===2?[...e,...e]:e;n.blendFuncSeparate(...t)},clearColor:(n,e)=>n.clearColor(...e),clearDepth:(n,e)=>n.clearDepth(e),clearStencil:(n,e)=>n.clearStencil(e),colorMask:(n,e)=>n.colorMask(...e),cull:(n,e)=>e?n.enable(2884):n.disable(2884),cullFace:(n,e)=>n.cullFace(e),depthTest:(n,e)=>e?n.enable(2929):n.disable(2929),depthFunc:(n,e)=>n.depthFunc(e),depthMask:(n,e)=>n.depthMask(e),depthRange:(n,e)=>n.depthRange(...e),dither:(n,e)=>e?n.enable(3024):n.disable(3024),derivativeHint:(n,e)=>{n.hint(35723,e)},frontFace:(n,e)=>n.frontFace(e),mipmapHint:(n,e)=>n.hint(33170,e),lineWidth:(n,e)=>n.lineWidth(e),polygonOffsetFill:(n,e)=>e?n.enable(32823):n.disable(32823),polygonOffset:(n,e)=>n.polygonOffset(...e),sampleCoverage:(n,e)=>n.sampleCoverage(e[0],e[1]||!1),scissorTest:(n,e)=>e?n.enable(3089):n.disable(3089),scissor:(n,e)=>n.scissor(...e),stencilTest:(n,e)=>e?n.enable(2960):n.disable(2960),stencilMask:(n,e)=>{e=lm(e)?e:[e,e];const[t,s]=e;n.stencilMaskSeparate(1028,t),n.stencilMaskSeparate(1029,s)},stencilFunc:(n,e)=>{e=lm(e)&&e.length===3?[...e,...e]:e;const[t,s,r,i,o,l]=e;n.stencilFuncSeparate(1028,t,s,r),n.stencilFuncSeparate(1029,i,o,l)},stencilOp:(n,e)=>{e=lm(e)&&e.length===3?[...e,...e]:e;const[t,s,r,i,o,l]=e;n.stencilOpSeparate(1028,t,s,r),n.stencilOpSeparate(1029,i,o,l)},viewport:(n,e)=>n.viewport(...e)};function mt(n,e,t){return e[n]!==void 0?e[n]:t[n]}const ek={blendEquation:(n,e,t)=>n.blendEquationSeparate(mt(32777,e,t),mt(34877,e,t)),blendFunc:(n,e,t)=>n.blendFuncSeparate(mt(32969,e,t),mt(32968,e,t),mt(32971,e,t),mt(32970,e,t)),polygonOffset:(n,e,t)=>n.polygonOffset(mt(32824,e,t),mt(10752,e,t)),sampleCoverage:(n,e,t)=>n.sampleCoverage(mt(32938,e,t),mt(32939,e,t)),stencilFuncFront:(n,e,t)=>n.stencilFuncSeparate(1028,mt(2962,e,t),mt(2967,e,t),mt(2963,e,t)),stencilFuncBack:(n,e,t)=>n.stencilFuncSeparate(1029,mt(34816,e,t),mt(36003,e,t),mt(36004,e,t)),stencilOpFront:(n,e,t)=>n.stencilOpSeparate(1028,mt(2964,e,t),mt(2965,e,t),mt(2966,e,t)),stencilOpBack:(n,e,t)=>n.stencilOpSeparate(1029,mt(34817,e,t),mt(34818,e,t),mt(34819,e,t))},FC={enable:(n,e)=>n({[e]:!0}),disable:(n,e)=>n({[e]:!1}),pixelStorei:(n,e,t)=>n({[e]:t}),hint:(n,e,t)=>n({[e]:t}),useProgram:(n,e)=>n({35725:e}),bindRenderbuffer:(n,e,t)=>n({36007:t}),bindTransformFeedback:(n,e,t)=>n({36389:t}),bindVertexArray:(n,e)=>n({34229:e}),bindFramebuffer:(n,e,t)=>{switch(e){case 36160:return n({36006:t,36010:t});case 36009:return n({36006:t});case 36008:return n({36010:t});default:return null}},bindBuffer:(n,e,t)=>{const s={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return s?n({[s]:t}):{valueChanged:!0}},blendColor:(n,e,t,s,r)=>n({32773:new Float32Array([e,t,s,r])}),blendEquation:(n,e)=>n({32777:e,34877:e}),blendEquationSeparate:(n,e,t)=>n({32777:e,34877:t}),blendFunc:(n,e,t)=>n({32969:e,32968:t,32971:e,32970:t}),blendFuncSeparate:(n,e,t,s,r)=>n({32969:e,32968:t,32971:s,32970:r}),clearColor:(n,e,t,s,r)=>n({3106:new Float32Array([e,t,s,r])}),clearDepth:(n,e)=>n({2931:e}),clearStencil:(n,e)=>n({2961:e}),colorMask:(n,e,t,s,r)=>n({3107:[e,t,s,r]}),cullFace:(n,e)=>n({2885:e}),depthFunc:(n,e)=>n({2932:e}),depthRange:(n,e,t)=>n({2928:new Float32Array([e,t])}),depthMask:(n,e)=>n({2930:e}),frontFace:(n,e)=>n({2886:e}),lineWidth:(n,e)=>n({2849:e}),polygonOffset:(n,e,t)=>n({32824:e,10752:t}),sampleCoverage:(n,e,t)=>n({32938:e,32939:t}),scissor:(n,e,t,s,r)=>n({3088:new Int32Array([e,t,s,r])}),stencilMask:(n,e)=>n({2968:e,36005:e}),stencilMaskSeparate:(n,e,t)=>n({[e===1028?2968:36005]:t}),stencilFunc:(n,e,t,s)=>n({2962:e,2967:t,2963:s,34816:e,36003:t,36004:s}),stencilFuncSeparate:(n,e,t,s,r)=>n({[e===1028?2962:34816]:t,[e===1028?2967:36003]:s,[e===1028?2963:36004]:r}),stencilOp:(n,e,t,s)=>n({2964:e,2965:t,2966:s,34817:e,34818:t,34819:s}),stencilOpSeparate:(n,e,t,s,r)=>n({[e===1028?2964:34817]:t,[e===1028?2965:34818]:s,[e===1028?2966:34819]:r}),viewport:(n,e,t,s,r)=>n({2978:[e,t,s,r]})},Os=(n,e)=>n.isEnabled(e),PC={3042:Os,2884:Os,2929:Os,3024:Os,32823:Os,32926:Os,32928:Os,3089:Os,2960:Os,35977:Os},tk=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Ma(n,e){if(sk(e))return;const t={};for(const r in e){const i=Number(r),o=Z8[r];o&&(typeof o=="string"?t[o]=!0:o(n,e[r],i))}const s=n.state&&n.state.cache;if(s)for(const r in t){const i=ek[r];i(n,e,s)}}function P2(n,e=cy){if(typeof e=="number"){const r=e,i=PC[r];return i?i(n,r):n.getParameter(r)}const t=Array.isArray(e)?e:Object.keys(e),s={};for(const r of t){const i=PC[r];s[r]=i?i(n,Number(r)):n.getParameter(Number(r))}return s}function nk(n){Ma(n,cy)}function sk(n){for(const e in n)return!1;return!0}function rk(n,e){if(n===e)return!0;const t=Array.isArray(n)||ArrayBuffer.isView(n),s=Array.isArray(e)||ArrayBuffer.isView(e);if(t&&s&&n.length===e.length){for(let r=0;r<n.length;++r)if(n[r]!==e[r])return!1;return!0}return!1}class Li{constructor(e,t){b(this,"gl");b(this,"program",null);b(this,"stateStack",[]);b(this,"enable",!0);b(this,"cache",null);b(this,"log");b(this,"initialized",!1);this.gl=e,this.log=(t==null?void 0:t.log)||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}static get(e){return e.state}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];Ma(this.gl,e),this.stateStack.pop()}trackState(e,t){if(this.cache=t.copyState?P2(e):Object.assign({},cy),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,ok(e);for(const s in FC){const r=FC[s];ik(e,s,r)}UC(e,"getParameter"),UC(e,"isEnabled")}_updateCache(e){let t=!1,s;const r=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const i in e){const o=e[i],l=this.cache[i];rk(o,l)||(t=!0,s=l,r&&!(i in r)&&(r[i]=l),this.cache[i]=o)}return{valueChanged:t,oldValue:s}}}function UC(n,e){const t=n[e].bind(n);n[e]=function(r){if(r===void 0||tk.has(r))return t(r);const i=Li.get(n);return r in i.cache||(i.cache[r]=t(r)),i.enable?i.cache[r]:t(r)},Object.defineProperty(n[e],"name",{value:`${e}-from-cache`,configurable:!1})}function ik(n,e,t){if(!n[e])return;const s=n[e].bind(n);n[e]=function(...i){const o=Li.get(n),{valueChanged:l,oldValue:f}=t(o._updateCache,...i);return l&&s(...i),f},Object.defineProperty(n[e],"name",{value:`${e}-to-cache`,configurable:!1})}function ok(n){const e=n.useProgram.bind(n);n.useProgram=function(s){const r=Li.get(n);r.program!==s&&(e(s),r.program=s)}}function ak(n,e,t){let s="";const r={preserveDrawingBuffer:!0,...t};let i=null;if(i||(i=n.getContext("webgl2",r)),r.failIfMajorPerformanceCaveat&&(s||(s="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow.")),!i&&!t.failIfMajorPerformanceCaveat&&(r.failIfMajorPerformanceCaveat=!1,i=n.getContext("webgl2",r),i.luma||(i.luma={}),i.luma.softwareRenderer=!0),i||(i=n.getContext("webgl",{}),i&&(i=null,s||(s="Your browser only supports WebGL1"))),!i)throw s||(s="Your browser does not support WebGL"),new Error(`Failed to create WebGL context: ${s}`);const{onContextLost:o,onContextRestored:l}=e;return n.addEventListener("webglcontextlost",f=>o(f),!1),n.addEventListener("webglcontextrestored",f=>l(f),!1),i.luma||(i.luma={}),i}function Aa(n,e,t){return t[e]===void 0&&(t[e]=n.getExtension(e)||null),t[e]}function ck(n,e){const t=n.getParameter(7936),s=n.getParameter(7937);Aa(n,"WEBGL_debug_renderer_info",e);const r=e.WEBGL_debug_renderer_info,i=n.getParameter(r?r.UNMASKED_VENDOR_WEBGL:7936),o=n.getParameter(r?r.UNMASKED_RENDERER_WEBGL:7937),l=i||t,f=o||s,h=n.getParameter(7938),g=U2(l,f),m=lk(l,f),A=uk(l,f);return{type:"webgl",gpu:g,gpuType:A,gpuBackend:m,vendor:l,renderer:f,version:h,shadingLanguage:"glsl",shadingLanguageVersion:300}}function U2(n,e){return/NVIDIA/i.exec(n)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(n)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(n)||/Apple/i.exec(e)?"apple":/AMD/i.exec(n)||/AMD/i.exec(e)||/ATI/i.exec(n)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(n)||/SwiftShader/i.exec(e)?"software":"unknown"}function lk(n,e){return/Metal/i.exec(n)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(n)||/ANGLE/i.exec(e)?"opengl":"unknown"}function uk(n,e){if(/SwiftShader/i.exec(n)||/SwiftShader/i.exec(e))return"cpu";switch(U2(n,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function L2(n){switch(n){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(n))}const Wc="WEBGL_compressed_texture_s3tc",Yc="WEBGL_compressed_texture_s3tc_srgb",Qo="EXT_texture_compression_rgtc",Zo="EXT_texture_compression_bptc",fk="WEBGL_compressed_texture_etc",hk="WEBGL_compressed_texture_astc",dk="WEBGL_compressed_texture_etc1",gk="WEBGL_compressed_texture_pvrtc",pk="WEBGL_compressed_texture_atc",LC="EXT_texture_norm16",kC="EXT_render_snorm",mk="EXT_color_buffer_float",ly={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[kC],"norm16-renderable-webgl":[LC],"snorm16-renderable-webgl":[LC,kC],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Wc,Yc,Qo,Zo],"texture-compression-bc5-webgl":[Qo],"texture-compression-bc7-webgl":[Zo],"texture-compression-etc2":[fk],"texture-compression-astc":[hk],"texture-compression-etc1-webgl":[dk],"texture-compression-pvrtc-webgl":[gk],"texture-compression-atc-webgl":[pk]};function _k(n){return n in ly}function Ak(n,e,t){return(ly[e]||[]).every(r=>Aa(n,r,t))}const uy={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:mk,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Wc},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:Yc},"bc1-rgba-unorm":{gl:33777,x:Wc},"bc1-rgba-unorm-srgb":{gl:35916,x:Yc},"bc2-rgba-unorm":{gl:33778,x:Wc},"bc2-rgba-unorm-srgb":{gl:35918,x:Yc},"bc3-rgba-unorm":{gl:33779,x:Wc},"bc3-rgba-unorm-srgb":{gl:35919,x:Yc},"bc4-r-unorm":{gl:36283,x:Qo},"bc4-r-snorm":{gl:36284,x:Qo},"bc5-rg-unorm":{gl:36285,x:Qo},"bc5-rg-snorm":{gl:36286,x:Qo},"bc6h-rgb-ufloat":{gl:36495,x:Zo},"bc6h-rgb-float":{gl:36494,x:Zo},"bc7-rgba-unorm":{gl:36492,x:Zo},"bc7-rgba-unorm-srgb":{gl:36493,x:Zo},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function yk(n,e,t){let s=e.create;const r=uy[e.format];return(r==null?void 0:r.gl)===void 0&&(s=!1),r!=null&&r.x&&(s=s&&!!Aa(n,r.x,t)),{format:e.format,create:s&&e.create,render:s&&e.render,filter:s&&e.filter,blend:s&&e.blend,store:s&&e.store}}function k2(n){var r;const e=uy[n],t=Ek(n),s=NA(n);return{internalFormat:t,format:(e==null?void 0:e.dataFormat)||Tk(s.channels,s.integer,s.normalized,t),type:s.dataType?L2(s.dataType):((r=e==null?void 0:e.types)==null?void 0:r[0])||5121,compressed:s.compressed||!1}}function bk(n){switch(NA(n).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${n}`)}}function Tk(n,e,t,s){if(s===6408||s===6407)return s;switch(n){case"r":return e&&!t?36244:6403;case"rg":return e&&!t?33320:33319;case"rgb":return e&&!t?36248:6407;case"rgba":return e&&!t?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function Ek(n){const e=uy[n],t=e==null?void 0:e.gl;if(t===void 0)throw new Error(`Unsupported texture format ${n}`);return t}const HC={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class Ck extends SF{constructor(t,s,r){super([],r);b(this,"gl");b(this,"extensions");b(this,"testedFeatures",new Set);this.gl=t,this.extensions=s,Aa(t,"EXT_color_buffer_float",s)}*[Symbol.iterator](){const t=this.getFeatures();for(const s of t)this.has(s)&&(yield s);return[]}has(t){var s;return(s=this.disabledFeatures)!=null&&s[t]?!1:(this.testedFeatures.has(t)||(this.testedFeatures.add(t),_k(t)&&Ak(this.gl,t,this.extensions)&&this.features.add(t),this.getWebGLFeature(t)&&this.features.add(t)),this.features.has(t))}initializeFeatures(){const t=this.getFeatures().filter(s=>s!=="polygon-mode-webgl");for(const s of t)this.has(s)}getFeatures(){return[...Object.keys(HC),...Object.keys(ly)]}getWebGLFeature(t){const s=HC[t];return typeof s=="string"?!!Aa(this.gl,s,this.extensions):!!s}}class vk extends BF{constructor(t){super();b(this,"gl");b(this,"limits",{});this.gl=t}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(t){return this.limits[t]===void 0&&(this.limits[t]=this.gl.getParameter(t)),this.limits[t]||0}}class ol extends rh{constructor(t,s){super(t,s);b(this,"device");b(this,"gl");b(this,"handle");b(this,"colorAttachments",[]);b(this,"depthStencilAttachment",null);const r=s.handle===null;this.device=t,this.gl=t.gl,this.handle=this.props.handle||r?this.props.handle:this.gl.createFramebuffer(),r||(t.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const t=this.gl.bindFramebuffer(36160,this.handle);for(let s=0;s<this.colorAttachments.length;++s){const r=this.colorAttachments[s];if(r){const i=36064+s;this._attachTextureView(i,r)}}if(this.depthStencilAttachment){const s=bk(this.depthStencilAttachment.props.format);this._attachTextureView(s,this.depthStencilAttachment)}if(this.device.props.debug){const s=this.gl.checkFramebufferStatus(36160);if(s!==36053)throw new Error(`Framebuffer ${Sk(s)}`)}this.gl.bindFramebuffer(36160,t)}_attachTextureView(t,s){const{gl:r}=this.device,{texture:i}=s,o=s.props.baseMipLevel,l=s.props.baseArrayLayer;switch(r.bindTexture(i.glTarget,i.handle),i.glTarget){case 35866:case 32879:r.framebufferTextureLayer(36160,t,i.handle,o,l);break;case 34067:const f=Bk(l);r.framebufferTexture2D(36160,t,f,i.handle,o);break;case 3553:r.framebufferTexture2D(36160,t,3553,i.handle,o);break;default:throw new Error("Illegal texture type")}r.bindTexture(i.glTarget,null)}}function Bk(n){return n<34069?n+34069:n}function Sk(n){switch(n){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${n}`}}class wk extends __{constructor(t,s){super(s);b(this,"device");b(this,"format","rgba8unorm");b(this,"depthStencilFormat","depth24plus");b(this,"presentationSize");b(this,"_framebuffer",null);this.device=t,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}get[Symbol.toStringTag](){return"WebGLCanvasContext"}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new ol(this.device,{handle:null}),this._framebuffer}update(){const t=this.getPixelSize();(t[0]!==this.presentationSize[0]||t[1]!==this.presentationSize[1])&&(this.presentationSize=t,this.resize())}resize(t){if(this.device.gl&&this.canvas){const s=this.getDevicePixelRatio(t==null?void 0:t.useDevicePixels);this.setDevicePixelRatio(s,t);return}}commit(){}}async function H2(n,e){const t=document.getElementsByTagName("head")[0];if(!t)throw new Error("loadScript");const s=document.createElement("script");return s.setAttribute("type","text/javascript"),s.setAttribute("src",n),new Promise((r,i)=>{s.onload=r,s.onerror=o=>i(new Error(`Unable to load script '${n}': ${o}`)),t.appendChild(s)})}const Rk=1;let rt=null,GC=!1;const fy={debugSpectorJS:te.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function xk(n){if(!globalThis.SPECTOR)try{await H2(n.debugSpectorJSUrl||fy.debugSpectorJSUrl)}catch(e){te.warn(String(e))}}function Ik(n){var e;if(n={...fy,...n},!n.debugSpectorJS)return null;if(!rt&&globalThis.SPECTOR&&!((e=globalThis.luma)!=null&&e.spector)){te.probe(Rk,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:t}=globalThis.SPECTOR;rt=new t,globalThis.luma&&(globalThis.luma.spector=rt)}if(!rt)return null;if(GC||(GC=!0,rt.spyCanvases(),rt==null||rt.onCaptureStarted.add(t=>te.info("Spector capture started:",t)()),rt==null||rt.onCapture.add(t=>{te.info("Spector capture complete:",t)(),rt==null||rt.getResultUI(),rt==null||rt.resultView.display(),rt==null||rt.resultView.addCapture(t)})),n.gl){const t=n.gl,s=t.device;rt==null||rt.startCapture(n.gl,500),t.device=s,new Promise(r=>setTimeout(r,2e3)).then(r=>{te.info("Spector capture stopped after 2 seconds")(),rt==null||rt.stopCapture()})}return rt}const Mk="https://unpkg.com/webgl-debug@2.0.1/index.js";function G2(n){return n.luma=n.luma||{},n.luma}async function Ok(){zi()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await H2(Mk))}function Dk(n,e={}){return e.debugWebGL||e.traceWebGL?Fk(n,e):Nk(n)}function Nk(n){const e=G2(n);return e.realContext?e.realContext:n}function Fk(n,e){if(!globalThis.WebGLDebugUtils)return te.warn("webgl-debug not loaded")(),n;const t=G2(n);if(t.debugContext)return t.debugContext;globalThis.WebGLDebugUtils.init({...qo,...n});const s=globalThis.WebGLDebugUtils.makeDebugContext(n,Pk.bind(null,e),Uk.bind(null,e));for(const o in qo)!(o in s)&&typeof qo[o]=="number"&&(s[o]=qo[o]);class r{}Object.setPrototypeOf(s,Object.getPrototypeOf(n)),Object.setPrototypeOf(r,s);const i=Object.create(r);return t.realContext=n,t.debugContext=i,i.debug=!0,i}function VC(n,e){e=Array.from(e).map(s=>s===void 0?"undefined":s);let t=globalThis.WebGLDebugUtils.glFunctionArgsToString(n,e);return t=`${t.slice(0,100)}${t.length>100?"...":""}`,`gl.${n}(${t})`}function Pk(n,e,t,s){s=Array.from(s).map(l=>l===void 0?"undefined":l);const r=globalThis.WebGLDebugUtils.glEnumToString(e),i=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,s),o=`${r} in gl.${t}(${i})`;te.error(o)();debugger}function Uk(n,e,t){let s="";te.level>=1&&(s=VC(e,t),n.traceWebGL&&te.log(1,s)());for(const r of t)if(r===void 0){s=s||VC(e,t);debugger}}const um={};function Lk(n="id"){um[n]=um[n]||1;const e=um[n]++;return`${n}-${e}`}class al extends ut{constructor(t,s={}){super(t,s);b(this,"device");b(this,"gl");b(this,"handle");b(this,"glTarget");b(this,"glUsage");b(this,"glIndexType",5123);b(this,"byteLength");b(this,"bytesUsed");this.device=t,this.gl=this.device.gl;const r=typeof s=="object"?s.handle:void 0;this.handle=r||this.gl.createBuffer(),t.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=kk(this.props.usage),this.glUsage=Hk(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,s.data?this._initWithData(s.data,s.byteOffset,s.byteLength):this._initWithByteLength(s.byteLength||0)}_initWithData(t,s=0,r=t.byteLength+s){const i=this.glTarget;this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,this.glUsage),this.gl.bufferSubData(i,s,t),this.gl.bindBuffer(i,null),this.bytesUsed=r,this.byteLength=r,this._setDebugData(t,s,r),this.trackAllocatedMemory(r)}_initWithByteLength(t){let s=t;t===0&&(s=new Float32Array(0));const r=this.glTarget;return this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,s,this.glUsage),this.gl.bindBuffer(r,null),this.bytesUsed=t,this.byteLength=t,this._setDebugData(null,0,t),this.trackAllocatedMemory(t),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(t,s=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,s,t),this.gl.bindBuffer(36663,null),this._setDebugData(t,s,t.byteLength)}async readAsync(t=0,s){return this.readSyncWebGL(t,s)}readSyncWebGL(t=0,s){s=s??this.byteLength-t;const r=new Uint8Array(s),i=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,r,i,s),this.gl.bindBuffer(36662,null),this._setDebugData(r,t,s),r}}function kk(n){return n&ut.INDEX?34963:n&ut.VERTEX?34962:n&ut.UNIFORM?35345:34962}function Hk(n){return n&ut.INDEX||n&ut.VERTEX?35044:n&ut.UNIFORM?35048:35044}function Gk(n){const e=n.split(/\r?\n/),t=[];for(const s of e){if(s.length<=1)continue;const r=s.split(":");if(r.length===2){const[m,A]=r;t.push({message:A.trim(),type:jC(m),lineNum:0,linePos:0});continue}const[i,o,l,...f]=r;let h=parseInt(l,10);isNaN(h)&&(h=0);let g=parseInt(o,10);isNaN(g)&&(g=0),t.push({message:f.join(":").trim(),type:jC(i),lineNum:h,linePos:g})}return t}function jC(n){const e=["warning","error","info"],t=n.toLowerCase();return e.includes(t)?t:"info"}class Vk extends nh{constructor(t,s){super(t,s);b(this,"device");b(this,"handle");switch(this.device=t,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const t=this.device.gl.getShaderInfoLog(this.handle);return t?Gk(t):[]}getTranslatedSource(){const s=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return(s==null?void 0:s.getTranslatedShaderSource(this.handle))||null}async _compile(t){t=t.startsWith("#version ")?t:`#version 300 es
${t}`;const{gl:s}=this.device;if(s.shaderSource(this.handle,t),s.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}te.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),te.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const t=async i=>await new Promise(o=>setTimeout(o,i));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:r}=this.device;for(;;){if(r.getShaderParameter(this.handle,37297))return;await t(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function jk(n,e,t,s){if(Jk(e))return s(n);const r=n;r.pushState();try{return zk(n,e),Ma(r.gl,t),s(n)}finally{r.popState()}}function zk(n,e){const t=n,{gl:s}=t;if(e.cullMode)switch(e.cullMode){case"none":s.disable(2884);break;case"front":s.enable(2884),s.cullFace(1028);break;case"back":s.enable(2884),s.cullFace(1029);break}if(e.frontFace&&s.frontFace(ki("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&n.features.has("depth-clip-control")&&s.enable(34383),e.depthBias!==void 0&&(s.enable(32823),s.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&n.features.has("provoking-vertex-webgl")){const i=t.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,o=ki("provokingVertex",e.provokingVertex,{first:36429,last:36430});i==null||i.provokingVertexWEBGL(o)}if((e.polygonMode||e.polygonOffsetLine)&&n.features.has("polygon-mode-webgl")){if(e.polygonMode){const i=t.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,o=ki("polygonMode",e.polygonMode,{fill:6914,line:6913});i==null||i.polygonModeWEBGL(1028,o),i==null||i.polygonModeWEBGL(1029,o)}e.polygonOffsetLine&&s.enable(10754)}if(n.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&s.enable(12288),e.clipDistance1&&s.enable(12289),e.clipDistance2&&s.enable(12290),e.clipDistance3&&s.enable(12291),e.clipDistance4&&s.enable(12292),e.clipDistance5&&s.enable(12293),e.clipDistance6&&s.enable(12294),e.clipDistance7&&s.enable(12295)),e.depthWriteEnabled!==void 0&&s.depthMask(Xk("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?s.enable(2929):s.disable(2929),s.depthFunc(z_("depthCompare",e.depthCompare))),e.stencilWriteMask){const r=e.stencilWriteMask;s.stencilMaskSeparate(1028,r),s.stencilMaskSeparate(1029,r)}if(e.stencilReadMask&&te.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const r=e.stencilReadMask||4294967295,i=z_("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?s.enable(2960):s.disable(2960),s.stencilFuncSeparate(1028,i,0,r),s.stencilFuncSeparate(1029,i,0,r)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const r=fm("stencilPassOperation",e.stencilPassOperation),i=fm("stencilFailOperation",e.stencilFailOperation),o=fm("stencilDepthFailOperation",e.stencilDepthFailOperation);s.stencilOpSeparate(1028,i,o,r),s.stencilOpSeparate(1029,i,o,r)}switch(e.blend){case!0:s.enable(3042);break;case!1:s.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const r=zC("blendColorOperation",e.blendColorOperation||"add"),i=zC("blendAlphaOperation",e.blendAlphaOperation||"add");s.blendEquationSeparate(r,i);const o=df("blendColorSrcFactor",e.blendColorSrcFactor||"one"),l=df("blendColorDstFactor",e.blendColorDstFactor||"zero"),f=df("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),h=df("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");s.blendFuncSeparate(o,l,f,h)}}function z_(n,e){return ki(n,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function fm(n,e){return ki(n,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function zC(n,e){return ki(n,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function df(n,e){return ki(n,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function $k(n,e){return`Illegal parameter ${e} for ${n}`}function ki(n,e,t){if(!(e in t))throw new Error($k(n,e));return t[e]}function Xk(n,e){return e}function Jk(n){let e=!0;for(const t in n){e=!1;break}return e}function V2(n){const e={};return n.addressModeU&&(e[10242]=hm(n.addressModeU)),n.addressModeV&&(e[10243]=hm(n.addressModeV)),n.addressModeW&&(e[32882]=hm(n.addressModeW)),n.magFilter&&(e[10240]=$_(n.magFilter)),(n.minFilter||n.mipmapFilter)&&(e[10241]=Wk(n.minFilter||"linear",n.mipmapFilter)),n.lodMinClamp!==void 0&&(e[33082]=n.lodMinClamp),n.lodMaxClamp!==void 0&&(e[33083]=n.lodMaxClamp),n.type==="comparison-sampler"&&(e[34892]=34894),n.compare&&(e[34893]=z_("compare",n.compare)),n.maxAnisotropy&&(e[34046]=n.maxAnisotropy),e}function hm(n){switch(n){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function $_(n){switch(n){case"nearest":return 9728;case"linear":return 9729}}function Wk(n,e="none"){if(!e)return $_(n);switch(e){case"none":return $_(n);case"nearest":return n==="nearest"?9984:9986;case"linear":return n==="nearest"?9985:9987}}class X_ extends sh{constructor(t,s){super(t,s);b(this,"device");b(this,"handle");b(this,"parameters");this.device=t,this.parameters=V2(s),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(t){for(const[s,r]of Object.entries(t)){const i=Number(s);switch(i){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,i,r);break;default:this.device.gl.samplerParameteri(this.handle,i,r);break}}}}class ea extends th{constructor(t,s){super(t,{...dt.defaultProps,...s});b(this,"device");b(this,"gl");b(this,"handle");b(this,"texture");this.device=t,this.gl=this.device.gl,this.handle=null,this.texture=s.texture}}const Yk="Failed to deduce GL constant from typed array";function Kk(n){switch(ArrayBuffer.isView(n)?n.constructor:n){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(Yk)}}function qk(n,e){const{clamped:t=!0}=e||{};switch(n){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return t?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function j2(n){switch(n){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function Qk(n){switch(n){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function Ah(n,e,t){if(Zk(e))return t(n);const{nocatch:s=!0}=e,r=Li.get(n);r.push(),Ma(n,e);let i;if(s)i=t(n),r.pop();else try{i=t(n)}finally{r.pop()}return i}function Zk(n){for(const e in n)return!1;return!0}function e9(n,e,t){const{dimension:s,width:r,height:i,depth:o=0}=t,{glInternalFormat:l}=t,f=t.glTarget;switch(s){case"2d-array":case"3d":n.texStorage3D(f,e,l,r,i,o);break;default:n.texStorage2D(f,e,l,r,i)}}function $C(n,e,t,s){const{width:r,height:i}=s,{dimension:o,depth:l=0,mipLevel:f=0}=s,{x:h=0,y:g=0,z:m=0}=s,{glFormat:A,glType:y}=s,E=z2(s.glTarget,o,l),v=s.flipY?{37440:!0}:{};Ah(n,v,()=>{switch(o){case"2d-array":case"3d":n.bindTexture(E,e),n.texSubImage3D(E,f,h,g,m,r,i,l,A,y,t),n.bindTexture(E,null);break;case"2d":case"cube":n.bindTexture(E,e),n.texSubImage2D(E,f,h,g,r,i,A,y,t),n.bindTexture(E,null);break;default:throw new Error(o)}})}function XC(n,e,t){const{dimension:s,width:r,height:i,depth:o=0,mipLevel:l=0,byteOffset:f=0}=t,{x:h=0,y:g=0,z:m=0}=t,{glFormat:A,glType:y,compressed:E}=t,v=z2(t.glTarget,s,o);switch(s){case"2d-array":case"3d":E?n.compressedTexSubImage3D(v,l,h,g,m,r,i,o,A,e,f):n.texSubImage3D(v,l,h,g,m,r,i,o,A,y,e,f);break;case"2d":case"cube":E?n.compressedTexSubImage2D(v,l,h,g,r,i,A,e,f):n.texSubImage2D(v,l,h,g,r,i,A,y,e,f);break;default:throw new Error(s)}}function t9(n){switch(n){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(n)}function z2(n,e,t){return e==="cube"?34069+t:n}function n9(n,e){var x;const{sourceX:t=0,sourceY:s=0,sourceAttachment:r=0}=e||{};let{target:i=null,sourceWidth:o,sourceHeight:l,sourceDepth:f,sourceFormat:h,sourceType:g}=e||{};const{framebuffer:m,deleteFramebuffer:A}=$2(n),{gl:y,handle:E}=m;o||(o=m.width),l||(l=m.height);const v=(x=m.colorAttachments[r])==null?void 0:x.texture;if(!v)throw new Error(`Invalid framebuffer attachment ${r}`);f=(v==null?void 0:v.depth)||1,h||(h=(v==null?void 0:v.glFormat)||6408),g||(g=(v==null?void 0:v.glType)||5121),i=i9(i,g,h,o,l),g=g||Kk(i);const S=y.bindFramebuffer(36160,E);return y.readBuffer(36064+r),y.readPixels(t,s,o,l,h,g,i),y.readBuffer(36064),y.bindFramebuffer(36160,S||null),A&&m.destroy(),i}function s9(n,e){const{target:t,sourceX:s=0,sourceY:r=0,sourceFormat:i=6408,targetByteOffset:o=0}=e||{};let{sourceWidth:l,sourceHeight:f,sourceType:h}=e||{};const{framebuffer:g,deleteFramebuffer:m}=$2(n);l=l||g.width,f=f||g.height;const A=g;h=h||5121;let y=t;if(!y){const v=j2(i),S=Qk(h),x=o+l*f*v*S;y=A.device.createBuffer({byteLength:x})}const E=n.device.createCommandEncoder();return E.copyTextureToBuffer({sourceTexture:n,width:l,height:f,origin:[s,r],destinationBuffer:y,byteOffset:o}),E.destroy(),m&&g.destroy(),y}function $2(n){return n instanceof rh?{framebuffer:n,deleteFramebuffer:!1}:{framebuffer:r9(n),deleteFramebuffer:!0}}function r9(n,e){const{device:t,width:s,height:r,id:i}=n;return t.createFramebuffer({...e,id:`framebuffer-for-${i}`,width:s,height:r,colorAttachments:[n]})}function i9(n,e,t,s,r,i){if(n)return n;e||(e=5121);const o=qk(e,{clamped:!1}),l=j2(t);return new o(s*r*l)}class cl extends dt{constructor(t,s){super(t,s);b(this,"device");b(this,"gl");b(this,"handle");b(this,"sampler");b(this,"view");b(this,"mipmaps");b(this,"compressed");b(this,"glTarget");b(this,"glFormat");b(this,"glType");b(this,"glInternalFormat");b(this,"textureUnit",0);const r={...this.props};r.data=s.data,this.device=t,this.gl=this.device.gl,this.glTarget=t9(this.props.dimension);const i=k2(this.props.format);this.glInternalFormat=i.internalFormat,this.glFormat=i.format,this.glType=i.type,this.compressed=i.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(r),Object.seal(this)}_initialize(t){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:t.data});let{width:s,height:r}=t;if(!s||!r){const i=dt.getTextureDataSize(t.data);s=(i==null?void 0:i.width)||1,r=(i==null?void 0:i.height)||1}if(this.width=s,this.height=r,this.depth=t.depth,this.setSampler(t.sampler),this.view=new ea(this.device,{...this.props,texture:this}),this.bind(),e9(this.gl,this.mipLevels,this),t.data)switch(t.dimension){case"1d":this.setTexture1DData(t.data);break;case"2d":this.setTexture2DData(t.data);break;case"3d":this.setTexture3DData(t.data);break;case"cube":this.setTextureCubeData(t.data);break;case"2d-array":this.setTextureArrayData(t.data);break;case"cube-array":this.setTextureCubeArrayData(t.data);break;default:throw new Error(t.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(t){return new ea(this.device,{...t,texture:this})}setSampler(t={}){let s;t instanceof X_?(this.sampler=t,s=t.props):(this.sampler=new X_(this.device,t),s=t);const r=V2(s);this._setSamplerParameters(r)}generateMipmap(t){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(te.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!(t!=null&&t.force))))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(r){te.warn(`Error generating mipmap for ${this}: ${r.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(t){const s=dt.getExternalImageSize(t.image),r={...dt.defaultCopyExternalImageOptions,...s,...t},{image:i,depth:o,mipLevel:l,x:f,y:h,z:g,flipY:m}=r;let{width:A,height:y}=r;const{dimension:E,glTarget:v,glFormat:S,glInternalFormat:x,glType:O}=this;if(A=Math.min(A,this.width-f),y=Math.min(y,this.height-h),t.sourceX||t.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return $C(this.device.gl,this.handle,i,{dimension:E,mipLevel:l,x:f,y:h,z:g,width:A,height:y,depth:o,glFormat:S,glType:O,glTarget:v,flipY:m}),{width:r.width,height:r.height}}setTexture1DData(t){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(t,s=0){this.bind();const r=dt.normalizeTextureData(t,this);r.length>1&&this.props.mipmaps!==!1&&te.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let i=0;i<r.length;i++){const o=r[i];this._setMipLevel(s,i,o)}this.unbind()}setTexture3DData(t){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(t)&&(this.bind(),XC(this.device.gl,t,this),this.unbind())}setTextureCubeData(t,s=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(const r of dt.CubeFaces)this.setTextureCubeFaceData(t[r],r)}setTextureArrayData(t){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(t){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(t,s,r=0){Array.isArray(t)&&t.length>1&&this.props.mipmaps!==!1&&te.warn(`${this.id} has mipmap and multiple LODs.`)();const i=dt.CubeFaces.indexOf(s);this.setTexture2DData(t,i)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(t){const{face:s,width:r,height:i,pixels:o,data:l,format:f=6408,type:h=5121}=t,{gl:g}=this,m=o||l;this.bind(),m instanceof Promise?m.then(A=>this.setImageDataForFace(Object.assign({},t,{face:s,data:A,pixels:A}))):this.width||this.height?g.texImage2D(s,0,f,r,i,0,f,h,m):g.texImage2D(s,0,f,f,h,m)}_getImageDataMap(t){for(let s=0;s<dt.CubeFaces.length;++s){const r=dt.CubeFaces[s];t[r]&&(t[34069+s]=t[r],delete t[r])}return t}_setSamplerParameters(t){te.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(t))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[s,r]of Object.entries(t)){const i=Number(s),o=r;switch(i){case 33082:case 33083:this.gl.texParameterf(this.glTarget,i,o);break;case 10241:this.gl.texParameteri(this.glTarget,i,o);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,i,o);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,i,o);break;default:this.gl.texParameteri(this.glTarget,i,o);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(t,s,r,i=this.glTarget){if(dt.isExternalImage(r)){$C(this.device.gl,this.handle,r,{...this,depth:t,mipLevel:s,glTarget:i,flipY:this.props.flipY});return}if(dt.isTextureLevelData(r)){XC(this.device.gl,r.data,{...this,depth:t,mipLevel:s,glTarget:i});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(t){const{gl:s}=this;return t!==void 0&&(this.textureUnit=t,s.activeTexture(33984+t)),s.bindTexture(this.glTarget,this.handle),t}unbind(t){const{gl:s}=this;return t!==void 0&&(this.textureUnit=t,s.activeTexture(33984+t)),s.bindTexture(this.glTarget,null),t}}const o9=[1,2,4,8];class a9 extends A_{constructor(t,s){var o;super(t,s);b(this,"device");b(this,"glParameters");this.device=t;let r;if(!((o=s==null?void 0:s.parameters)!=null&&o.viewport))if(s!=null&&s.framebuffer){const{width:l,height:f}=s.framebuffer;r=[0,0,l,f]}else{const[l,f]=t.getCanvasContext().getDrawingBufferSize();r=[0,0,l,f]}this.device.pushState(),this.setParameters({viewport:r,...this.props.parameters});const i=this.props.framebuffer;if(i!=null&&i.handle)if(this.props.framebuffer){const l=this.props.framebuffer.colorAttachments.map((f,h)=>36064+h);this.device.gl.drawBuffers(l)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}setParameters(t={}){const s={...this.glParameters};s.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(s.depthMask=!this.props.depthReadOnly),s.stencilMask=this.props.stencilReadOnly?0:1,s[35977]=this.props.discard,t.viewport&&(t.viewport.length>=6?(s.viewport=t.viewport.slice(0,4),s.depthRange=[t.viewport[4],t.viewport[5]]):s.viewport=t.viewport),t.scissorRect&&(s.scissorTest=!0,s.scissor=t.scissorRect),t.blendConstant&&(s.blendColor=t.blendConstant),t.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),t[2967]=t.stencilReference),t.colorMask&&(s.colorMask=o9.map(r=>!!(r&t.colorMask))),this.glParameters=s,Ma(this.device.gl,s)}beginOcclusionQuery(t){const s=this.props.occlusionQuerySet;s==null||s.beginOcclusionQuery()}endOcclusionQuery(){const t=this.props.occlusionQuerySet;t==null||t.endOcclusionQuery()}clear(){const t={...this.glParameters};let s=0;this.props.clearColors&&this.props.clearColors.forEach((r,i)=>{r&&this.clearColorBuffer(i,r)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(s|=16384,t.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(s|=256,t.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(s|=1024,t.clearStencil=this.props.clearStencil),s!==0&&Ah(this.device.gl,t,()=>{this.device.gl.clear(s)})}clearColorBuffer(t=0,s=[0,0,0,0]){Ah(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(s.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,t,s);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,t,s);break;case Float32Array:this.device.gl.clearBufferfv(6144,t,s);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}function c9(n){return l9.includes(n)}const l9=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],X2={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function J2(n){const e=X2[n];if(!e)throw new Error("uniform");const[t,s,,r]=e;return{format:r,components:s,glType:t}}function u9(n){const e=X2[n];if(!e)throw new Error("attribute");const[,t,,s,r]=e;return{attributeType:s,vertexFormat:r,components:t}}function f9(n,e){const t={attributes:[],bindings:[]};t.attributes=h9(n,e);const s=p9(n,e);for(const l of s){const f=l.uniforms.map(h=>({name:h.name,format:h.format,byteOffset:h.byteOffset,byteStride:h.byteStride,arrayLength:h.arrayLength}));t.bindings.push({type:"uniform",name:l.name,group:0,location:l.location,visibility:(l.vertex?1:0)&(l.fragment?2:0),minBindingSize:l.byteLength,uniforms:f})}const r=g9(n,e);let i=0;for(const l of r)if(c9(l.type)){const{viewDimension:f,sampleType:h}=_9(l.type);t.bindings.push({type:"texture",name:l.name,group:0,location:i,viewDimension:f,sampleType:h}),l.textureUnit=i,i+=1}r.length&&(t.uniforms=r);const o=d9(n,e);return o!=null&&o.length&&(t.varyings=o),t}function h9(n,e){const t=[],s=n.getProgramParameter(e,35721);for(let r=0;r<s;r++){const i=n.getActiveAttrib(e,r);if(!i)throw new Error("activeInfo");const{name:o,type:l}=i,f=n.getAttribLocation(e,o);if(f>=0){const{attributeType:h}=u9(l),g=/instance/i.test(o)?"instance":"vertex";t.push({name:o,location:f,stepMode:g,type:h})}}return t.sort((r,i)=>r.location-i.location),t}function d9(n,e){const t=[],s=n.getProgramParameter(e,35971);for(let r=0;r<s;r++){const i=n.getTransformFeedbackVarying(e,r);if(!i)throw new Error("activeInfo");const{name:o,type:l,size:f}=i,{glType:h,components:g}=J2(l),m={location:r,name:o,type:h,size:f*g};t.push(m)}return t.sort((r,i)=>r.location-i.location),t}function g9(n,e){const t=[],s=n.getProgramParameter(e,35718);for(let r=0;r<s;r++){const i=n.getActiveUniform(e,r);if(!i)throw new Error("activeInfo");const{name:o,size:l,type:f}=i,{name:h,isArray:g}=A9(o);let m=n.getUniformLocation(e,h);const A={location:m,name:h,size:l,type:f,isArray:g};if(t.push(A),A.size>1)for(let y=0;y<A.size;y++){const E=`${h}[${y}]`;m=n.getUniformLocation(e,E);const v={...A,name:E,location:m};t.push(v)}}return t}function p9(n,e){const t=(i,o)=>n.getActiveUniformBlockParameter(e,i,o),s=[],r=n.getProgramParameter(e,35382);for(let i=0;i<r;i++){const o={name:n.getActiveUniformBlockName(e,i)||"",location:t(i,35391),byteLength:t(i,35392),vertex:t(i,35396),fragment:t(i,35398),uniformCount:t(i,35394),uniforms:[]},l=t(i,35395)||[],f=n.getActiveUniforms(e,l,35383),h=n.getActiveUniforms(e,l,35384),g=n.getActiveUniforms(e,l,35387),m=n.getActiveUniforms(e,l,35388);for(let A=0;A<o.uniformCount;++A){const y=n.getActiveUniform(e,l[A]);if(!y)throw new Error("activeInfo");o.uniforms.push({name:y.name,format:J2(f[A]).format,type:f[A],arrayLength:h[A],byteOffset:g[A],byteStride:m[A]})}s.push(o)}return s.sort((i,o)=>i.location-o.location),s}const m9={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function _9(n){const e=m9[n];if(!e)throw new Error("sampler");const[t,s]=e;return{viewDimension:t,sampleType:s}}function A9(n){if(n[n.length-1]!=="]")return{name:n,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(n);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${n}`);return{name:t[1],length:t[2]?1:0,isArray:!!t[2]}}function y9(n,e,t,s){const r=n;let i=s;i===!0&&(i=1),i===!1&&(i=0);const o=typeof i=="number"?[i]:i;switch(t){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof s!="number")throw new Error("samplers must be set to integers");return n.uniform1i(e,s);case 5126:return n.uniform1fv(e,o);case 35664:return n.uniform2fv(e,o);case 35665:return n.uniform3fv(e,o);case 35666:return n.uniform4fv(e,o);case 5124:return n.uniform1iv(e,o);case 35667:return n.uniform2iv(e,o);case 35668:return n.uniform3iv(e,o);case 35669:return n.uniform4iv(e,o);case 35670:return n.uniform1iv(e,o);case 35671:return n.uniform2iv(e,o);case 35672:return n.uniform3iv(e,o);case 35673:return n.uniform4iv(e,o);case 5125:return r.uniform1uiv(e,o,1);case 36294:return r.uniform2uiv(e,o,2);case 36295:return r.uniform3uiv(e,o,3);case 36296:return r.uniform4uiv(e,o,4);case 35674:return n.uniformMatrix2fv(e,!1,o);case 35675:return n.uniformMatrix3fv(e,!1,o);case 35676:return n.uniformMatrix4fv(e,!1,o);case 35685:return r.uniformMatrix2x3fv(e,!1,o);case 35686:return r.uniformMatrix2x4fv(e,!1,o);case 35687:return r.uniformMatrix3x2fv(e,!1,o);case 35688:return r.uniformMatrix3x4fv(e,!1,o);case 35689:return r.uniformMatrix4x2fv(e,!1,o);case 35690:return r.uniformMatrix4x3fv(e,!1,o)}throw new Error("Illegal uniform")}function b9(n){return S2(n)!==null||typeof n=="number"||typeof n=="boolean"}function T9(n){const e={bindings:{},uniforms:{}};return Object.keys(n).forEach(t=>{const s=n[t];b9(s)?e.uniforms[t]=s:e.bindings[t]=s}),e}function E9(n){switch(n){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(n)}}function C9(n){switch(n){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(n)}}const JC=4;class v9 extends ha{constructor(t,s){super(t,s);b(this,"device");b(this,"handle");b(this,"vs");b(this,"fs");b(this,"introspectedLayout");b(this,"uniforms",{});b(this,"bindings",{});b(this,"varyings",null);b(this,"_uniformCount",0);b(this,"_uniformSetters",{});this.device=t,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=s.vs,this.fs=s.fs;const{varyings:r,bufferMode:i=35981}=s;r&&r.length>0&&(this.varyings=r,this.device.gl.transformFeedbackVaryings(this.handle,r,i)),this._linkShaders(),te.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=f9(this.device.gl,this.handle),te.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=B9(this.introspectedLayout,s.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(t,s){for(const[r,i]of Object.entries(t)){const o=this.shaderLayout.bindings.find(l=>l.name===r)||this.shaderLayout.bindings.find(l=>l.name===`${r}Uniforms`);if(!o){const l=this.shaderLayout.bindings.map(f=>`"${f.name}"`).join(", ");s!=null&&s.disableWarnings||te.warn(`No binding "${r}" in render pipeline "${this.id}", expected one of ${l}`,i)();continue}switch(i||te.warn(`Unsetting binding "${r}" in render pipeline "${this.id}"`)(),o.type){case"uniform":if(!(i instanceof al)&&!(i.buffer instanceof al))throw new Error("buffer value");break;case"texture":if(!(i instanceof ea||i instanceof cl||i instanceof ol))throw new Error("texture value");break;case"sampler":te.warn(`Ignoring sampler ${r}`)();break;default:throw new Error(o.type)}this.bindings[r]=i}}draw(t){var S;const{renderPass:s,parameters:r=this.props.parameters,topology:i=this.props.topology,vertexArray:o,vertexCount:l,instanceCount:f,isInstanced:h=!1,firstVertex:g=0,transformFeedback:m}=t,A=E9(i),y=!!o.indexBuffer,E=(S=o.indexBuffer)==null?void 0:S.glIndexType;if(this.linkStatus!=="success")return te.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return te.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),o.bindBeforeRender(s),m&&m.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const v=s;return jk(this.device,r,v.glParameters,()=>{y&&h?this.device.gl.drawElementsInstanced(A,l||0,E,g,f||0):y?this.device.gl.drawElements(A,l||0,E,g):h?this.device.gl.drawArraysInstanced(A,g,l||0,f||0):this.device.gl.drawArrays(A,g,l||0),m&&m.end()}),o.unbindAfterRender(s),!0}setUniformsWebGL(t){const{bindings:s}=T9(t);Object.keys(s).forEach(r=>{te.warn(`Unsupported value "${JSON.stringify(s[r])}" used in setUniforms() for key ${r}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,t)}async _linkShaders(){const{gl:t}=this.device;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),te.time(JC,`linkProgram for ${this.id}`)(),t.linkProgram(this.handle),te.timeEnd(JC,`linkProgram for ${this.id}`)(),te.level,!this.device.features.has("compilation-status-async-webgl")){const r=this._getLinkStatus();this._reportLinkStatus(r);return}te.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),te.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const s=this._getLinkStatus();this._reportLinkStatus(s)}async _reportLinkStatus(t){var s;switch(t){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break}switch((s=this.fs)==null?void 0:s.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break}const r=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${t}: ${r}`)}}_getLinkStatus(){const{gl:t}=this.device;return t.getProgramParameter(this.handle,35714)?(t.validateProgram(this.handle),t.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const t=async i=>await new Promise(o=>setTimeout(o,i));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:r}=this.device;for(;;){if(r.getProgramParameter(this.handle,37297))return;await t(10)}}_areTexturesRenderable(){let t=!0;for(const s of this.shaderLayout.bindings)!this.bindings[s.name]&&!this.bindings[s.name.replace(/Uniforms$/,"")]&&(te.warn(`Binding ${s.name} not found in ${this.id}`)(),t=!1);return t}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:t}=this.device;t.useProgram(this.handle);let s=0,r=0;for(const i of this.shaderLayout.bindings){const o=this.bindings[i.name]||this.bindings[i.name.replace(/Uniforms$/,"")];if(!o)throw new Error(`No value for binding ${i.name} in ${this.id}`);switch(i.type){case"uniform":const{name:l}=i,f=t.getUniformBlockIndex(this.handle,l);if(f===4294967295)throw new Error(`Invalid uniform block name ${l}`);t.uniformBlockBinding(this.handle,r,f),o instanceof al?t.bindBufferBase(35345,r,o.handle):t.bindBufferRange(35345,r,o.buffer.handle,o.offset||0,o.size||o.buffer.byteLength-o.offset),r+=1;break;case"texture":if(!(o instanceof ea||o instanceof cl||o instanceof ol))throw new Error("texture");let h;if(o instanceof ea)h=o.texture;else if(o instanceof cl)h=o;else if(o instanceof ol&&o.colorAttachments[0]instanceof ea)te.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),h=o.colorAttachments[0].texture;else throw new Error("No texture");t.activeTexture(33984+s),t.bindTexture(h.glTarget,h.handle),s+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${i.type}' not supported in WebGL`)}}}_applyUniforms(){for(const t of this.shaderLayout.uniforms||[]){const{name:s,location:r,type:i,textureUnit:o}=t,l=this.uniforms[s]??o;l!==void 0&&y9(this.device.gl,r,i,l)}}}function B9(n,e){const t={...n,attributes:n.attributes.map(s=>({...s}))};for(const s of(e==null?void 0:e.attributes)||[]){const r=t.attributes.find(i=>i.name===s.name);r?(r.type=s.type||r.type,r.stepMode=s.stepMode||r.stepMode):te.warn(`shader layout attribute ${s.name} not present in shader`)}return t}class S9 extends b_{constructor(t){super(t,{});b(this,"device");b(this,"commands",[]);this.device=t}submitCommands(t=this.commands){for(const s of t)switch(s.name){case"copy-buffer-to-buffer":w9(this.device,s.options);break;case"copy-buffer-to-texture":R9(this.device,s.options);break;case"copy-texture-to-buffer":x9(this.device,s.options);break;case"copy-texture-to-texture":I9(this.device,s.options);break;default:throw new Error(s.name)}}}function w9(n,e){const t=e.sourceBuffer,s=e.destinationBuffer;n.gl.bindBuffer(36662,t.handle),n.gl.bindBuffer(36663,s.handle),n.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),n.gl.bindBuffer(36662,null),n.gl.bindBuffer(36663,null)}function R9(n,e){throw new Error("Not implemented")}function x9(n,e){const{sourceTexture:t,mipLevel:s=0,aspect:r="all",width:i=e.sourceTexture.width,height:o=e.sourceTexture.height,depthOrArrayLayers:l=0,origin:f=[0,0],destinationBuffer:h,byteOffset:g=0,bytesPerRow:m,rowsPerImage:A}=e;if(r!=="all")throw new Error("aspect not supported in WebGL");if(s!==0||l!==0||m||A)throw new Error("not implemented");const{framebuffer:y,destroyFramebuffer:E}=W2(t);let v;try{const S=h,x=i||y.width,O=o||y.height,R=k2(y.colorAttachments[0].texture.props.format),D=R.format,z=R.type;n.gl.bindBuffer(35051,S.handle),v=n.gl.bindFramebuffer(36160,y.handle),n.gl.readPixels(f[0],f[1],x,O,D,z,g)}finally{n.gl.bindBuffer(35051,null),v!==void 0&&n.gl.bindFramebuffer(36160,v),E&&y.destroy()}}function I9(n,e){const{sourceTexture:t,destinationMipLevel:s=0,origin:r=[0,0],destinationOrigin:i=[0,0],destinationTexture:o}=e;let{width:l=e.destinationTexture.width,height:f=e.destinationTexture.height}=e;const{framebuffer:h,destroyFramebuffer:g}=W2(t),[m,A]=r,[y,E,v]=i,S=n.gl.bindFramebuffer(36160,h.handle);let x=null,O;if(o instanceof cl)x=o,l=Number.isFinite(l)?l:x.width,f=Number.isFinite(f)?f:x.height,x.bind(0),O=x.glTarget;else throw new Error("invalid destination");switch(O){case 3553:case 34067:n.gl.copyTexSubImage2D(O,s,y,E,m,A,l,f);break;case 35866:case 32879:n.gl.copyTexSubImage3D(O,s,y,E,v,m,A,l,f);break}x&&x.unbind(),n.gl.bindFramebuffer(36160,S),g&&h.destroy()}function W2(n){if(n instanceof dt){const{width:e,height:t,id:s}=n;return{framebuffer:n.device.createFramebuffer({id:`framebuffer-for-${s}`,width:e,height:t,colorAttachments:[n]}),destroyFramebuffer:!0}}return{framebuffer:n,destroyFramebuffer:!1}}class M9 extends y_{constructor(t,s){super(t,s);b(this,"device");b(this,"commandBuffer");this.device=t,this.commandBuffer=new S9(t)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(t){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:t})}copyBufferToTexture(t){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:t})}copyTextureToBuffer(t){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:t})}copyTextureToTexture(t){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:t})}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}resolveQuerySet(t,s,r){}}function O9(n){const{target:e,source:t,start:s=0,count:r=1}=n,i=t.length,o=r*i;let l=0;for(let f=s;l<i;l++)e[f++]=t[l];for(;l<o;)l<o-l?(e.copyWithin(s+l,s,s+l),l*=2):(e.copyWithin(s+l,s,s+o-l),l=o);return n.target}class hy extends T_{constructor(t,s){super(t,s);b(this,"device");b(this,"handle");b(this,"buffer",null);b(this,"bufferValue",null);this.device=t,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(t){return XM()==="Chrome"}destroy(){var t;super.destroy(),this.buffer&&((t=this.buffer)==null||t.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(t){const s=t;if(s&&s.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,s?s.handle:null),this.indexBuffer=s,this.device.gl.bindVertexArray(null)}setBuffer(t,s){const r=s;if(r.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:i,type:o,stride:l,offset:f,normalized:h,integer:g,divisor:m}=this._getAccessor(t);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,r.handle),g?this.device.gl.vertexAttribIPointer(t,i,o,l,f):this.device.gl.vertexAttribPointer(t,i,o,h,l,f),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(t),this.device.gl.vertexAttribDivisor(t,m||0),this.attributes[t]=r,this.device.gl.bindVertexArray(null)}setConstantWebGL(t,s){this._enable(t,!1),this.attributes[t]=s}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let t=0;t<this.maxVertexAttributes;++t){const s=this.attributes[t];ArrayBuffer.isView(s)&&this.device.setConstantAttributeWebGL(t,s)}}_getAccessor(t){const s=this.attributeInfos[t];if(!s)throw new Error(`Unknown attribute location ${t}`);const r=L2(s.bufferDataType);return{size:s.bufferComponents,type:r,stride:s.byteStride,offset:s.byteOffset,normalized:s.normalized,integer:s.integer,divisor:s.stepMode==="instance"?1:0}}_enable(t,s=!0){const i=hy.isConstantAttributeZeroSupported(this.device)||t!==0;(s||i)&&(t=Number(t),this.device.gl.bindVertexArray(this.handle),s?this.device.gl.enableVertexAttribArray(t):this.device.gl.disableVertexAttribArray(t),this.device.gl.bindVertexArray(null))}getConstantBuffer(t,s){const r=D9(s),i=r.byteLength*t,o=r.length*t;if(this.buffer&&i!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${i} !== ${this.buffer.byteLength}.`);let l=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:i}),l=l||!N9(r,this.bufferValue),l){const f=tP(s.constructor,o);O9({target:f,source:r,start:0,count:o}),this.buffer.write(f),this.bufferValue=s}return this.buffer}}function D9(n){return Array.isArray(n)?new Float32Array(n):n}function N9(n,e){if(!n||!e||n.length!==e.length||n.constructor!==e.constructor)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}class F9 extends E_{constructor(t,s){super(t,s);b(this,"device");b(this,"gl");b(this,"handle");b(this,"layout");b(this,"buffers",{});b(this,"unusedBuffers",{});b(this,"bindOnUse",!0);b(this,"_bound",!1);this.device=t,this.gl=t.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,s.buffers&&this.setBuffers(s.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(t="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(C9(t))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(t){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const s in t)this.setBuffer(s,t[s])})}setBuffer(t,s){const r=this._getVaryingIndex(t),{buffer:i,byteLength:o,byteOffset:l}=this._getBufferRange(s);if(r<0){this.unusedBuffers[t]=i,te.warn(`${this.id} unusedBuffers varying buffer ${t}`)();return}this.buffers[r]={buffer:i,byteLength:o,byteOffset:l},this.bindOnUse||this._bindBuffer(r,i,l,o)}getBuffer(t){if(WC(t))return this.buffers[t]||null;const s=this._getVaryingIndex(t);return s>=0?this.buffers[s]:null}bind(t=this.handle){if(typeof t!="function")return this.gl.bindTransformFeedback(36386,t),this;let s;return this._bound?s=t():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,s=t(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),s}unbind(){this.bind(null)}_getBufferRange(t){if(t instanceof al)return{buffer:t,byteOffset:0,byteLength:t.byteLength};const{buffer:s,byteOffset:r=0,byteLength:i=t.buffer.byteLength}=t;return{buffer:s,byteOffset:r,byteLength:i}}_getVaryingIndex(t){if(WC(t))return Number(t);for(const s of this.layout.varyings)if(t===s.name)return s.location;return-1}_bindBuffers(){for(const t in this.buffers){const{buffer:s,byteLength:r,byteOffset:i}=this._getBufferRange(this.buffers[t]);this._bindBuffer(Number(t),s,i,r)}}_unbindBuffers(){for(const t in this.buffers)this.gl.bindBufferBase(35982,Number(t),null)}_bindBuffer(t,s,r=0,i){const o=s&&s.handle;!o||i===void 0?this.gl.bindBufferBase(35982,t,o):this.gl.bindBufferRange(35982,t,o,r,i)}}function WC(n){return typeof n=="number"?Number.isInteger(n):/^\d+$/.test(n)}class P9 extends C_{constructor(t,s){super(t,s);b(this,"device");b(this,"handle");b(this,"target",null);b(this,"_queryPending",!1);b(this,"_pollingPromise",null);if(this.device=t,s.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(t){return this._begin(t!=null&&t.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(t){this._queryPending||(this.target=t,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const t=this.device.gl.getQueryParameter(this.handle,34919);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(t=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let s=0;return this._pollingPromise=new Promise((r,i)=>{const o=()=>{this.isResultAvailable()?(r(this.getResult()),this._pollingPromise=null):s++>t?(i("Timed out"),this._pollingPromise=null):requestAnimationFrame(o)};requestAnimationFrame(o)}),this._pollingPromise}}class ta extends ei{constructor(t){var m,A;super({...t,id:t.id||Lk("webgl-device")});b(this,"type","webgl");b(this,"handle");b(this,"features");b(this,"limits");b(this,"info");b(this,"canvasContext");b(this,"lost");b(this,"_resolveContextLost");b(this,"gl");b(this,"debug",!1);b(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});b(this,"_extensions",{});b(this,"_polyfilled",!1);b(this,"spectorJS");b(this,"renderPass",null);b(this,"_constants");const s=ei._getCanvasContextProps(t);if(!s)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let r=(A=(m=s.canvas)==null?void 0:m.gl)==null?void 0:A.device;if(r)throw new Error(`WebGL context already attached to device ${r.id}`);this.canvasContext=new wk(this,s),this.lost=new Promise(y=>{this._resolveContextLost=y});const i={...t.webgl};s.alphaMode==="premultiplied"&&(i.premultipliedAlpha=!0),t.powerPreference!==void 0&&(i.powerPreference=t.powerPreference);const l=this.props._handle||ak(this.canvasContext.canvas,{onContextLost:y=>{var E;return(E=this._resolveContextLost)==null?void 0:E.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})},onContextRestored:y=>console.log("WebGL context restored")},i);if(!l)throw new Error("WebGL context creation failed");if(r=l.device,r){if(t._reuseDevices)return te.log(1,`Not creating a new Device, instead returning a reference to Device ${r.id} already attached to WebGL context`,r)(),r._reused=!0,r;throw new Error(`WebGL context already attached to device ${r.id}`)}this.handle=l,this.gl=l,this.spectorJS=Ik({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=ck(this.gl,this._extensions),this.limits=new vk(this.gl),this.features=new Ck(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),s.autoResize!==!1&&this.canvasContext.resize(),new Li(this.gl,{log:(...y)=>te.log(1,...y)()}).trackState(this.gl,{copyState:!1});const h=t.debugWebGL||t.debug,g=t.debugWebGL;h&&(this.gl=Dk(this.gl,{debugWebGL:h,traceWebGL:g}),te.warn("WebGL debug mode activated. Performance reduced.")(),t.debugWebGL&&(te.level=Math.max(te.level,1)))}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(t){throw new Error("WebGL only supports a single canvas")}createBuffer(t){const s=this._normalizeBufferProps(t);return new al(this,s)}createTexture(t){return new cl(this,t)}createExternalTexture(t){throw new Error("createExternalTexture() not implemented")}createSampler(t){return new X_(this,t)}createShader(t){return new Vk(this,t)}createFramebuffer(t){return new ol(this,t)}createVertexArray(t){return new hy(this,t)}createTransformFeedback(t){return new F9(this,t)}createQuerySet(t){return new P9(this,t)}createRenderPipeline(t){return new v9(this,t)}beginRenderPass(t){return new a9(this,t)}createComputePipeline(t){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(t){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(t={}){return new M9(this,t)}submit(){var t;(t=this.renderPass)==null||t.end(),this.renderPass=null}readPixelsToArrayWebGL(t,s){return n9(t,s)}readPixelsToBufferWebGL(t,s){return s9(t,s)}setParametersWebGL(t){Ma(this.gl,t)}getParametersWebGL(t){return P2(this.gl,t)}withParametersWebGL(t,s){return Ah(this.gl,t,s)}resetWebGL(){te.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),nk(this.gl)}_getDeviceSpecificTextureFormatCapabilities(t){return yk(this.gl,t,this._extensions)}loseDevice(){var i;let t=!1;const r=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return r&&(t=!0,r.loseContext()),(i=this._resolveContextLost)==null||i.call(this,{reason:"destroyed",message:"Application triggered context loss"}),t}pushState(){Li.get(this.gl).push()}popState(){Li.get(this.gl).pop()}setSpectorMetadata(t,s){t.__SPECTOR_Metadata=s}getGLKey(t,s){const r=Number(t);for(const i in this.gl)if(this.gl[i]===r)return`GL.${i}`;return s!=null&&s.emptyIfUnknown?"":String(t)}getGLKeys(t){const s={emptyIfUnknown:!0};return Object.entries(t).reduce((r,[i,o])=>(r[`${i}:${this.getGLKey(i,s)}`]=`${o}:${this.getGLKey(o,s)}`,r),{})}setConstantAttributeWebGL(t,s){const r=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(r).fill(null);const i=this._constants[t];switch(i&&H9(i,s)&&te.info(1,`setConstantAttributeWebGL(${t}) could have been skipped, value unchanged`)(),this._constants[t]=s,s.constructor){case Float32Array:U9(this,t,s);break;case Int32Array:L9(this,t,s);break;case Uint32Array:k9(this,t,s);break;default:throw new Error("constant")}}getExtension(t){return Aa(this.gl,t,this._extensions),this._extensions}}function U9(n,e,t){switch(t.length){case 1:n.gl.vertexAttrib1fv(e,t);break;case 2:n.gl.vertexAttrib2fv(e,t);break;case 3:n.gl.vertexAttrib3fv(e,t);break;case 4:n.gl.vertexAttrib4fv(e,t);break}}function L9(n,e,t){n.gl.vertexAttribI4iv(e,t)}function k9(n,e,t){n.gl.vertexAttribI4uiv(e,t)}function H9(n,e){if(!n||!e||n.length!==e.length||n.constructor!==e.constructor)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}const G9={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},V9=n=>({drawBuffersWEBGL(e){return n.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),j9=n=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return n.createVertexArray()},deleteVertexArrayOES(e){return n.deleteVertexArray(e)},isVertexArrayOES(e){return n.isVertexArray(e)},bindVertexArrayOES(e){return n.bindVertexArray(e)}}),z9=n=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return n.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return n.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return n.vertexAttribDivisor(...e)}});function $9(n=!0){const e=HTMLCanvasElement.prototype;if(!n&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(t,s){if(t==="webgl"||t==="experimental-webgl"){const r=this.originalGetContext("webgl2",s);return r instanceof HTMLElement&&X9(r),r}return this.originalGetContext(t,s)}}function X9(n){n.getExtension("EXT_color_buffer_float");const e={...G9,WEBGL_disjoint_timer_query:n.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:V9(n),OES_vertex_array_object:j9(n),ANGLE_instanced_arrays:z9(n)},t=n.getExtension;n.getExtension=function(r){const i=t.call(n,r);return i||(r in e?e[r]:null)};const s=n.getSupportedExtensions;n.getSupportedExtensions=function(){const r=s.apply(n)||[];return r==null?void 0:r.concat(Object.keys(e))}}const gf=1;class J9 extends MF{constructor(){super();b(this,"type","webgl");ei.defaultProps={...ei.defaultProps,...fy},ta.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(t){$9(t)}async attach(t){if(t instanceof ta)return t;if((t==null?void 0:t.device)instanceof ei)return t.device;if(!W9(t))throw new Error("Invalid WebGL2RenderingContext");return new ta({_handle:t,createCanvasContext:{canvas:t.canvas,autoResize:!1}})}async create(t={}){te.groupCollapsed(gf,"WebGLDevice created")();const s=[];(t.debugWebGL||t.debug)&&s.push(Ok()),t.debugSpectorJS&&s.push(xk(t));const r=await Promise.allSettled(s);for(const l of r)l.status==="rejected"&&te.error(`Failed to initialize debug libraries ${l.reason}`)();const i=new ta(t),o=`${i._reused?"Reusing":"Created"} device with WebGL2 ${i.debug?"debug ":""}context: ${i.info.vendor}, ${i.info.renderer} for canvas: ${i.canvasContext.id}`;return te.probe(gf,o)(),te.table(gf,i.info)(),te.groupEnd(gf)(),i}}function W9(n){return typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext?!0:!!(n&&Number.isFinite(n._version))}const YC=new J9;function $r(){}const Y9=({isDragging:n})=>n?"grabbing":"grab",Y2={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:$r,onWebGLInitialized:$r,onResize:$r,onViewStateChange:$r,onInteractionStateChange:$r,onBeforeRender:$r,onAfterRender:$r,onLoad:$r,onError:n=>Ve.error(n.message,n.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:Y9,getTooltip:null,debug:!1,drawPickingColors:!1};class Tl{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new wa({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=s=>{const{_pickRequest:r}=this;if(s.type==="pointerleave")r.x=-1,r.y=-1,r.radius=0;else{if(s.leftButton||s.rightButton)return;{const i=s.offsetCenter;if(!i)return;r.x=i.x,r.y=i.y,r.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:r.x,y:r.y}),r.event=s},this._onEvent=s=>{const r=N_[s.type],i=s.offsetCenter;if(!r||!i||!this.layerManager)return;const o=this.layerManager.getLayers(),l=this.deckPicker.getLastPickedObject({x:i.x,y:i.y,layers:o,viewports:this.getViewports(i)},this._lastPointerDownInfo),{layer:f}=l,h=f&&(f[r]||f.props[r]),g=this.props[r];let m=!1;h&&(m=h.call(f,l,s)),m||(g==null||g(l,s),this.widgetManager.onEvent(l,s))},this._onPointerDown=s=>{var o;if(((o=this.device)==null?void 0:o.type)==="webgpu")return;const r=s.offsetCenter,i=this._pick("pickObject","pickObject Time",{x:r.x,y:r.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=i.result[0]||i.emptyInfo},this.props={...Y2,...e},e=this.props,e.viewState&&e.initialViewState&&Ve.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let t=this.device;!t&&e.gl&&(e.gl instanceof WebGLRenderingContext&&Ve.error("WebGL1 context not supported.")(),t=YC.attach(e.gl)),t||(t=m_.createDevice({type:"best-available",_reuseDevices:!0,adapters:[YC],...e.deviceProps,createCanvasContext:{canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(t,e),this.setProps(e),e._typedArrayManagerProps&&yl.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,t,s,r,i,o,l,f,h,g;(e=this.animationLoop)==null||e.stop(),(t=this.animationLoop)==null||t.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(s=this.layerManager)==null||s.finalize(),this.layerManager=null,(r=this.viewManager)==null||r.finalize(),this.viewManager=null,(i=this.effectManager)==null||i.finalize(),this.effectManager=null,(o=this.deckRenderer)==null||o.finalize(),this.deckRenderer=null,(l=this.deckPicker)==null||l.finalize(),this.deckPicker=null,(f=this.eventManager)==null||f.destroy(),this.eventManager=null,(h=this.widgetManager)==null||h.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((g=this.canvas.parentElement)==null||g.removeChild(this.canvas),this.canvas=null)}setProps(e){var s;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&Ve.removed("onLayerHover","onHover")(),"onLayerClick"in e&&Ve.removed("onLayerClick","onClick")(),e.initialViewState&&!As(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(s=this.animationLoop)==null||s.setProps(t),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t),this.widgetManager.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const s=this.viewManager.needsRedraw(e),r=this.layerManager.needsRedraw(e),i=this.effectManager.needsRedraw(e),o=this.deckRenderer.needsRedraw(e);return t=t||s||r||i||o,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return this.viewManager!==null}getViews(){return Mt(this.viewManager),this.viewManager.views}getViewports(e){return Mt(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(const s in e)this.layerManager.resourceManager.add({resourceId:s,data:e[s],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var t;(t=this.layerManager)==null||t.removeDefaultShaderModule(e)}_pick(e,t,s){Mt(this.deckPicker);const{stats:r}=this;r.get("Pick Count").incrementCount(),r.get(t).timeStart();const i=this.deckPicker[e]({layers:this.layerManager.getLayers(s),views:this.viewManager.getViews(),viewports:this.getViewports(s),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...s});return r.get(t).timeEnd(),i}_createCanvas(e){let t=e.canvas;return typeof t=="string"&&(t=document.getElementById(t),Mt(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){var r;if(!this.canvas)return;const{width:t,height:s}=e;if(t||t===0){const i=Number.isFinite(t)?`${t}px`:t;this.canvas.style.width=i}if(s||s===0){const i=Number.isFinite(s)?`${s}px`:s;this.canvas.style.position=((r=e.style)==null?void 0:r.position)||"absolute",this.canvas.style.height=i}}_updateCanvasSize(){var r,i;const{canvas:e}=this;if(!e)return;const t=e.clientWidth??e.width,s=e.clientHeight??e.height;(t!==this.width||s!==this.height)&&(this.width=t,this.height=s,(r=this.viewManager)==null||r.setProps({width:t,height:s}),(i=this.layerManager)==null||i.activateViewport(this.getViewports()[0]),this.props.onResize({width:t,height:s}))}_createAnimationLoop(e,t){const{gl:s,onError:r,useDevicePixels:i}=t;return new e8({device:e,useDevicePixels:i,autoResizeDrawingBuffer:!s,autoResizeViewport:!1,onInitialize:o=>this._setDevice(o.device),onRender:this._onRenderFrame.bind(this),onError:r})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,t=Array.isArray(e)?e:e?[e]:[new ay({id:"default-view"})];return t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var t,s,r,i;if(((t=this.device)==null?void 0:t.type)==="webgpu")return;const{_pickRequest:e}=this;if(e.event){const{result:o,emptyInfo:l}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=o.length>0;let f=l,h=!1;for(const g of o)f=g,h=((s=g.layer)==null?void 0:s.onHover(g,e.event))||h;h||((i=(r=this.props).onHover)==null||i.call(r,f,e.event),this.widgetManager.onHover(f,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var r,i;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(r=this.device.canvasContext)==null?void 0:r.canvas),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const t=new B2;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new x4(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(mC).map(o=>{var y;const[l,f,h,g]=mC[o],m=(y=this.props.eventRecognizerOptions)==null?void 0:y[o],A={...f,...m,event:o};return{recognizer:new l(A),recognizeWith:h,requestFailure:g}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const o in N_)this.eventManager.on(o,this._onEvent);this.viewManager=new v8({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const s=this.viewManager.getViewports()[0];this.layerManager=new C8(this.device,{deck:this,stats:this.stats,viewport:s,timeline:t}),this.effectManager=new L8({deck:this,device:this.device}),this.deckRenderer=new G8(this.device),this.deckPicker=new J8(this.device),this.widgetManager=new K8({deck:this,parentElement:(i=this.canvas)==null?void 0:i.parentElement}),this.widgetManager.addDefault(new Q8),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){var o;const{device:s,gl:r}=this.layerManager.context;this.props.onBeforeRender({device:s,gl:r});const i={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t};(o=this.deckRenderer)==null||o.renderLayers(i),i.pass==="screen"&&this.widgetManager.onRedraw({viewports:i.viewports,layers:i.layers}),this.props.onAfterRender({device:s,gl:r})}_onRenderFrame(){var e;this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Ve.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),((e=this.device)==null?void 0:e.type)!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const s=m_.stats.get("Memory Usage");e.bufferMemory=s.get("Buffer Memory").count,e.textureMemory=s.get("Texture Memory").count,e.renderbufferMemory=s.get("Renderbuffer Memory").count,e.gpuMemory=s.get("GPU Memory").count}}Tl.defaultProps=Y2;Tl.VERSION=PN;function K9(n){switch(n){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return d3(n)}}const q9=h3;function pf(n,e,t){const s=t==="webgpu"&&e.type==="uint8"?"unorm8":e.type;return{attribute:n,format:e.size>1?`${s}x${e.size}`:e.type,byteOffset:e.offset||0}}function Ni(n){return n.stride||n.size*n.bytesPerElement}function Q9(n,e){return n.type===e.type&&n.size===e.size&&Ni(n)===Ni(e)&&(n.offset||0)===(e.offset||0)}function J_(n,e){e.offset&&Ve.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const t=Ni(n),s=e.vertexOffset!==void 0?e.vertexOffset:n.vertexOffset||0,r=e.elementOffset||0,i=s*t+r*n.bytesPerElement+(n.offset||0);return{...e,offset:i,stride:t}}function Z9(n,e){const t=J_(n,e);return{high:t,low:{...t,offset:t.offset+n.size*4}}}class eH{constructor(e,t,s){this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;const r=t.logicalType||t.type,i=r==="float64";let{defaultValue:o}=t;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);let l;i?l="float32":!r&&t.isIndexed?l="uint32":l=r||"float32";let f=K9(r||l);this.doublePrecision=i,i&&t.fp64===!1&&(f=Float32Array),this.value=null,this.settings={...t,defaultType:f,defaultValue:o,logicalType:r,type:l,normalized:l.includes("norm"),size:this.size,bytesPerElement:f.BYTES_PER_ELEMENT},this.state={...s,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Ni(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),yl.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,t=null){const s={};if(this.state.constant){const r=this.value;if(t){const i=J_(this.getAccessor(),t),o=i.offset/r.BYTES_PER_ELEMENT,l=i.size||this.size;s[e]=r.subarray(o,o+l)}else s[e]=r}else s[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?s[`${e}64Low`]=s[e]:s[`${e}64Low`]=new Float32Array(this.size)),s}_getBufferLayout(e=this.id,t=null){const s=this.getAccessor(),r=[],i={name:this.id,byteStride:Ni(s),attributes:r};if(this.doublePrecision){const o=Z9(s,t||{});r.push(pf(e,{...s,...o.high},this.device.type),pf(`${e}64Low`,{...s,...o.low},this.device.type))}else if(t){const o=J_(s,t);r.push(pf(e,{...s,...o},this.device.type))}else r.push(pf(e,s,this.device.type));return i}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:s,size:r}=this,i=s*r;if(t&&i&&t.length>=i){const o=new Array(r).fill(1/0),l=new Array(r).fill(-1/0);for(let f=0;f<i;)for(let h=0;h<r;h++){const g=t[f++];g<o[h]&&(o[h]=g),g>l[h]&&(l[h]=g)}e=[o,l]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let s;ArrayBuffer.isView(e)?s={value:e}:e instanceof ut?s={buffer:e}:s=e;const r={...this.settings,...s};if(ArrayBuffer.isView(s.value)){if(!s.type)if(this.doublePrecision&&s.value instanceof Float64Array)r.type="float32";else{const o=q9(s.value);r.type=r.normalized?o.replace("int","norm"):o}r.bytesPerElement=s.value.BYTES_PER_ELEMENT,r.stride=Ni(r)}if(t.bounds=null,s.constant){let i=s.value;if(i=this._normalizeValue(i,[],0),this.settings.normalized&&(i=this.normalizeConstant(i)),!(!t.constant||!this._areValuesEqual(i,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=ArrayBuffer.isView(i)?i:new Float32Array(i)}else if(s.buffer){const i=s.buffer;t.externalBuffer=i,t.constant=!1,this.value=s.value||null}else if(s.value){this._checkExternalBuffer(s);let i=s.value;t.externalBuffer=null,t.constant=!1,this.value=i;let{buffer:o}=this;const l=Ni(r),f=(r.vertexOffset||0)*l;if(this.doublePrecision&&i instanceof Float64Array&&(i=rm(i,r)),this.settings.isIndexed){const g=this.settings.defaultType;i.constructor!==g&&(i=new g(i))}const h=i.byteLength+f+l*2;(!o||o.byteLength<h)&&(o=this._createBuffer(h)),o.write(i,f)}return this.setAccessor(r),!0}updateSubBuffer(e={}){this.state.bounds=null;const t=this.value,{startOffset:s=0,endOffset:r}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?rm(t,{size:this.size,startIndex:s,endIndex:r}):t.subarray(s,r),s*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,t=!1){const{state:s}=this,r=s.allocatedValue,i=yl.allocate(r,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=i;const{byteOffset:o}=this;let{buffer:l}=this;return(!l||l.byteLength<i.byteLength+o)&&(l=this._createBuffer(i.byteLength+o),t&&r&&l.write(r instanceof Float64Array?rm(r,this):r,o)),s.allocatedValue=i,s.constant=!1,s.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error(`Attribute ${this.id} value is not TypedArray`);const s=this.settings.defaultType;let r=!1;if(this.doublePrecision&&(r=t.BYTES_PER_ELEMENT<4),r)throw new Error(`Attribute ${this.id} does not support ${t.constructor.name}`);!(t instanceof s)&&this.settings.normalized&&!("normalized"in e)&&Ve.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(t=>(t+128)/255*2-1);case"snorm16":return new Float32Array(e).map(t=>(t+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(t=>t/255);case"unorm16":return new Float32Array(e).map(t=>t/65535);default:return e}}_normalizeValue(e,t,s){const{defaultValue:r,size:i}=this.settings;if(Number.isFinite(e))return t[s]=e,t;if(!e){let o=i;for(;--o>=0;)t[s+o]=r[o];return t}switch(i){case 4:t[s+3]=Number.isFinite(e[3])?e[3]:r[3];case 3:t[s+2]=Number.isFinite(e[2])?e[2]:r[2];case 2:t[s+1]=Number.isFinite(e[1])?e[1]:r[1];case 1:t[s+0]=Number.isFinite(e[0])?e[0]:r[0];break;default:let o=i;for(;--o>=0;)t[s+o]=Number.isFinite(e[o])?e[o]:r[o]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:s}=this;for(let r=0;r<s;r++)if(e[r]!==t[r])return!1;return!0}_createBuffer(e){var r;this._buffer&&this._buffer.destroy();const{isIndexed:t,type:s}=this.settings;return this._buffer=this.device.createBuffer({...(r=this._buffer)==null?void 0:r.props,id:this.id,usage:(t?ut.INDEX:ut.VERTEX)|ut.COPY_DST,indexType:t?s:void 0,byteLength:e}),this._buffer}}const KC=[],qC=[];function K2(n,e=0,t=1/0){let s=KC;const r={index:-1,data:n,target:[]};return n?typeof n[Symbol.iterator]=="function"?s=n:n.length>0&&(qC.length=n.length,s=qC):s=KC,(e>0||Number.isFinite(t))&&(s=(Array.isArray(s)?s:Array.from(s)).slice(e,t),r.index=e-1),{iterable:s,objectInfo:r}}function q2(n){return n&&n[Symbol.asyncIterator]}function tH(n,e){const{size:t,stride:s,offset:r,startIndices:i,nested:o}=e,l=n.BYTES_PER_ELEMENT,f=s?s/l:t,h=r?r/l:0,g=Math.floor((n.length-h)/f);return(m,{index:A,target:y})=>{if(!i){const x=A*f+h;for(let O=0;O<t;O++)y[O]=n[x+O];return y}const E=i[A],v=i[A+1]||g;let S;if(o){S=new Array(v-E);for(let x=E;x<v;x++){const O=x*f+h;y=new Array(t);for(let R=0;R<t;R++)y[R]=n[O+R];S[x-E]=y}}else if(f===t)S=n.subarray(E*t+h,v*t+h);else{S=new n.constructor((v-E)*t);let x=0;for(let O=E;O<v;O++){const R=O*f+h;for(let D=0;D<t;D++)S[x++]=n[R+D]}}return S}}const nH=[],jf=[[0,1/0]];function sH(n,e){if(n===jf||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return n;const t=[],s=n.length;let r=0;for(let i=0;i<s;i++){const o=n[i];o[1]<e[0]?(t.push(o),r=i+1):o[0]>e[1]?t.push(o):e=[Math.min(o[0],e[0]),Math.max(o[1],e[1])]}return t.splice(r,0,e),t}const rH={interpolation:{duration:0,easing:n=>n},spring:{stiffness:.05,damping:.5}};function Q2(n,e){if(!n)return null;Number.isFinite(n)&&(n={type:"interpolation",duration:n});const t=n.type||"interpolation";return{...rH[t],...e,...n,type:t}}class Z2 extends eH{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:jf}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var t;(t=this.state).layoutChanged||(t.layoutChanged=!Q9(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,s=this.settings.transition,r=Array.isArray(t)?e[t.find(i=>e[i])]:e[t];return Q2(r,s)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:s=0,endRow:r=1/0}=t;this.state.updateRanges=sH(this.state.updateRanges,[s,r])}else this.state.updateRanges=jf}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=nH}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:s}=this;return s.noAlloc?!1:s.update?(super.allocate(e,t.updateRanges!==jf),!0):!1}updateBuffer({numInstances:e,data:t,props:s,context:r}){if(!this.needsUpdate())return!1;const{state:{updateRanges:i},settings:{update:o,noAlloc:l}}=this;let f=!0;if(o){for(const[h,g]of i)o.call(r,this,{data:t,startRow:h,endRow:g,props:s,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[h,g]of i){const m=Number.isFinite(h)?this.getVertexOffset(h):0,A=Number.isFinite(g)?this.getVertexOffset(g):l||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:m,endOffset:A})}this._checkAttributeArray()}else f=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),f}setConstantValue(e){return this.device.type==="webgpu"||e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){const{state:s,settings:r}=this;if(!e)return s.binaryValue=null,s.binaryAccessor=null,!1;if(r.noAlloc)return!1;if(s.binaryValue===e)return this.clearNeedsUpdate(),!0;if(s.binaryValue=e,this.setNeedsRedraw(),r.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const o=e;Mt(ArrayBuffer.isView(o.value),`invalid ${r.accessor}`);const l=!!o.size&&o.size!==this.size;return s.binaryAccessor=tH(o.value,{size:o.size||this.size,stride:o.stride,offset:o.offset,startIndices:t,nested:l}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(const s in e)Object.assign(t,super.getValue(s,e[s]));return t}getBufferLayout(e){this.state.layoutChanged=!1;const t=this.settings.shaderAttributes,s=super._getBufferLayout(),{stepMode:r}=this.settings;if(r==="dynamic"?s.stepMode=e?e.isInstanced?"instance":"vertex":"instance":s.stepMode=r??"vertex",!t)return s;for(const i in t){const o=super._getBufferLayout(i,t[i]);s.attributes.push(...o.attributes)}return s}_autoUpdater(e,{data:t,startRow:s,endRow:r,props:i,numInstances:o}){if(e.constant&&this.context.device.type!=="webgpu")return;const{settings:l,state:f,value:h,size:g,startIndices:m}=e,{accessor:A,transform:y}=l;let E=f.binaryAccessor||(typeof A=="function"?A:i[A]);typeof E!="function"&&(E=()=>E),Mt(typeof E=="function",`accessor "${A}" is not a function`);let v=e.getVertexOffset(s);const{iterable:S,objectInfo:x}=K2(t,s,r);for(const O of S){x.index++;let R=E(O,x);if(y&&(R=y.call(this,R)),m){const D=(x.index<m.length-1?m[x.index+1]:o)-m[x.index];if(R&&Array.isArray(R[0])){let z=v;for(const J of R)e._normalizeValue(J,h,z),z+=g}else R&&R.length>g?h.set(R,v):(e._normalizeValue(R,x.target,0),A8({target:h,source:x.target,start:v,count:D}));v+=D*g}else e._normalizeValue(R,h,v),v+=g}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let s=!0;switch(t){case 4:s=s&&Number.isFinite(e[3]);case 3:s=s&&Number.isFinite(e[2]);case 2:s=s&&Number.isFinite(e[1]);case 1:s=s&&Number.isFinite(e[0]);break;default:s=!1}if(!s)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function dm(n){const{source:e,target:t,start:s=0,size:r,getData:i}=n,o=n.end||t.length,l=e.length,f=o-s;if(l>f){t.set(e.subarray(0,f),s);return}if(t.set(e,s),!i)return;let h=l;for(;h<f;){const g=i(h,e);for(let m=0;m<r;m++)t[s+h]=g[m]||0,h++}}function iH({source:n,target:e,size:t,getData:s,sourceStartIndices:r,targetStartIndices:i}){if(!r||!i)return dm({source:n,target:e,size:t,getData:s}),e;let o=0,l=0;const f=s&&((g,m)=>s(g+l,m)),h=Math.min(r.length,i.length);for(let g=1;g<h;g++){const m=r[g]*t,A=i[g]*t;dm({source:n.subarray(o,m),target:e,start:l,end:A,size:t,getData:f}),o=m,l=A}return l<e.length&&dm({source:[],target:e,start:l,size:t,getData:f}),e}function oH(n){const{device:e,settings:t,value:s}=n,r=new Z2(e,t);return r.setData({value:s instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:t.normalized}),r}function ew(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${n}"`)}}function tw(n){switch(n){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function nw(n){n.push(n.shift())}function aH(n,e){const{doublePrecision:t,settings:s,value:r,size:i}=n,o=t&&r instanceof Float64Array?2:1;let l=0;const{shaderAttributes:f}=n.settings;if(f)for(const h of Object.values(f))l=Math.max(l,h.vertexOffset??0);return(s.noAlloc?r.length:(e+l)*i)*o}function sw({device:n,source:e,target:t}){return(!t||t.byteLength<e.byteLength)&&(t==null||t.destroy(),t=n.createBuffer({byteLength:e.byteLength,usage:e.usage})),t}function rw({device:n,buffer:e,attribute:t,fromLength:s,toLength:r,fromStartIndices:i,getData:o=l=>l}){const l=t.doublePrecision&&t.value instanceof Float64Array?2:1,f=t.size*l,h=t.byteOffset,g=t.settings.bytesPerElement<4?h/t.settings.bytesPerElement*4:h,m=t.startIndices,A=i&&m,y=t.isConstant;if(!A&&e&&s>=r)return e;const E=t.value instanceof Float64Array?Float32Array:t.value.constructor,v=y?t.value:new E(t.getBuffer().readSyncWebGL(h,r*E.BYTES_PER_ELEMENT).buffer);if(t.settings.normalized&&!y){const R=o;o=(D,z)=>t.normalizeConstant(R(D,z))}const S=y?(R,D)=>o(v,D):(R,D)=>o(v.subarray(R+h,R+h+f),D),x=e?new Float32Array(e.readSyncWebGL(g,s*4).buffer):new Float32Array(0),O=new Float32Array(r);return iH({source:x,target:O,sourceStartIndices:i,targetStartIndices:m,size:f,getData:S}),(!e||e.byteLength<O.byteLength+g)&&(e==null||e.destroy(),e=n.createBuffer({byteLength:O.byteLength+g,usage:35050})),e.write(O,g),e}class iw{constructor({device:e,attribute:t,timeline:s}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new Qh(s),this.attribute=t,this.attributeInTransition=oH(t),this.currentStartIndices=t.startIndices}get inProgress(){return this.transition.inProgress}start(e,t,s=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=aH(this.attribute,t),this.transition.start({...e,duration:s})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class cH extends iw{constructor({device:e,attribute:t,timeline:s}){super({device:e,attribute:t,timeline:s}),this.type="interpolation",this.transform=hH(e,t)}start(e,t){const s=this.currentLength,r=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:i,attribute:o}=this;nw(i),i[0]=rw({device:this.device,buffer:i[0],attribute:o,fromLength:s,toLength:this.currentLength,fromStartIndices:r,getData:e.enter}),i[1]=sw({device:this.device,source:i[0],target:i[1]}),this.setBuffer(i[1]);const{transform:l}=this,f=l.model;let h=Math.floor(this.currentLength/o.size);ow(o)&&(h/=2),f.setVertexCount(h),o.isConstant?(f.setAttributes({aFrom:i[0]}),f.setConstantAttributes({aTo:o.value})):f.setAttributes({aFrom:i[0],aTo:o.getBuffer()}),l.transformFeedback.setBuffers({vCurrent:i[1]})}onUpdate(){const{duration:e,easing:t}=this.settings,{time:s}=this.transition;let r=s/e;t&&(r=t(r));const{model:i}=this.transform,o={time:r};i.shaderInputs.setProps({interpolation:o}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const lH=`uniform interpolationUniforms {
  float time;
} interpolation;
`,QC={name:"interpolation",vs:lH,uniformTypes:{time:"f32"}},uH=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,fH=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function ow(n){return n.doublePrecision&&n.value instanceof Float64Array}function hH(n,e){const t=e.size,s=ew(t),r=tw(t),i=e.getBufferLayout();return ow(e)?new bl(n,{vs:fH,bufferLayout:[{name:"aFrom",byteStride:8*t,attributes:[{attribute:"aFrom",format:r,byteOffset:0},{attribute:"aFrom64Low",format:r,byteOffset:4*t}]},{name:"aTo",byteStride:8*t,attributes:[{attribute:"aTo",format:r,byteOffset:0},{attribute:"aTo64Low",format:r,byteOffset:4*t}]}],modules:[AL,QC],defines:{ATTRIBUTE_TYPE:s,ATTRIBUTE_SIZE:t},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new bl(n,{vs:uH,bufferLayout:[{name:"aFrom",format:r},{name:"aTo",format:i.attributes[0].format}],modules:[QC],defines:{ATTRIBUTE_TYPE:s},varyings:["vCurrent"],disableWarnings:!0})}class dH extends iw{constructor({device:e,attribute:t,timeline:s}){super({device:e,attribute:t,timeline:s}),this.type="spring",this.texture=yH(e),this.framebuffer=bH(e,this.texture),this.transform=AH(e,t)}start(e,t){const s=this.currentLength,r=this.currentStartIndices;super.start(e,t);const{buffers:i,attribute:o}=this;for(let f=0;f<2;f++)i[f]=rw({device:this.device,buffer:i[f],attribute:o,fromLength:s,toLength:this.currentLength,fromStartIndices:r,getData:e.enter});i[2]=sw({device:this.device,source:i[0],target:i[2]}),this.setBuffer(i[1]);const{model:l}=this.transform;l.setVertexCount(Math.floor(this.currentLength/o.size)),o.isConstant?l.setConstantAttributes({aTo:o.value}):l.setAttributes({aTo:o.getBuffer()})}onUpdate(){const{buffers:e,transform:t,framebuffer:s,transition:r}=this,i=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]});const o={stiffness:i.stiffness,damping:i.damping};t.model.shaderInputs.setProps({spring:o}),t.run({framebuffer:s,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),nw(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(s)[0]>0||r.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const gH=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,pH={name:"spring",vs:gH,uniformTypes:{damping:"f32",stiffness:"f32"}},mH=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,_H=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function AH(n,e){const t=ew(e.size),s=tw(e.size);return new bl(n,{vs:mH,fs:_H,bufferLayout:[{name:"aPrev",format:s},{name:"aCur",format:s},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[pH],defines:{ATTRIBUTE_TYPE:t},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function yH(n){return n.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function bH(n,e){return n.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const TH={interpolation:cH,spring:dH};class EH{constructor(e,{id:t,timeline:s}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=t,this.device=e,this.timeline=s,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:s}){this.numInstances=s||1;for(const r in e){const i=e[r],o=i.getTransitionSetting(t);o&&this._updateAttribute(r,i,o)}for(const r in this.transitions){const i=e[r];(!i||!i.getTransitionSetting(t))&&this._removeTransition(r)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const s=this.transitions[t];s.inProgress&&(e[t]=s.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,s){const r=this.transitions[e];let i=!r||r.type!==s.type;if(i){r&&this._removeTransition(e);const o=TH[s.type];o?this.transitions[e]=new o({attribute:t,timeline:this.timeline,device:this.device}):(Ve.error(`unsupported transition type '${s.type}'`)(),i=!1)}(i||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(s,this.numInstances))}}const ZC="attributeManager.invalidate",CH="attributeManager.updateStart",vH="attributeManager.updateEnd",BH="attribute.updateStart",SH="attribute.allocate",wH="attribute.updateEnd";class RH{constructor(e,{id:t="attribute-manager",stats:s,timeline:r}={}){this.mergeBoundsMemoized=Il(G6),this.id=t,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=s,this.attributeTransitionManager=new EH(e,{id:`${t}-transitions`,timeline:r}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const t of e)this.attributes[t]!==void 0&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const s=this._invalidateTrigger(e,t);qt(ZC,this,e,s)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);qt(ZC,this,"all")}update({data:e,numInstances:t,startIndices:s=null,transitions:r,props:i={},buffers:o={},context:l={}}){let f=!1;qt(CH,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const h in this.attributes){const g=this.attributes[h],m=g.settings.accessor;g.startIndices=s,g.numInstances=t,i[h]&&Ve.removed(`props.${h}`,`data.attributes.${h}`)(),g.setExternalBuffer(o[h])||g.setBinaryValue(typeof m=="string"?o[m]:void 0,e.startIndices)||typeof m=="string"&&!o[m]&&g.setConstantValue(i[m])||g.needsUpdate()&&(f=!0,this._updateAttribute({attribute:g,numInstances:t,data:e,props:i,context:l})),this.needsRedraw=this.needsRedraw||g.needsRedraw()}f&&qt(vH,this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:r})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const t=e.map(s=>{var r;return(r=this.attributes[s])==null?void 0:r.getBounds()});return this.mergeBoundsMemoized(t)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:t,attributeTransitionManager:s}=this,r={...s.getAttributes()};for(const i in t){const o=t[i];o.needsRedraw(e)&&!s.hasAttribute(i)&&(r[i]=o)}return r}getBufferLayouts(e){return Object.values(this.getAttributes()).map(t=>t.getBufferLayout(e))}_add(e,t){for(const s in e){const r=e[s],i={...r,id:s,size:r.isIndexed&&1||r.size||1,...t};this.attributes[s]=new Z2(this.device,i)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(r=>{e[r]||(e[r]=[]),e[r].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:s,updateTriggers:r}=this,i=r[e];return i&&i.forEach(o=>{const l=s[o];l&&l.setNeedsUpdate(l.id,t)}),i}_updateAttribute(e){const{attribute:t,numInstances:s}=e;if(qt(BH,t),t.constant){t.setConstantValue(t.value);return}t.allocate(s)&&qt(SH,t,s),t.updateBuffer(e)&&(this.needsRedraw=!0,qt(wH,t,s))}}class xH extends Qh{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:s,duration:r,easing:i}}=this,o=i(e/r);this._value=hh(t,s,o)}}const ev=1e-5;function tv(n,e,t,s,r){const i=e-n,l=(t-e)*r,f=-i*s;return l+f+i+e}function IH(n,e,t,s,r){if(Array.isArray(t)){const i=[];for(let o=0;o<t.length;o++)i[o]=tv(n[o],e[o],t[o],s,r);return i}return tv(n,e,t,s,r)}function nv(n,e){if(Array.isArray(n)){let t=0;for(let s=0;s<n.length;s++){const r=n[s]-e[s];t+=r*r}return Math.sqrt(t)}return Math.abs(n-e)}class MH extends Qh{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:s,stiffness:r}=this.settings,{_prevValue:i=e,_currValue:o=e}=this;let l=IH(i,o,t,s,r);const f=nv(l,t),h=nv(l,o);f<ev&&h<ev&&(l=t,this.end()),this._prevValue=o,this._currValue=l}}const OH={interpolation:xH,spring:MH};class DH{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,s,r){const{transitions:i}=this;if(i.has(e)){const f=i.get(e),{value:h=f.settings.fromValue}=f;t=h,this.remove(e)}if(r=Q2(r),!r)return;const o=OH[r.type];if(!o){Ve.error(`unsupported transition type '${r.type}'`)();return}const l=new o(this.timeline);l.start({...r,fromValue:t,toValue:s}),i.set(e,l)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,s]of this.transitions)s.update(),e[t]=s.value,s.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function NH(n){const e=n[ni];for(const t in e){const s=e[t],{validate:r}=s;if(r&&!r(n[t],s))throw new Error(`Invalid prop ${t}: ${n[t]}`)}}function FH(n,e){const t=aw({newProps:n,oldProps:e,propTypes:n[ni],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),s=UH(n,e);let r=!1;return s||(r=LH(n,e)),{dataChanged:s,propsChanged:t,updateTriggersChanged:r,extensionsChanged:kH(n,e),transitionsChanged:PH(n,e)}}function PH(n,e){if(!n.transitions)return!1;const t={},s=n[ni];let r=!1;for(const i in n.transitions){const o=s[i],l=o&&o.type;(l==="number"||l==="color"||l==="array")&&W_(n[i],e[i],o)&&(t[i]=!0,r=!0)}return r?t:!1}function aw({newProps:n,oldProps:e,ignoreProps:t={},propTypes:s={},triggerName:r="props"}){if(e===n)return!1;if(typeof n!="object"||n===null)return`${r} changed shallowly`;if(typeof e!="object"||e===null)return`${r} changed shallowly`;for(const i of Object.keys(n))if(!(i in t)){if(!(i in e))return`${r}.${i} added`;const o=W_(n[i],e[i],s[i]);if(o)return`${r}.${i} ${o}`}for(const i of Object.keys(e))if(!(i in t)){if(!(i in n))return`${r}.${i} dropped`;if(!Object.hasOwnProperty.call(n,i)){const o=W_(n[i],e[i],s[i]);if(o)return`${r}.${i} ${o}`}}return!1}function W_(n,e,t){let s=t&&t.equal;return s&&!s(n,e,t)||!s&&(s=n&&e&&n.equals,s&&!s.call(n,e))?"changed deeply":!s&&e!==n?"changed shallowly":null}function UH(n,e){if(e===null)return"oldProps is null, initial diff";let t=!1;const{dataComparator:s,_dataDiff:r}=n;return s?s(n.data,e.data)||(t="Data comparator detected a change"):n.data!==e.data&&(t="A new data container was supplied"),t&&r&&(t=r(n.data,e.data)||t),t}function LH(n,e){if(e===null)return{all:!0};if("all"in n.updateTriggers&&sv(n,e,"all"))return{all:!0};const t={};let s=!1;for(const r in n.updateTriggers)r!=="all"&&sv(n,e,r)&&(t[r]=!0,s=!0);return s?t:!1}function kH(n,e){if(e===null)return!0;const t=e.extensions,{extensions:s}=n;if(s===t)return!1;if(!t||!s||s.length!==t.length)return!0;for(let r=0;r<s.length;r++)if(!s[r].equals(t[r]))return!0;return!1}function sv(n,e,t){let s=n.updateTriggers[t];s=s??{};let r=e.updateTriggers[t];return r=r??{},aw({oldProps:r,newProps:s,triggerName:t})}const HH="count(): argument not an object",GH="count(): argument not a container";function VH(n){if(!zH(n))throw new Error(HH);if(typeof n.count=="function")return n.count();if(Number.isFinite(n.size))return n.size;if(Number.isFinite(n.length))return n.length;if(jH(n))return Object.keys(n).length;throw new Error(GH)}function jH(n){return n!==null&&typeof n=="object"&&n.constructor===Object}function zH(n){return n!==null&&typeof n=="object"}function rv(n,e){if(!e)return n;const t={...n,...e};if("defines"in e&&(t.defines={...n.defines,...e.defines}),"modules"in e&&(t.modules=(n.modules||[]).concat(e.modules),e.modules.some(s=>s.name==="project64"))){const s=t.modules.findIndex(r=>r.name==="project32");s>=0&&t.modules.splice(s,1)}if("inject"in e)if(!n.inject)t.inject=e.inject;else{const s={...n.inject};for(const r in e.inject)s[r]=(s[r]||"")+e.inject[r];t.inject=s}return t}const $H={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Y_={};function XH(n,e,t,s){if(t instanceof dt)return t;t.constructor&&t.constructor.name!=="Object"&&(t={data:t});let r=null;t.compressed&&(r={minFilter:"linear",mipmapFilter:t.data.length>1?"nearest":"linear"});const i=e.createTexture({...t,sampler:{...$H,...r,...s},mipmaps:!0});return Y_[i.id]=n,i}function JH(n,e){!e||!(e instanceof dt)||Y_[e.id]===n&&(e.delete(),delete Y_[e.id])}const WH={boolean:{validate(n,e){return!0},equal(n,e,t){return!!n==!!e}},number:{validate(n,e){return Number.isFinite(n)&&(!("max"in e)||n<=e.max)&&(!("min"in e)||n>=e.min)}},color:{validate(n,e){return e.optional&&!n||K_(n)&&(n.length===3||n.length===4)},equal(n,e,t){return As(n,e,1)}},accessor:{validate(n,e){const t=yh(n);return t==="function"||t===yh(e.value)},equal(n,e,t){return typeof e=="function"?!0:As(n,e,1)}},array:{validate(n,e){return e.optional&&!n||K_(n)},equal(n,e,t){const{compare:s}=t,r=Number.isInteger(s)?s:s?1:0;return s?As(n,e,r):n===e}},object:{equal(n,e,t){if(t.ignore)return!0;const{compare:s}=t,r=Number.isInteger(s)?s:s?1:0;return s?As(n,e,r):n===e}},function:{validate(n,e){return e.optional&&!n||typeof n=="function"},equal(n,e,t){return!t.compare&&t.ignore!==!1||n===e}},data:{transform:(n,e,t)=>{if(!n)return n;const{dataTransform:s}=t.props;return s?s(n):typeof n.shape=="string"&&n.shape.endsWith("-table")&&Array.isArray(n.data)?n.data:n}},image:{transform:(n,e,t)=>{const s=t.context;return!s||!s.device?null:XH(t.id,s.device,n,{...e.parameters,...t.props.textureParameters})},release:(n,e,t)=>{JH(t.id,n)}}};function YH(n){const e={},t={},s={};for(const[r,i]of Object.entries(n)){const o=i==null?void 0:i.deprecatedFor;if(o)s[r]=Array.isArray(o)?o:[o];else{const l=KH(r,i);e[r]=l,t[r]=l.value}}return{propTypes:e,defaultProps:t,deprecatedProps:s}}function KH(n,e){switch(yh(e)){case"object":return Fc(n,e);case"array":return Fc(n,{type:"array",value:e,compare:!1});case"boolean":return Fc(n,{type:"boolean",value:e});case"number":return Fc(n,{type:"number",value:e});case"function":return Fc(n,{type:"function",value:e,compare:!0});default:return{name:n,type:"unknown",value:e}}}function Fc(n,e){return"type"in e?{name:n,...WH[e.type],...e}:"value"in e?{name:n,type:yh(e.value),...e}:{name:n,type:"object",value:e}}function K_(n){return Array.isArray(n)||ArrayBuffer.isView(n)}function yh(n){return K_(n)?"array":n===null?"null":typeof n}function qH(n,e){let t;for(let i=e.length-1;i>=0;i--){const o=e[i];"extensions"in o&&(t=o.extensions)}const s=q_(n.constructor,t),r=Object.create(s);r[_h]=n,r[ji]={},r[Zr]={};for(let i=0;i<e.length;++i){const o=e[i];for(const l in o)r[l]=o[l]}return Object.freeze(r),r}const QH="_mergedDefaultProps";function q_(n,e){if(!(n instanceof Zh.constructor))return{};let t=QH;if(e)for(const r of e){const i=r.constructor;i&&(t+=`:${i.extensionName||i.name}`)}const s=cw(n,t);return s||(n[t]=ZH(n,e||[]))}function ZH(n,e){if(!n.prototype)return null;const s=Object.getPrototypeOf(n),r=q_(s),i=cw(n,"defaultProps")||{},o=YH(i),l=Object.assign(Object.create(null),r,o.defaultProps),f=Object.assign(Object.create(null),r==null?void 0:r[ni],o.propTypes),h=Object.assign(Object.create(null),r==null?void 0:r[cm],o.deprecatedProps);for(const g of e){const m=q_(g.constructor);m&&(Object.assign(l,m),Object.assign(f,m[ni]),Object.assign(h,m[cm]))}return eG(l,n),nG(l,f),tG(l,h),l[ni]=f,l[cm]=h,e.length===0&&!dy(n,"_propTypes")&&(n._propTypes=f),l}function eG(n,e){const t=rG(e);Object.defineProperties(n,{id:{writable:!0,value:t}})}function tG(n,e){for(const t in e)Object.defineProperty(n,t,{enumerable:!1,set(s){const r=`${this.id}: ${t}`;for(const i of e[t])dy(this,i)||(this[i]=s);Ve.deprecated(r,e[t].join("/"))()}})}function nG(n,e){const t={},s={};for(const r in e){const i=e[r],{name:o,value:l}=i;i.async&&(t[o]=l,s[o]=sG(o))}n[ua]=t,n[ji]={},Object.defineProperties(n,s)}function sG(n){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||q2(e)?this[ji][n]=e:this[Zr][n]=e},get(){if(this[Zr]){if(n in this[Zr])return this[Zr][n]||this[ua][n];if(n in this[ji]){const e=this[_h]&&this[_h].internalState;if(e&&e.hasAsyncProp(n))return e.getAsyncProp(n)||this[ua][n]}}return this[ua][n]}}}function dy(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function cw(n,e){return dy(n,e)&&n[e]}function rG(n){const e=n.componentName;return e||Ve.warn(`${n.name}.componentName not specified`)(),e||n.name}let iG=0;class Zh{constructor(...e){this.props=qH(this,e),this.id=this.props.id,this.count=iG++}clone(e){const{props:t}=this,s={};for(const r in t[ua])r in t[Zr]?s[r]=t[Zr][r]:r in t[ji]&&(s[r]=t[ji][r]);return new this.constructor({...t,...s,...e})}}Zh.componentName="Component";Zh.defaultProps={};const oG=Object.freeze({});class aG{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||oG}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return!!(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[_h]||this.component;const t=e[Zr]||{},s=e[ji]||e,r=e[ua]||{};for(const i in t){const o=t[i];this._createAsyncPropData(i,r[i]),this._updateAsyncProp(i,o),t[i]=this.getAsyncProp(i)}for(const i in s){const o=s[i];this._createAsyncPropData(i,r[i]),this._updateAsyncProp(i,o)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if(typeof t=="string"&&(t=this._fetch(e,t)),t instanceof Promise){this._watchPromise(e,t);return}if(q2(t)){this._resolveAsyncIterable(e,t);return}this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const s=this.asyncProps[e];return t===s.resolvedValue||t===s.lastValue?!1:(s.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const s=this.asyncProps[e];s&&(t=this._postProcessValue(s,t),s.resolvedValue=t,s.pendingLoadCount++,s.resolvedLoadCount=s.pendingLoadCount)}_setAsyncPropValue(e,t,s){const r=this.asyncProps[e];r&&s>=r.resolvedLoadCount&&t!==void 0&&(this._freezeAsyncOldProps(),r.resolvedValue=t,r.resolvedLoadCount=s,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const s=this.asyncProps[e];if(s){s.pendingLoadCount++;const r=s.pendingLoadCount;t.then(i=>{this.component&&(i=this._postProcessValue(s,i),this._setAsyncPropValue(e,i,r),this._onResolve(e,i))}).catch(i=>{this._onError(e,i)})}}async _resolveAsyncIterable(e,t){if(e!=="data"){this._setPropValue(e,t);return}const s=this.asyncProps[e];if(!s)return;s.pendingLoadCount++;const r=s.pendingLoadCount;let i=[],o=0;for await(const l of t){if(!this.component)return;const{dataTransform:f}=this.component.props;f?i=f(l,i):i=i.concat(l),Object.defineProperty(i,"__diff",{enumerable:!1,value:[{startRow:o,endRow:i.length}]}),o=i.length,this._setAsyncPropValue(e,i,r)}this._onResolve(e,i)}_postProcessValue(e,t){const s=e.type;return s&&this.component&&(s.release&&s.release(e.resolvedValue,s,this.component),s.transform)?s.transform(t,s,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const r=this.component&&this.component.props[ni];this.asyncProps[e]={type:r&&r[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class cG extends aG{constructor({attributeManager:e,layer:t}){super(t),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const s=this.layer,r=s==null?void 0:s.props.fetch;return r?r(t,{propName:e,layer:s}):super._fetch(e,t)}_onResolve(e,t){const s=this.layer;if(s){const r=s.props.onDataLoad;e==="data"&&r&&r(t,{propName:e,layer:s})}}_onError(e,t){const s=this.layer;s&&s.raiseError(t,`loading ${e} of ${this.layer}`)}}const lG="layer.changeFlag",uG="layer.initialize",fG="layer.update",hG="layer.finalize",dG="layer.matched",iv=2**24-1,gG=Object.freeze([]),pG=Il(({oldViewport:n,viewport:e})=>n.equals(e));let us=new Uint8ClampedArray(0);const mG={data:{type:"data",value:gG,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:n=>n&&n.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(n,{propName:e,layer:t,loaders:s,loadOptions:r,signal:i})=>{const{resourceManager:o}=t.context;r=r||t.getLoadOptions(),s=s||t.props.loaders,i&&(r={...r,fetch:{...r==null?void 0:r.fetch,signal:i}});let l=o.contains(n);return!l&&!r&&(o.add({resourceId:n,data:zs(n,s),persistent:!1}),l=!0),l?o.subscribe({resourceId:n,onChange:f=>{var h;return(h=t.internalState)==null?void 0:h.reloadAsyncProp(e,f)},consumerId:t.id,requestId:e}):zs(n,s,r)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Me.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:n})=>[0,-n*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Oa extends Zh{constructor(){super(...arguments),this.internalState=null,this.lifecycle=Jo.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){Mt(this.internalState);const t=this.internalState.viewport||this.context.viewport,s=v2(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[r,i,o]=b2(s,t.pixelProjectionMatrix);return e.length===2?[r,i]:[r,i,o]}unproject(e){return Mt(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){Mt(this.internalState);const s=this.internalState.viewport||this.context.viewport;return J6(e,{viewport:s,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const t of this.getModels())t.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Me.DEFAULT||e===Me.LNGLAT||e===Me.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){Mt(e instanceof Uint8Array);const[t,s,r]=e;return t+s*256+r*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:VH(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=rv(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const t of this.props.extensions)e=rv(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:s}=e.changeFlags;if(s&&t)if(Array.isArray(s))for(const r of s)t.invalidateAll(r);else t.invalidateAll();if(t){const{props:r}=e,i=this.internalState.hasPickingBuffer,o=Number.isInteger(r.highlightedObjectIndex)||r.pickable||r.extensions.some(l=>l.getNeedsPickingBuffer.call(this,l));if(i!==o){this.internalState.hasPickingBuffer=o;const{pickingColors:l,instancePickingColors:f}=t.attributes,h=l||f;h&&(o&&h.constant&&(h.constant=!1,t.invalidate(h.id)),!h.value&&!o&&(h.constant=!0,h.value=[0,0,0]))}}}finalizeState(e){for(const s of this.getModels())s.destroy();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e.renderPass)}getPickingInfo({info:e,mode:t,sourceLayer:s}){const{index:r}=e;return r>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[r]),e}raiseError(e,t){var s,r,i,o;t&&(e=new Error(`${t}: ${e.message}`,{cause:e})),(r=(s=this.props).onError)!=null&&r.call(s,e)||(o=(i=this.context)==null?void 0:i.onError)==null||o.call(i,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,(!t||!pG({oldViewport:t,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const t=this.getAttributeManager();t&&(e==="all"?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(const s in e)e[s].layoutChanged()&&(t=!0);for(const s of this.getModels())this._setModelAttributes(s,e,t)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,s=this.getNumInstances(),r=this.getStartIndices();e.update({data:t.data,numInstances:s,startIndices:r,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const i=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(i)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),s=Object.create(this.props);for(const r in t)Object.defineProperty(s,r,{value:t[r]});return s}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;const s=Math.floor(us.length/4);if(this.internalState.usesPickingColorCache=!0,s<t){t>iv&&Ve.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),us=yl.allocate(us,t,{size:4,copy:!0,maxCount:Math.max(t,iv)});const r=Math.floor(us.length/4),i=[0,0,0];for(let o=s;o<r;o++)this.encodePickingColor(o,i),us[o*4+0]=i[0],us[o*4+1]=i[1],us[o*4+2]=i[2],us[o*4+3]=0}e.value=us.subarray(0,t*4)}_setModelAttributes(e,t,s=!1){var l;if(!Object.keys(t).length)return;if(s){const f=this.getAttributeManager();e.setBufferLayout(f.getBufferLayouts(e)),t=f.getAttributes()}const r=((l=e.userData)==null?void 0:l.excludeAttributes)||{},i={},o={};for(const f in t){if(r[f])continue;const h=t[f].getValue();for(const g in h){const m=h[g];m instanceof ut?t[f].settings.isIndexed?e.setIndexBuffer(m):i[g]=m:m&&(o[g]=m)}}e.setAttributes(i),e.setConstantAttributes(o)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t)){this._disablePickingIndex(e);return}const{pickingColors:s,instancePickingColors:r}=this.getAttributeManager().attributes,i=s||r,o=i&&t.attributes&&t.attributes[i.id];if(o&&o.value){const l=o.value,f=this.encodePickingColor(e);for(let h=0;h<t.length;h++){const g=i.getVertexOffset(h);l[g]===f[0]&&l[g+1]===f[1]&&l[g+2]===f[2]&&this._disablePickingIndex(h)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:s}=this.getAttributeManager().attributes,r=t||s;if(!r)return;const i=r.getVertexOffset(e),o=r.getVertexOffset(e+1);r.buffer.write(new Uint8Array(o-i),i)}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,s=e||t;s&&(this.internalState.usesPickingColorCache&&s.value.buffer!==us.buffer&&(s.value=us.subarray(0,s.value.length)),s.updateSubBuffer({startOffset:0}))}_initialize(){Mt(!this.internalState),Mt(Number.isFinite(this.props.coordinateSystem)),qt(uG,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new cG({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Ve.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new DH(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){qt(dG,this,this===e);const{state:t,internalState:s}=e;this!==e&&(this.internalState=s,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(qt(fG,this,e),!e)return;const t=this.props,s=this.context,r=this.internalState,i=s.viewport,o=this._updateUniformTransition();r.propsInTransition=o,s.viewport=r.viewport||i,this.props=o;try{const l=this._getUpdateParams(),f=this.getModels();if(s.device)this.updateState(l);else try{this.updateState(l)}catch{}for(const g of this.props.extensions)g.updateState.call(this,l,g);this.setNeedsRedraw(),this._updateAttributes();const h=this.getModels()[0]!==f[0];this._postUpdate(l,h)}finally{s.viewport=i,this.props=t,this._clearChangeFlags(),r.needsUpdate=!1,r.resetOldProps()}}_finalize(){qt(hG,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:t=null,uniforms:s={},parameters:r={}}){this._updateAttributeTransition();const i=this.props,o=this.context;this.props=this.internalState.propsInTransition||i;try{t&&this.setShaderModuleProps(t);const{getPolygonOffset:l}=this.props,f=l&&l(s)||[0,0];o.device instanceof ta&&o.device.setParametersWebGL({polygonOffset:f});for(const h of this.getModels())h.device.type==="webgpu"?h.setParameters({...h.parameters,...r}):h.setParameters(r);if(o.device instanceof ta)o.device.withParametersWebGL(r,()=>{const h={renderPass:e,shaderModuleProps:t,uniforms:s,parameters:r,context:o};for(const g of this.props.extensions)g.draw.call(this,h,g);this.draw(h)});else{const h={renderPass:e,shaderModuleProps:t,uniforms:s,parameters:r,context:o};for(const g of this.props.extensions)g.draw.call(this,h,g);this.draw(h)}}finally{this.props=i}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const r in e)if(e[r]){let i=!1;switch(r){case"dataChanged":const o=e[r],l=t[r];o&&Array.isArray(l)&&(t.dataChanged=Array.isArray(o)?l.concat(o):o,i=!0);default:t[r]||(t[r]=e[r],i=!0)}i&&qt(lG,this,r,e)}const s=!!(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=s,t.somethingChanged=s||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){var r;const s=FH(e,t);if(s.updateTriggersChanged)for(const i in s.updateTriggersChanged)s.updateTriggersChanged[i]&&this.invalidateAttribute(i);if(s.transitionsChanged)for(const i in s.transitionsChanged)this.internalState.uniformTransitions.add(i,t[i],e[i],(r=e.transitions)==null?void 0:r[i]);return this.setChangeFlags(s)}validateProps(){NH(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:s}=this.props;e.picked&&typeof s=="function"&&(t.highlightColor=s(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new RH(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:s,oldProps:r}=e,i=this.state.model;i!=null&&i.isInstanced&&i.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:l,highlightColor:f}=s;if(t||r.autoHighlight!==o||r.highlightedObjectIndex!==l||r.highlightColor!==f){const h={};Array.isArray(f)&&(h.highlightColor=f),(t||r.autoHighlight!==o||l!==r.highlightedObjectIndex)&&(h.highlightedObjectColor=Number.isFinite(l)&&l>=0?this.encodePickingColor(l):null),this.setShaderModuleProps({picking:h})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const s=this.getAttributeManager(),r=s?s.getNeedsRedraw(e):!1;if(t=t||r,t)for(const i of this.props.extensions)i.onNeedsRedraw.call(this,i);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Oa.defaultProps=mG;Oa.layerName="Layer";const _G="compositeLayer.renderLayers";class lw extends Oa{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:t}=e;return t&&t.__source&&t.__source.parent&&t.__source.parent.id===this.id&&(e.object=t.__source.object,e.index=t.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){const{_subLayerProps:s}=this.props;return s&&s[e]&&s[e].type||t}getSubLayerRow(e,t,s){return e.__source={parent:this,object:t,index:s},e}getSubLayerAccessor(e){if(typeof e=="function"){const t={index:-1,data:this.props.data,target:[]};return(s,r)=>s&&s.__source?(t.index=s.__source.index,e(s.__source.object,t)):e(s,r)}return e}getSubLayerProps(e={}){var ie;const{opacity:t,pickable:s,visible:r,parameters:i,getPolygonOffset:o,highlightedObjectIndex:l,autoHighlight:f,highlightColor:h,coordinateSystem:g,coordinateOrigin:m,wrapLongitude:A,positionFormat:y,modelMatrix:E,extensions:v,fetch:S,operation:x,_subLayerProps:O}=this.props,R={id:"",updateTriggers:{},opacity:t,pickable:s,visible:r,parameters:i,getPolygonOffset:o,highlightedObjectIndex:l,autoHighlight:f,highlightColor:h,coordinateSystem:g,coordinateOrigin:m,wrapLongitude:A,positionFormat:y,modelMatrix:E,extensions:v,fetch:S,operation:x},D=O&&e.id&&O[e.id],z=D&&D.updateTriggers,J=e.id||"sublayer";if(D){const re=this.props[ni],ee=e.type?e.type._propTypes:{};for(const le in D){const fe=ee[le]||re[le];fe&&fe.type==="accessor"&&(D[le]=this.getSubLayerAccessor(D[le]))}}Object.assign(R,e,D),R.id=`${this.props.id}-${J}`,R.updateTriggers={all:(ie=this.props.updateTriggers)==null?void 0:ie.all,...e.updateTriggers,...z};for(const re of v){const ee=re.getSubLayerProps.call(this,re);ee&&Object.assign(R,ee,{updateTriggers:Object.assign(R.updateTriggers,ee.updateTriggers)})}return R}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let s=this.internalState.subLayers;const r=!s||this.needsUpdate();if(r){const i=this.renderLayers();s=_a(i,Boolean),this.internalState.subLayers=s}qt(_G,this,r,s);for(const i of s)i.parent=this}}lw.layerName="CompositeLayer";const mf=Math.PI/180,ov=180/Math.PI,zf=6370972,na=256;function AG(){const n=na/zf,e=Math.PI/180*na;return{unitsPerMeter:[n,n,n],unitsPerMeter2:[0,0,0],metersPerUnit:[1/n,1/n,1/n],unitsPerDegree:[e,e,n],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/n]}}class yG extends Ia{constructor(e={}){const{longitude:t=0,zoom:s=0,nearZMultiplier:r=.5,farZMultiplier:i=1,resolution:o=10}=e;let{latitude:l=0,height:f,altitude:h=1.5,fovy:g}=e;l=Math.max(Math.min(l,Qr),-Qr),f=f||1,g?h=ny(g):g=Al(h);const m=1/Math.PI/Math.cos(l*Math.PI/180),A=Math.pow(2,s)*m,y=e.nearZ??r,E=e.farZ??(h+na*2*A/f)*i,v=new we().lookAt({eye:[0,-h,0],up:[0,0,1]});v.rotateX(l*mf),v.rotateZ(-t*mf),v.scale(A/f),super({...e,height:f,viewMatrix:v,longitude:t,latitude:l,zoom:s,distanceScales:AG(),fovy:g,focalDistance:h,near:y,far:E}),this.scale=A,this.latitude=l,this.longitude=t,this.resolution=o}get projectionMode(){return Nn.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const t={targetZ:e.z||0},s=this.unproject([0,this.height/2],t),r=this.unproject([this.width/2,0],t),i=this.unproject([this.width,this.height/2],t),o=this.unproject([this.width/2,this.height],t);return i[0]<this.longitude&&(i[0]+=360),s[0]>this.longitude&&(s[0]-=360),[Math.min(s[0],i[0],r[0],o[0]),Math.min(s[1],i[1],r[1],o[1]),Math.max(s[0],i[0],r[0],o[0]),Math.max(s[1],i[1],r[1],o[1])]}unproject(e,{topLeft:t=!0,targetZ:s}={}){const[r,i,o]=e,l=t?i:this.height-i,{pixelUnprojectionMatrix:f}=this;let h;if(Number.isFinite(o))h=gm(f,[r,l,o,1]);else{const y=gm(f,[r,l,-1,1]),E=gm(f,[r,l,1,1]),v=((s||0)/zf+1)*na,S=qp($3([],y,E)),x=qp(y),O=qp(E),D=4*((4*x*O-(S-x-O)**2)/16)/S,z=Math.sqrt(x-D),J=Math.sqrt(Math.max(0,v*v-D)),ie=(z-J)/Math.sqrt(S);h=oU([],y,E,ie)}const[g,m,A]=this.unprojectPosition(h);return Number.isFinite(o)?[g,m,A]:Number.isFinite(s)?[g,m,s]:[g,m]}projectPosition(e){const[t,s,r=0]=e,i=t*mf,o=s*mf,l=Math.cos(o),f=(r/zf+1)*na;return[Math.sin(i)*l*f,-Math.cos(i)*l*f,Math.sin(o)*f]}unprojectPosition(e){const[t,s,r]=e,i=X3(e),o=Math.asin(r/i),f=Math.atan2(t,-s)*ov,h=o*ov,g=(i/na-1)*zf;return[f,h,g]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,t){const s=this.unproject(t);return{longitude:e[0]-s[0]+this.longitude,latitude:e[1]-s[1]+this.latitude}}}function gm(n,e){const t=xa([],e,n);return qA(t,t,1/t[3]),t}class bG extends D2{applyConstraints(e){const{maxZoom:t,minZoom:s,zoom:r}=e;e.zoom=Wn(r,s,t);const{longitude:i,latitude:o}=e;return(i<-180||i>180)&&(e.longitude=U6(i+180,360)-180),e.latitude=Wn(o,-Qr,Qr),e}}class TG extends O2{constructor(){super(...arguments),this.ControllerState=bG,this.transition={transitionDuration:300,transitionInterpolator:new oy(["longitude","latitude","zoom"])},this.dragMode="pan"}setProps(e){super.setProps(e),this.dragRotate=!1,this.touchRotate=!1}}class uw extends M2{constructor(e={}){super(e)}getViewportType(e){return e.zoom>12?Vi:yG}get ControllerType(){return TG}}uw.displayName="GlobeView";const av=`uniform pointCloudUniforms {
  float radiusPixels;
  highp int sizeUnits;
} pointCloud;
`,EG={name:"pointCloud",vs:av,fs:av,uniformTypes:{radiusPixels:"f32",sizeUnits:"i32"}},CG=`#version 300 es
#define SHADER_NAME point-cloud-layer-vertex-shader
in vec3 positions;
in vec3 instanceNormals;
in vec4 instanceColors;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec3 instancePickingColors;
out vec4 vColor;
out vec2 unitPosition;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.normal = project_normal(instanceNormals);
unitPosition = positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
vec3 offset = vec3(positions.xy * project_size_to_pixel(pointCloud.radiusPixels, pointCloud.sizeUnits), 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, instanceColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,vG=`#version 300 es
#define SHADER_NAME point-cloud-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 unitPosition;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition.xy;
float distToCenter = length(unitPosition);
if (distToCenter > 1.0) {
discard;
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,fw=[0,0,0,255],hw=[0,0,1],BG={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:n=>n.position},getNormal:{type:"accessor",value:hw},getColor:{type:"accessor",value:fw},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function SG(n){const{header:e,attributes:t}=n;if(!(!e||!t)&&(n.length=e.vertexCount,t.POSITION&&(t.instancePositions=t.POSITION),t.NORMAL&&(t.instanceNormals=t.NORMAL),t.COLOR_0)){const{size:s,value:r}=t.COLOR_0;t.instanceColors={size:s,type:"unorm8",value:r}}}class gy extends Oa{getShaders(){return super.getShaders({vs:CG,fs:vG,modules:[ey,i2,ry,EG]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:hw},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:fw}})}updateState(e){var r;const{changeFlags:t,props:s}=e;super.updateState(e),t.extensionsChanged&&((r=this.state.model)==null||r.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll()),t.dataChanged&&SG(s.data)}draw({uniforms:e}){const{pointSize:t,sizeUnits:s}=this.props,r=this.state.model,i={sizeUnits:ml[s],radiusPixels:t};r.shaderInputs.setProps({pointCloud:i}),r.draw(this.context.renderPass)}_getModel(){const e=[];for(let t=0;t<3;t++){const s=t/3*Math.PI*2;e.push(Math.cos(s)*2,Math.sin(s)*2,0)}return new ri(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new ca({topology:"triangle-list",attributes:{positions:new Float32Array(e)}}),isInstanced:!0})}}gy.layerName="PointCloudLayer";gy.defaultProps=BG;const On={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};new L;new L;const Pc=new L,cv=new L;class Ol{constructor(e=[0,0,0],t=0){this.radius=-0,this.center=new L,this.fromCenterRadius(e,t)}fromCenterRadius(e,t){return this.center.from(e),this.radius=t,this}fromCornerPoints(e,t){return t=Pc.from(t),this.center=new L().from(e).add(t).scale(.5),this.radius=this.center.distance(t),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new Ol(this.center,this.radius)}union(e){const t=this.center,s=this.radius,r=e.center,i=e.radius,o=Pc.copy(r).subtract(t),l=o.magnitude();if(s>=l+i)return this.clone();if(i>=l+s)return e.clone();const f=(s+l+i)*.5;return cv.copy(o).scale((-s+f)/l).add(t),this.center.copy(cv),this.radius=f,this}expand(e){const s=Pc.from(e).subtract(this.center).magnitude();return s>this.radius&&(this.radius=s),this}transform(e){this.center.transform(e);const t=SU(Pc,e);return this.radius=Math.max(t[0],Math.max(t[1],t[2]))*this.radius,this}distanceSquaredTo(e){const t=this.distanceTo(e);return t*t}distanceTo(e){const s=Pc.from(e).subtract(this.center);return Math.max(0,s.len()-this.radius)}intersectPlane(e){const t=this.center,s=this.radius,i=e.normal.dot(t)+e.distance;return i<-s?On.OUTSIDE:i<s?On.INTERSECTING:On.INSIDE}}const wG=new L,RG=new L,_f=new L,Af=new L,yf=new L,xG=new L,IG=new L,or={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class Dl{constructor(e=[0,0,0],t=[0,0,0,0,0,0,0,0,0]){this.center=new L().from(e),this.halfAxes=new at(t)}get halfSize(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),s=this.halfAxes.getColumn(2);return[new L(e).len(),new L(t).len(),new L(s).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),s=this.halfAxes.getColumn(2),r=new L(e).normalize(),i=new L(t).normalize(),o=new L(s).normalize();return new ga().fromMatrix3(new at([...r,...i,...o]))}fromCenterHalfSizeQuaternion(e,t,s){const r=new ga(s),i=new at().fromQuaternion(r);return i[0]=i[0]*t[0],i[1]=i[1]*t[0],i[2]=i[2]*t[0],i[3]=i[3]*t[1],i[4]=i[4]*t[1],i[5]=i[5]*t[1],i[6]=i[6]*t[2],i[7]=i[7]*t[2],i[8]=i[8]*t[2],this.center=new L().from(e),this.halfAxes=i,this}clone(){return new Dl(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new Ol){const t=this.halfAxes,s=t.getColumn(0,_f),r=t.getColumn(1,Af),i=t.getColumn(2,yf),o=wG.copy(s).add(r).add(i);return e.center.copy(this.center),e.radius=o.magnitude(),e}intersectPlane(e){const t=this.center,s=e.normal,r=this.halfAxes,i=s.x,o=s.y,l=s.z,f=Math.abs(i*r[or.COLUMN0ROW0]+o*r[or.COLUMN0ROW1]+l*r[or.COLUMN0ROW2])+Math.abs(i*r[or.COLUMN1ROW0]+o*r[or.COLUMN1ROW1]+l*r[or.COLUMN1ROW2])+Math.abs(i*r[or.COLUMN2ROW0]+o*r[or.COLUMN2ROW1]+l*r[or.COLUMN2ROW2]),h=s.dot(t)+e.distance;return h<=-f?On.OUTSIDE:h>=f?On.INSIDE:On.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=RG.from(e).subtract(this.center),s=this.halfAxes,r=s.getColumn(0,_f),i=s.getColumn(1,Af),o=s.getColumn(2,yf),l=r.magnitude(),f=i.magnitude(),h=o.magnitude();r.normalize(),i.normalize(),o.normalize();let g=0,m;return m=Math.abs(t.dot(r))-l,m>0&&(g+=m*m),m=Math.abs(t.dot(i))-f,m>0&&(g+=m*m),m=Math.abs(t.dot(o))-h,m>0&&(g+=m*m),g}computePlaneDistances(e,t,s=[-0,-0]){let r=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;const o=this.center,l=this.halfAxes,f=l.getColumn(0,_f),h=l.getColumn(1,Af),g=l.getColumn(2,yf),m=xG.copy(f).add(h).add(g).add(o),A=IG.copy(m).subtract(e);let y=t.dot(A);return r=Math.min(y,r),i=Math.max(y,i),m.copy(o).add(f).add(h).subtract(g),A.copy(m).subtract(e),y=t.dot(A),r=Math.min(y,r),i=Math.max(y,i),m.copy(o).add(f).subtract(h).add(g),A.copy(m).subtract(e),y=t.dot(A),r=Math.min(y,r),i=Math.max(y,i),m.copy(o).add(f).subtract(h).subtract(g),A.copy(m).subtract(e),y=t.dot(A),r=Math.min(y,r),i=Math.max(y,i),o.copy(m).subtract(f).add(h).add(g),A.copy(m).subtract(e),y=t.dot(A),r=Math.min(y,r),i=Math.max(y,i),o.copy(m).subtract(f).add(h).subtract(g),A.copy(m).subtract(e),y=t.dot(A),r=Math.min(y,r),i=Math.max(y,i),o.copy(m).subtract(f).subtract(h).add(g),A.copy(m).subtract(e),y=t.dot(A),r=Math.min(y,r),i=Math.max(y,i),o.copy(m).subtract(f).subtract(h).subtract(g),A.copy(m).subtract(e),y=t.dot(A),r=Math.min(y,r),i=Math.max(y,i),s[0]=r,s[1]=i,s}transform(e){this.center.transformAsPoint(e);const t=this.halfAxes.getColumn(0,_f);t.transformAsPoint(e);const s=this.halfAxes.getColumn(1,Af);s.transformAsPoint(e);const r=this.halfAxes.getColumn(2,yf);return r.transformAsPoint(e),this.halfAxes=new at([...t,...s,...r]),this}getTransform(){throw new Error("not implemented")}}const lv=new L,uv=new L;class Fs{constructor(e=[0,0,1],t=0){this.normal=new L,this.distance=-0,this.fromNormalDistance(e,t)}fromNormalDistance(e,t){return ps(Number.isFinite(t)),this.normal.from(e).normalize(),this.distance=t,this}fromPointNormal(e,t){e=lv.from(e),this.normal.from(t).normalize();const s=-this.normal.dot(e);return this.distance=s,this}fromCoefficients(e,t,s,r){return this.normal.set(e,t,s),ps(Ts(this.normal.len(),1)),this.distance=r,this}clone(){return new Fs(this.normal,this.distance)}equals(e){return Ts(this.distance,e.distance)&&Ts(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const t=uv.copy(this.normal).transformAsVector(e).normalize(),s=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(s,t)}projectPointOntoPlane(e,t=[0,0,0]){const s=lv.from(e),r=this.getPointDistance(s),i=uv.copy(this.normal).scale(r);return s.subtract(i).to(t)}}const fv=[new L([1,0,0]),new L([0,1,0]),new L([0,0,1])],hv=new L,MG=new L;class Yn{constructor(e=[]){this.planes=e}fromBoundingSphere(e){this.planes.length=2*fv.length;const t=e.center,s=e.radius;let r=0;for(const i of fv){let o=this.planes[r],l=this.planes[r+1];o||(o=this.planes[r]=new Fs),l||(l=this.planes[r+1]=new Fs);const f=hv.copy(i).scale(-s).add(t);o.fromPointNormal(f,i);const h=hv.copy(i).scale(s).add(t),g=MG.copy(i).negate();l.fromPointNormal(h,g),r+=2}return this}computeVisibility(e){let t=On.INSIDE;for(const s of this.planes)switch(e.intersectPlane(s)){case On.OUTSIDE:return On.OUTSIDE;case On.INTERSECTING:t=On.INTERSECTING;break}return t}computeVisibilityWithPlaneMask(e,t){if(ps(Number.isFinite(t),"parentPlaneMask is required."),t===Yn.MASK_OUTSIDE||t===Yn.MASK_INSIDE)return t;let s=Yn.MASK_INSIDE;const r=this.planes;for(let i=0;i<this.planes.length;++i){const o=i<31?1<<i:0;if(i<31&&(t&o)===0)continue;const l=r[i],f=e.intersectPlane(l);if(f===On.OUTSIDE)return Yn.MASK_OUTSIDE;f===On.INTERSECTING&&(s|=o)}return s}}Yn.MASK_OUTSIDE=4294967295;Yn.MASK_INSIDE=0;Yn.MASK_INDETERMINATE=2147483647;new L;new L;new L;new L;new L;new L;new L;new L;new L;new L;new L;new L;new L;new L;new L;new L;new L;const Ds=new at,OG=new at,DG=new at,bf=new at,dv=new at;function NG(n,e={}){const t=fL,s=10;let r=0,i=0;const o=OG,l=DG;o.identity(),l.copy(n);const f=t*FG(l);for(;i<s&&PG(l)>f;)UG(l,bf),dv.copy(bf).transpose(),l.multiplyRight(bf),l.multiplyLeft(dv),o.multiplyRight(bf),++r>2&&(++i,r=0);return e.unitary=o.toTarget(e.unitary),e.diagonal=l.toTarget(e.diagonal),e}function FG(n){let e=0;for(let t=0;t<9;++t){const s=n[t];e+=s*s}return Math.sqrt(e)}const Q_=[1,0,0],Z_=[2,2,1];function PG(n){let e=0;for(let t=0;t<3;++t){const s=n[Ds.getElementIndex(Z_[t],Q_[t])];e+=2*s*s}return Math.sqrt(e)}function UG(n,e){const t=Z3;let s=0,r=1;for(let h=0;h<3;++h){const g=Math.abs(n[Ds.getElementIndex(Z_[h],Q_[h])]);g>s&&(r=h,s=g)}const i=Q_[r],o=Z_[r];let l=1,f=0;if(Math.abs(n[Ds.getElementIndex(o,i)])>t){const h=n[Ds.getElementIndex(o,o)],g=n[Ds.getElementIndex(i,i)],m=n[Ds.getElementIndex(o,i)],A=(h-g)/2/m;let y;A<0?y=-1/(-A+Math.sqrt(1+A*A)):y=1/(A+Math.sqrt(1+A*A)),l=1/Math.sqrt(1+y*y),f=y*l}return at.IDENTITY.to(e),e[Ds.getElementIndex(i,i)]=e[Ds.getElementIndex(o,o)]=l,e[Ds.getElementIndex(o,i)]=f,e[Ds.getElementIndex(i,o)]=-f,e}const Xr=new L,LG=new L,kG=new L,HG=new L,GG=new L,VG=new at,jG={diagonal:new at,unitary:new at};function dw(n,e=new Dl){if(!n||n.length===0)return e.halfAxes=new at([0,0,0,0,0,0,0,0,0]),e.center=new L,e;const t=n.length,s=new L(0,0,0);for(const ee of n)s.add(ee);const r=1/t;s.multiplyByScalar(r);let i=0,o=0,l=0,f=0,h=0,g=0;for(const ee of n){const le=Xr.copy(ee).subtract(s);i+=le.x*le.x,o+=le.x*le.y,l+=le.x*le.z,f+=le.y*le.y,h+=le.y*le.z,g+=le.z*le.z}i*=r,o*=r,l*=r,f*=r,h*=r,g*=r;const m=VG;m[0]=i,m[1]=o,m[2]=l,m[3]=o,m[4]=f,m[5]=h,m[6]=l,m[7]=h,m[8]=g;const{unitary:A}=NG(m,jG),y=e.halfAxes.copy(A);let E=y.getColumn(0,kG),v=y.getColumn(1,HG),S=y.getColumn(2,GG),x=-Number.MAX_VALUE,O=-Number.MAX_VALUE,R=-Number.MAX_VALUE,D=Number.MAX_VALUE,z=Number.MAX_VALUE,J=Number.MAX_VALUE;for(const ee of n)Xr.copy(ee),x=Math.max(Xr.dot(E),x),O=Math.max(Xr.dot(v),O),R=Math.max(Xr.dot(S),R),D=Math.min(Xr.dot(E),D),z=Math.min(Xr.dot(v),z),J=Math.min(Xr.dot(S),J);E=E.multiplyByScalar(.5*(D+x)),v=v.multiplyByScalar(.5*(z+O)),S=S.multiplyByScalar(.5*(J+R)),e.center.copy(E).add(v).add(S);const ie=LG.set(x-D,O-z,R-J).multiplyByScalar(.5),re=new at([ie[0],0,0,0,ie[1],0,0,0,ie[2]]);return e.halfAxes.multiplyRight(re),e}const pm=Math.PI/180,Tf=new Float32Array(16),gv=new Float32Array(12);function pv(n,e,t){const s=e[0]*pm,r=e[1]*pm,i=e[2]*pm,o=Math.sin(i),l=Math.sin(s),f=Math.sin(r),h=Math.cos(i),g=Math.cos(s),m=Math.cos(r),A=t[0],y=t[1],E=t[2];n[0]=A*m*g,n[1]=A*f*g,n[2]=A*-l,n[3]=y*(-f*h+m*l*o),n[4]=y*(m*h+f*l*o),n[5]=y*g*o,n[6]=E*(f*o+m*l*h),n[7]=E*(-m*o+f*l*h),n[8]=E*g*h}function mv(n){return n[0]=n[0],n[1]=n[1],n[2]=n[2],n[3]=n[4],n[4]=n[5],n[5]=n[6],n[6]=n[8],n[7]=n[9],n[8]=n[10],n[9]=n[12],n[10]=n[13],n[11]=n[14],n.subarray(0,12)}const gw={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrixCol0:{size:3,elementOffset:0},instanceModelMatrixCol1:{size:3,elementOffset:3},instanceModelMatrixCol2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(n,{startRow:e,endRow:t}){const{data:s,getOrientation:r,getScale:i,getTranslation:o,getTransformMatrix:l}=this.props,f=Array.isArray(l),h=f&&l.length===16,g=Array.isArray(i),m=Array.isArray(r),A=Array.isArray(o),y=h||!f&&!!l(s[0]);y?n.constant=h:n.constant=m&&g&&A;const E=n.value;if(n.constant){let v;y?(Tf.set(l),v=mv(Tf)):(v=gv,pv(v,r,i),v.set(o,9)),n.value=new Float32Array(v)}else{let v=e*n.size;const{iterable:S,objectInfo:x}=K2(s,e,t);for(const O of S){x.index++;let R;if(y)Tf.set(h?l:l(O,x)),R=mv(Tf);else{R=gv;const D=m?r:r(O,x),z=g?i:i(O,x);pv(R,D,z),R.set(A?o:o(O,x),9)}E[v++]=R[0],E[v++]=R[1],E[v++]=R[2],E[v++]=R[3],E[v++]=R[4],E[v++]=R[5],E[v++]=R[6],E[v++]=R[7],E[v++]=R[8],E[v++]=R[9],E[v++]=R[10],E[v++]=R[11]}}}};function pw(n,e){return e===Me.CARTESIAN||e===Me.METER_OFFSETS||e===Me.DEFAULT&&!n.isGeospatial}const _v=`uniform simpleMeshUniforms {
  float sizeScale;
  bool composeModelMatrix;
  bool hasTexture;
  bool flatShading;
} simpleMesh;
`,zG={name:"simpleMesh",vs:_v,fs:_v,uniformTypes:{sizeScale:"f32",composeModelMatrix:"f32",hasTexture:"f32",flatShading:"f32"}},$G=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = texCoords;
geometry.pickingColor = instancePickingColors;
vTexCoord = texCoords;
cameraPosition = project.cameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 pos = (instanceModelMatrix * positions) * simpleMesh.sizeScale + instanceTranslation;
if (simpleMesh.composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
geometry.position = position_commonspace;
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
}
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,XG=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform sampler2D sampler;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
geometry.uv = vTexCoord;
vec3 normal;
if (simpleMesh.flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = simpleMesh.hasTexture ? texture(sampler, vTexCoord) : vColor;
DECKGL_FILTER_COLOR(color, geometry);
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * layer.opacity);
}
`;function mm(n){const e=n.positions||n.POSITION;Ve.assert(e,'no "postions" or "POSITION" attribute in mesh');const t=e.value.length/e.size;let s=n.COLOR_0||n.colors;s||(s={size:3,value:new Float32Array(t*3).fill(1)});let r=n.NORMAL||n.normals;r||(r={size:3,value:new Float32Array(t*3).fill(0)});let i=n.TEXCOORD_0||n.texCoords;return i||(i={size:2,value:new Float32Array(t*2).fill(0)}),{positions:e,colors:s,normals:r,texCoords:i}}function Av(n){return n instanceof ca?(n.attributes=mm(n.attributes),n):n.attributes?new ca({...n,topology:"triangle-list",attributes:mm(n.attributes)}):new ca({topology:"triangle-list",attributes:mm(n)})}const JG=[0,0,0,255],WG={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:n=>n.position},getColor:{type:"accessor",value:JG},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0,value:null}};class py extends Oa{getShaders(){return super.getShaders({vs:$G,fs:XG,modules:[ey,o2,ry,zG]})}getBounds(){var s;if(this.props._instanced)return super.getBounds();let e=this.state.positionBounds;if(e)return e;const{mesh:t}=this.props;if(!t)return null;if(e=(s=t.header)==null?void 0:s.boundingBox,!e){const{attributes:r}=Av(t);r.POSITION=r.POSITION||r.positions,e=xA(r)}return this.state.positionBounds=e,e}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:"float64",fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:"unorm8",transition:!0,size:this.props.colorFormat.length,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:gw}),this.setState({emptyTexture:this.context.device.createTexture({data:new Uint8Array(4),width:1,height:1})})}updateState(e){var i;super.updateState(e);const{props:t,oldProps:s,changeFlags:r}=e;if(t.mesh!==s.mesh||r.extensionsChanged){if(this.state.positionBounds=null,(i=this.state.model)==null||i.destroy(),t.mesh){this.state.model=this.getModel(t.mesh);const o=t.mesh.attributes||t.mesh;this.setState({hasNormals:!!(o.NORMAL||o.normals)})}this.getAttributeManager().invalidateAll()}t.texture!==s.texture&&t.texture instanceof dt&&this.setTexture(t.texture),this.state.model&&this.state.model.setTopology(this.props.wireframe?"line-strip":"triangle-list")}finalizeState(e){super.finalizeState(e),this.state.emptyTexture.delete()}draw({uniforms:e}){const{model:t}=this.state;if(!t)return;const{viewport:s,renderPass:r}=this.context,{sizeScale:i,coordinateSystem:o,_instanced:l}=this.props,f={sizeScale:i,composeModelMatrix:!l||pw(s,o),flatShading:!this.state.hasNormals};t.shaderInputs.setProps({simpleMesh:f}),t.draw(r)}get isLoaded(){var e;return!!((e=this.state)!=null&&e.model&&super.isLoaded)}getModel(e){const t=new ri(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:Av(e),isInstanced:!0}),{texture:s}=this.props,{emptyTexture:r}=this.state,i={sampler:s||r,hasTexture:!!s};return t.shaderInputs.setProps({simpleMesh:i}),t}setTexture(e){const{emptyTexture:t,model:s}=this.state;if(s){const r={sampler:e||t,hasTexture:!!e};s.shaderInputs.setProps({simpleMesh:r})}}}py.defaultProps=WG;py.layerName="SimpleMeshLayer";var ms;(function(n){n[n.FUNC_ADD=32774]="FUNC_ADD",n[n.ONE=1]="ONE",n[n.SRC_ALPHA=770]="SRC_ALPHA",n[n.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",n[n.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",n[n.LINEAR=9729]="LINEAR",n[n.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",n[n.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL"})(ms||(ms={}));function mw(n,e,t,s){const r={defines:{MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},bindings:{},uniforms:{camera:[0,0,0],metallicRoughnessValues:[1,1]},parameters:{},glParameters:{},generatedTextures:[]};r.defines.USE_TEX_LOD=1;const{imageBasedLightingEnvironment:i}=s;return i&&(r.bindings.pbr_diffuseEnvSampler=i.diffuseEnvSampler.texture,r.bindings.pbr_specularEnvSampler=i.specularEnvSampler.texture,r.bindings.pbr_BrdfLUT=i.brdfLutTexture.texture,r.uniforms.scaleIBLAmbient=[1,1]),s!=null&&s.pbrDebug&&(r.defines.PBR_DEBUG=1,r.uniforms.scaleDiffBaseMR=[0,0,0,0],r.uniforms.scaleFGDSpec=[0,0,0,0]),t.NORMAL&&(r.defines.HAS_NORMALS=1),t.TANGENT&&(s!=null&&s.useTangents)&&(r.defines.HAS_TANGENTS=1),t.TEXCOORD_0&&(r.defines.HAS_UV=1),s!=null&&s.imageBasedLightingEnvironment&&(r.defines.USE_IBL=1),s!=null&&s.lights&&(r.defines.USE_LIGHTS=1),e&&YG(n,e,r),r}function YG(n,e,t){if(t.uniforms.unlit=!!e.unlit,e.pbrMetallicRoughness&&KG(n,e.pbrMetallicRoughness,t),e.normalTexture){ll(n,e.normalTexture,"pbr_normalSampler","HAS_NORMALMAP",t);const{scale:s=1}=e.normalTexture;t.uniforms.normalScale=s}if(e.occlusionTexture){ll(n,e.occlusionTexture,"pbr_occlusionSampler","HAS_OCCLUSIONMAP",t);const{strength:s=1}=e.occlusionTexture;t.uniforms.occlusionStrength=s}switch(e.emissiveTexture&&(ll(n,e.emissiveTexture,"pbr_emissiveSampler","HAS_EMISSIVEMAP",t),t.uniforms.emissiveFactor=e.emissiveFactor||[0,0,0]),e.alphaMode){case"MASK":const{alphaCutoff:s=.5}=e;t.defines.ALPHA_CUTOFF=1,t.uniforms.alphaCutoff=s;break;case"BLEND":te.warn("glTF BLEND alphaMode might not work well because it requires mesh sorting")(),t.parameters.blendColorOperation="add",t.parameters.blendColorSrcFactor="src-alpha",t.parameters.blendColorDstFactor="one-minus-src-alpha",t.parameters.blendAlphaOperation="add",t.parameters.blendAlphaSrcFactor="one",t.parameters.blendAlphaDstFactor="one-minus-src-alpha",t.glParameters.blend=!0,t.glParameters.blendEquation=ms.FUNC_ADD,t.glParameters.blendFunc=[ms.SRC_ALPHA,ms.ONE_MINUS_SRC_ALPHA,ms.ONE,ms.ONE_MINUS_SRC_ALPHA];break}}function KG(n,e,t){e.baseColorTexture&&ll(n,e.baseColorTexture,"pbr_baseColorSampler","HAS_BASECOLORMAP",t),t.uniforms.baseColorFactor=e.baseColorFactor||[1,1,1,1],e.metallicRoughnessTexture&&ll(n,e.metallicRoughnessTexture,"pbr_metallicRoughnessSampler","HAS_METALROUGHNESSMAP",t);const{metallicFactor:s=1,roughnessFactor:r=1}=e;t.uniforms.metallicRoughnessValues=[s,r]}function ll(n,e,t,s=null,r){var g,m;const i=((m=(g=e==null?void 0:e.texture)==null?void 0:g.sampler)==null?void 0:m.parameters)||{},o=e.texture.source.image;let l,f={};o.compressed?(l=o,f={[ms.TEXTURE_MIN_FILTER]:o.data.length>1?ms.LINEAR_MIPMAP_NEAREST:ms.LINEAR}):l={data:o};const h=n.createTexture({id:e.uniformName||e.id,parameters:{...i,...f},pixelStore:{[ms.UNPACK_FLIP_Y_WEBGL]:!1},...l});r.bindings[t]=h,s&&(r.defines[s]=1),r.generatedTextures.push(h)}const qG="4.3.2",bh={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let yv;async function bv(n){aO(n.modules);const e=cO("basis");return e||(yv||(yv=QG(n)),await yv)}async function QG(n){let e=null,t=null;return[e,t]=await Promise.all([await js(bh.TRANSCODER,"textures",n),await js(bh.TRANSCODER_WASM,"textures",n)]),e=e||globalThis.BASIS,await ZG(e,t)}function ZG(n,e){const t={};return e&&(t.wasmBinary=e),new Promise(s=>{n(t).then(r=>{const{BasisFile:i,initializeBasis:o}=r;o(),s({BasisFile:i})})})}let _m;async function Tv(n){const e=n.modules||{};return e.basisEncoder?e.basisEncoder:(_m=_m||eV(n),await _m)}async function eV(n){let e=null,t=null;return[e,t]=await Promise.all([await js(bh.ENCODER,"textures",n),await js(bh.ENCODER_WASM,"textures",n)]),e=e||globalThis.BASIS,await tV(e,t)}function tV(n,e){const t={};return e&&(t.wasmBinary=e),new Promise(s=>{n(t).then(r=>{const{BasisFile:i,KTX2File:o,initializeBasis:l,BasisEncoder:f}=r;l(),s({BasisFile:i,KTX2File:o,BasisEncoder:f})})})}const Vo={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_ASTC_4X4_KHR:37808},nV=["","WEBKIT_","MOZ_"],Ev={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let Ef=null;function sV(n){if(!Ef){n=n||rV()||void 0,Ef=new Set;for(const e of nV)for(const t in Ev)if(n&&n.getExtension(`${e}${t}`)){const s=Ev[t];Ef.add(s)}}return Ef}function rV(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}const xn=[171,75,84,88,32,50,48,187,13,10,26,10];function iV(n){const e=new Uint8Array(n);return!(e.byteLength<xn.length||e[0]!==xn[0]||e[1]!==xn[1]||e[2]!==xn[2]||e[3]!==xn[3]||e[4]!==xn[4]||e[5]!==xn[5]||e[6]!==xn[6]||e[7]!==xn[7]||e[8]!==xn[8]||e[9]!==xn[9]||e[10]!==xn[10]||e[11]!==xn[11])}const oV={etc1:{basisFormat:0,compressed:!0,format:Vo.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:Vo.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:Vo.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:Vo.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:Vo.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:Vo.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function aV(n,e){if(e.basis.containerFormat==="auto"){if(iV(n)){const s=await Tv(e);return Cv(s.KTX2File,n,e)}const{BasisFile:t}=await bv(e);return Am(t,n,e)}switch(e.basis.module){case"encoder":const t=await Tv(e);switch(e.basis.containerFormat){case"ktx2":return Cv(t.KTX2File,n,e);case"basis":default:return Am(t.BasisFile,n,e)}case"transcoder":default:const{BasisFile:s}=await bv(e);return Am(s,n,e)}}function Am(n,e,t){const s=new n(new Uint8Array(e));try{if(!s.startTranscoding())throw new Error("Failed to start basis transcoding");const r=s.getNumImages(),i=[];for(let o=0;o<r;o++){const l=s.getNumLevels(o),f=[];for(let h=0;h<l;h++)f.push(cV(s,o,h,t));i.push(f)}return i}finally{s.close(),s.delete()}}function cV(n,e,t,s){const r=n.getImageWidth(e,t),i=n.getImageHeight(e,t),o=n.getHasAlpha(),{compressed:l,format:f,basisFormat:h}=_w(s,o),g=n.getImageTranscodedSizeInBytes(e,t,h),m=new Uint8Array(g);if(!n.transcodeImage(m,e,t,h,0,0))throw new Error("failed to start Basis transcoding");return{width:r,height:i,data:m,compressed:l,format:f,hasAlpha:o}}function Cv(n,e,t){const s=new n(new Uint8Array(e));try{if(!s.startTranscoding())throw new Error("failed to start KTX2 transcoding");const r=s.getLevels(),i=[];for(let o=0;o<r;o++)i.push(lV(s,o,t));return[i]}finally{s.close(),s.delete()}}function lV(n,e,t){const{alphaFlag:s,height:r,width:i}=n.getImageLevelInfo(e,0,0),{compressed:o,format:l,basisFormat:f}=_w(t,s),h=n.getImageTranscodedSizeInBytes(e,0,0,f),g=new Uint8Array(h);if(!n.transcodeImage(g,e,0,0,f,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:i,height:r,data:g,compressed:o,levelSize:h,hasAlpha:s,format:l}}function _w(n,e){let t=n&&n.basis&&n.basis.format;return t==="auto"&&(t=Aw()),typeof t=="object"&&(t=e?t.alpha:t.noAlpha),t=t.toLowerCase(),oV[t]}function Aw(){const n=sV();return n.has("astc")?"astc-4x4":n.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:n.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:n.has("etc1")?"etc1":n.has("etc2")?"etc2":"rgb565"}const uV={dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:qG,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},fV={...uV,parse:aV},hV={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},dV={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};class gV{constructor(e){b(this,"name");b(this,"startTime",0);b(this,"playing",!0);b(this,"speed",1);b(this,"channels",[]);Object.assign(this,e)}animate(e){if(!this.playing)return;const s=(e/1e3-this.startTime)*this.speed;this.channels.forEach(({sampler:r,target:i,path:o})=>{TV(s,r,i,o),_V(i,i._node)})}}class pV{constructor(e){b(this,"animations");this.animations=e.animations.map((t,s)=>{const r=t.name||`Animation-${s}`,i=t.samplers.map(({input:l,interpolation:f="LINEAR",output:h})=>({input:vv(e.accessors[l]),interpolation:f,output:vv(e.accessors[h])})),o=t.channels.map(({sampler:l,target:f})=>({sampler:i[l],target:e.nodes[f.node],path:f.path}));return new gV({name:r,channels:o})})}animate(e){this.setTime(e)}setTime(e){this.animations.forEach(t=>t.animate(e))}getAnimations(){return this.animations}}function vv(n){if(!n._animation){const e=dV[n.componentType],t=hV[n.type],s=t*n.count,{buffer:r,byteOffset:i}=n.bufferView.data,o=new e(r,i+(n.byteOffset||0),s);if(t===1)n._animation=Array.from(o);else{const l=[];for(let f=0;f<o.length;f+=t)l.push(Array.from(o.slice(f,f+t)));n._animation=l}}return n._animation}const mV=new we;function _V(n,e){if(e.matrix.identity(),n.translation&&e.matrix.translate(n.translation),n.rotation){const t=mV.fromQuaternion(n.rotation);e.matrix.multiplyRight(t)}n.scale&&e.matrix.scale(n.scale)}const ym=new ga;function AV(n,e,t,s,r){if(e==="rotation"){ym.slerp({start:t,target:s,ratio:r});for(let i=0;i<ym.length;i++)n[e][i]=ym[i]}else for(let i=0;i<t.length;i++)n[e][i]=r*s[i]+(1-r)*t[i]}function yV(n,e,{p0:t,outTangent0:s,inTangent1:r,p1:i,tDiff:o,ratio:l}){for(let f=0;f<n[e].length;f++){const h=s[f]*o,g=r[f]*o;n[e][f]=(2*Math.pow(l,3)-3*Math.pow(l,2)+1)*t[f]+(Math.pow(l,3)-2*Math.pow(l,2)+l)*h+(-2*Math.pow(l,3)+3*Math.pow(l,2))*i[f]+(Math.pow(l,3)-Math.pow(l,2))*g}}function bV(n,e,t){for(let s=0;s<t.length;s++)n[e][s]=t[s]}function TV(n,{input:e,interpolation:t,output:s},r,i){const o=e[e.length-1],l=n%o,f=e.findIndex(A=>A>=l),h=Math.max(0,f-1);if(!Array.isArray(r[i]))switch(i){case"translation":r[i]=[0,0,0];break;case"rotation":r[i]=[0,0,0,1];break;case"scale":r[i]=[1,1,1];break;default:te.warn(`Bad animation path ${i}`)()}const g=e[h],m=e[f];switch(t){case"STEP":bV(r,i,s[h]);break;case"LINEAR":if(m>g){const A=(l-g)/(m-g);AV(r,i,s[h],s[f],A)}break;case"CUBICSPLINE":if(m>g){const A=(l-g)/(m-g),y=m-g,E=s[3*h+1],v=s[3*h+2],S=s[3*f+0],x=s[3*f+1];yV(r,i,{p0:E,outTangent0:v,inTangent1:S,p1:x,tDiff:y,ratio:A})}break;default:te.warn(`Interpolation ${t} not supported`)();break}}const EV=`
layout(0) positions: vec4; // in vec4 POSITION;

  #ifdef HAS_NORMALS
    in vec4 normals; // in vec4 NORMAL;
  #endif

  #ifdef HAS_TANGENTS
    in vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // in vec2 TEXCOORD_0;
    in vec2 texCoords;
  #endif

@vertex
  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * positions;
  }

@fragment
  out vec4 fragmentColor;

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`,CV=`#version 300 es

  // in vec4 POSITION;
  in vec4 positions;

  #ifdef HAS_NORMALS
    // in vec4 NORMAL;
    in vec4 normals;
  #endif

  #ifdef HAS_TANGENTS
    in vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // in vec2 TEXCOORD_0;
    in vec2 texCoords;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = pbrProjection.modelViewProjectionMatrix * positions;
  }
`,vV=`#version 300 es
  out vec4 fragmentColor;

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`;function BV(n,e){const{id:t,geometry:s,material:r,vertexCount:i,materialOptions:o,modelOptions:l}=e,f=mw(n,r,s.attributes,o);te.info(4,"createGLTFModel defines: ",f.defines)();const h=[],g={depthWriteEnabled:!0,depthCompare:"less",depthFormat:"depth24plus",cullMode:"back"},m={id:t,source:EV,vs:CV,fs:vV,geometry:s,topology:s.topology,vertexCount:i,modules:[QA],...l,defines:{...f.defines,...l.defines},parameters:{...g,...f.parameters,...l.parameters}},A=new ri(n,m),{camera:y,...E}={...f.uniforms,...l.uniforms,...f.bindings,...l.bindings};return A.shaderInputs.setProps({pbrMaterial:E,pbrProjection:{camera:y}}),new V_({managedResources:h,model:A})}var Oi;(function(n){n[n.POINTS=0]="POINTS",n[n.LINES=1]="LINES",n[n.LINE_LOOP=2]="LINE_LOOP",n[n.LINE_STRIP=3]="LINE_STRIP",n[n.TRIANGLES=4]="TRIANGLES",n[n.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",n[n.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(Oi||(Oi={}));function SV(n){switch(n){case Oi.POINTS:return"point-list";case Oi.LINES:return"line-list";case Oi.LINE_STRIP:return"line-strip";case Oi.TRIANGLES:return"triangle-list";case Oi.TRIANGLE_STRIP:return"triangle-strip";default:throw new Error(String(n))}}const wV={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class RV{constructor(e,t={}){b(this,"device");b(this,"options");b(this,"gltf");this.device=e,this.options={...wV,...t}}instantiate(e){return this.gltf=eA(e),(this.gltf.scenes||[]).map(s=>this.createScene(s))}createAnimator(){return Array.isArray(this.gltf.animations)?new pV(this.gltf):null}createScene(e){const s=(e.nodes||[]).map(i=>this.createNode(i));return new la({id:e.name||e.id,children:s})}createNode(e){if(!e._node){const r=(e.children||[]).map(o=>this.createNode(o));e.mesh&&r.push(this.createMesh(e.mesh));const i=new la({id:e.name||e.id,children:r});if(e.matrix)i.setMatrix(e.matrix);else{if(i.matrix.identity(),e.translation&&i.matrix.translate(e.translation),e.rotation){const o=new we().fromQuaternion(e.rotation);i.matrix.multiplyRight(o)}e.scale&&i.matrix.scale(e.scale)}e._node=i}const t=this.gltf.nodes.find(s=>s.id===e.id);return t._node=e._node,e._node}createMesh(e){if(!e._mesh){const s=(e.primitives||[]).map((i,o)=>this.createPrimitive(i,o,e)),r=new la({id:e.name||e.id,children:s});e._mesh=r}return e._mesh}createPrimitive(e,t,s){const r=e.name||`${s.name||s.id}-primitive-${t}`,i=SV(e.mode||4),o=e.indices?e.indices.count:this.getVertexCount(e.attributes),l=BV(this.device,{id:r,geometry:this.createGeometry(r,e,i),material:e.material,materialOptions:this.options,modelOptions:this.options.modelOptions,vertexCount:o});return l.bounds=[e.attributes.POSITION.min,e.attributes.POSITION.max],l}getVertexCount(e){throw new Error("getVertexCount not implemented")}createGeometry(e,t,s){const r={};for(const[i,o]of Object.entries(t.attributes)){const{components:l,size:f,value:h}=o;r[i]={size:f??l,value:h}}return new ca({id:e,topology:s,indices:t.indices.value,attributes:r})}createBuffer(e,t){e.bufferView||(e.bufferView={});const{bufferView:s}=e;return s.lumaBuffers||(s.lumaBuffers={}),s.lumaBuffers[t]||(s.lumaBuffers[t]=this.device.createBuffer({id:`from-${s.id}`,data:s.data||e.value})),s.lumaBuffers[t]}createSampler(e){return e}needsPOT(){return!1}}function eA(n){if(ArrayBuffer.isView(n)||n instanceof ArrayBuffer||n instanceof ImageBitmap)return n;if(Array.isArray(n))return n.map(eA);if(n&&typeof n=="object"){const e={};for(const t in n)e[t]=eA(n[t]);return e}return n}function xV(n,e,t){const s=new RV(n,t),r=s.instantiate(e),i=s.createAnimator();return{scenes:r,animator:i}}function Fn(n,e){if(!n)throw new Error(e||"assert failed: gltf")}const yw={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},bw={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},IV=1.33,Bv=["SCALAR","VEC2","VEC3","VEC4"],MV=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],OV=new Map(MV),DV={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},NV={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},FV={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function Tw(n){return Bv[n-1]||Bv[0]}function ed(n){const e=OV.get(n.constructor);if(!e)throw new Error("Illegal typed array");return e}function my(n,e){const t=FV[n.componentType],s=DV[n.type],r=NV[n.componentType],i=n.count*s,o=n.count*s*r;Fn(o>=0&&o<=e.byteLength);const l=bw[n.componentType],f=yw[n.type];return{ArrayType:t,length:i,byteLength:o,componentByteSize:l,numberOfComponentsInElement:f}}function Ew(n){let{images:e,bufferViews:t}=n;e=e||[],t=t||[];const s=e.map(o=>o.bufferView);t=t.filter(o=>!s.includes(o));const r=t.reduce((o,l)=>o+l.byteLength,0),i=e.reduce((o,l)=>{const{width:f,height:h}=l.image;return o+f*h},0);return r+Math.ceil(4*i*IV)}function PV(n,e,t){const s=n.bufferViews[t];Fn(s);const r=s.buffer,i=e[r];Fn(i);const o=(s.byteOffset||0)+i.byteOffset;return new Uint8Array(i.arrayBuffer,o,s.byteLength)}function UV(n,e,t){var v,S;const s=typeof t=="number"?(v=n.accessors)==null?void 0:v[t]:t;if(!s)throw new Error(`No gltf accessor ${JSON.stringify(t)}`);const r=(S=n.bufferViews)==null?void 0:S[s.bufferView||0];if(!r)throw new Error(`No gltf buffer view for accessor ${r}`);const{arrayBuffer:i,byteOffset:o}=e[r.buffer],l=(o||0)+(s.byteOffset||0)+(r.byteOffset||0),{ArrayType:f,length:h,componentByteSize:g,numberOfComponentsInElement:m}=my(s,r),A=g*m,y=r.byteStride||A;if(typeof r.byteStride>"u"||r.byteStride===A)return new f(i,l,h);const E=new f(h);for(let x=0;x<s.count;x++){const O=new f(i,l+x*y,m);E.set(O,x*m)}return E}function LV(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}let kt=class{constructor(e){b(this,"gltf");b(this,"sourceBuffers");b(this,"byteLength");this.gltf={json:(e==null?void 0:e.json)||LV(),buffers:(e==null?void 0:e.buffers)||[],images:(e==null?void 0:e.images)||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){const t=this.getUsedExtensions().find(r=>r===e),s=this.getRequiredExtensions().find(r=>r===e);return typeof t=="string"||typeof s=="string"}getExtension(e){const t=this.getUsedExtensions().find(r=>r===e),s=this.json.extensions||{};return t?s[e]:null}getRequiredExtension(e){return this.getRequiredExtensions().find(s=>s===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,t){return(e.extensions||{})[t]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,t){if(typeof t=="object")return t;const s=this.json[e]&&this.json[e][t];if(!s)throw new Error(`glTF file error: Could not find ${e}[${t}]`);return s}getTypedArrayForBufferView(e){e=this.getBufferView(e);const t=e.buffer,s=this.gltf.buffers[t];Fn(s);const r=(e.byteOffset||0)+s.byteOffset;return new Uint8Array(s.arrayBuffer,r,e.byteLength)}getTypedArrayForAccessor(e){const t=this.getAccessor(e);return UV(this.gltf.json,this.gltf.buffers,t)}getTypedArrayForImageData(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),r=this.getBuffer(t.buffer).data,i=t.byteOffset||0;return new Uint8Array(r,i,t.byteLength)}addApplicationData(e,t){return this.json[e]=t,this}addExtraData(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}addObjectExtension(e,t,s){return e.extensions=e.extensions||{},e.extensions[t]=s,this.registerUsedExtension(t),this}setObjectExtension(e,t,s){const r=e.extensions||{};r[t]=s}removeObjectExtension(e,t){const s=(e==null?void 0:e.extensions)||{};if(s[t]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const r=this.json.extensionsRemoved;r.includes(t)||r.push(t)}delete s[t]}addExtension(e,t={}){return Fn(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}addRequiredExtension(e,t={}){return Fn(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(t=>t===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(t=>t===e)||this.json.extensionsRequired.push(e)}removeExtension(e){var t;if((t=this.json.extensions)!=null&&t[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const s=this.json.extensionsRemoved;s.includes(e)||s.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:t}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:t}),this.json.scenes.length-1}addNode(e){const{meshIndex:t,matrix:s}=e;this.json.nodes=this.json.nodes||[];const r={mesh:t};return s&&(r.matrix=s),this.json.nodes.push(r),this.json.nodes.length-1}addMesh(e){const{attributes:t,indices:s,material:r,mode:i=4}=e,l={primitives:[{attributes:this._addAttributes(t),mode:i}]};if(s){const f=this._addIndices(s);l.primitives[0].indices=f}return Number.isFinite(r)&&(l.primitives[0].material=r),this.json.meshes=this.json.meshes||[],this.json.meshes.push(l),this.json.meshes.length-1}addPointCloud(e){const s={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(s),this.json.meshes.length-1}addImage(e,t){const s=MA(e),r=t||(s==null?void 0:s.mimeType),o={bufferView:this.addBufferView(e),mimeType:r};return this.json.images=this.json.images||[],this.json.images.push(o),this.json.images.length-1}addBufferView(e,t=0,s=this.byteLength){const r=e.byteLength;Fn(Number.isFinite(r)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const i={buffer:t,byteOffset:s,byteLength:r};return this.byteLength+=wl(r,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(i),this.json.bufferViews.length-1}addAccessor(e,t){const s={bufferView:e,type:Tw(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(s),this.json.accessors.length-1}addBinaryBuffer(e,t={size:3}){const s=this.addBufferView(e);let r={min:t.min,max:t.max};(!r.min||!r.max)&&(r=this._getAccessorMinMax(e,t.size));const i={size:t.size,componentType:ed(e),count:Math.round(e.length/t.size),min:r.min,max:r.max};return this.addAccessor(s,Object.assign(i,t))}addTexture(e){const{imageIndex:t}=e,s={source:t};return this.json.textures=this.json.textures||[],this.json.textures.push(s),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var i,o;const e=this.byteLength,t=new ArrayBuffer(e),s=new Uint8Array(t);let r=0;for(const l of this.sourceBuffers||[])r=NO(l,s,r);(o=(i=this.json)==null?void 0:i.buffers)!=null&&o[0]?this.json.buffers[0].byteLength=e:this.json.buffers=[{byteLength:e}],this.gltf.binary=t,this.sourceBuffers=[t],this.gltf.buffers=[{arrayBuffer:t,byteOffset:0,byteLength:t.byteLength}]}_removeStringFromArray(e,t){let s=!0;for(;s;){const r=e.indexOf(t);r>-1?e.splice(r,1):s=!1}}_addAttributes(e={}){const t={};for(const s in e){const r=e[s],i=this._getGltfAttributeName(s),o=this.addBinaryBuffer(r.value,r);t[i]=o}return t}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,t){const s={min:null,max:null};if(e.length<t)return s;s.min=[],s.max=[];const r=e.subarray(0,t);for(const i of r)s.min.push(i),s.max.push(i);for(let i=t;i<e.length;i+=t)for(let o=0;o<t;o++)s.min[0+o]=Math.min(s.min[0+o],e[i+o]),s.max[0+o]=Math.max(s.max[0+o],e[i+o]);return s}};function Sv(n){return(n%1+1)%1}const Cw={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},kV={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},vw={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function _y(n,e){return vw[e]*Cw[n]}function td(n,e,t,s){if(t!=="UINT8"&&t!=="UINT16"&&t!=="UINT32"&&t!=="UINT64")return null;const r=n.getTypedArrayForBufferView(e),i=nd(r,"SCALAR",t,s+1);return i instanceof BigInt64Array||i instanceof BigUint64Array?null:i}function nd(n,e,t,s=1){const r=Cw[e],i=kV[t],o=vw[t],l=s*r,f=l*o;let h=n.buffer,g=n.byteOffset;return g%o!==0&&(h=new Uint8Array(h).slice(g,g+f).buffer,g=0),new i(h,g,l)}function Ay(n,e,t){var h,g,m,A,y;const s=`TEXCOORD_${e.texCoord||0}`,r=t.attributes[s],i=n.getTypedArrayForAccessor(r),o=n.gltf.json,l=e.index,f=(g=(h=o.textures)==null?void 0:h[l])==null?void 0:g.source;if(typeof f<"u"){const E=(A=(m=o.images)==null?void 0:m[f])==null?void 0:A.mimeType,v=(y=n.gltf.images)==null?void 0:y[f];if(v&&typeof v.width<"u"){const S=[];for(let x=0;x<i.length;x+=2){const O=HV(v,E,i,x,e.channels);S.push(O)}return S}}return[]}function Bw(n,e,t,s,r){if(!(t!=null&&t.length))return;const i=[];for(const g of t){let m=s.findIndex(A=>A===g);m===-1&&(m=s.push(g)-1),i.push(m)}const o=new Uint32Array(i),l=n.gltf.buffers.push({arrayBuffer:o.buffer,byteOffset:o.byteOffset,byteLength:o.byteLength})-1,f=n.addBufferView(o,l,0),h=n.addAccessor(f,{size:1,componentType:ed(o),count:o.length});r.attributes[e]=h}function HV(n,e,t,s,r=[0]){const i={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},o=t[s],l=t[s+1];let f=1;e&&(e.indexOf("image/jpeg")!==-1||e.indexOf("image/png")!==-1)&&(f=4);const h=GV(o,l,n,f);let g=0;for(const m of r){const A=typeof m=="number"?Object.values(i)[m]:i[m],y=h+A.offset,E=$S(n);if(E.data.length<=y)throw new Error(`${E.data.length} <= ${y}`);const v=E.data[y];g|=v<<A.shift}return g}function GV(n,e,t,s=1){const r=t.width,i=Sv(n)*(r-1),o=Math.round(i),l=t.height,f=Sv(e)*(l-1),h=Math.round(f),g=t.components?t.components:s;return(h*r+o)*g}function Sw(n,e,t,s,r){const i=[];for(let o=0;o<e;o++){const l=t[o],f=t[o+1]-t[o];if(f+l>s)break;const h=l/r,g=f/r;i.push(n.slice(h,h+g))}return i}function ww(n,e,t){const s=[];for(let r=0;r<e;r++){const i=r*t;s.push(n.slice(i,i+t))}return s}function Rw(n,e,t,s){if(t)throw new Error("Not implemented - arrayOffsets for strings is specified");if(s){const r=[],i=new TextDecoder("utf8");let o=0;for(let l=0;l<n;l++){const f=s[l+1]-s[l];if(f+o<=e.length){const h=e.subarray(o,f+o),g=i.decode(h);r.push(g),o+=f}}return r}return[]}const fa="EXT_mesh_features",VV=fa;async function jV(n,e){const t=new kt(n);$V(t,e)}function zV(n,e){const t=new kt(n);return JV(t),t.createBinaryChunk(),t.gltf}function $V(n,e){const t=n.gltf.json;if(t.meshes)for(const s of t.meshes)for(const r of s.primitives)XV(n,r,e)}function XV(n,e,t){var i,o,l;if(!((i=t==null?void 0:t.gltf)!=null&&i.loadBuffers))return;const s=(o=e.extensions)==null?void 0:o[fa],r=s==null?void 0:s.featureIds;if(r)for(const f of r){let h;if(typeof f.attribute<"u"){const g=`_FEATURE_ID_${f.attribute}`,m=e.attributes[g];h=n.getTypedArrayForAccessor(m)}else typeof f.texture<"u"&&((l=t==null?void 0:t.gltf)!=null&&l.loadImages)?h=Ay(n,f.texture,e):h=[];f.data=h}}function JV(n,e){const t=n.gltf.json.meshes;if(t)for(const s of t)for(const r of s.primitives)YV(n,r)}function WV(n,e,t,s){e.extensions||(e.extensions={});let r=e.extensions[fa];r||(r={featureIds:[]},e.extensions[fa]=r);const{featureIds:i}=r,o={featureCount:t.length,propertyTable:s,data:t};i.push(o),n.addObjectExtension(e,fa,r)}function YV(n,e){var r;const t=(r=e.extensions)==null?void 0:r[fa];if(!t)return;const s=t.featureIds;s.forEach((i,o)=>{if(i.data){const{accessorKey:l,index:f}=KV(e.attributes),h=new Uint32Array(i.data);s[o]={featureCount:h.length,propertyTable:i.propertyTable,attribute:f},n.gltf.buffers.push({arrayBuffer:h.buffer,byteOffset:h.byteOffset,byteLength:h.byteLength});const g=n.addBufferView(h),m=n.addAccessor(g,{size:1,componentType:ed(h),count:h.length});e.attributes[l]=m}})}function KV(n){const e="_FEATURE_ID_",t=Object.keys(n).filter(i=>i.indexOf(e)===0);let s=-1;for(const i of t){const o=Number(i.substring(e.length));o>s&&(s=o)}return s++,{accessorKey:`${e}${s}`,index:s}}const qV=Object.freeze(Object.defineProperty({__proto__:null,createExtMeshFeatures:WV,decode:jV,encode:zV,name:VV},Symbol.toStringTag,{value:"Module"})),ya="EXT_structural_metadata",QV=ya;async function ZV(n,e){const t=new kt(n);t5(t,e)}function e5(n,e){const t=new kt(n);return _5(t),t.createBinaryChunk(),t.gltf}function t5(n,e){var s,r;if(!((s=e.gltf)!=null&&s.loadBuffers))return;const t=n.getExtension(ya);t&&((r=e.gltf)!=null&&r.loadImages&&n5(n,t),s5(n,t))}function n5(n,e){const t=e.propertyTextures,s=n.gltf.json;if(t&&s.meshes)for(const r of s.meshes)for(const i of r.primitives)i5(n,t,i,e)}function s5(n,e){const t=e.schema;if(!t)return;const s=t.classes,r=e.propertyTables;if(s&&r)for(const i in s){const o=r5(r,i);o&&a5(n,t,o)}}function r5(n,e){for(const t of n)if(t.class===e)return t;return null}function i5(n,e,t,s){var o;if(!e)return;const r=(o=t.extensions)==null?void 0:o[ya],i=r==null?void 0:r.propertyTextures;if(i)for(const l of i){const f=e[l];o5(n,f,t,s)}}function o5(n,e,t,s){var i;if(!e.properties)return;s.dataAttributeNames||(s.dataAttributeNames=[]);const r=e.class;for(const o in e.properties){const l=`${r}_${o}`,f=(i=e.properties)==null?void 0:i[o];if(!f)continue;f.data||(f.data=[]);const h=f.data,g=Ay(n,f,t);g!==null&&(Bw(n,l,g,h,t),f.data=h,s.dataAttributeNames.push(l))}}function a5(n,e,t){var i,o;const s=(i=e.classes)==null?void 0:i[t.class];if(!s)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${t.class}`);const r=t.count;for(const l in s.properties){const f=s.properties[l],h=(o=t.properties)==null?void 0:o[l];if(h){const g=c5(n,e,f,r,h);h.data=g}}}function c5(n,e,t,s,r){let i=[];const o=r.values,l=n.getTypedArrayForBufferView(o),f=l5(n,t,r,s),h=u5(n,r,s);switch(t.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{i=f5(t,s,l,f);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${t.type}`);case"STRING":{i=Rw(s,l,f,h);break}case"ENUM":{i=h5(e,t,s,l,f);break}default:throw new Error(`Unknown classProperty type ${t.type}`)}return i}function l5(n,e,t,s){return e.array&&typeof e.count>"u"&&typeof t.arrayOffsets<"u"?td(n,t.arrayOffsets,t.arrayOffsetType||"UINT32",s):null}function u5(n,e,t){return typeof e.stringOffsets<"u"?td(n,e.stringOffsets,e.stringOffsetType||"UINT32",t):null}function f5(n,e,t,s){const r=n.array,i=n.count,o=_y(n.type,n.componentType),l=t.byteLength/o;let f;return n.componentType?f=nd(t,n.type,n.componentType,l):f=t,r?s?Sw(f,e,s,t.length,o):i?ww(f,e,i):[]:f}function h5(n,e,t,s,r){var m;const i=e.enumType;if(!i)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const o=(m=n.enums)==null?void 0:m[i];if(!o)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${i}`);const l=o.valueType||"UINT16",f=_y(e.type,l),h=s.byteLength/f;let g=nd(s,e.type,l,h);if(g||(g=s),e.array){if(r)return d5({valuesData:g,numberOfElements:t,arrayOffsets:r,valuesDataBytesLength:s.length,elementSize:f,enumEntry:o});const A=e.count;return A?g5(g,t,A,o):[]}return yy(g,0,t,o)}function d5(n){const{valuesData:e,numberOfElements:t,arrayOffsets:s,valuesDataBytesLength:r,elementSize:i,enumEntry:o}=n,l=[];for(let f=0;f<t;f++){const h=s[f],g=s[f+1]-s[f];if(g+h>r)break;const m=h/i,A=g/i,y=yy(e,m,A,o);l.push(y)}return l}function g5(n,e,t,s){const r=[];for(let i=0;i<e;i++){const o=t*i,l=yy(n,o,t,s);r.push(l)}return r}function yy(n,e,t,s){const r=[];for(let i=0;i<t;i++)if(n instanceof BigInt64Array||n instanceof BigUint64Array)r.push("");else{const o=n[e+i],l=p5(s,o);l?r.push(l.name):r.push("")}return r}function p5(n,e){for(const t of n.values)if(t.value===e)return t;return null}const m5="schemaClassId";function _5(n,e){var s,r;const t=n.getExtension(ya);if(t&&t.propertyTables)for(const i of t.propertyTables){const o=i.class,l=(r=(s=t.schema)==null?void 0:s.classes)==null?void 0:r[o];i.properties&&l&&A5(i,l,n)}}function A5(n,e,t){for(const s in n.properties){const r=n.properties[s].data;if(r){const i=e.properties[s];if(i){const o=E5(r,i,t);n.properties[s]=o}}}}function y5(n,e,t=m5){let s=n.getExtension(ya);s||(s=n.addExtension(ya)),s.schema=b5(e,t,s.schema);const r=T5(e,t,s.schema);return s.propertyTables||(s.propertyTables=[]),s.propertyTables.push(r)-1}function b5(n,e,t){const s=t??{id:"schema_id"},r={properties:{}};for(const i of n){const o={type:i.elementType,componentType:i.componentType};r.properties[i.name]=o}return s.classes={},s.classes[e]=r,s}function T5(n,e,t){var o;const s={class:e,count:0};let r=0;const i=(o=t.classes)==null?void 0:o[e];for(const l of n){if(r===0&&(r=l.values.length),r!==l.values.length&&l.values.length)throw new Error("Illegal values in attributes");(i==null?void 0:i.properties[l.name])&&(s.properties||(s.properties={}),s.properties[l.name]={values:0,data:l.values})}return s.count=r,s}function E5(n,e,t){const s={values:0};if(e.type==="STRING"){const{stringData:r,stringOffsets:i}=B5(n);s.stringOffsets=bm(i,t),s.values=bm(r,t)}else if(e.type==="SCALAR"&&e.componentType){const r=v5(n,e.componentType);s.values=bm(r,t)}return s}const C5={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:Int32Array,UINT64:Uint32Array,FLOAT32:Float32Array,FLOAT64:Float64Array};function v5(n,e){const t=[];for(const r of n)t.push(Number(r));const s=C5[e];if(!s)throw new Error("Illegal component type");return new s(t)}function B5(n){const e=new TextEncoder,t=[];let s=0;for(const f of n){const h=e.encode(f);s+=h.length,t.push(h)}const r=new Uint8Array(s),i=[];let o=0;for(const f of t)r.set(f,o),i.push(o),o+=f.length;i.push(o);const l=new Uint32Array(i);return{stringData:r,stringOffsets:l}}function bm(n,e){return e.gltf.buffers.push({arrayBuffer:n.buffer,byteOffset:n.byteOffset,byteLength:n.byteLength}),e.addBufferView(n)}const S5=Object.freeze(Object.defineProperty({__proto__:null,createExtStructuralMetadata:y5,decode:ZV,encode:e5,name:QV},Symbol.toStringTag,{value:"Module"})),xw="EXT_feature_metadata",w5=xw;async function R5(n,e){const t=new kt(n);x5(t,e)}function x5(n,e){var s,r;if(!((s=e.gltf)!=null&&s.loadBuffers))return;const t=n.getExtension(xw);t&&((r=e.gltf)!=null&&r.loadImages&&I5(n,t),M5(n,t))}function I5(n,e){const t=e.schema;if(!t)return;const s=t.classes,{featureTextures:r}=e;if(s&&r)for(const i in s){const o=s[i],l=D5(r,i);l&&F5(n,l,o)}}function M5(n,e){const t=e.schema;if(!t)return;const s=t.classes,r=e.featureTables;if(s&&r)for(const i in s){const o=O5(r,i);o&&N5(n,t,o)}}function O5(n,e){for(const t in n){const s=n[t];if(s.class===e)return s}return null}function D5(n,e){for(const t in n){const s=n[t];if(s.class===e)return s}return null}function N5(n,e,t){var i,o;if(!t.class)return;const s=(i=e.classes)==null?void 0:i[t.class];if(!s)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${t.class}`);const r=t.count;for(const l in s.properties){const f=s.properties[l],h=(o=t.properties)==null?void 0:o[l];if(h){const g=P5(n,e,f,r,h);h.data=g}}}function F5(n,e,t){var r;const s=e.class;for(const i in t.properties){const o=(r=e==null?void 0:e.properties)==null?void 0:r[i];if(o){const l=G5(n,o,s);o.data=l}}}function P5(n,e,t,s,r){let i=[];const o=r.bufferView,l=n.getTypedArrayForBufferView(o),f=U5(n,t,r,s),h=L5(n,t,r,s);return t.type==="STRING"||t.componentType==="STRING"?i=Rw(s,l,f,h):k5(t)&&(i=H5(t,s,l,f)),i}function U5(n,e,t,s){return e.type==="ARRAY"&&typeof e.componentCount>"u"&&typeof t.arrayOffsetBufferView<"u"?td(n,t.arrayOffsetBufferView,t.offsetType||"UINT32",s):null}function L5(n,e,t,s){return typeof t.stringOffsetBufferView<"u"?td(n,t.stringOffsetBufferView,t.offsetType||"UINT32",s):null}function k5(n){const e=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return e.includes(n.type)||typeof n.componentType<"u"&&e.includes(n.componentType)}function H5(n,e,t,s){const r=n.type==="ARRAY",i=n.componentCount,o="SCALAR",l=n.componentType||n.type,f=_y(o,l),h=t.byteLength/f,g=nd(t,o,l,h);return r?s?Sw(g,e,s,t.length,f):i?ww(g,e,i):[]:g}function G5(n,e,t){const s=n.gltf.json;if(!s.meshes)return[];const r=[];for(const i of s.meshes)for(const o of i.primitives)V5(n,t,e,r,o);return r}function V5(n,e,t,s,r){const i={channels:t.channels,...t.texture},o=Ay(n,i,r);o&&Bw(n,e,o,s,r)}const j5=Object.freeze(Object.defineProperty({__proto__:null,decode:R5,name:w5},Symbol.toStringTag,{value:"Module"})),z5="4.3.2",ba=!0,wv=1735152710,by=12,Th=8,$5=1313821514,X5=5130562,J5=0,W5=0,Y5=1;function K5(n,e=0){return`${String.fromCharCode(n.getUint8(e+0))}${String.fromCharCode(n.getUint8(e+1))}${String.fromCharCode(n.getUint8(e+2))}${String.fromCharCode(n.getUint8(e+3))}`}function q5(n,e=0,t={}){const s=new DataView(n),{magic:r=wv}=t,i=s.getUint32(e,!1);return i===r||i===wv}function Q5(n,e,t=0,s={}){const r=new DataView(e),i=K5(r,t+0),o=r.getUint32(t+4,ba),l=r.getUint32(t+8,ba);switch(Object.assign(n,{header:{byteOffset:t,byteLength:l,hasBinChunk:!1},type:i,version:o,json:{},binChunks:[]}),t+=by,n.version){case 1:return Z5(n,r,t);case 2:return ej(n,r,t,s={});default:throw new Error(`Invalid GLB version ${n.version}. Only supports version 1 and 2.`)}}function Z5(n,e,t){it(n.header.byteLength>by+Th);const s=e.getUint32(t+0,ba),r=e.getUint32(t+4,ba);return t+=Th,it(r===J5),tA(n,e,t,s),t+=s,t+=nA(n,e,t,n.header.byteLength),t}function ej(n,e,t,s){return it(n.header.byteLength>by+Th),tj(n,e,t,s),t+n.header.byteLength}function tj(n,e,t,s){for(;t+8<=n.header.byteLength;){const r=e.getUint32(t+0,ba),i=e.getUint32(t+4,ba);switch(t+=Th,i){case $5:tA(n,e,t,r);break;case X5:nA(n,e,t,r);break;case W5:s.strict||tA(n,e,t,r);break;case Y5:s.strict||nA(n,e,t,r);break}t+=wl(r,4)}return t}function tA(n,e,t,s){const r=new Uint8Array(e.buffer,t,s),o=new TextDecoder("utf8").decode(r);return n.json=JSON.parse(o),wl(s,4)}function nA(n,e,t,s){return n.header.hasBinChunk=!0,n.binChunks.push({byteOffset:t,byteLength:s,arrayBuffer:e.buffer}),wl(s,4)}function Iw(n,e){if(n.startsWith("data:")||n.startsWith("http:")||n.startsWith("https:"))return n;const s=e.baseUri||e.uri;if(!s)throw new Error(`'baseUri' must be provided to resolve relative url ${n}`);return s.substr(0,s.lastIndexOf("/")+1)+n}const nj="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",sj="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",rj=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),ij=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),oj={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},aj={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function cj(n,e,t,s,r,i="NONE"){const o=await lj();hj(o,o.exports[aj[r]],n,e,t,s,o.exports[oj[i||"NONE"]])}let Tm;async function lj(){return Tm||(Tm=uj()),Tm}async function uj(){let n=nj;WebAssembly.validate(rj)&&(n=sj,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(fj(n),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function fj(n){const e=new Uint8Array(n.length);for(let s=0;s<n.length;++s){const r=n.charCodeAt(s);e[s]=r>96?r-71:r>64?r-65:r>47?r+4:r>46?63:62}let t=0;for(let s=0;s<n.length;++s)e[t++]=e[s]<60?ij[e[s]]:(e[s]-60)*64+e[++s];return e.buffer.slice(0,t)}function hj(n,e,t,s,r,i,o){const l=n.exports.sbrk,f=s+3&-4,h=l(f*r),g=l(i.length),m=new Uint8Array(n.exports.memory.buffer);m.set(i,g);const A=e(h,s,r,g,i.length);if(A===0&&o&&o(h,f,r),t.set(m.subarray(h,h+s*r)),l(h-l(0)),A!==0)throw new Error(`Malformed buffer data: ${A}`)}const Eh="EXT_meshopt_compression",dj=Eh;async function gj(n,e){var r,i;const t=new kt(n);if(!((r=e==null?void 0:e.gltf)!=null&&r.decompressMeshes)||!((i=e.gltf)!=null&&i.loadBuffers))return;const s=[];for(const o of n.json.bufferViews||[])s.push(pj(t,o));await Promise.all(s),t.removeExtension(Eh)}async function pj(n,e){const t=n.getObjectExtension(e,Eh);if(t){const{byteOffset:s=0,byteLength:r=0,byteStride:i,count:o,mode:l,filter:f="NONE",buffer:h}=t,g=n.gltf.buffers[h],m=new Uint8Array(g.arrayBuffer,g.byteOffset+s,r),A=new Uint8Array(n.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);await cj(A,o,i,m,l,f),n.removeObjectExtension(e,Eh)}}const mj=Object.freeze(Object.defineProperty({__proto__:null,decode:gj,name:dj},Symbol.toStringTag,{value:"Module"})),Wo="EXT_texture_webp",_j=Wo;function Aj(n,e){const t=new kt(n);if(!RN("image/webp")){if(t.getRequiredExtensions().includes(Wo))throw new Error(`gltf: Required extension ${Wo} not supported by browser`);return}const{json:s}=t;for(const r of s.textures||[]){const i=t.getObjectExtension(r,Wo);i&&(r.source=i.source),t.removeObjectExtension(r,Wo)}t.removeExtension(Wo)}const yj=Object.freeze(Object.defineProperty({__proto__:null,name:_j,preprocess:Aj},Symbol.toStringTag,{value:"Module"})),$f="KHR_texture_basisu",bj=$f;function Tj(n,e){const t=new kt(n),{json:s}=t;for(const r of s.textures||[]){const i=t.getObjectExtension(r,$f);i&&(r.source=i.source,t.removeObjectExtension(r,$f))}t.removeExtension($f)}const Ej=Object.freeze(Object.defineProperty({__proto__:null,name:bj,preprocess:Tj},Symbol.toStringTag,{value:"Module"})),Cj="4.3.2",vj={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:Cj,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function Bj(n,e,t){const s=Mw(e.metadata),r=[],i=Sj(e.attributes);for(const o in n){const l=n[o],f=Rv(o,l,i[o]);r.push(f)}if(t){const o=Rv("indices",t);r.push(o)}return{fields:r,metadata:s}}function Sj(n){const e={};for(const t in n){const s=n[t];e[s.name||"undefined"]=s}return e}function Rv(n,e,t){const s=t?Mw(t.metadata):void 0;return zS(n,e,s)}function Mw(n){Object.entries(n);const e={};for(const t in n)e[`${t}.string`]=JSON.stringify(n[t]);return e}const xv={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},wj={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},Rj=4;let xj=class{constructor(e){b(this,"draco");b(this,"decoder");b(this,"metadataQuerier");this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e,t={}){const s=new this.draco.DecoderBuffer;s.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(t);const r=this.decoder.GetEncodedGeometryType(s),i=r===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let o;switch(r){case this.draco.TRIANGULAR_MESH:o=this.decoder.DecodeBufferToMesh(s,i);break;case this.draco.POINT_CLOUD:o=this.decoder.DecodeBufferToPointCloud(s,i);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!o.ok()||!i.ptr){const A=`DRACO decompression failed: ${o.error_msg()}`;throw new Error(A)}const l=this._getDracoLoaderData(i,r,t),f=this._getMeshData(i,l,t),h=xA(f.attributes),g=Bj(f.attributes,l,f.indices);return{loader:"draco",loaderData:l,header:{vertexCount:i.num_points(),boundingBox:h},...f,schema:g}}finally{this.draco.destroy(s),i&&this.draco.destroy(i)}}_getDracoLoaderData(e,t,s){const r=this._getTopLevelMetadata(e),i=this._getDracoAttributes(e,s);return{geometry_type:t,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:r,attributes:i}}_getDracoAttributes(e,t){const s={};for(let r=0;r<e.num_attributes();r++){const i=this.decoder.GetAttribute(e,r),o=this._getAttributeMetadata(e,r);s[i.unique_id()]={unique_id:i.unique_id(),attribute_type:i.attribute_type(),data_type:i.data_type(),num_components:i.num_components(),byte_offset:i.byte_offset(),byte_stride:i.byte_stride(),normalized:i.normalized(),attribute_index:r,metadata:o};const l=this._getQuantizationTransform(i,t);l&&(s[i.unique_id()].quantization_transform=l);const f=this._getOctahedronTransform(i,t);f&&(s[i.unique_id()].octahedron_transform=f)}return s}_getMeshData(e,t,s){const r=this._getMeshAttributes(t,e,s);if(!r.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(s.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:r,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:r,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:r}}_getMeshAttributes(e,t,s){const r={};for(const i of Object.values(e.attributes)){const o=this._deduceAttributeName(i,s);i.name=o;const l=this._getAttributeValues(t,i);if(l){const{value:f,size:h}=l;r[o]={value:f,size:h,byteOffset:i.byte_offset,byteStride:i.byte_stride,normalized:i.normalized}}}return r}_getTriangleListIndices(e){const s=e.num_faces()*3,r=s*Rj,i=this.draco._malloc(r);try{return this.decoder.GetTrianglesUInt32Array(e,r,i),new Uint32Array(this.draco.HEAPF32.buffer,i,s).slice()}finally{this.draco._free(i)}}_getTriangleStripIndices(e){const t=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,t),Oj(t)}finally{this.draco.destroy(t)}}_getAttributeValues(e,t){const s=wj[t.data_type];if(!s)return console.warn(`DRACO: Unsupported attribute type ${t.data_type}`),null;const r=t.num_components,o=e.num_points()*r,l=o*s.BYTES_PER_ELEMENT,f=Ij(this.draco,s);let h;const g=this.draco._malloc(l);try{const m=this.decoder.GetAttribute(e,t.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,m,f,l,g),h=new s(this.draco.HEAPF32.buffer,g,o).slice()}finally{this.draco._free(g)}return{value:h,size:r}}_deduceAttributeName(e,t){const s=e.unique_id;for(const[o,l]of Object.entries(t.extraAttributes||{}))if(l===s)return o;const r=e.attribute_type;for(const o in xv)if(this.draco[o]===r)return xv[o];const i=t.attributeNameEntry||"name";return e.metadata[i]?e.metadata[i].string:`CUSTOM_ATTRIBUTE_${s}`}_getTopLevelMetadata(e){const t=this.decoder.GetMetadata(e);return this._getDracoMetadata(t)}_getAttributeMetadata(e,t){const s=this.decoder.GetAttributeMetadata(e,t);return this._getDracoMetadata(s)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const t={},s=this.metadataQuerier.NumEntries(e);for(let r=0;r<s;r++){const i=this.metadataQuerier.GetEntryName(e,r);t[i]=this._getDracoMetadataField(e,i)}return t}_getDracoMetadataField(e,t){const s=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,t,s);const r=Mj(s);return{int:this.metadataQuerier.GetIntEntry(e,t),string:this.metadataQuerier.GetStringEntry(e,t),double:this.metadataQuerier.GetDoubleEntry(e,t),intArray:r}}finally{this.draco.destroy(s)}}_disableAttributeTransforms(e){const{quantizedAttributes:t=[],octahedronAttributes:s=[]}=e,r=[...t,...s];for(const i of r)this.decoder.SkipAttributeTransform(this.draco[i])}_getQuantizationTransform(e,t){const{quantizedAttributes:s=[]}=t,r=e.attribute_type();if(s.map(o=>this.decoder[o]).includes(r)){const o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(e))return{quantization_bits:o.quantization_bits(),range:o.range(),min_values:new Float32Array([1,2,3]).map(l=>o.min_value(l))}}finally{this.draco.destroy(o)}}return null}_getOctahedronTransform(e,t){const{octahedronAttributes:s=[]}=t,r=e.attribute_type();if(s.map(o=>this.decoder[o]).includes(r)){const o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(e))return{quantization_bits:o.quantization_bits()}}finally{this.draco.destroy(o)}}return null}};function Ij(n,e){switch(e){case Float32Array:return n.DT_FLOAT32;case Int8Array:return n.DT_INT8;case Int16Array:return n.DT_INT16;case Int32Array:return n.DT_INT32;case Uint8Array:return n.DT_UINT8;case Uint16Array:return n.DT_UINT16;case Uint32Array:return n.DT_UINT32;default:return n.DT_INVALID}}function Mj(n){const e=n.size(),t=new Int32Array(e);for(let s=0;s<e;s++)t[s]=n.GetValue(s);return t}function Oj(n){const e=n.size(),t=new Int32Array(e);for(let s=0;s<e;s++)t[s]=n.GetValue(s);return t}const Dj="1.5.6",Nj="1.4.1",Em=`https://www.gstatic.com/draco/versioned/decoders/${Dj}`,dn={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},Cm={[dn.DECODER]:`${Em}/${dn.DECODER}`,[dn.DECODER_WASM]:`${Em}/${dn.DECODER_WASM}`,[dn.FALLBACK_DECODER]:`${Em}/${dn.FALLBACK_DECODER}`,[dn.ENCODER]:`https://raw.githubusercontent.com/google/draco/${Nj}/javascript/${dn.ENCODER}`};let vm;async function Fj(n){const e=n.modules||{};return e.draco3d?vm||(vm=e.draco3d.createDecoderModule({}).then(t=>({draco:t}))):vm||(vm=Pj(n)),await vm}async function Pj(n){let e,t;switch(n.draco&&n.draco.decoderType){case"js":e=await js(Cm[dn.FALLBACK_DECODER],"draco",n,dn.FALLBACK_DECODER);break;case"wasm":default:[e,t]=await Promise.all([await js(Cm[dn.DECODER],"draco",n,dn.DECODER),await js(Cm[dn.DECODER_WASM],"draco",n,dn.DECODER_WASM)])}return e=e||globalThis.DracoDecoderModule,await Uj(e,t)}function Uj(n,e){const t={};return e&&(t.wasmBinary=e),new Promise(s=>{n({...t,onModuleLoaded:r=>s({draco:r})})})}const Lj={...vj,parse:kj};async function kj(n,e){const{draco:t}=await Fj(e),s=new xj(t);try{return s.parseSync(n,e==null?void 0:e.draco)}finally{s.destroy()}}function Hj(n){const e={};for(const t in n){const s=n[t];if(t!=="indices"){const r=Ow(s);e[t]=r}}return e}function Ow(n){const{buffer:e,size:t,count:s}=Gj(n);return{value:e,size:t,byteOffset:0,count:s,type:Tw(t),componentType:ed(e)}}function Gj(n){let e=n,t=1,s=0;return n&&n.value&&(e=n.value,t=n.size||1),e&&(ArrayBuffer.isView(e)||(e=Vj(e,Float32Array)),s=e.length/t),{buffer:e,size:t,count:s}}function Vj(n,e,t=!1){return n?Array.isArray(n)?new e(n):t&&!(n instanceof e)?new e(n):n:null}const ii="KHR_draco_mesh_compression",jj=ii;function zj(n,e,t){const s=new kt(n);for(const r of Dw(s))s.getObjectExtension(r,ii)}async function $j(n,e,t){var i;if(!((i=e==null?void 0:e.gltf)!=null&&i.decompressMeshes))return;const s=new kt(n),r=[];for(const o of Dw(s))s.getObjectExtension(o,ii)&&r.push(Jj(s,o,e,t));await Promise.all(r),s.removeExtension(ii)}function Xj(n,e={}){const t=new kt(n);for(const s of t.json.meshes||[])Wj(s),t.addRequiredExtension(ii)}async function Jj(n,e,t,s){const r=n.getObjectExtension(e,ii);if(!r)return;const i=n.getTypedArrayForBufferView(r.bufferView),o=CA(i.buffer,i.byteOffset),l={...t};delete l["3d-tiles"];const f=await Sl(o,Lj,l,s),h=Hj(f.attributes);for(const[g,m]of Object.entries(h))if(g in e.attributes){const A=e.attributes[g],y=n.getAccessor(A);y!=null&&y.min&&(y!=null&&y.max)&&(m.min=y.min,m.max=y.max)}e.attributes=h,f.indices&&(e.indices=Ow(f.indices)),n.removeObjectExtension(e,ii),Yj(e)}function Wj(n,e,t=4,s,r){var g;if(!s.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const i=s.DracoWriter.encodeSync({attributes:n}),o=(g=r==null?void 0:r.parseSync)==null?void 0:g.call(r,{attributes:n}),l=s._addFauxAttributes(o.attributes),f=s.addBufferView(i);return{primitives:[{attributes:l,mode:t,extensions:{[ii]:{bufferView:f,attributes:l}}}]}}function Yj(n){if(!n.attributes&&Object.keys(n.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*Dw(n){for(const e of n.json.meshes||[])for(const t of e.primitives)yield t}const Kj=Object.freeze(Object.defineProperty({__proto__:null,decode:$j,encode:Xj,name:jj,preprocess:zj},Symbol.toStringTag,{value:"Module"})),sd="KHR_texture_transform",qj=sd,Cf=new L,Qj=new at,Zj=new at;async function ez(n,e){var i;if(!new kt(n).hasExtension(sd)||!((i=e.gltf)!=null&&i.loadBuffers))return;const r=n.json.materials||[];for(let o=0;o<r.length;o++)tz(o,n)}function tz(n,e){var i,o,l,f;const t=(i=e.json.materials)==null?void 0:i[n],s=[(o=t==null?void 0:t.pbrMetallicRoughness)==null?void 0:o.baseColorTexture,t==null?void 0:t.emissiveTexture,t==null?void 0:t.normalTexture,t==null?void 0:t.occlusionTexture,(l=t==null?void 0:t.pbrMetallicRoughness)==null?void 0:l.metallicRoughnessTexture],r=[];for(const h of s)h&&((f=h==null?void 0:h.extensions)!=null&&f[sd])&&nz(e,n,h,r)}function nz(n,e,t,s){const r=sz(t,s);if(!r)return;const i=n.json.meshes||[];for(const o of i)for(const l of o.primitives){const f=l.material;Number.isFinite(f)&&e===f&&rz(n,l,r)}}function sz(n,e){var o;const t=(o=n.extensions)==null?void 0:o[sd],{texCoord:s=0}=n,{texCoord:r=s}=t;if(!(e.findIndex(([l,f])=>l===s&&f===r)!==-1)){const l=az(t);return s!==r&&(n.texCoord=r),e.push([s,r]),{originalTexCoord:s,texCoord:r,matrix:l}}return null}function rz(n,e,t){var l,f;const{originalTexCoord:s,texCoord:r,matrix:i}=t,o=e.attributes[`TEXCOORD_${s}`];if(Number.isFinite(o)){const h=(l=n.json.accessors)==null?void 0:l[o];if(h&&h.bufferView){const g=(f=n.json.bufferViews)==null?void 0:f[h.bufferView];if(g){const{arrayBuffer:m,byteOffset:A}=n.buffers[g.buffer],y=(A||0)+(h.byteOffset||0)+(g.byteOffset||0),{ArrayType:E,length:v}=my(h,g),S=bw[h.componentType],x=yw[h.type],O=g.byteStride||S*x,R=new Float32Array(v);for(let D=0;D<h.count;D++){const z=new E(m,y+D*O,2);Cf.set(z[0],z[1],1),Cf.transformByMatrix3(i),R.set([Cf[0],Cf[1]],D*x)}s===r?iz(h,g,n.buffers,R):oz(r,h,e,n,R)}}}}function iz(n,e,t,s){n.componentType=5126,t.push({arrayBuffer:s.buffer,byteOffset:0,byteLength:s.buffer.byteLength}),e.buffer=t.length-1,e.byteLength=s.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function oz(n,e,t,s,r){s.buffers.push({arrayBuffer:r.buffer,byteOffset:0,byteLength:r.buffer.byteLength});const i=s.json.bufferViews;if(!i)return;i.push({buffer:s.buffers.length-1,byteLength:r.buffer.byteLength,byteOffset:0});const o=s.json.accessors;o&&(o.push({bufferView:(i==null?void 0:i.length)-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),t.attributes[`TEXCOORD_${n}`]=o.length-1)}function az(n){const{offset:e=[0,0],rotation:t=0,scale:s=[1,1]}=n,r=new at().set(1,0,0,0,1,0,e[0],e[1],1),i=Qj.set(Math.cos(t),Math.sin(t),0,-Math.sin(t),Math.cos(t),0,0,0,1),o=Zj.set(s[0],0,0,0,s[1],0,0,0,1);return r.multiplyRight(i).multiplyRight(o)}const cz=Object.freeze(Object.defineProperty({__proto__:null,decode:ez,name:qj},Symbol.toStringTag,{value:"Module"})),Fi="KHR_lights_punctual",lz=Fi;async function uz(n){const e=new kt(n),{json:t}=e,s=e.getExtension(Fi);s&&(e.json.lights=s.lights,e.removeExtension(Fi));for(const r of t.nodes||[]){const i=e.getObjectExtension(r,Fi);i&&(r.light=i.light),e.removeObjectExtension(r,Fi)}}async function fz(n){const e=new kt(n),{json:t}=e;if(t.lights){const s=e.addExtension(Fi);Fn(!s.lights),s.lights=t.lights,delete t.lights}if(e.json.lights){for(const s of e.json.lights){const r=s.node;e.addObjectExtension(r,Fi,s)}delete e.json.lights}}const hz=Object.freeze(Object.defineProperty({__proto__:null,decode:uz,encode:fz,name:lz},Symbol.toStringTag,{value:"Module"})),El="KHR_materials_unlit",dz=El;async function gz(n){const e=new kt(n),{json:t}=e;for(const s of t.materials||[])s.extensions&&s.extensions.KHR_materials_unlit&&(s.unlit=!0),e.removeObjectExtension(s,El);e.removeExtension(El)}function pz(n){const e=new kt(n),{json:t}=e;if(e.materials)for(const s of t.materials||[])s.unlit&&(delete s.unlit,e.addObjectExtension(s,El,{}),e.addExtension(El))}const mz=Object.freeze(Object.defineProperty({__proto__:null,decode:gz,encode:pz,name:dz},Symbol.toStringTag,{value:"Module"})),Kc="KHR_techniques_webgl",_z=Kc;async function Az(n){const e=new kt(n),{json:t}=e,s=e.getExtension(Kc);if(s){const r=bz(s,e);for(const i of t.materials||[]){const o=e.getObjectExtension(i,Kc);o&&(i.technique=Object.assign({},o,r[o.technique]),i.technique.values=Tz(i.technique,e)),e.removeObjectExtension(i,Kc)}e.removeExtension(Kc)}}async function yz(n,e){}function bz(n,e){const{programs:t=[],shaders:s=[],techniques:r=[]}=n,i=new TextDecoder;return s.forEach(o=>{if(Number.isFinite(o.bufferView))o.code=i.decode(e.getTypedArrayForBufferView(o.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),t.forEach(o=>{o.fragmentShader=s[o.fragmentShader],o.vertexShader=s[o.vertexShader]}),r.forEach(o=>{o.program=t[o.program]}),r}function Tz(n,e){const t=Object.assign({},n.values);return Object.keys(n.uniforms||{}).forEach(s=>{n.uniforms[s].value&&!(s in t)&&(t[s]=n.uniforms[s].value)}),Object.keys(t).forEach(s=>{typeof t[s]=="object"&&t[s].index!==void 0&&(t[s].texture=e.getTexture(t[s].index))}),t}const Ez=Object.freeze(Object.defineProperty({__proto__:null,decode:Az,encode:yz,name:_z},Symbol.toStringTag,{value:"Module"})),Nw=[S5,qV,mj,yj,Ej,Kj,hz,mz,Ez,cz,j5];function Cz(n,e={},t){var r;const s=Nw.filter(i=>Fw(i.name,e));for(const i of s)(r=i.preprocess)==null||r.call(i,n,e,t)}async function vz(n,e={},t){var r;const s=Nw.filter(i=>Fw(i.name,e));for(const i of s)await((r=i.decode)==null?void 0:r.call(i,n,e,t))}function Fw(n,e){var r;const t=((r=e==null?void 0:e.gltf)==null?void 0:r.excludeExtensions)||{};return!(n in t&&!t[n])}const Bm="KHR_binary_glTF";function Bz(n){const e=new kt(n),{json:t}=e;for(const s of t.images||[]){const r=e.getObjectExtension(s,Bm);r&&Object.assign(s,r),e.removeObjectExtension(s,Bm)}t.buffers&&t.buffers[0]&&delete t.buffers[0].uri,e.removeExtension(Bm)}const Iv={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},Sz={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};let wz=class{constructor(){b(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}});b(this,"json")}normalize(e,t){this.json=e.json;const s=e.json;switch(s.asset&&s.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${s.asset.version}`);return}if(!t.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(s),this._convertTopLevelObjectsToArrays(s),Bz(e),this._convertObjectIdsToArrayIndices(s),this._updateObjects(s),this._updateMaterial(s)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const t in Iv)this._convertTopLevelObjectToArray(e,t)}_convertTopLevelObjectToArray(e,t){const s=e[t];if(!(!s||Array.isArray(s))){e[t]=[];for(const r in s){const i=s[r];i.id=i.id||r;const o=e[t].length;e[t].push(i),this.idToIndexMap[t][r]=o}}}_convertObjectIdsToArrayIndices(e){for(const t in Iv)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const t of e.textures)this._convertTextureIds(t);for(const t of e.meshes)this._convertMeshIds(t);for(const t of e.nodes)this._convertNodeIds(t);for(const t of e.scenes)this._convertSceneIds(t)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const t of e.primitives){const{attributes:s,indices:r,material:i}=t;for(const o in s)s[o]=this._convertIdToIndex(s[o],"accessor");r&&(t.indices=this._convertIdToIndex(r,"accessor")),i&&(t.material=this._convertIdToIndex(i,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(t=>this._convertIdToIndex(t,"node"))),e.meshes&&(e.meshes=e.meshes.map(t=>this._convertIdToIndex(t,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(t=>this._convertIdToIndex(t,"node")))}_convertIdsToIndices(e,t){e[t]||(console.warn(`gltf v1: json doesn't contain attribute ${t}`),e[t]=[]);for(const s of e[t])for(const r in s){const i=s[r],o=this._convertIdToIndex(i,r);s[r]=o}}_convertIdToIndex(e,t){const s=Sz[t];if(s in this.idToIndexMap){const r=this.idToIndexMap[s][e];if(!Number.isFinite(r))throw new Error(`gltf v1: failed to resolve ${t} with id ${e}`);return r}return e}_updateObjects(e){for(const t of this.json.buffers)delete t.type}_updateMaterial(e){var t,s,r;for(const i of e.materials){i.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const o=((t=i.values)==null?void 0:t.tex)||((s=i.values)==null?void 0:s.texture2d_0)||((r=i.values)==null?void 0:r.diffuseTex),l=e.textures.findIndex(f=>f.id===o);l!==-1&&(i.pbrMetallicRoughness.baseColorTexture={index:l})}}};function Rz(n,e={}){return new wz().normalize(n,e)}async function xz(n,e,t=0,s,r){var i,o,l;return Iz(n,e,t,s),Rz(n,{normalize:(i=s==null?void 0:s.gltf)==null?void 0:i.normalize}),Cz(n,s,r),(o=s==null?void 0:s.gltf)!=null&&o.loadBuffers&&n.json.buffers&&await Mz(n,s,r),(l=s==null?void 0:s.gltf)!=null&&l.loadImages&&await Oz(n,s,r),await vz(n,s,r),n}function Iz(n,e,t,s){if(s.uri&&(n.baseUri=s.uri),e instanceof ArrayBuffer&&!q5(e,t,s)&&(e=new TextDecoder().decode(e)),typeof e=="string")n.json=IO(e);else if(e instanceof ArrayBuffer){const o={};t=Q5(o,e,t,s.glb),Fn(o.type==="glTF",`Invalid GLB magic string ${o.type}`),n._glb=o,n.json=o.json}else Fn(!1,"GLTF: must be ArrayBuffer or string");const r=n.json.buffers||[];if(n.buffers=new Array(r.length).fill(null),n._glb&&n._glb.header.hasBinChunk){const{binChunks:o}=n._glb;n.buffers[0]={arrayBuffer:o[0].arrayBuffer,byteOffset:o[0].byteOffset,byteLength:o[0].byteLength}}const i=n.json.images||[];n.images=new Array(i.length).fill({})}async function Mz(n,e,t){var r,i;const s=n.json.buffers||[];for(let o=0;o<s.length;++o){const l=s[o];if(l.uri){const{fetch:f}=t;Fn(f);const h=Iw(l.uri,e),g=await((r=t==null?void 0:t.fetch)==null?void 0:r.call(t,h)),m=await((i=g==null?void 0:g.arrayBuffer)==null?void 0:i.call(g));n.buffers[o]={arrayBuffer:m,byteOffset:0,byteLength:m.byteLength},delete l.uri}else n.buffers[o]===null&&(n.buffers[o]={arrayBuffer:new ArrayBuffer(l.byteLength),byteOffset:0,byteLength:l.byteLength})}}async function Oz(n,e,t){const s=Dz(n),r=n.json.images||[],i=[];for(const o of s)i.push(Nz(n,r[o],o,e,t));return await Promise.all(i)}function Dz(n){const e=new Set,t=n.json.textures||[];for(const s of t)s.source!==void 0&&e.add(s.source);return Array.from(e).sort()}async function Nz(n,e,t,s,r){let i;if(e.uri&&!e.hasOwnProperty("bufferView")){const l=Iw(e.uri,s),{fetch:f}=r;i=await(await f(l)).arrayBuffer(),e.bufferView={data:i}}if(Number.isFinite(e.bufferView)){const l=PV(n.json,n.buffers,e.bufferView);i=CA(l.buffer,l.byteOffset,l.byteLength)}Fn(i,"glTF image has no data");let o=await Sl(i,[WS,fV],{...s,mimeType:e.mimeType,basis:s.basis||{format:Aw()}},r);o&&o[0]&&(o={compressed:!0,mipmaps:!1,width:o[0].width,height:o[0].height,data:o[0]}),n.images=n.images||[],n.images[t]=o}const Cl={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:z5,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:Fz,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function Fz(n,e={},t){e={...Cl.options,...e},e.gltf={...Cl.options.gltf,...e.gltf};const{byteOffset:s=0}=e;return await xz({},n,s,e,t)}const Pz={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Uz={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Xn={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},Lz={magFilter:Xn.TEXTURE_MAG_FILTER,minFilter:Xn.TEXTURE_MIN_FILTER,wrapS:Xn.TEXTURE_WRAP_S,wrapT:Xn.TEXTURE_WRAP_T},kz={[Xn.TEXTURE_MAG_FILTER]:Xn.LINEAR,[Xn.TEXTURE_MIN_FILTER]:Xn.NEAREST_MIPMAP_LINEAR,[Xn.TEXTURE_WRAP_S]:Xn.REPEAT,[Xn.TEXTURE_WRAP_T]:Xn.REPEAT};function Hz(){return{id:"default-sampler",parameters:kz}}function Gz(n){return Uz[n]}function Vz(n){return Pz[n]}let jz=class{constructor(){b(this,"baseUri","");b(this,"jsonUnprocessed");b(this,"json");b(this,"buffers",[]);b(this,"images",[])}postProcess(e,t={}){const{json:s,buffers:r=[],images:i=[]}=e,{baseUri:o=""}=e;return Fn(s),this.baseUri=o,this.buffers=r,this.images=i,this.jsonUnprocessed=s,this.json=this._resolveTree(e.json,t),this.json}_resolveTree(e,t={}){const s={...e};return this.json=s,e.bufferViews&&(s.bufferViews=e.bufferViews.map((r,i)=>this._resolveBufferView(r,i))),e.images&&(s.images=e.images.map((r,i)=>this._resolveImage(r,i))),e.samplers&&(s.samplers=e.samplers.map((r,i)=>this._resolveSampler(r,i))),e.textures&&(s.textures=e.textures.map((r,i)=>this._resolveTexture(r,i))),e.accessors&&(s.accessors=e.accessors.map((r,i)=>this._resolveAccessor(r,i))),e.materials&&(s.materials=e.materials.map((r,i)=>this._resolveMaterial(r,i))),e.meshes&&(s.meshes=e.meshes.map((r,i)=>this._resolveMesh(r,i))),e.nodes&&(s.nodes=e.nodes.map((r,i)=>this._resolveNode(r,i)),s.nodes=s.nodes.map((r,i)=>this._resolveNodeChildren(r))),e.skins&&(s.skins=e.skins.map((r,i)=>this._resolveSkin(r,i))),e.scenes&&(s.scenes=e.scenes.map((r,i)=>this._resolveScene(r,i))),typeof this.json.scene=="number"&&s.scenes&&(s.scene=s.scenes[this.json.scene]),s}getScene(e){return this._get(this.json.scenes,e)}getNode(e){return this._get(this.json.nodes,e)}getSkin(e){return this._get(this.json.skins,e)}getMesh(e){return this._get(this.json.meshes,e)}getMaterial(e){return this._get(this.json.materials,e)}getAccessor(e){return this._get(this.json.accessors,e)}getCamera(e){return this._get(this.json.cameras,e)}getTexture(e){return this._get(this.json.textures,e)}getSampler(e){return this._get(this.json.samplers,e)}getImage(e){return this._get(this.json.images,e)}getBufferView(e){return this._get(this.json.bufferViews,e)}getBuffer(e){return this._get(this.json.buffers,e)}_get(e,t){if(typeof t=="object")return t;const s=e&&e[t];return s||console.warn(`glTF file error: Could not find ${e}[${t}]`),s}_resolveScene(e,t){return{...e,id:e.id||`scene-${t}`,nodes:(e.nodes||[]).map(s=>this.getNode(s))}}_resolveNode(e,t){const s={...e,id:(e==null?void 0:e.id)||`node-${t}`};return e.mesh!==void 0&&(s.mesh=this.getMesh(e.mesh)),e.camera!==void 0&&(s.camera=this.getCamera(e.camera)),e.skin!==void 0&&(s.skin=this.getSkin(e.skin)),e.meshes!==void 0&&e.meshes.length&&(s.mesh=e.meshes.reduce((r,i)=>{const o=this.getMesh(i);return r.id=o.id,r.primitives=r.primitives.concat(o.primitives),r},{primitives:[]})),s}_resolveNodeChildren(e){return e.children&&(e.children=e.children.map(t=>this.getNode(t))),e}_resolveSkin(e,t){const s=typeof e.inverseBindMatrices=="number"?this.getAccessor(e.inverseBindMatrices):void 0;return{...e,id:e.id||`skin-${t}`,inverseBindMatrices:s}}_resolveMesh(e,t){const s={...e,id:e.id||`mesh-${t}`,primitives:[]};return e.primitives&&(s.primitives=e.primitives.map(r=>{const i={...r,attributes:{},indices:void 0,material:void 0},o=r.attributes;for(const l in o)i.attributes[l]=this.getAccessor(o[l]);return r.indices!==void 0&&(i.indices=this.getAccessor(r.indices)),r.material!==void 0&&(i.material=this.getMaterial(r.material)),i})),s}_resolveMaterial(e,t){const s={...e,id:e.id||`material-${t}`};if(s.normalTexture&&(s.normalTexture={...s.normalTexture},s.normalTexture.texture=this.getTexture(s.normalTexture.index)),s.occlusionTexture&&(s.occlusionTexture={...s.occlusionTexture},s.occlusionTexture.texture=this.getTexture(s.occlusionTexture.index)),s.emissiveTexture&&(s.emissiveTexture={...s.emissiveTexture},s.emissiveTexture.texture=this.getTexture(s.emissiveTexture.index)),s.emissiveFactor||(s.emissiveFactor=s.emissiveTexture?[1,1,1]:[0,0,0]),s.pbrMetallicRoughness){s.pbrMetallicRoughness={...s.pbrMetallicRoughness};const r=s.pbrMetallicRoughness;r.baseColorTexture&&(r.baseColorTexture={...r.baseColorTexture},r.baseColorTexture.texture=this.getTexture(r.baseColorTexture.index)),r.metallicRoughnessTexture&&(r.metallicRoughnessTexture={...r.metallicRoughnessTexture},r.metallicRoughnessTexture.texture=this.getTexture(r.metallicRoughnessTexture.index))}return s}_resolveAccessor(e,t){const s=Gz(e.componentType),r=Vz(e.type),i=s*r,o={...e,id:e.id||`accessor-${t}`,bytesPerComponent:s,components:r,bytesPerElement:i,value:void 0,bufferView:void 0,sparse:void 0};if(e.bufferView!==void 0&&(o.bufferView=this.getBufferView(e.bufferView)),o.bufferView){const l=o.bufferView.buffer,{ArrayType:f,byteLength:h}=my(o,o.bufferView),g=(o.bufferView.byteOffset||0)+(o.byteOffset||0)+l.byteOffset;let m=l.arrayBuffer.slice(g,g+h);o.bufferView.byteStride&&(m=this._getValueFromInterleavedBuffer(l,g,o.bufferView.byteStride,o.bytesPerElement,o.count)),o.value=new f(m)}return o}_getValueFromInterleavedBuffer(e,t,s,r,i){const o=new Uint8Array(i*r);for(let l=0;l<i;l++){const f=t+l*s;o.set(new Uint8Array(e.arrayBuffer.slice(f,f+r)),l*r)}return o.buffer}_resolveTexture(e,t){return{...e,id:e.id||`texture-${t}`,sampler:typeof e.sampler=="number"?this.getSampler(e.sampler):Hz(),source:typeof e.source=="number"?this.getImage(e.source):void 0}}_resolveSampler(e,t){const s={id:e.id||`sampler-${t}`,...e,parameters:{}};for(const r in s){const i=this._enumSamplerParameter(r);i!==void 0&&(s.parameters[i]=s[r])}return s}_enumSamplerParameter(e){return Lz[e]}_resolveImage(e,t){const s={...e,id:e.id||`image-${t}`,image:null,bufferView:e.bufferView!==void 0?this.getBufferView(e.bufferView):void 0},r=this.images[t];return r&&(s.image=r),s}_resolveBufferView(e,t){const s=e.buffer,r=this.buffers[s].arrayBuffer;let i=this.buffers[s].byteOffset||0;return e.byteOffset&&(i+=e.byteOffset),{id:`bufferView-${t}`,...e,buffer:this.buffers[s],data:new Uint8Array(r,i,e.byteLength)}}_resolveCamera(e,t){const s={...e,id:e.id||`camera-${t}`};return s.perspective,s.orthographic,s}};function Ty(n,e){return new jz().postProcess(n,e)}async function zz(n){const e=[];return n.scenes.forEach(t=>{t.traverse(s=>{Object.values(s.model.uniforms).forEach(r=>{r.loaded===!1&&e.push(r)})})}),await $z(()=>e.some(t=>!t.loaded))}async function $z(n){for(;n();)await new Promise(e=>requestAnimationFrame(e))}const Mv=`uniform scenegraphUniforms {
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  mat4 sceneModelMatrix;
  bool composeModelMatrix;
} scenegraph;
`,Xz={name:"scenegraph",vs:Mv,fs:Mv,uniformTypes:{sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",sceneModelMatrix:"mat4x4<f32>",composeModelMatrix:"f32"}},Jz=`#version 300 es
#define SHADER_NAME scenegraph-layer-vertex-shader
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
in vec3 positions;
#ifdef HAS_UV
in vec2 texCoords;
#endif
#ifdef LIGHTING_PBR
#ifdef HAS_NORMALS
in vec3 normals;
#endif
#endif
out vec4 vColor;
#ifndef LIGHTING_PBR
#ifdef HAS_UV
out vec2 vTEXCOORD_0;
#endif
#endif
void main(void) {
#if defined(HAS_UV) && !defined(LIGHTING_PBR)
vTEXCOORD_0 = texCoords;
geometry.uv = texCoords;
#endif
geometry.worldPosition = instancePositions;
geometry.pickingColor = instancePickingColors;
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 normal = vec3(0.0, 0.0, 1.0);
#ifdef LIGHTING_PBR
#ifdef HAS_NORMALS
normal = instanceModelMatrix * (scenegraph.sceneModelMatrix * vec4(normals, 0.0)).xyz;
#endif
#endif
float originalSize = project_size_to_pixel(scenegraph.sizeScale);
float clampedSize = clamp(originalSize, scenegraph.sizeMinPixels, scenegraph.sizeMaxPixels);
vec3 pos = (instanceModelMatrix * (scenegraph.sceneModelMatrix * vec4(positions, 1.0)).xyz) * scenegraph.sizeScale * (clampedSize / originalSize) + instanceTranslation;
if(scenegraph.composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
geometry.normal = project_normal(normal);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
geometry.normal = project_normal(normal);
}
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef LIGHTING_PBR
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = texCoords;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Wz=`#version 300 es
#define SHADER_NAME scenegraph-layer-fragment-shader
in vec4 vColor;
out vec4 fragColor;
#ifndef LIGHTING_PBR
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
in vec2 vTEXCOORD_0;
uniform sampler2D pbr_baseColorSampler;
#endif
#endif
void main(void) {
#ifdef LIGHTING_PBR
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
#else
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
fragColor = vColor * texture(pbr_baseColorSampler, vTEXCOORD_0);
geometry.uv = vTEXCOORD_0;
#else
fragColor = vColor;
#endif
#endif
fragColor.a *= layer.opacity;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Pw=[255,255,255,255],Yz={scenegraph:{type:"object",value:null,async:!0},getScene:n=>n&&n.scenes?typeof n.scene=="object"?n.scene:n.scenes[n.scene||0]:n,getAnimator:n=>n&&n.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:n=>n.position},getColor:{type:"accessor",value:Pw},_lighting:"flat",_imageBasedLightingEnvironment:void 0,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[Cl]};class Ey extends Oa{getShaders(){const e={};let t;this.props._lighting==="pbr"?(t=QA,e.LIGHTING_PBR=1):t={name:"pbrMaterial"};const s=[ey,ry,Xz,t];return super.getShaders({defines:e,vs:Jz,fs:Wz,modules:s})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:"unorm8",size:this.props.colorFormat.length,accessor:"getColor",defaultValue:Pw,transition:!0},instanceModelMatrix:gw})}updateState(e){super.updateState(e);const{props:t,oldProps:s}=e;t.scenegraph!==s.scenegraph?this._updateScenegraph():t._animations!==s._animations&&this._applyAnimationsProp(this.state.animator,t._animations)}finalizeState(e){var t;super.finalizeState(e),(t=this.state.scenegraph)==null||t.destroy()}get isLoaded(){var e;return!!((e=this.state)!=null&&e.scenegraph&&super.isLoaded)}_updateScenegraph(){var l;const e=this.props,{device:t}=this.context;let s=null;if(e.scenegraph instanceof mh)s={scenes:[e.scenegraph]};else if(e.scenegraph&&typeof e.scenegraph=="object"){const f=e.scenegraph,h=f.json?Ty(f):f,g=xV(t,h,this._getModelOptions());s={gltf:h,...g},zz(g).then(()=>{this.setNeedsRedraw()}).catch(m=>{this.raiseError(m,"loading glTF")})}const r={layer:this,device:this.context.device},i=e.getScene(s,r),o=e.getAnimator(s,r);if(i instanceof la){(l=this.state.scenegraph)==null||l.destroy(),this._applyAnimationsProp(o,e._animations);const f=[];i.traverse(h=>{h instanceof V_&&f.push(h.model)}),this.setState({scenegraph:i,animator:o,models:f}),this.getAttributeManager().invalidateAll()}else i!==null&&Ve.warn("invalid scenegraph:",i)()}_applyAnimationsProp(e,t){if(!e||!t)return;const s=e.getAnimations();Object.keys(t).sort().forEach(r=>{const i=t[r];if(r==="*")s.forEach(o=>{Object.assign(o,i)});else if(Number.isFinite(Number(r))){const o=Number(r);o>=0&&o<s.length?Object.assign(s[o],i):Ve.warn(`animation ${r} not found`)()}else{const o=s.find(({name:l})=>l===r);o?Object.assign(o,i):Ve.warn(`animation ${r} not found`)()}})}_getModelOptions(){const{_imageBasedLightingEnvironment:e}=this.props;let t;return e&&(typeof e=="function"?t=e({gl:this.context.gl,layer:this}):t=e),{imageBasedLightingEnvironment:t,modelOptions:{id:this.props.id,isInstanced:!0,bufferLayout:this.getAttributeManager().getBufferLayouts(),...this.getShaders()},useTangents:!1}}draw({context:e}){if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(e.timeline.getTime()),this.setNeedsRedraw());const{viewport:t,renderPass:s}=this.context,{sizeScale:r,sizeMinPixels:i,sizeMaxPixels:o,coordinateSystem:l}=this.props,f=this.getNumInstances();this.state.scenegraph.traverse((h,{worldMatrix:g})=>{if(h instanceof V_){const{model:m}=h;m.setInstanceCount(f);const A={camera:m.uniforms.cameraPosition},y={sizeScale:r,sizeMinPixels:i,sizeMaxPixels:o,composeModelMatrix:pw(t,l),sceneModelMatrix:g};m.shaderInputs.setProps({pbrProjection:A,scenegraph:y}),m.draw(s)}})}}Ey.defaultProps=Yz;Ey.layerName="ScenegraphLayer";const Ov=`uniform meshUniforms {
  bool pickFeatureIds;
} mesh;
`,Kz={name:"mesh",vs:Ov,fs:Ov,uniformTypes:{pickFeatureIds:"f32"}},qz=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
vec2 applyUVRegion(vec2 uv) {
#ifdef HAS_UV_REGIONS
return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
#else
return uv;
#endif
}
void main(void) {
vec2 uv = applyUVRegion(texCoords);
geometry.uv = uv;
if (mesh.pickFeatureIds) {
geometry.pickingColor = featureIdsPickingColors;
} else {
geometry.pickingColor = instancePickingColors;
}
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vTexCoord = uv;
cameraPosition = project.cameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
vec3 pos = (instanceModelMatrix * positions) * simpleMesh.sizeScale;
vec3 projectedPosition = project_position(positions);
position_commonspace = vec4(projectedPosition, 1.0);
gl_Position = project_common_position_to_clipspace(position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef MODULE_PBRMATERIAL
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = uv;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Qz=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform sampler2D sampler;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
#ifdef MODULE_PBRMATERIAL
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
fragColor.a *= layer.opacity;
#else
geometry.uv = vTexCoord;
vec3 normal;
if (simpleMesh.flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = simpleMesh.hasTexture ? texture(sampler, vTexCoord) : vColor;
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * layer.opacity);
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function Zz(n){const e=n.positions||n.POSITION,t=e.value.length/e.size;n.COLOR_0||n.colors||(n.colors={size:4,value:new Uint8Array(t*4).fill(255),normalized:!0})}const e$={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class Cy extends py{getShaders(){const e=super.getShaders();return e.modules.push(QA,Kz),{...e,vs:qz,fs:Qz}}initializeState(){const{featureIds:e}=this.props;super.initializeState();const t=this.getAttributeManager();e&&t.add({featureIdsPickingColors:{type:"uint8",size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(e){super.updateState(e);const{props:t,oldProps:s}=e;t.pbrMaterial!==s.pbrMaterial&&this.updatePbrMaterialUniforms(t.pbrMaterial)}draw(e){const{featureIds:t}=this.props,{model:s}=this.state;if(!s)return;const r={pickFeatureIds:!!t},i={camera:s.uniforms.cameraPosition};s.shaderInputs.setProps({pbrProjection:i,mesh:r}),super.draw(e)}getModel(e){const{id:t}=this.props,s=this.parseMaterial(this.props.pbrMaterial,e);this.setState({parsedPBRMaterial:s});const r=this.getShaders();return Zz(e.attributes),new ri(this.context.device,{...this.getShaders(),id:t,geometry:e,bufferLayout:this.getAttributeManager().getBufferLayouts(),defines:{...r.defines,...s==null?void 0:s.defines,HAS_UV_REGIONS:e.attributes.uvRegions?1:0},parameters:s==null?void 0:s.parameters,isInstanced:!0})}updatePbrMaterialUniforms(e){const{model:t}=this.state;if(t){const{mesh:s}=this.props,r=this.parseMaterial(e,s);this.setState({parsedPBRMaterial:r});const{pbr_baseColorSampler:i}=r.bindings,{emptyTexture:o}=this.state,l={sampler:i||o,hasTexture:!!i},{camera:f,...h}={...r.bindings,...r.uniforms};t.shaderInputs.setProps({simpleMesh:l,pbrMaterial:h})}}parseMaterial(e,t){const s=!!(e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture);return mw(this.context.device,{unlit:s,...e},{NORMAL:t.attributes.normals,TEXCOORD_0:t.attributes.texCoords},{pbrDebug:!1,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(e){const t=this.props.featureIds,s=new Uint8ClampedArray(t.length*e.size),r=[];for(let i=0;i<t.length;i++)this.encodePickingColor(t[i],r),s[i*3]=r[0],s[i*3+1]=r[1],s[i*3+2]=r[2];e.value=s}finalizeState(e){var t;super.finalizeState(e),(t=this.state.parsedPBRMaterial)==null||t.generatedTextures.forEach(s=>s.destroy()),this.setState({parsedPBRMaterial:null})}}Cy.layerName="MeshLayer";Cy.defaultProps=e$;const t$=6378137,n$=6378137,s$=6356752314245179e-9;function rd(n){return n}new L;function r$(n,e=[],t=rd){return"longitude"in n?(e[0]=t(n.longitude),e[1]=t(n.latitude),e[2]=n.height):"x"in n?(e[0]=t(n.x),e[1]=t(n.y),e[2]=n.z):(e[0]=t(n[0]),e[1]=t(n[1]),e[2]=n[2]),e}function i$(n,e=[]){return r$(n,e,Ot._cartographicRadians?rd:zP)}function o$(n,e,t=rd){return"longitude"in e?(e.longitude=t(n[0]),e.latitude=t(n[1]),e.height=n[2]):"x"in e?(e.x=t(n[0]),e.y=t(n[1]),e.z=n[2]):(e[0]=t(n[0]),e[1]=t(n[1]),e[2]=n[2]),e}function a$(n,e){return o$(n,e,Ot._cartographicRadians?rd:$P)}const Dv=1e-14,c$=new L,Nv={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},Sm={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},Uc={east:new L,north:new L,up:new L,west:new L,south:new L,down:new L},l$=new L,u$=new L,f$=new L;function Fv(n,e,t,s,r,i){const o=Nv[e]&&Nv[e][t];ps(o&&(!s||s===o));let l,f,h;const g=c$.copy(r);if(Ts(g.x,0,Dv)&&Ts(g.y,0,Dv)){const A=Math.sign(g.z);l=l$.fromArray(Sm[e]),e!=="east"&&e!=="west"&&l.scale(A),f=u$.fromArray(Sm[t]),t!=="east"&&t!=="west"&&f.scale(A),h=f$.fromArray(Sm[s]),s!=="east"&&s!=="west"&&h.scale(A)}else{const{up:A,east:y,north:E}=Uc;y.set(-g.y,g.x,0).normalize(),n.geodeticSurfaceNormal(g,A),E.copy(A).cross(y);const{down:v,west:S,south:x}=Uc;v.copy(A).scale(-1),S.copy(y).scale(-1),x.copy(E).scale(-1),l=Uc[e],f=Uc[t],h=Uc[s]}return i[0]=l.x,i[1]=l.y,i[2]=l.z,i[3]=0,i[4]=f.x,i[5]=f.y,i[6]=f.z,i[7]=0,i[8]=h.x,i[9]=h.y,i[10]=h.z,i[11]=0,i[12]=g.x,i[13]=g.y,i[14]=g.z,i[15]=1,i}const jo=new L,h$=new L,d$=new L;function g$(n,e,t=[]){const{oneOverRadii:s,oneOverRadiiSquared:r,centerToleranceSquared:i}=e;jo.from(n);const o=jo.x,l=jo.y,f=jo.z,h=s.x,g=s.y,m=s.z,A=o*o*h*h,y=l*l*g*g,E=f*f*m*m,v=A+y+E,S=Math.sqrt(1/v);if(!Number.isFinite(S))return;const x=h$;if(x.copy(n).scale(S),v<i)return x.to(t);const O=r.x,R=r.y,D=r.z,z=d$;z.set(x.x*O*2,x.y*R*2,x.z*D*2);let J=(1-S)*jo.len()/(.5*z.len()),ie=0,re,ee,le,fe;do{J-=ie,re=1/(1+J*O),ee=1/(1+J*R),le=1/(1+J*D);const ye=re*re,ke=ee*ee,me=le*le,Oe=ye*re,W=ke*ee,oe=me*le;fe=A*ye+y*ke+E*me-1;const He=-2*(A*Oe*O+y*W*R+E*oe*D);ie=fe/He}while(Math.abs(fe)>uL);return jo.scale([re,ee,le]).to(t)}const vf=new L,Pv=new L,p$=new L,fs=new L,m$=new L,Bf=new L;class qe{constructor(e=0,t=0,s=0){this.centerToleranceSquared=lL,ps(e>=0),ps(t>=0),ps(s>=0),this.radii=new L(e,t,s),this.radiiSquared=new L(e*e,t*t,s*s),this.radiiToTheFourth=new L(e*e*e*e,t*t*t*t,s*s*s*s),this.oneOverRadii=new L(e===0?0:1/e,t===0?0:1/t,s===0?0:1/s),this.oneOverRadiiSquared=new L(e===0?0:1/(e*e),t===0?0:1/(t*t),s===0?0:1/(s*s)),this.minimumRadius=Math.min(e,t,s),this.maximumRadius=Math.max(e,t,s),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(e){return this===e||!!(e&&this.radii.equals(e.radii))}toString(){return this.radii.toString()}cartographicToCartesian(e,t=[0,0,0]){const s=Pv,r=p$,[,,i]=e;this.geodeticSurfaceNormalCartographic(e,s),r.copy(this.radiiSquared).scale(s);const o=Math.sqrt(s.dot(r));return r.scale(1/o),s.scale(i),r.add(s),r.to(t)}cartesianToCartographic(e,t=[0,0,0]){Bf.from(e);const s=this.scaleToGeodeticSurface(Bf,fs);if(!s)return;const r=this.geodeticSurfaceNormal(s,Pv),i=m$;i.copy(Bf).subtract(s);const o=Math.atan2(r.y,r.x),l=Math.asin(r.z),f=Math.sign(JA(i,Bf))*V3(i);return a$([o,l,f],t)}eastNorthUpToFixedFrame(e,t=new we){return Fv(this,"east","north","up",e,t)}localFrameToFixedFrame(e,t,s,r,i=new we){return Fv(this,e,t,s,r,i)}geocentricSurfaceNormal(e,t=[0,0,0]){return vf.from(e).normalize().to(t)}geodeticSurfaceNormalCartographic(e,t=[0,0,0]){const s=i$(e),r=s[0],i=s[1],o=Math.cos(i);return vf.set(o*Math.cos(r),o*Math.sin(r),Math.sin(i)).normalize(),vf.to(t)}geodeticSurfaceNormal(e,t=[0,0,0]){return vf.from(e).scale(this.oneOverRadiiSquared).normalize().to(t)}scaleToGeodeticSurface(e,t){return g$(e,this,t)}scaleToGeocentricSurface(e,t=[0,0,0]){fs.from(e);const s=fs.x,r=fs.y,i=fs.z,o=this.oneOverRadiiSquared,l=1/Math.sqrt(s*s*o.x+r*r*o.y+i*i*o.z);return fs.multiplyScalar(l).to(t)}transformPositionToScaledSpace(e,t=[0,0,0]){return fs.from(e).scale(this.oneOverRadii).to(t)}transformPositionFromScaledSpace(e,t=[0,0,0]){return fs.from(e).scale(this.radii).to(t)}getSurfaceNormalIntersectionWithZAxis(e,t=0,s=[0,0,0]){ps(Ts(this.radii.x,this.radii.y,Z3)),ps(this.radii.z>0),fs.from(e);const r=fs.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(r)>=this.radii.z-t))return fs.set(0,0,r).to(s)}}qe.WGS84=new qe(t$,n$,s$);class _${constructor(e,t,s){b(this,"item");b(this,"previous");b(this,"next");this.item=e,this.previous=t,this.next=s}}class A${constructor(){b(this,"head",null);b(this,"tail",null);b(this,"_length",0)}get length(){return this._length}add(e){const t=new _$(e,this.tail,null);return this.tail?(this.tail.next=t,this.tail=t):(this.head=t,this.tail=t),++this._length,t}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}splice(e,t){e!==t&&(this.remove(t),this._insert(e,t))}_insert(e,t){const s=e.next;e.next=t,this.tail===e?this.tail=t:s.previous=t,t.next=s,t.previous=e,++this._length}}class y${constructor(){b(this,"_list");b(this,"_sentinel");b(this,"_trimTiles");this._list=new A$,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(e){const t=e._cacheNode;t&&this._list.splice(this._sentinel,t)}add(e,t,s){t._cacheNode||(t._cacheNode=this._list.add(t),s&&s(e,t))}unloadTile(e,t,s){const r=t._cacheNode;r&&(this._list.remove(r),t._cacheNode=null,s&&s(e,t))}unloadTiles(e,t){const s=this._trimTiles;this._trimTiles=!1;const r=this._list,i=e.maximumMemoryUsage*1024*1024,o=this._sentinel;let l=r.head;for(;l!==o&&(e.gpuMemoryUsageInBytes>i||s);){const f=l.item;l=l.next,this.unloadTile(e,f,t)}}trim(){this._trimTiles=!0}}function b$(n,e){it(n),it(e);const{rtcCenter:t,gltfUpAxis:s}=e,{computedTransform:r,boundingVolume:{center:i}}=n;let o=new we(r);switch(t&&o.translate(t),s){case"Z":break;case"Y":const m=new we().rotateX(Math.PI/2);o=o.multiplyRight(m);break;case"X":const A=new we().rotateY(-Math.PI/2);o=o.multiplyRight(A);break}e.isQuantized&&o.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);const l=new L(i);e.cartesianModelMatrix=o,e.cartesianOrigin=l;const f=qe.WGS84.cartesianToCartographic(l,new L),g=qe.WGS84.eastNorthUpToFixedFrame(l).invert();e.cartographicModelMatrix=g.multiplyRight(o),e.cartographicOrigin=f,e.coordinateSystem||(e.modelMatrix=e.cartographicModelMatrix)}const Uv=new L,wm=new L,sA=new Yn([new Fs,new Fs,new Fs,new Fs,new Fs,new Fs]);function T$(n,e){const{cameraDirection:t,cameraUp:s,height:r}=n,{metersPerUnit:i}=n.distanceScales,o=Xf(n,n.center),l=qe.WGS84.eastNorthUpToFixedFrame(o),f=n.unprojectPosition(n.cameraPosition),h=qe.WGS84.cartographicToCartesian(f,new L),g=new L(l.transformAsVector(new L(t).scale(i))).normalize(),m=new L(l.transformAsVector(new L(s).scale(i))).normalize();C$(n);const A=n.constructor,{longitude:y,latitude:E,width:v,bearing:S,zoom:x}=n,O=new A({longitude:y,latitude:E,height:r,width:v,bearing:S,zoom:x,pitch:0});return{camera:{position:h,direction:g,up:m},viewport:n,topDownViewport:O,height:r,cullingVolume:sA,frameNumber:e,sseDenominator:1.15}}function E$(n,e,t){if(t===0||n.length<=t)return[n,[]];const s=[],{longitude:r,latitude:i}=e.viewport;for(const[h,g]of n.entries()){const[m,A]=g.header.mbs,y=Math.abs(r-m),E=Math.abs(i-A),v=Math.sqrt(E*E+y*y);s.push([h,v])}const o=s.sort((h,g)=>h[1]-g[1]),l=[];for(let h=0;h<t;h++)l.push(n[o[h][0]]);const f=[];for(let h=t;h<o.length;h++)f.push(n[o[h][0]]);return[l,f]}function C$(n){const e=n.getFrustumPlanes(),t=Lv(e.near,n.cameraPosition),s=Xf(n,t),r=Xf(n,n.cameraPosition,wm);let i=0;sA.planes[i++].fromPointNormal(s,Uv.copy(s).subtract(r));for(const o in e){if(o==="near")continue;const l=e[o],f=Lv(l,t,wm),h=Xf(n,f,wm);sA.planes[i++].fromPointNormal(h,Uv.copy(s).subtract(h))}}function Lv(n,e,t=new L){const s=n.normal.dot(e);return t.copy(n.normal).scale(n.distance-s).add(e),t}function Xf(n,e,t=new L){const s=n.unprojectPosition(e);return qe.WGS84.cartographicToCartesian(s,t)}const v$=6378137,B$=6378137,rA=6356752314245179e-9,sa=new L;function S$(n,e){if(n instanceof Dl){const{halfAxes:t}=n,s=R$(t);return Math.log2(rA/(s+e[2]))}else if(n instanceof Ol){const{radius:t}=n;return Math.log2(rA/(t+e[2]))}else if(n.width&&n.height){const{width:t,height:s}=n,r=Math.log2(v$/t),i=Math.log2(B$/s);return(r+i)/2}return 1}function Uw(n,e,t){qe.WGS84.cartographicToCartesian([n.xmax,n.ymax,n.zmax],sa);const s=Math.sqrt(Math.pow(sa[0]-t[0],2)+Math.pow(sa[1]-t[1],2)+Math.pow(sa[2]-t[2],2));return Math.log2(rA/(s+e[2]))}function w$(n,e,t){const[s,r,i,o]=n;return Uw({xmax:i,ymax:o,zmax:0},e,t)}function R$(n){n.getColumn(0,sa);const e=n.getColumn(1),t=n.getColumn(2);return sa.add(e).add(t).len()}const In={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5};var Es;(function(n){n[n.ADD=1]="ADD",n[n.REPLACE=2]="REPLACE"})(Es||(Es={}));var fr;(function(n){n.EMPTY="empty",n.SCENEGRAPH="scenegraph",n.POINTCLOUD="pointcloud",n.MESH="mesh"})(fr||(fr={}));var hn;(function(n){n.I3S="I3S",n.TILES3D="TILES3D"})(hn||(hn={}));var Ta;(function(n){n.GEOMETRIC_ERROR="geometricError",n.MAX_SCREEN_THRESHOLD="maxScreenThreshold"})(Ta||(Ta={}));const x$={USE_OPTIMIZATION:1};function Lw(n){return n!=null}const Qt=new L,Jf=new L,I$=new L,M$=new L,xi=new L,kv=new L,Hv=new L,Gv=new L;function Rm(n,e,t){if(it(n,"3D Tile: boundingVolume must be defined"),n.box)return kw(n.box,e,t);if(n.region)return N$(n.region);if(n.sphere)return D$(n.sphere,e,t);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function O$(n,e){if(n.box)return F$(e);if(n.region){const[t,s,r,i,o,l]=n.region;return[[gs(t),gs(s),o],[gs(r),gs(i),l]]}if(n.sphere)return P$(e);throw new Error("Unkown boundingVolume type")}function kw(n,e,t){const s=new L(n[0],n[1],n[2]);e.transform(s,s);let r=[];if(n.length===10){const h=n.slice(3,6),g=new ga;g.fromArray(n,6);const m=new L([1,0,0]),A=new L([0,1,0]),y=new L([0,0,1]);m.transformByQuaternion(g),m.scale(h[0]),A.transformByQuaternion(g),A.scale(h[1]),y.transformByQuaternion(g),y.scale(h[2]),r=[...m.toArray(),...A.toArray(),...y.toArray()]}else r=[...n.slice(3,6),...n.slice(6,9),...n.slice(9,12)];const i=e.transformAsVector(r.slice(0,3)),o=e.transformAsVector(r.slice(3,6)),l=e.transformAsVector(r.slice(6,9)),f=new at([i[0],i[1],i[2],o[0],o[1],o[2],l[0],l[1],l[2]]);return Lw(t)?(t.center=s,t.halfAxes=f,t):new Dl(s,f)}function D$(n,e,t){const s=new L(n[0],n[1],n[2]);e.transform(s,s);const r=e.getScale(Jf),i=Math.max(Math.max(r[0],r[1]),r[2]),o=n[3]*i;return Lw(t)?(t.center=s,t.radius=o,t):new Ol(s,o)}function N$(n){const[e,t,s,r,i,o]=n,l=qe.WGS84.cartographicToCartesian([gs(e),gs(r),i],I$),f=qe.WGS84.cartographicToCartesian([gs(s),gs(t),o],M$),h=new L().addVectors(l,f).multiplyByScalar(.5);return qe.WGS84.cartesianToCartographic(h,xi),qe.WGS84.cartographicToCartesian([gs(s),xi[1],xi[2]],kv),qe.WGS84.cartographicToCartesian([xi[0],gs(r),xi[2]],Hv),qe.WGS84.cartographicToCartesian([xi[0],xi[1],o],Gv),kw([...h,...kv.subtract(h),...Hv.subtract(h),...Gv.subtract(h)],new we)}function F$(n){const e=Hw(),{halfAxes:t}=n,s=new L(t.getColumn(0)),r=new L(t.getColumn(1)),i=new L(t.getColumn(2));for(let o=0;o<2;o++){for(let l=0;l<2;l++){for(let f=0;f<2;f++)Qt.copy(n.center),Qt.add(s),Qt.add(r),Qt.add(i),Gw(e,Qt),i.negate();r.negate()}s.negate()}return e}function P$(n){const e=Hw(),{center:t,radius:s}=n,r=qe.WGS84.scaleToGeodeticSurface(t,Qt);let i;r?i=qe.WGS84.geodeticSurfaceNormal(r):i=new L(0,0,1);let o=new L(i[2],-i[1],0);o.len()>0?o.normalize():o=new L(0,1,0);const l=o.clone().cross(i);for(const f of[o,l,i]){Jf.copy(f).scale(s);for(let h=0;h<2;h++)Qt.copy(t),Qt.add(Jf),Gw(e,Qt),Jf.negate()}return e}function Hw(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function Gw(n,e){qe.WGS84.cartesianToCartographic(e,Qt),n[0][0]=Math.min(n[0][0],Qt[0]),n[0][1]=Math.min(n[0][1],Qt[1]),n[0][2]=Math.min(n[0][2],Qt[2]),n[1][0]=Math.max(n[1][0],Qt[0]),n[1][1]=Math.max(n[1][1],Qt[1]),n[1][2]=Math.max(n[1][2],Qt[2])}new L;new L;new we;new L;new L;new L;function U$(n,e){const t=n*e;return 1-Math.exp(-(t*t))}function L$(n,e){if(n.dynamicScreenSpaceError&&n.dynamicScreenSpaceErrorComputedDensity){const t=n.dynamicScreenSpaceErrorComputedDensity,s=n.dynamicScreenSpaceErrorFactor;return U$(e,t)*s}return 0}function k$(n,e,t){const s=n.tileset,r=n.parent&&n.parent.lodMetricValue||n.lodMetricValue,i=t?r:n.lodMetricValue;if(i===0)return 0;const o=Math.max(n._distanceToCamera,1e-7),{height:l,sseDenominator:f}=e,{viewDistanceScale:h}=s.options;let g=i*l*(h||1)/(o*f);return g-=L$(s,o),g}const xm=new L,Vv=new L,Jr=new L,jv=new L,H$=new L,Im=new we,zv=new we;function G$(n,e){if(n.lodMetricValue===0||isNaN(n.lodMetricValue))return"DIG";const t=2*Vw(n,e);return t<2?"OUT":!n.header.children||t<=n.lodMetricValue?"DRAW":n.header.children?"DIG":"OUT"}function Vw(n,e){const{topDownViewport:t}=e,s=n.header.mbs[1],r=n.header.mbs[0],i=n.header.mbs[2],o=n.header.mbs[3],l=[...n.boundingVolume.center],f=t.unprojectPosition(t.cameraPosition);qe.WGS84.cartographicToCartesian(f,xm),Vv.copy(xm).subtract(l).normalize(),qe.WGS84.eastNorthUpToFixedFrame(l,Im),zv.copy(Im).invert(),Jr.copy(xm).transform(zv);const h=Math.sqrt(Jr[0]*Jr[0]+Jr[1]*Jr[1]),g=h*h/Jr[2];jv.copy([Jr[0],Jr[1],g]);const A=jv.transform(Im).subtract(l).normalize(),E=Vv.cross(A).normalize().scale(o).add(l),v=qe.WGS84.cartesianToCartographic(E),S=t.project([r,s,i]),x=t.project(v);return H$.copy(S).subtract(x).magnitude()}function V$(n){return{assetGltfUpAxis:n.asset&&n.asset.gltfUpAxis||"Y"}}class $v{constructor(e=0){b(this,"_map",new Map);b(this,"_array");b(this,"_length");this._array=new Array(e),this._length=e}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e)}get values(){return this._array}get(e){return it(e<this._array.length),this._array[e]}set(e,t){it(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=t,this._map.set(t,e)}delete(e){const t=this._map.get(e);t>=0&&(this._array.splice(t,1),this._map.delete(e),this.length--)}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){const t=this.length++;this._array[t]=e,this._map.set(e,t)}}pop(){const e=this._array[--this.length];return this._map.delete(e),e}reserve(e){it(e>=0),e>this._array.length&&(this._array.length=e)}resize(e){it(e>=0),this.length=e}trim(e){e==null&&(e=this.length),this._array.length=e}reset(){this._array=[],this._map=new Map,this._length=0}find(e){return this._map.has(e)}}const j$={loadSiblings:!1,skipLevelOfDetail:!1,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class id{constructor(e){b(this,"options");b(this,"root",null);b(this,"selectedTiles",{});b(this,"requestedTiles",{});b(this,"emptyTiles",{});b(this,"lastUpdate",new Date().getTime());b(this,"updateDebounceTime",1e3);b(this,"_traversalStack",new $v);b(this,"_emptyTraversalStack",new $v);b(this,"_frameNumber",null);this.options={...j$,...e}}traversalFinished(e){return!0}traverse(e,t,s){this.root=e,this.options={...this.options,...s},this.reset(),this.updateTile(e,t),this._frameNumber=t.frameNumber,this.executeTraversal(e,t)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(e,t){const s=this._traversalStack;for(e._selectionDepth=1,s.push(e);s.length>0;){const i=s.pop();let o=!1;this.canTraverse(i,t)&&(this.updateChildTiles(i,t),o=this.updateAndPushChildren(i,t,s,i.hasRenderContent?i._selectionDepth+1:i._selectionDepth));const l=i.parent,f=!!(!l||l._shouldRefine),h=!o;i.hasRenderContent?i.refine===Es.ADD?(this.loadTile(i,t),this.selectTile(i,t)):i.refine===Es.REPLACE&&(this.loadTile(i,t),h&&this.selectTile(i,t)):(this.emptyTiles[i.id]=i,this.loadTile(i,t),h&&this.selectTile(i,t)),this.touchTile(i,t),i._shouldRefine=o&&f}const r=new Date().getTime();(this.traversalFinished(t)||r-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=r,this.options.onTraversalEnd(t))}updateChildTiles(e,t){const s=e.children;for(const r of s)this.updateTile(r,t)}updateAndPushChildren(e,t,s,r){const{loadSiblings:i,skipLevelOfDetail:o}=this.options,l=e.children;l.sort(this.compareDistanceToCamera.bind(this));const f=e.refine===Es.REPLACE&&e.hasRenderContent&&!o;let h=!1,g=!0;for(const m of l)if(m._selectionDepth=r,m.isVisibleAndInRequestVolume?(s.find(m)&&s.delete(m),s.push(m),h=!0):(f||i)&&(this.loadTile(m,t),this.touchTile(m,t)),f){let A;if(m._inRequestVolume?m.hasRenderContent?A=m.contentAvailable:A=this.executeEmptyTraversal(m,t):A=!1,g=g&&A,!g)return!1}return h||(g=!1),g}updateTile(e,t){this.updateTileVisibility(e,t)}selectTile(e,t){this.shouldSelectTile(e)&&(e._selectedFrame=t.frameNumber,this.selectedTiles[e.id]=e)}loadTile(e,t){this.shouldLoadTile(e)&&(e._requestedFrame=t.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}touchTile(e,t){e.tileset._cache.touch(e),e._touchedFrame=t.frameNumber}canTraverse(e,t){return e.hasChildren?e.hasTilesetContent?!e.contentExpired:this.shouldRefine(e,t):!1}shouldLoadTile(e){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,t,s=!1){let r=e._screenSpaceError;return s&&(r=e.getScreenSpaceError(t,!0)),r>e.tileset.memoryAdjustedScreenSpaceError}updateTileVisibility(e,t){const s=[];if(this.options.viewportTraversersMap)for(const r in this.options.viewportTraversersMap)this.options.viewportTraversersMap[r]===t.viewport.id&&s.push(r);else s.push(t.viewport.id);e.updateVisibility(t,s)}compareDistanceToCamera(e,t){return e._distanceToCamera-t._distanceToCamera}anyChildrenVisible(e,t){let s=!1;for(const r of e.children)r.updateVisibility(t),s=s||r.isVisibleAndInRequestVolume;return s}executeEmptyTraversal(e,t){let s=!0;const r=this._emptyTraversalStack;for(r.push(e);r.length>0;){const i=r.pop(),o=!i.hasRenderContent&&this.canTraverse(i,t),l=!i.hasRenderContent&&i.children.length===0;if(!o&&!i.contentAvailable&&!l&&(s=!1),this.updateTile(i,t),i.isVisibleAndInRequestVolume||(this.loadTile(i,t),this.touchTile(i,t)),o){const f=i.children;for(const h of f)r.push(h)}}return s}}const Xv=new L;function z$(n){return n!=null}class iA{constructor(e,t,s,r=""){b(this,"tileset");b(this,"header");b(this,"id");b(this,"url");b(this,"parent");b(this,"refine");b(this,"type");b(this,"contentUrl");b(this,"lodMetricType","geometricError");b(this,"lodMetricValue",0);b(this,"boundingVolume",null);b(this,"content",null);b(this,"contentState",In.UNLOADED);b(this,"gpuMemoryUsageInBytes",0);b(this,"children",[]);b(this,"depth",0);b(this,"viewportIds",[]);b(this,"transform",new we);b(this,"extensions",null);b(this,"implicitTiling",null);b(this,"userData",{});b(this,"computedTransform");b(this,"hasEmptyContent",!1);b(this,"hasTilesetContent",!1);b(this,"traverser",new id({}));b(this,"_cacheNode",null);b(this,"_frameNumber",null);b(this,"_expireDate",null);b(this,"_expiredContent",null);b(this,"_boundingBox");b(this,"_distanceToCamera",0);b(this,"_screenSpaceError",0);b(this,"_visibilityPlaneMask");b(this,"_visible");b(this,"_contentBoundingVolume");b(this,"_viewerRequestVolume");b(this,"_initialTransform",new we);b(this,"_priority",0);b(this,"_selectedFrame",0);b(this,"_requestedFrame",0);b(this,"_selectionDepth",0);b(this,"_touchedFrame",0);b(this,"_centerZDepth",0);b(this,"_shouldRefine",!1);b(this,"_stackLength",0);b(this,"_visitedFrame",0);b(this,"_inRequestVolume",!1);b(this,"_lodJudge",null);this.header=t,this.tileset=e,this.id=r||t.id,this.url=t.url,this.parent=s,this.refine=this._getRefine(t.refine),this.type=t.type,this.contentUrl=t.contentUrl,this._initializeLodMetric(t),this._initializeTransforms(t),this._initializeBoundingVolumes(t),this._initializeContent(t),this._initializeRenderingState(t),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===In.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===In.UNLOADED}get contentExpired(){return this.contentState===In.EXPIRED}get contentFailed(){return this.contentState===In.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=O$(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(e,t){switch(this.tileset.type){case hn.I3S:return Vw(this,e);case hn.TILES3D:return k$(this,e,t);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const e=this.tileset._traverser,{skipLevelOfDetail:t}=e.options,s=this.refine===Es.ADD||t;if(s&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===In.UNLOADED)return-1;const r=this.parent,o=r&&(!s||this._screenSpaceError===0||r.hasTilesetContent)?r._screenSpaceError:this._screenSpaceError,l=e.root?e.root._screenSpaceError:0;return Math.max(l-o,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=In.LOADING;const t=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!t)return this.contentState=In.UNLOADED,!1;try{const s=this.tileset.getTileUrl(this.contentUrl),r=this.tileset.loader,i={...this.tileset.loadOptions,[r.id]:{...this.tileset.loadOptions[r.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(r.id)}};return this.content=await zs(s,r,i),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=In.READY,this._onContentLoaded(),!0}catch(s){throw this.contentState=In.FAILED,s}finally{t.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=In.UNLOADED,!0}updateVisibility(e,t){if(this._frameNumber===e.frameNumber)return;const s=this.parent,r=s?s._visibilityPlaneMask:Yn.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const i=s?s.computedTransform:this.tileset.modelMatrix;this._updateTransform(i)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,r),this._visible=this._visibilityPlaneMask!==Yn.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=t}visibility(e,t){const{cullingVolume:s}=e,{boundingVolume:r}=this;return s.computeVisibilityWithPlaneMask(r,t)}contentVisibility(){return!0}distanceToTile(e){const t=this.boundingVolume;return Math.sqrt(Math.max(t.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth({camera:e}){const t=this.boundingVolume;return Xv.subVectors(t.center,e.position),e.direction.dot(Xv)}insideViewerRequestVolume(e){const t=this._viewerRequestVolume;return!t||t.distanceSquaredTo(e.camera.position)<=0}updateExpiration(){if(z$(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=In.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(e){this.transform=e.transform?new we(e.transform):new we;const t=this.parent,s=this.tileset,r=t&&t.computedTransform?t.computedTransform.clone():s.modelMatrix.clone();this.computedTransform=new we(r).multiplyRight(this.transform);const i=t&&t._initialTransform?t._initialTransform.clone():new we;this._initialTransform=new we(i).multiplyRight(this.transform)}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=In.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=Yn.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(e){return e||this.parent&&this.parent.refine||Es.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(e){this.boundingVolume=Rm(e.boundingVolume,this.computedTransform,this.boundingVolume);const t=e.content;t&&(t.boundingVolume&&(this._contentBoundingVolume=Rm(t.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=Rm(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(e=new we){const t=e.clone().multiplyRight(this.transform);t.equals(this.computedTransform)||(this.computedTransform=t,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(e){switch(e){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return V$(this.tileset.tileset)}}}class $$ extends id{compareDistanceToCamera(e,t){return t._distanceToCamera===0&&e._distanceToCamera===0?t._centerZDepth-e._centerZDepth:t._distanceToCamera-e._distanceToCamera}updateTileVisibility(e,t){if(super.updateTileVisibility(e,t),!e.isVisibleAndInRequestVolume)return;const s=e.children.length>0;if(e.hasTilesetContent&&s){const o=e.children[0];this.updateTileVisibility(o,t),e._visible=o._visible;return}if(this.meetsScreenSpaceErrorEarly(e,t)){e._visible=!1;return}const r=e.refine===Es.REPLACE,i=e._optimChildrenWithinParent===x$.USE_OPTIMIZATION;if(r&&i&&s&&!this.anyChildrenVisible(e,t)){e._visible=!1;return}}meetsScreenSpaceErrorEarly(e,t){const{parent:s}=e;return!s||s.hasTilesetContent||s.refine!==Es.ADD?!1:!this.shouldRefine(e,t,!0)}}class X${constructor(){b(this,"frameNumberMap",new Map)}register(e,t){const s=this.frameNumberMap.get(e)||new Map,r=s.get(t)||0;s.set(t,r+1),this.frameNumberMap.set(e,s)}deregister(e,t){const s=this.frameNumberMap.get(e);if(!s)return;const r=s.get(t)||1;s.set(t,r-1)}isZero(e,t){var r;return(((r=this.frameNumberMap.get(e))==null?void 0:r.get(t))||0)===0}}const Mm={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class J${constructor(){b(this,"_statusMap");b(this,"pendingTilesRegister",new X$);this._statusMap={}}add(e,t,s,r){if(!this._statusMap[t]){const{frameNumber:i,viewport:{id:o}}=r;this._statusMap[t]={request:e,callback:s,key:t,frameState:r,status:Mm.REQUESTED},this.pendingTilesRegister.register(o,i),e().then(l=>{this._statusMap[t].status=Mm.COMPLETED;const{frameNumber:f,viewport:{id:h}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(h,f),this._statusMap[t].callback(l,r)}).catch(l=>{this._statusMap[t].status=Mm.ERROR;const{frameNumber:f,viewport:{id:h}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(h,f),s(l)})}}update(e,t){if(this._statusMap[e]){const{frameNumber:s,viewport:{id:r}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(r,s);const{frameNumber:i,viewport:{id:o}}=t;this.pendingTilesRegister.register(o,i),this._statusMap[e].frameState=t}}find(e){return this._statusMap[e]}hasPendingTiles(e,t){return!this.pendingTilesRegister.isZero(e,t)}}class W$ extends id{constructor(t){super(t);b(this,"_tileManager");this._tileManager=new J$}traversalFinished(t){return!this._tileManager.hasPendingTiles(t.viewport.id,this._frameNumber||0)}shouldRefine(t,s){return t._lodJudge=G$(t,s),t._lodJudge==="DIG"}updateChildTiles(t,s){const r=t.header.children||[],i=t.children,o=t.tileset;for(const l of r){const f=`${l.id}-${s.viewport.id}`,h=i&&i.find(g=>g.id===f);if(h)h&&this.updateTile(h,s);else{let g=()=>this._loadTile(l.id,o);this._tileManager.find(f)?this._tileManager.update(f,s):(o.tileset.nodePages&&(g=()=>o.tileset.nodePagesTile.formTileFromNodePages(l.id)),this._tileManager.add(g,f,A=>this._onTileLoad(A,t,f),s))}}return!1}async _loadTile(t,s){const{loader:r}=s,i=s.getTileUrl(`${s.url}/nodes/${t}`),o={...s.loadOptions,i3s:{...s.loadOptions.i3s,isTileHeader:!0}};return await zs(i,r,o)}_onTileLoad(t,s,r){const i=new iA(s.tileset,t,s,r);s.children.push(i);const o=this._tileManager.find(i.id).frameState;this.updateTile(i,o),this._frameNumber===o.frameNumber&&(this.traversalFinished(o)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(i,o)}}const Y$={description:"",ellipsoid:qe.WGS84,modelMatrix:new we,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,memoryCacheOverflow:1,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:n=>n,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,memoryAdjustedScreenSpaceError:!1,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},Sf="Tiles In Tileset(s)",Om="Tiles In Memory",Jv="Tiles In View",Wv="Tiles To Render",Yv="Tiles Loaded",Dm="Tiles Loading",Kv="Tiles Unloaded",qv="Failed Tile Loads",Qv="Points/Vertices",Nm="Tile Memory Use",Zv="Maximum Screen Space Error";class K${constructor(e,t){b(this,"options");b(this,"loadOptions");b(this,"type");b(this,"tileset");b(this,"loader");b(this,"url");b(this,"basePath");b(this,"modelMatrix");b(this,"ellipsoid");b(this,"lodMetricType");b(this,"lodMetricValue");b(this,"refine");b(this,"root",null);b(this,"roots",{});b(this,"asset",{});b(this,"description","");b(this,"properties");b(this,"extras",null);b(this,"attributions",{});b(this,"credits",{});b(this,"stats");b(this,"contentFormats",{draco:!1,meshopt:!1,dds:!1,ktx2:!1});b(this,"cartographicCenter",null);b(this,"cartesianCenter",null);b(this,"zoom",1);b(this,"boundingVolume",null);b(this,"dynamicScreenSpaceErrorComputedDensity",0);b(this,"maximumMemoryUsage",32);b(this,"gpuMemoryUsageInBytes",0);b(this,"memoryAdjustedScreenSpaceError",0);b(this,"_cacheBytes",0);b(this,"_cacheOverflowBytes",0);b(this,"_frameNumber",0);b(this,"_queryParams",{});b(this,"_extensionsUsed",[]);b(this,"_tiles",{});b(this,"_pendingCount",0);b(this,"selectedTiles",[]);b(this,"traverseCounter",0);b(this,"geometricError",0);b(this,"lastUpdatedVieports",null);b(this,"_requestedTiles",[]);b(this,"_emptyTiles",[]);b(this,"frameStateData",{});b(this,"_traverser");b(this,"_cache",new y$);b(this,"_requestScheduler");b(this,"updatePromise",null);b(this,"tilesetInitializationPromise");this.options={...Y$,...t},this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||vA(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new VO({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.memoryAdjustedScreenSpaceError=this.options.maximumScreenSpaceError,this._cacheBytes=this.options.maximumMemoryUsage*1024*1024,this._cacheOverflowBytes=this.options.memoryCacheOverflow*1024*1024,this.stats=new wa({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(e)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(e){this.options={...this.options,...e}}getTileUrl(e){if(e.startsWith("data:"))return e;let s=e;return this.queryParams.length&&(s=`${e}${e.includes("?")?"&":"?"}${this.queryParams}`),s}hasExtension(e){return this._extensionsUsed.indexOf(e)>-1}update(e=null){this.tilesetInitializationPromise.then(()=>{!e&&this.lastUpdatedVieports?e=this.lastUpdatedVieports:this.lastUpdatedVieports=e,e&&this.doUpdate(e)})}async selectTiles(e=null){return await this.tilesetInitializationPromise,e&&(this.lastUpdatedVieports=e),this.updatePromise||(this.updatePromise=new Promise(t=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),t(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}adjustScreenSpaceError(){this.gpuMemoryUsageInBytes<this._cacheBytes?this.memoryAdjustedScreenSpaceError=Math.max(this.memoryAdjustedScreenSpaceError/1.02,this.options.maximumScreenSpaceError):this.gpuMemoryUsageInBytes>this._cacheBytes+this._cacheOverflowBytes&&(this.memoryAdjustedScreenSpaceError*=1.02)}doUpdate(e){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const t=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=t.length;const s=[];for(const r of t){const i=r.id;this._needTraverse(i)?s.push(i):this.traverseCounter--}for(const r of t){const i=r.id;if(this.roots[i]||(this.roots[i]=this._initializeTileHeaders(this.tileset,null)),!s.includes(i))continue;const o=T$(r,this._frameNumber);this._traverser.traverse(this.roots[i],o,this.options)}}_needTraverse(e){let t=e;return this.options.viewportTraversersMap&&(t=this.options.viewportTraversersMap[e]),t===e}_onTraversalEnd(e){const t=e.viewport.id;this.frameStateData[t]||(this.frameStateData[t]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const s=this.frameStateData[t],r=Object.values(this._traverser.selectedTiles),[i,o]=E$(r,e,this.options.maximumTilesSelected);s.selectedTiles=i;for(const l of o)l.unselect();s._requestedTiles=Object.values(this._traverser.requestedTiles),s._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const e in this.frameStateData){const t=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(t.selectedTiles),this._requestedTiles=this._requestedTiles.concat(t._requestedTiles),this._emptyTiles=this._emptyTiles.concat(t._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const e of this.selectedTiles)this._tiles[e.id]=e;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(e,t){if(e.length!==t.length)return!0;const s=new Set(e.map(o=>o.id)),r=new Set(t.map(o=>o.id));let i=e.filter(o=>!r.has(o.id)).length>0;return i=i||t.filter(o=>!s.has(o.id)).length>0,i}_loadTiles(){for(const e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e)}_unloadTiles(){this._cache.unloadTiles(this,(e,t)=>e._unloadTile(t))}_updateStats(){let e=0,t=0;for(const s of this.selectedTiles)s.contentAvailable&&s.content&&(e++,s.content.pointCount?t+=s.content.pointCount:t+=s.content.vertexCount);this.stats.get(Jv).count=this.selectedTiles.length,this.stats.get(Wv).count=e,this.stats.get(Qv).count=t,this.stats.get(Zv).count=this.memoryAdjustedScreenSpaceError}async _initializeTileSet(e){this.type===hn.I3S&&(this.calculateViewPropsI3S(),e.root=await e.root),this.root=this._initializeTileHeaders(e,null),this.type===hn.TILES3D&&(this._initializeTiles3DTileset(e),this.calculateViewPropsTiles3D()),this.type===hn.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var s;const e=this.tileset.fullExtent;if(e){const{xmin:r,xmax:i,ymin:o,ymax:l,zmin:f,zmax:h}=e;this.cartographicCenter=new L(r+(i-r)/2,o+(l-o)/2,f+(h-f)/2),this.cartesianCenter=new L,qe.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=Uw(e,this.cartographicCenter,this.cartesianCenter);return}const t=(s=this.tileset.store)==null?void 0:s.extent;if(t){const[r,i,o,l]=t;this.cartographicCenter=new L(r+(o-r)/2,i+(l-i)/2,0),this.cartesianCenter=new L,qe.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=w$(t,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new L,this.zoom=1}calculateViewPropsTiles3D(){const e=this.root,{center:t}=e.boundingVolume;if(!t){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new L,this.zoom=1;return}t[0]!==0||t[1]!==0||t[2]!==0?(this.cartographicCenter=new L,qe.WGS84.cartesianToCartographic(t,this.cartographicCenter)):this.cartographicCenter=new L(0,0,-qe.WGS84.radii[0]),this.cartesianCenter=t,this.zoom=S$(e.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(Sf),this.stats.get(Dm),this.stats.get(Om),this.stats.get(Jv),this.stats.get(Wv),this.stats.get(Yv),this.stats.get(Kv),this.stats.get(qv),this.stats.get(Qv),this.stats.get(Nm,"memory"),this.stats.get(Zv)}_initializeTileHeaders(e,t){var r;const s=new iA(this,e.root,t);if(t&&(t.children.push(s),s.depth=t.depth+1),this.type===hn.TILES3D){const i=[];for(i.push(s);i.length>0;){const o=i.pop();this.stats.get(Sf).incrementCount();const l=o.header.children||[];for(const f of l){const h=new iA(this,f,o);if((r=h.contentUrl)!=null&&r.includes("?session=")){const m=new URL(h.contentUrl).searchParams.get("session");m&&(this._queryParams.session=m)}o.children.push(h),h.depth=o.depth+1,i.push(h)}}}return s}_initializeTraverser(){let e;switch(this.type){case hn.TILES3D:e=$$;break;case hn.I3S:e=W$;break;default:e=id}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e)}async _loadTile(e){let t;try{this._onStartTileLoading(),t=await e.loadContent()}catch(s){this._onTileLoadError(e,s instanceof Error?s:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(e,t)}}_onTileLoadError(e,t){this.stats.get(qv).incrementCount();const s=t.message||t.toString(),r=e.url;console.error(`A 3D tile failed to load: ${e.url} ${s}`),this.options.onTileError(e,s,r)}_onTileLoad(e,t){var s,r;if(t){if(this.type===hn.I3S){const i=((r=(s=this.tileset)==null?void 0:s.nodePagesTile)==null?void 0:r.nodesInNodePages)||0;this.stats.get(Sf).reset(),this.stats.get(Sf).addCount(i)}e&&e.content&&b$(e,e.content),this.updateContentTypes(e),this._addTileToCache(e),this.options.onTileLoad(e)}}updateContentTypes(e){var t;if(this.type===hn.I3S)switch(e.header.isDracoGeometry&&(this.contentFormats.draco=!0),e.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===hn.TILES3D){const{extensionsRemoved:s=[]}=((t=e.content)==null?void 0:t.gltf)||{};s.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),s.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),s.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(Dm).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(Dm).decrementCount()}_addTileToCache(e){this._cache.add(this,e,t=>t._updateCacheStats(e))}_updateCacheStats(e){this.stats.get(Yv).incrementCount(),this.stats.get(Om).incrementCount(),this.gpuMemoryUsageInBytes+=e.gpuMemoryUsageInBytes||0,this.stats.get(Nm).count=this.gpuMemoryUsageInBytes,this.options.memoryAdjustedScreenSpaceError&&this.adjustScreenSpaceError()}_unloadTile(e){this.gpuMemoryUsageInBytes-=e.gpuMemoryUsageInBytes||0,this.stats.get(Om).decrementCount(),this.stats.get(Kv).incrementCount(),this.stats.get(Nm).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}_destroy(){const e=[];for(this.root&&e.push(this.root);e.length>0;){const t=e.pop();for(const s of t.children)e.push(s);this._destroyTile(t)}this.root=null}_destroySubtree(e){const t=e,s=[];for(s.push(t);s.length>0;){e=s.pop();for(const r of e.children)s.push(r);e!==t&&this._destroyTile(e)}t.children=[]}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}_initializeTiles3DTileset(e){if(e.queryString){const t=new URLSearchParams(e.queryString),s=Object.fromEntries(t.entries());this._queryParams={...this._queryParams,...s}}if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0"&&this.asset.version!=="1.1")throw new Error("The tileset must be 3D Tiles version either 0.0 or 1.0 or 1.1.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed||[],this.extras=e.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const jw="4.3.2",Lc={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GLTF:"glTF"};function zw(n,e,t){it(n instanceof ArrayBuffer);const s=new TextDecoder("utf8"),r=new Uint8Array(n,e,t);return s.decode(r)}function q$(n,e=0){const t=new DataView(n);return`${String.fromCharCode(t.getUint8(e+0))}${String.fromCharCode(t.getUint8(e+1))}${String.fromCharCode(t.getUint8(e+2))}${String.fromCharCode(t.getUint8(e+3))}`}const Q$="4.3.2",Z$={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:Q$,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function eX(n,e,t){const s=$w(e.metadata),r=[],i=tX(e.attributes);for(const o in n){const l=n[o],f=eB(o,l,i[o]);r.push(f)}if(t){const o=eB("indices",t);r.push(o)}return{fields:r,metadata:s}}function tX(n){const e={};for(const t in n){const s=n[t];e[s.name||"undefined"]=s}return e}function eB(n,e,t){const s=t?$w(t.metadata):void 0;return zS(n,e,s)}function $w(n){Object.entries(n);const e={};for(const t in n)e[`${t}.string`]=JSON.stringify(n[t]);return e}const tB={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},nX={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},sX=4;let rX=class{constructor(e){b(this,"draco");b(this,"decoder");b(this,"metadataQuerier");this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e,t={}){const s=new this.draco.DecoderBuffer;s.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(t);const r=this.decoder.GetEncodedGeometryType(s),i=r===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let o;switch(r){case this.draco.TRIANGULAR_MESH:o=this.decoder.DecodeBufferToMesh(s,i);break;case this.draco.POINT_CLOUD:o=this.decoder.DecodeBufferToPointCloud(s,i);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!o.ok()||!i.ptr){const A=`DRACO decompression failed: ${o.error_msg()}`;throw new Error(A)}const l=this._getDracoLoaderData(i,r,t),f=this._getMeshData(i,l,t),h=xA(f.attributes),g=eX(f.attributes,l,f.indices);return{loader:"draco",loaderData:l,header:{vertexCount:i.num_points(),boundingBox:h},...f,schema:g}}finally{this.draco.destroy(s),i&&this.draco.destroy(i)}}_getDracoLoaderData(e,t,s){const r=this._getTopLevelMetadata(e),i=this._getDracoAttributes(e,s);return{geometry_type:t,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:r,attributes:i}}_getDracoAttributes(e,t){const s={};for(let r=0;r<e.num_attributes();r++){const i=this.decoder.GetAttribute(e,r),o=this._getAttributeMetadata(e,r);s[i.unique_id()]={unique_id:i.unique_id(),attribute_type:i.attribute_type(),data_type:i.data_type(),num_components:i.num_components(),byte_offset:i.byte_offset(),byte_stride:i.byte_stride(),normalized:i.normalized(),attribute_index:r,metadata:o};const l=this._getQuantizationTransform(i,t);l&&(s[i.unique_id()].quantization_transform=l);const f=this._getOctahedronTransform(i,t);f&&(s[i.unique_id()].octahedron_transform=f)}return s}_getMeshData(e,t,s){const r=this._getMeshAttributes(t,e,s);if(!r.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(s.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:r,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:r,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:r}}_getMeshAttributes(e,t,s){const r={};for(const i of Object.values(e.attributes)){const o=this._deduceAttributeName(i,s);i.name=o;const l=this._getAttributeValues(t,i);if(l){const{value:f,size:h}=l;r[o]={value:f,size:h,byteOffset:i.byte_offset,byteStride:i.byte_stride,normalized:i.normalized}}}return r}_getTriangleListIndices(e){const s=e.num_faces()*3,r=s*sX,i=this.draco._malloc(r);try{return this.decoder.GetTrianglesUInt32Array(e,r,i),new Uint32Array(this.draco.HEAPF32.buffer,i,s).slice()}finally{this.draco._free(i)}}_getTriangleStripIndices(e){const t=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,t),aX(t)}finally{this.draco.destroy(t)}}_getAttributeValues(e,t){const s=nX[t.data_type];if(!s)return console.warn(`DRACO: Unsupported attribute type ${t.data_type}`),null;const r=t.num_components,o=e.num_points()*r,l=o*s.BYTES_PER_ELEMENT,f=iX(this.draco,s);let h;const g=this.draco._malloc(l);try{const m=this.decoder.GetAttribute(e,t.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,m,f,l,g),h=new s(this.draco.HEAPF32.buffer,g,o).slice()}finally{this.draco._free(g)}return{value:h,size:r}}_deduceAttributeName(e,t){const s=e.unique_id;for(const[o,l]of Object.entries(t.extraAttributes||{}))if(l===s)return o;const r=e.attribute_type;for(const o in tB)if(this.draco[o]===r)return tB[o];const i=t.attributeNameEntry||"name";return e.metadata[i]?e.metadata[i].string:`CUSTOM_ATTRIBUTE_${s}`}_getTopLevelMetadata(e){const t=this.decoder.GetMetadata(e);return this._getDracoMetadata(t)}_getAttributeMetadata(e,t){const s=this.decoder.GetAttributeMetadata(e,t);return this._getDracoMetadata(s)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const t={},s=this.metadataQuerier.NumEntries(e);for(let r=0;r<s;r++){const i=this.metadataQuerier.GetEntryName(e,r);t[i]=this._getDracoMetadataField(e,i)}return t}_getDracoMetadataField(e,t){const s=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,t,s);const r=oX(s);return{int:this.metadataQuerier.GetIntEntry(e,t),string:this.metadataQuerier.GetStringEntry(e,t),double:this.metadataQuerier.GetDoubleEntry(e,t),intArray:r}}finally{this.draco.destroy(s)}}_disableAttributeTransforms(e){const{quantizedAttributes:t=[],octahedronAttributes:s=[]}=e,r=[...t,...s];for(const i of r)this.decoder.SkipAttributeTransform(this.draco[i])}_getQuantizationTransform(e,t){const{quantizedAttributes:s=[]}=t,r=e.attribute_type();if(s.map(o=>this.decoder[o]).includes(r)){const o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(e))return{quantization_bits:o.quantization_bits(),range:o.range(),min_values:new Float32Array([1,2,3]).map(l=>o.min_value(l))}}finally{this.draco.destroy(o)}}return null}_getOctahedronTransform(e,t){const{octahedronAttributes:s=[]}=t,r=e.attribute_type();if(s.map(o=>this.decoder[o]).includes(r)){const o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(e))return{quantization_bits:o.quantization_bits()}}finally{this.draco.destroy(o)}}return null}};function iX(n,e){switch(e){case Float32Array:return n.DT_FLOAT32;case Int8Array:return n.DT_INT8;case Int16Array:return n.DT_INT16;case Int32Array:return n.DT_INT32;case Uint8Array:return n.DT_UINT8;case Uint16Array:return n.DT_UINT16;case Uint32Array:return n.DT_UINT32;default:return n.DT_INVALID}}function oX(n){const e=n.size(),t=new Int32Array(e);for(let s=0;s<e;s++)t[s]=n.GetValue(s);return t}function aX(n){const e=n.size(),t=new Int32Array(e);for(let s=0;s<e;s++)t[s]=n.GetValue(s);return t}const cX="1.5.6",lX="1.4.1",Fm=`https://www.gstatic.com/draco/versioned/decoders/${cX}`,gn={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},Pm={[gn.DECODER]:`${Fm}/${gn.DECODER}`,[gn.DECODER_WASM]:`${Fm}/${gn.DECODER_WASM}`,[gn.FALLBACK_DECODER]:`${Fm}/${gn.FALLBACK_DECODER}`,[gn.ENCODER]:`https://raw.githubusercontent.com/google/draco/${lX}/javascript/${gn.ENCODER}`};let Um;async function uX(n){const e=n.modules||{};return e.draco3d?Um||(Um=e.draco3d.createDecoderModule({}).then(t=>({draco:t}))):Um||(Um=fX(n)),await Um}async function fX(n){let e,t;switch(n.draco&&n.draco.decoderType){case"js":e=await js(Pm[gn.FALLBACK_DECODER],"draco",n,gn.FALLBACK_DECODER);break;case"wasm":default:[e,t]=await Promise.all([await js(Pm[gn.DECODER],"draco",n,gn.DECODER),await js(Pm[gn.DECODER_WASM],"draco",n,gn.DECODER_WASM)])}return e=e||globalThis.DracoDecoderModule,await hX(e,t)}function hX(n,e){const t={};return e&&(t.wasmBinary=e),new Promise(s=>{n({...t,onModuleLoaded:r=>s({draco:r})})})}const dX={...Z$,parse:gX};async function gX(n,e){const{draco:t}=await uX(e),s=new rX(t);try{return s.parseSync(n,e==null?void 0:e.draco)}finally{s.destroy()}}const pX={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},vt={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},Fe={...pX,...vt},Lm={[vt.DOUBLE]:Float64Array,[vt.FLOAT]:Float32Array,[vt.UNSIGNED_SHORT]:Uint16Array,[vt.UNSIGNED_INT]:Uint32Array,[vt.UNSIGNED_BYTE]:Uint8Array,[vt.BYTE]:Int8Array,[vt.SHORT]:Int16Array,[vt.INT]:Int32Array},mX={DOUBLE:vt.DOUBLE,FLOAT:vt.FLOAT,UNSIGNED_SHORT:vt.UNSIGNED_SHORT,UNSIGNED_INT:vt.UNSIGNED_INT,UNSIGNED_BYTE:vt.UNSIGNED_BYTE,BYTE:vt.BYTE,SHORT:vt.SHORT,INT:vt.INT},km="Failed to convert GL type";let ul=class qc{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(const t in Lm)if(Lm[t]===e)return t;throw new Error(km)}static fromName(e){const t=mX[e];if(!t)throw new Error(km);return t}static getArrayType(e){switch(e){case vt.UNSIGNED_SHORT_5_6_5:case vt.UNSIGNED_SHORT_4_4_4_4:case vt.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const t=Lm[e];if(!t)throw new Error(km);return t}}static getByteSize(e){return qc.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return!!qc.getArrayType(e)}static createTypedArray(e,t,s=0,r){r===void 0&&(r=(t.byteLength-s)/qc.getByteSize(e));const i=qc.getArrayType(e);return new i(t,s,r)}};function _X(n,e){if(!n)throw new Error(`math.gl assertion failed. ${e}`)}function AX(n,e=[0,0,0]){const t=n>>11&31,s=n>>5&63,r=n&31;return e[0]=t<<3,e[1]=s<<2,e[2]=r<<3,e}new Ra;new L;new Ra;new Ra;function nB(n,e=255){return Wn(n,0,e)/e*2-1}function sB(n){return n<0?-1:1}function yX(n,e,t,s){if(_X(s),n<0||n>t||e<0||e>t)throw new Error(`x and y must be unsigned normalized integers between 0 and ${t}`);if(s.x=nB(n,t),s.y=nB(e,t),s.z=1-(Math.abs(s.x)+Math.abs(s.y)),s.z<0){const r=s.x;s.x=(1-Math.abs(s.y))*sB(r),s.y=(1-Math.abs(r))*sB(s.y)}return s.normalize()}function bX(n,e,t){return yX(n,e,255,t)}let vy=class{constructor(e,t){b(this,"json");b(this,"buffer");b(this,"featuresLength",0);b(this,"_cachedTypedArrays",{});this.json=e,this.buffer=t}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return!!this.json[e]}getGlobalProperty(e,t=Fe.UNSIGNED_INT,s=1){const r=this.json[e];return r&&Number.isFinite(r.byteOffset)?this._getTypedArrayFromBinary(e,t,s,1,r.byteOffset):r}getPropertyArray(e,t,s){const r=this.json[e];return r&&Number.isFinite(r.byteOffset)?("componentType"in r&&(t=ul.fromName(r.componentType)),this._getTypedArrayFromBinary(e,t,s,this.featuresLength,r.byteOffset)):this._getTypedArrayFromArray(e,t,r)}getProperty(e,t,s,r,i){const o=this.json[e];if(!o)return o;const l=this.getPropertyArray(e,t,s);if(s===1)return l[r];for(let f=0;f<s;++f)i[f]=l[s*r+f];return i}_getTypedArrayFromBinary(e,t,s,r,i){const o=this._cachedTypedArrays;let l=o[e];return l||(l=ul.createTypedArray(t,this.buffer.buffer,this.buffer.byteOffset+i,r*s),o[e]=l),l}_getTypedArrayFromArray(e,t,s){const r=this._cachedTypedArrays;let i=r[e];return i||(i=ul.createTypedArray(t,s),r[e]=i),i}};const TX={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},EX={SCALAR:(n,e)=>n[e],VEC2:(n,e)=>[n[2*e+0],n[2*e+1]],VEC3:(n,e)=>[n[3*e+0],n[3*e+1],n[3*e+2]],VEC4:(n,e)=>[n[4*e+0],n[4*e+1],n[4*e+2],n[4*e+3]],MAT2:(n,e)=>[n[4*e+0],n[4*e+1],n[4*e+2],n[4*e+3]],MAT3:(n,e)=>[n[9*e+0],n[9*e+1],n[9*e+2],n[9*e+3],n[9*e+4],n[9*e+5],n[9*e+6],n[9*e+7],n[9*e+8]],MAT4:(n,e)=>[n[16*e+0],n[16*e+1],n[16*e+2],n[16*e+3],n[16*e+4],n[16*e+5],n[16*e+6],n[16*e+7],n[16*e+8],n[16*e+9],n[16*e+10],n[16*e+11],n[16*e+12],n[16*e+13],n[16*e+14],n[16*e+15]]},CX={SCALAR:(n,e,t)=>{e[t]=n},VEC2:(n,e,t)=>{e[2*t+0]=n[0],e[2*t+1]=n[1]},VEC3:(n,e,t)=>{e[3*t+0]=n[0],e[3*t+1]=n[1],e[3*t+2]=n[2]},VEC4:(n,e,t)=>{e[4*t+0]=n[0],e[4*t+1]=n[1],e[4*t+2]=n[2],e[4*t+3]=n[3]},MAT2:(n,e,t)=>{e[4*t+0]=n[0],e[4*t+1]=n[1],e[4*t+2]=n[2],e[4*t+3]=n[3]},MAT3:(n,e,t)=>{e[9*t+0]=n[0],e[9*t+1]=n[1],e[9*t+2]=n[2],e[9*t+3]=n[3],e[9*t+4]=n[4],e[9*t+5]=n[5],e[9*t+6]=n[6],e[9*t+7]=n[7],e[9*t+8]=n[8],e[9*t+9]=n[9]},MAT4:(n,e,t)=>{e[16*t+0]=n[0],e[16*t+1]=n[1],e[16*t+2]=n[2],e[16*t+3]=n[3],e[16*t+4]=n[4],e[16*t+5]=n[5],e[16*t+6]=n[6],e[16*t+7]=n[7],e[16*t+8]=n[8],e[16*t+9]=n[9],e[16*t+10]=n[10],e[16*t+11]=n[11],e[16*t+12]=n[12],e[16*t+13]=n[13],e[16*t+14]=n[14],e[16*t+15]=n[15]}};function vX(n,e,t,s){const{componentType:r}=n;it(n.componentType);const i=typeof r=="string"?ul.fromName(r):r,o=TX[n.type],l=EX[n.type],f=CX[n.type];return t+=n.byteOffset,{values:ul.createTypedArray(i,e,t,o*s),type:i,size:o,unpacker:l,packer:f}}const Ls=n=>n!==void 0;function BX(n,e,t){if(!e)return null;let s=n.getExtension("3DTILES_batch_table_hierarchy");const r=e.HIERARCHY;return r&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=r,s=r),s?SX(s,t):null}function SX(n,e){let t,s,r;const i=n.instancesLength,o=n.classes;let l=n.classIds,f=n.parentCounts,h=n.parentIds,g=i;Ls(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,GL.UNSIGNED_SHORT),l.type=AttributeType.SCALAR,r=getBinaryAccessor(l),l=r.createArrayBufferView(e.buffer,e.byteOffset+l.byteOffset,i));let m;if(Ls(f))for(Ls(f.byteOffset)&&(f.componentType=defaultValue(f.componentType,GL.UNSIGNED_SHORT),f.type=AttributeType.SCALAR,r=getBinaryAccessor(f),f=r.createArrayBufferView(e.buffer,e.byteOffset+f.byteOffset,i)),m=new Uint16Array(i),g=0,t=0;t<i;++t)m[t]=g,g+=f[t];Ls(h)&&Ls(h.byteOffset)&&(h.componentType=defaultValue(h.componentType,GL.UNSIGNED_SHORT),h.type=AttributeType.SCALAR,r=getBinaryAccessor(h),h=r.createArrayBufferView(e.buffer,e.byteOffset+h.byteOffset,g));const A=o.length;for(t=0;t<A;++t){const S=o[t].length,x=o[t].instances,O=getBinaryProperties(S,x,e);o[t].instances=combine(O,x)}const y=new Array(A).fill(0),E=new Uint16Array(i);for(t=0;t<i;++t)s=l[t],E[t]=y[s],++y[s];const v={classes:o,classIds:l,classIndexes:E,parentCounts:f,parentIndexes:m,parentIds:h};return xX(v),v}function kc(n,e,t){if(!n)return;const s=n.parentCounts;return n.parentIds?t(n,e):s>0?wX(n,e,t):RX(n,e,t)}function wX(n,e,t){const s=n.classIds,r=n.parentCounts,i=n.parentIds,o=n.parentIndexes,l=s.length,f=scratchVisited;f.length=Math.max(f.length,l);const h=++marker,g=scratchStack;for(g.length=0,g.push(e);g.length>0;){if(e=g.pop(),f[e]===h)continue;f[e]=h;const m=t(n,e);if(Ls(m))return m;const A=r[e],y=o[e];for(let E=0;E<A;++E){const v=i[y+E];v!==e&&g.push(v)}}return null}function RX(n,e,t){let s=!0;for(;s;){const r=t(n,e);if(Ls(r))return r;const i=n.parentIds[e];s=i!==e,e=i}throw new Error("traverseHierarchySingleParent")}function xX(n){const t=n.classIds.length;for(let s=0;s<t;++s)Xw(n,s,stack)}function Xw(n,e,t){const s=n.parentCounts,r=n.parentIds,i=n.parentIndexes,l=n.classIds.length;if(!Ls(r))return;assert(e<l,`Parent index ${e} exceeds the total number of instances: ${l}`),assert(t.indexOf(e)===-1,"Circular dependency detected in the batch table hierarchy."),t.push(e);const f=Ls(s)?s[e]:1,h=Ls(s)?i[e]:e;for(let g=0;g<f;++g){const m=r[h+g];m!==e&&Xw(n,m,t)}t.pop(e)}function un(n){return n!=null}const wf=(n,e)=>n,IX={HIERARCHY:!0,extensions:!0,extras:!0};let Jw=class{constructor(e,t,s,r={}){b(this,"json");b(this,"binary");b(this,"featureCount");b(this,"_extensions");b(this,"_properties");b(this,"_binaryProperties");b(this,"_hierarchy");var i;it(s>=0),this.json=e||{},this.binary=t,this.featureCount=s,this._extensions=((i=this.json)==null?void 0:i.extensions)||{},this._properties={};for(const o in this.json)IX[o]||(this._properties[o]=this.json[o]);this._binaryProperties=this._initializeBinaryProperties(),r["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=BX(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,t){if(this._checkBatchId(e),it(typeof t=="string",t),this._hierarchy){const s=kc(this._hierarchy,e,(r,i)=>{const o=r.classIds[i];return r.classes[o].name===t});return un(s)}return!1}isExactClass(e,t){return it(typeof t=="string",t),this.getExactClassName(e)===t}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy){const t=this._hierarchy.classIds[e];return this._hierarchy.classes[t].name}}hasProperty(e,t){return this._checkBatchId(e),it(typeof t=="string",t),un(this._properties[t])||this._hasPropertyInHierarchy(e,t)}getPropertyNames(e,t){this._checkBatchId(e),t=un(t)?t:[],t.length=0;const s=Object.keys(this._properties);return t.push(...s),this._hierarchy&&this._getPropertyNamesInHierarchy(e,t),t}getProperty(e,t){if(this._checkBatchId(e),it(typeof t=="string",t),this._binaryProperties){const r=this._binaryProperties[t];if(un(r))return this._getBinaryProperty(r,e)}const s=this._properties[t];if(un(s))return wf(s[e]);if(this._hierarchy){const r=this._getHierarchyProperty(e,t);if(un(r))return r}}setProperty(e,t,s){const r=this.featureCount;if(this._checkBatchId(e),it(typeof t=="string",t),this._binaryProperties){const o=this._binaryProperties[t];if(o){this._setBinaryProperty(o,e,s);return}}if(this._hierarchy&&this._setHierarchyProperty(this,e,t,s))return;let i=this._properties[t];un(i)||(this._properties[t]=new Array(r),i=this._properties[t]),i[e]=wf(s)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,t){return e.unpack(e.typedArray,t)}_setBinaryProperty(e,t,s){e.pack(s,e.typedArray,t)}_initializeBinaryProperties(){let e=null;for(const t in this._properties){const s=this._properties[t],r=this._initializeBinaryProperty(t,s);r&&(e=e||{},e[t]=r)}return e}_initializeBinaryProperty(e,t){if("byteOffset"in t){const s=t;it(this.binary,`Property ${e} requires a batch table binary.`),it(s.type,`Property ${e} requires a type.`);const r=vX(s,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:r.values,componentCount:r.size,unpack:r.unpacker,pack:r.packer}}return null}_hasPropertyInHierarchy(e,t){if(!this._hierarchy)return!1;const s=kc(this._hierarchy,e,(r,i)=>{const o=r.classIds[i],l=r.classes[o].instances;return un(l[t])});return un(s)}_getPropertyNamesInHierarchy(e,t){kc(this._hierarchy,e,(s,r)=>{const i=s.classIds[r],o=s.classes[i].instances;for(const l in o)o.hasOwnProperty(l)&&t.indexOf(l)===-1&&t.push(l)})}_getHierarchyProperty(e,t){return kc(this._hierarchy,e,(s,r)=>{const i=s.classIds[r],o=s.classes[i],l=s.classIndexes[r],f=o.instances[t];return un(f)?un(f.typedArray)?this._getBinaryProperty(f,l):wf(f[l]):null})}_setHierarchyProperty(e,t,s,r){const i=kc(this._hierarchy,t,(o,l)=>{const f=o.classIds[l],h=o.classes[f],g=o.classIndexes[l],m=h.instances[s];return un(m)?(it(l===t,`Inherited property "${s}" is read-only.`),un(m.typedArray)?this._setBinaryProperty(m,g,r):m[g]=wf(r),!0):!1});return un(i)}};const Hm=4;function od(n,e,t=0){const s=new DataView(e);if(n.magic=s.getUint32(t,!0),t+=Hm,n.version=s.getUint32(t,!0),t+=Hm,n.byteLength=s.getUint32(t,!0),t+=Hm,n.version!==1)throw new Error(`3D Tile Version ${n.version} not supported`);return t}const zo=4,rB="b3dm tile in legacy format.";function By(n,e,t){const s=new DataView(e);let r;n.header=n.header||{};let i=s.getUint32(t,!0);t+=zo;let o=s.getUint32(t,!0);t+=zo;let l=s.getUint32(t,!0);t+=zo;let f=s.getUint32(t,!0);return t+=zo,l>=570425344?(t-=zo*2,r=i,l=o,f=0,i=0,o=0,console.warn(rB)):f>=570425344&&(t-=zo,r=l,l=i,f=o,i=0,o=0,console.warn(rB)),n.header.featureTableJsonByteLength=i,n.header.featureTableBinaryByteLength=o,n.header.batchTableJsonByteLength=l,n.header.batchTableBinaryByteLength=f,n.header.batchLength=r,t}function Sy(n,e,t,s){return t=MX(n,e,t),t=OX(n,e,t),t}function MX(n,e,t,s){const{featureTableJsonByteLength:r,featureTableBinaryByteLength:i,batchLength:o}=n.header||{};if(n.featureTableJson={BATCH_LENGTH:o||0},r&&r>0){const l=zw(e,t,r);n.featureTableJson=JSON.parse(l)}return t+=r||0,n.featureTableBinary=new Uint8Array(e,t,i),t+=i||0,t}function OX(n,e,t,s){const{batchTableJsonByteLength:r,batchTableBinaryByteLength:i}=n.header||{};if(r&&r>0){const o=zw(e,t,r);n.batchTableJson=JSON.parse(o),t+=r,i&&i>0&&(n.batchTableBinary=new Uint8Array(e,t,i),n.batchTableBinary=new Uint8Array(n.batchTableBinary),t+=i)}return t}function Ww(n,e,t){if(!e&&(!n||!n.batchIds||!t))return null;const{batchIds:s,isRGB565:r,pointCount:i=0}=n;if(s&&t){const o=new Uint8ClampedArray(i*3);for(let l=0;l<i;l++){const f=s[l],g=t.getProperty(f,"dimensions").map(m=>m*255);o[l*3]=g[0],o[l*3+1]=g[1],o[l*3+2]=g[2]}return{type:Fe.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}if(e&&r){const o=new Uint8ClampedArray(i*3);for(let l=0;l<i;l++){const f=AX(e[l]);o[l*3]=f[0],o[l*3+1]=f[1],o[l*3+2]=f[2]}return{type:Fe.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}return e&&e.length===i*3?{type:Fe.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:Fe.UNSIGNED_BYTE,value:e||new Uint8ClampedArray,size:4,normalized:!0}}const iB=new L;function DX(n,e){if(!e)return null;if(n.isOctEncoded16P){const t=new Float32Array((n.pointsLength||0)*3);for(let s=0;s<(n.pointsLength||0);s++)bX(e[s*2],e[s*2+1],iB),iB.toArray(t,s*3);return{type:Fe.FLOAT,size:2,value:t}}return{type:Fe.FLOAT,size:2,value:e}}function NX(n,e,t){return n.isQuantized?t["3d-tiles"]&&t["3d-tiles"].decodeQuantizedPositions?(n.isQuantized=!1,FX(n,e)):{type:Fe.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}function FX(n,e){const t=new L,s=new Float32Array(n.pointCount*3);for(let r=0;r<n.pointCount;r++)t.set(e[r*3],e[r*3+1],e[r*3+2]).scale(1/n.quantizedRange).multiply(n.quantizedVolumeScale).add(n.quantizedVolumeOffset).toArray(s,r*3);return s}async function PX(n,e,t,s,r){t=od(n,e,t),t=By(n,e,t),t=Sy(n,e,t),UX(n);const{featureTable:i,batchTable:o}=LX(n);return await jX(n,i,o,s,r),kX(n,i,s),HX(n,i,o),GX(n,i),t}function UX(n){n.attributes={positions:null,colors:null,normals:null,batchIds:null},n.isQuantized=!1,n.isTranslucent=!1,n.isRGB565=!1,n.isOctEncoded16P=!1}function LX(n){const e=new vy(n.featureTableJson,n.featureTableBinary),t=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(t))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=t,n.featuresLength=t,n.pointsLength=t,n.pointCount=t,n.rtcCenter=e.getGlobalProperty("RTC_CENTER",Fe.FLOAT,3);const s=VX(n,e);return{featureTable:e,batchTable:s}}function kX(n,e,t){if(n.attributes=n.attributes||{positions:null,colors:null,normals:null,batchIds:null},!n.attributes.positions){if(e.hasProperty("POSITION"))n.attributes.positions=e.getPropertyArray("POSITION",Fe.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){const s=e.getPropertyArray("POSITION_QUANTIZED",Fe.UNSIGNED_SHORT,3);if(n.isQuantized=!0,n.quantizedRange=65535,n.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Fe.FLOAT,3),!n.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(n.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Fe.FLOAT,3),!n.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");n.attributes.positions=NX(n,s,t)}}if(!n.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function HX(n,e,t){if(n.attributes=n.attributes||{positions:null,colors:null,normals:null,batchIds:null},!n.attributes.colors){let s=null;e.hasProperty("RGBA")?(s=e.getPropertyArray("RGBA",Fe.UNSIGNED_BYTE,4),n.isTranslucent=!0):e.hasProperty("RGB")?s=e.getPropertyArray("RGB",Fe.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(s=e.getPropertyArray("RGB565",Fe.UNSIGNED_SHORT,1),n.isRGB565=!0),n.attributes.colors=Ww(n,s,t)}e.hasProperty("CONSTANT_RGBA")&&(n.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",Fe.UNSIGNED_BYTE,4))}function GX(n,e){if(n.attributes=n.attributes||{positions:null,colors:null,normals:null,batchIds:null},!n.attributes.normals){let t=null;e.hasProperty("NORMAL")?t=e.getPropertyArray("NORMAL",Fe.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(t=e.getPropertyArray("NORMAL_OCT16P",Fe.UNSIGNED_BYTE,2),n.isOctEncoded16P=!0),n.attributes.normals=DX(n,t)}}function VX(n,e){let t=null;if(!n.batchIds&&e.hasProperty("BATCH_ID")&&(n.batchIds=e.getPropertyArray("BATCH_ID",Fe.UNSIGNED_SHORT,1),n.batchIds)){const s=e.getGlobalProperty("BATCH_LENGTH");if(!s)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:r,batchTableBinary:i}=n;t=new Jw(r,i,s)}return t}async function jX(n,e,t,s,r){let i,o,l;const f=n.batchTableJson&&n.batchTableJson.extensions&&n.batchTableJson.extensions["3DTILES_draco_point_compression"];f&&(l=f.properties);const h=e.getExtension("3DTILES_draco_point_compression");if(h){o=h.properties;const m=h.byteOffset,A=h.byteLength;if(!o||!Number.isFinite(m)||!A)throw new Error("Draco properties, byteOffset, and byteLength must be defined");i=(n.featureTableBinary||[]).slice(m,m+A),n.hasPositions=Number.isFinite(o.POSITION),n.hasColors=Number.isFinite(o.RGB)||Number.isFinite(o.RGBA),n.hasNormals=Number.isFinite(o.NORMAL),n.hasBatchIds=Number.isFinite(o.BATCH_ID),n.isTranslucent=Number.isFinite(o.RGBA)}if(!i)return!0;const g={buffer:i,properties:{...o,...l},batchTableProperties:l};return await zX(n,g,s,r)}async function zX(n,e,t,s){if(!s)return;const r={...t,draco:{...t==null?void 0:t.draco,extraAttributes:e.batchTableProperties||{}}};delete r["3d-tiles"];const i=await Sl(e.buffer,dX,r,s),o=i.attributes.POSITION&&i.attributes.POSITION.value,l=i.attributes.COLOR_0&&i.attributes.COLOR_0.value,f=i.attributes.NORMAL&&i.attributes.NORMAL.value,h=i.attributes.BATCH_ID&&i.attributes.BATCH_ID.value,g=o&&i.attributes.POSITION.value.quantization,m=f&&i.attributes.NORMAL.value.quantization;if(g){const y=i.POSITION.data.quantization,E=y.range;n.quantizedVolumeScale=new L(E,E,E),n.quantizedVolumeOffset=new L(y.minValues),n.quantizedRange=(1<<y.quantizationBits)-1,n.isQuantizedDraco=!0}m&&(n.octEncodedRange=(1<<i.NORMAL.data.quantization.quantizationBits)-1,n.isOctEncodedDraco=!0);const A={};if(e.batchTableProperties)for(const y of Object.keys(e.batchTableProperties))i.attributes[y]&&i.attributes[y].value&&(A[y.toLowerCase()]=i.attributes[y].value);n.attributes={positions:o,colors:Ww(n,l,void 0),normals:f,batchIds:h,...A}}const oA={URI:0,EMBEDDED:1};function Yw(n,e,t,s){n.rotateYtoZ=!0;const r=(n.byteOffset||0)+(n.byteLength||0)-t;if(r===0)throw new Error("glTF byte length must be greater than 0.");return n.gltfUpAxis=s!=null&&s["3d-tiles"]&&s["3d-tiles"].assetGltfUpAxis?s["3d-tiles"].assetGltfUpAxis:"Y",n.gltfArrayBuffer=CA(e,t,r),n.gltfByteOffset=0,n.gltfByteLength=r,t%4===0||console.warn(`${n.type}: embedded glb is not aligned to a 4-byte boundary.`),(n.byteOffset||0)+(n.byteLength||0)}async function Kw(n,e,t,s){const r=(t==null?void 0:t["3d-tiles"])||{};if($X(n,e),r.loadGLTF){if(!s)return;if(n.gltfUrl){const{fetch:i}=s,o=await i(n.gltfUrl,t);n.gltfArrayBuffer=await o.arrayBuffer(),n.gltfByteOffset=0}if(n.gltfArrayBuffer){const i=await Sl(n.gltfArrayBuffer,Cl,t,s);n.gltf=Ty(i),n.gpuMemoryUsageInBytes=Ew(n.gltf),delete n.gltfArrayBuffer,delete n.gltfByteOffset,delete n.gltfByteLength}}}function $X(n,e,t){switch(e){case oA.URI:if(n.gltfArrayBuffer){const s=new Uint8Array(n.gltfArrayBuffer,n.gltfByteOffset),i=new TextDecoder().decode(s);n.gltfUrl=i.replace(/[\s\0]+$/,"")}delete n.gltfArrayBuffer,delete n.gltfByteOffset,delete n.gltfByteLength;break;case oA.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function XX(n,e,t,s,r){var o;t=JX(n,e,t,s),await Kw(n,oA.EMBEDDED,s,r);const i=(o=n==null?void 0:n.gltf)==null?void 0:o.extensions;return i&&i.CESIUM_RTC&&(n.rtcCenter=i.CESIUM_RTC.center),t}function JX(n,e,t,s,r){t=od(n,e,t),t=By(n,e,t),t=Sy(n,e,t),t=Yw(n,e,t,s);const i=new vy(n.featureTableJson,n.featureTableBinary);return n.rtcCenter=i.getGlobalProperty("RTC_CENTER",Fe.FLOAT,3),t}async function WX(n,e,t,s,r){return t=YX(n,e,t,s),await Kw(n,n.gltfFormat||0,s,r),t}function YX(n,e,t,s,r){var h;if(t=od(n,e,t),n.version!==1)throw new Error(`Instanced 3D Model version ${n.version} is not supported`);t=By(n,e,t);const i=new DataView(e);if(n.gltfFormat=i.getUint32(t,!0),t+=4,t=Sy(n,e,t),t=Yw(n,e,t,s),!((h=n==null?void 0:n.header)!=null&&h.featureTableJsonByteLength)||n.header.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const o=new vy(n.featureTableJson,n.featureTableBinary),l=o.getGlobalProperty("INSTANCES_LENGTH");if(o.featuresLength=l,!Number.isFinite(l))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");n.eastNorthUp=o.getGlobalProperty("EAST_NORTH_UP"),n.rtcCenter=o.getGlobalProperty("RTC_CENTER",Fe.FLOAT,3);const f=new Jw(n.batchTableJson,n.batchTableBinary,l);return KX(n,o,f,l),t}function KX(n,e,t,s){const r=new Array(s),i=new L;new L,new L,new L;const o=new at,l=new ga,f=new L,h={},g=new we,m=[],A=[],y=[],E=[];for(let v=0;v<s;v++){let S;if(e.hasProperty("POSITION"))S=e.getProperty("POSITION",Fe.FLOAT,3,v,i);else if(e.hasProperty("POSITION_QUANTIZED")){S=e.getProperty("POSITION_QUANTIZED",Fe.UNSIGNED_SHORT,3,v,i);const J=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Fe.FLOAT,3);if(!J)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const ie=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Fe.FLOAT,3);if(!ie)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const re=65535;for(let ee=0;ee<3;ee++)S[ee]=S[ee]/re*ie[ee]+J[ee]}if(!S)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(i.copy(S),h.translation=i,n.normalUp=e.getProperty("NORMAL_UP",Fe.FLOAT,3,v,m),n.normalRight=e.getProperty("NORMAL_RIGHT",Fe.FLOAT,3,v,A),n.normalUp){if(!n.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");n.hasCustomOrientation=!0}else{if(n.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",Fe.UNSIGNED_SHORT,2,v,m),n.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",Fe.UNSIGNED_SHORT,2,v,A),n.octNormalUp)throw n.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");n.eastNorthUp?(qe.WGS84.eastNorthUpToFixedFrame(i,g),g.getRotationMatrix3(o)):o.identity()}l.fromMatrix3(o),h.rotation=l,f.set(1,1,1);const x=e.getProperty("SCALE",Fe.FLOAT,1,v,y);Number.isFinite(x)&&f.multiplyByScalar(x);const O=e.getProperty("SCALE_NON_UNIFORM",Fe.FLOAT,3,v,m);O&&f.scale(O),h.scale=f;let R=e.getProperty("BATCH_ID",Fe.UNSIGNED_SHORT,1,v,E);R===void 0&&(R=v);const D=new we().fromQuaternion(h.rotation);g.identity(),g.translate(h.translation),g.multiplyRight(D),g.scale(h.scale);const z=g.clone();r[v]={modelMatrix:z,batchId:R}}n.instances=r}async function qX(n,e,t,s,r,i){t=od(n,e,t);const o=new DataView(e);for(n.tilesLength=o.getUint32(t,!0),t+=4,n.tiles=[];n.tiles.length<n.tilesLength&&(n.byteLength||0)-t>12;){const l={shape:"tile3d"};n.tiles.push(l),t=await i(e,t,s,r,l)}return t}async function QX(n,e,t,s){var r,i;if(n.rotateYtoZ=!0,n.gltfUpAxis=(r=t==null?void 0:t["3d-tiles"])!=null&&r.assetGltfUpAxis?t["3d-tiles"].assetGltfUpAxis:"Y",(i=t==null?void 0:t["3d-tiles"])!=null&&i.loadGLTF){if(!s)return e.byteLength;const o=await Sl(e,Cl,t,s);n.gltf=Ty(o),n.gpuMemoryUsageInBytes=Ew(n.gltf)}else n.gltfArrayBuffer=e;return e.byteLength}async function qw(n,e=0,t,s,r={shape:"tile3d"}){switch(r.byteOffset=e,r.type=q$(n,e),r.type){case Lc.COMPOSITE:return await qX(r,n,e,t,s,qw);case Lc.BATCHED_3D_MODEL:return await XX(r,n,e,t,s);case Lc.GLTF:return await QX(r,n,t,s);case Lc.INSTANCED_3D_MODEL:return await WX(r,n,e,t,s);case Lc.POINT_CLOUD:return await PX(r,n,e,t,s);default:throw new Error(`3DTileLoader: unknown type ${r.type}`)}}const ZX=1952609651,e7=1;async function t7(n,e,t){if(new Uint32Array(n.slice(0,4))[0]!==ZX)throw new Error("Wrong subtree file magic number");if(new Uint32Array(n.slice(4,8))[0]!==e7)throw new Error("Wrong subtree file verson, must be 1");const i=oB(n.slice(8,16)),o=new Uint8Array(n,24,i),f=new TextDecoder("utf8").decode(o),h=JSON.parse(f),g=oB(n.slice(16,24));let m=new ArrayBuffer(0);if(g&&(m=n.slice(24+i)),await Rf(h,h.tileAvailability,m,t),Array.isArray(h.contentAvailability))for(const A of h.contentAvailability)await Rf(h,A,m,t);else await Rf(h,h.contentAvailability,m,t);return await Rf(h,h.childSubtreeAvailability,m,t),h}async function Rf(n,e,t,s){const r=Number.isFinite(e.bitstream)?e.bitstream:e.bufferView;if(typeof r!="number")return;const i=n.bufferViews[r],o=n.buffers[i.buffer];if(!(s!=null&&s.baseUrl))throw new Error("Url is not provided");if(!s.fetch)throw new Error("fetch is not provided");if(o.uri){const f=`${(s==null?void 0:s.baseUrl)||""}/${o.uri}`,g=await(await s.fetch(f)).arrayBuffer();e.explicitBitstream=new Uint8Array(g,i.byteOffset,i.byteLength);return}const l=n.buffers.slice(0,i.buffer).reduce((f,h)=>f+h.byteLength,0);e.explicitBitstream=new Uint8Array(t.slice(l,l+o.byteLength),i.byteOffset,i.byteLength)}function oB(n){const e=new DataView(n),t=e.getUint32(0,!0),s=e.getUint32(4,!0);return t+2**32*s}const Qw={dataType:null,batchType:null,id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:jw,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:t7,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var Kn=null;try{Kn=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function je(n,e,t){this.low=n|0,this.high=e|0,this.unsigned=!!t}je.prototype.__isLong__;Object.defineProperty(je.prototype,"__isLong__",{value:!0});function Zt(n){return(n&&n.__isLong__)===!0}function aB(n){var e=Math.clz32(n&-n);return n?31-e:e}je.isLong=Zt;var cB={},lB={};function Ji(n,e){var t,s,r;return e?(n>>>=0,(r=0<=n&&n<256)&&(s=lB[n],s)?s:(t=Ue(n,0,!0),r&&(lB[n]=t),t)):(n|=0,(r=-128<=n&&n<128)&&(s=cB[n],s)?s:(t=Ue(n,n<0?-1:0,!1),r&&(cB[n]=t),t))}je.fromInt=Ji;function qn(n,e){if(isNaN(n))return e?hr:ys;if(e){if(n<0)return hr;if(n>=Zw)return nR}else{if(n<=-fB)return mn;if(n+1>=fB)return tR}return n<0?qn(-n,e).neg():Ue(n%Ea|0,n/Ea|0,e)}je.fromNumber=qn;function Ue(n,e,t){return new je(n,e,t)}je.fromBits=Ue;var Ch=Math.pow;function wy(n,e,t){if(n.length===0)throw Error("empty string");if(typeof e=="number"?(t=e,e=!1):e=!!e,n==="NaN"||n==="Infinity"||n==="+Infinity"||n==="-Infinity")return e?hr:ys;if(t=t||10,t<2||36<t)throw RangeError("radix");var s;if((s=n.indexOf("-"))>0)throw Error("interior hyphen");if(s===0)return wy(n.substring(1),e,t).neg();for(var r=qn(Ch(t,8)),i=ys,o=0;o<n.length;o+=8){var l=Math.min(8,n.length-o),f=parseInt(n.substring(o,o+l),t);if(l<8){var h=qn(Ch(t,l));i=i.mul(h).add(qn(f))}else i=i.mul(r),i=i.add(qn(f))}return i.unsigned=e,i}je.fromString=wy;function is(n,e){return typeof n=="number"?qn(n,e):typeof n=="string"?wy(n,e):Ue(n.low,n.high,typeof e=="boolean"?e:n.unsigned)}je.fromValue=is;var uB=65536,n7=1<<24,Ea=uB*uB,Zw=Ea*Ea,fB=Zw/2,hB=Ji(n7),ys=Ji(0);je.ZERO=ys;var hr=Ji(0,!0);je.UZERO=hr;var ra=Ji(1);je.ONE=ra;var eR=Ji(1,!0);je.UONE=eR;var aA=Ji(-1);je.NEG_ONE=aA;var tR=Ue(-1,2147483647,!1);je.MAX_VALUE=tR;var nR=Ue(-1,-1,!0);je.MAX_UNSIGNED_VALUE=nR;var mn=Ue(0,-2147483648,!1);je.MIN_VALUE=mn;var ne=je.prototype;ne.toInt=function(){return this.unsigned?this.low>>>0:this.low};ne.toNumber=function(){return this.unsigned?(this.high>>>0)*Ea+(this.low>>>0):this.high*Ea+(this.low>>>0)};ne.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(mn)){var t=qn(e),s=this.div(t),r=s.mul(t).sub(this);return s.toString(e)+r.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=qn(Ch(e,6),this.unsigned),o=this,l="";;){var f=o.div(i),h=o.sub(f.mul(i)).toInt()>>>0,g=h.toString(e);if(o=f,o.isZero())return g+l;for(;g.length<6;)g="0"+g;l=""+g+l}};ne.getHighBits=function(){return this.high};ne.getHighBitsUnsigned=function(){return this.high>>>0};ne.getLowBits=function(){return this.low};ne.getLowBitsUnsigned=function(){return this.low>>>0};ne.getNumBitsAbs=function(){if(this.isNegative())return this.eq(mn)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1};ne.isSafeInteger=function(){var e=this.high>>21;return e?this.unsigned?!1:e===-1&&!(this.low===0&&this.high===-2097152):!0};ne.isZero=function(){return this.high===0&&this.low===0};ne.eqz=ne.isZero;ne.isNegative=function(){return!this.unsigned&&this.high<0};ne.isPositive=function(){return this.unsigned||this.high>=0};ne.isOdd=function(){return(this.low&1)===1};ne.isEven=function(){return(this.low&1)===0};ne.equals=function(e){return Zt(e)||(e=is(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};ne.eq=ne.equals;ne.notEquals=function(e){return!this.eq(e)};ne.neq=ne.notEquals;ne.ne=ne.notEquals;ne.lessThan=function(e){return this.comp(e)<0};ne.lt=ne.lessThan;ne.lessThanOrEqual=function(e){return this.comp(e)<=0};ne.lte=ne.lessThanOrEqual;ne.le=ne.lessThanOrEqual;ne.greaterThan=function(e){return this.comp(e)>0};ne.gt=ne.greaterThan;ne.greaterThanOrEqual=function(e){return this.comp(e)>=0};ne.gte=ne.greaterThanOrEqual;ne.ge=ne.greaterThanOrEqual;ne.compare=function(e){if(Zt(e)||(e=is(e)),this.eq(e))return 0;var t=this.isNegative(),s=e.isNegative();return t&&!s?-1:!t&&s?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};ne.comp=ne.compare;ne.negate=function(){return!this.unsigned&&this.eq(mn)?mn:this.not().add(ra)};ne.neg=ne.negate;ne.add=function(e){Zt(e)||(e=is(e));var t=this.high>>>16,s=this.high&65535,r=this.low>>>16,i=this.low&65535,o=e.high>>>16,l=e.high&65535,f=e.low>>>16,h=e.low&65535,g=0,m=0,A=0,y=0;return y+=i+h,A+=y>>>16,y&=65535,A+=r+f,m+=A>>>16,A&=65535,m+=s+l,g+=m>>>16,m&=65535,g+=t+o,g&=65535,Ue(A<<16|y,g<<16|m,this.unsigned)};ne.subtract=function(e){return Zt(e)||(e=is(e)),this.add(e.neg())};ne.sub=ne.subtract;ne.multiply=function(e){if(this.isZero())return this;if(Zt(e)||(e=is(e)),Kn){var t=Kn.mul(this.low,this.high,e.low,e.high);return Ue(t,Kn.get_high(),this.unsigned)}if(e.isZero())return this.unsigned?hr:ys;if(this.eq(mn))return e.isOdd()?mn:ys;if(e.eq(mn))return this.isOdd()?mn:ys;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(hB)&&e.lt(hB))return qn(this.toNumber()*e.toNumber(),this.unsigned);var s=this.high>>>16,r=this.high&65535,i=this.low>>>16,o=this.low&65535,l=e.high>>>16,f=e.high&65535,h=e.low>>>16,g=e.low&65535,m=0,A=0,y=0,E=0;return E+=o*g,y+=E>>>16,E&=65535,y+=i*g,A+=y>>>16,y&=65535,y+=o*h,A+=y>>>16,y&=65535,A+=r*g,m+=A>>>16,A&=65535,A+=i*h,m+=A>>>16,A&=65535,A+=o*f,m+=A>>>16,A&=65535,m+=s*g+r*h+i*f+o*l,m&=65535,Ue(y<<16|E,m<<16|A,this.unsigned)};ne.mul=ne.multiply;ne.divide=function(e){if(Zt(e)||(e=is(e)),e.isZero())throw Error("division by zero");if(Kn){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Kn.div_u:Kn.div_s)(this.low,this.high,e.low,e.high);return Ue(t,Kn.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?hr:ys;var s,r,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return hr;if(e.gt(this.shru(1)))return eR;i=hr}else{if(this.eq(mn)){if(e.eq(ra)||e.eq(aA))return mn;if(e.eq(mn))return ra;var o=this.shr(1);return s=o.div(e).shl(1),s.eq(ys)?e.isNegative()?ra:aA:(r=this.sub(e.mul(s)),i=s.add(r.div(e)),i)}else if(e.eq(mn))return this.unsigned?hr:ys;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=ys}for(r=this;r.gte(e);){s=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var l=Math.ceil(Math.log(s)/Math.LN2),f=l<=48?1:Ch(2,l-48),h=qn(s),g=h.mul(e);g.isNegative()||g.gt(r);)s-=f,h=qn(s,this.unsigned),g=h.mul(e);h.isZero()&&(h=ra),i=i.add(h),r=r.sub(g)}return i};ne.div=ne.divide;ne.modulo=function(e){if(Zt(e)||(e=is(e)),Kn){var t=(this.unsigned?Kn.rem_u:Kn.rem_s)(this.low,this.high,e.low,e.high);return Ue(t,Kn.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};ne.mod=ne.modulo;ne.rem=ne.modulo;ne.not=function(){return Ue(~this.low,~this.high,this.unsigned)};ne.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32};ne.clz=ne.countLeadingZeros;ne.countTrailingZeros=function(){return this.low?aB(this.low):aB(this.high)+32};ne.ctz=ne.countTrailingZeros;ne.and=function(e){return Zt(e)||(e=is(e)),Ue(this.low&e.low,this.high&e.high,this.unsigned)};ne.or=function(e){return Zt(e)||(e=is(e)),Ue(this.low|e.low,this.high|e.high,this.unsigned)};ne.xor=function(e){return Zt(e)||(e=is(e)),Ue(this.low^e.low,this.high^e.high,this.unsigned)};ne.shiftLeft=function(e){return Zt(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Ue(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Ue(0,this.low<<e-32,this.unsigned)};ne.shl=ne.shiftLeft;ne.shiftRight=function(e){return Zt(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Ue(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Ue(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};ne.shr=ne.shiftRight;ne.shiftRightUnsigned=function(e){return Zt(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Ue(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):e===32?Ue(this.high,0,this.unsigned):Ue(this.high>>>e-32,0,this.unsigned)};ne.shru=ne.shiftRightUnsigned;ne.shr_u=ne.shiftRightUnsigned;ne.rotateLeft=function(e){var t;return Zt(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?Ue(this.high,this.low,this.unsigned):e<32?(t=32-e,Ue(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(e-=32,t=32-e,Ue(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))};ne.rotl=ne.rotateLeft;ne.rotateRight=function(e){var t;return Zt(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?Ue(this.high,this.low,this.unsigned):e<32?(t=32-e,Ue(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(e-=32,t=32-e,Ue(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))};ne.rotr=ne.rotateRight;ne.toSigned=function(){return this.unsigned?Ue(this.low,this.high,!1):this};ne.toUnsigned=function(){return this.unsigned?this:Ue(this.low,this.high,!0)};ne.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};ne.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};ne.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};je.fromBytes=function(e,t,s){return s?je.fromBytesLE(e,t):je.fromBytesBE(e,t)};je.fromBytesLE=function(e,t){return new je(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};je.fromBytesBE=function(e,t){return new je(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};typeof BigInt=="function"&&(je.fromBigInt=function(e,t){var s=Number(BigInt.asIntN(32,e)),r=Number(BigInt.asIntN(32,e>>BigInt(32)));return Ue(s,r,t)},je.fromValue=function(e,t){return typeof e=="bigint"?je.fromBigInt(e,t):is(e,t)},ne.toBigInt=function(){var e=BigInt(this.low>>>0),t=BigInt(this.unsigned?this.high>>>0:this.high);return t<<BigInt(32)|e});const s7=16;function sR(n){n==="X"&&(n="");const e=n.padEnd(s7,"0");return je.fromString(e,!0,16)}function r7(n){if(n.isZero())return"X";let e=n.countTrailingZeros();const t=e%4;e=(e-t)/4;const s=e;e*=4;const i=n.shiftRightUnsigned(e).toString(16).replace(/0+$/,"");return Array(17-s-i.length).join("0")+i}function i7(n,e){const t=o7(n).shiftRightUnsigned(2);return n.add(je.fromNumber(2*e+1-4).multiply(t))}function o7(n){return n.and(n.not().add(1))}const a7=3,c7=30,l7=2*c7+1,dB=180/Math.PI;function u7(n){if(n.length===0)throw new Error(`Invalid Hilbert quad key ${n}`);const e=n.split("/"),t=parseInt(e[0],10),s=e[1],r=s.length;let i=0;const o=[0,0];for(let l=r-1;l>=0;l--){i=r-l;const f=s[l];let h=0,g=0;f==="1"?g=1:f==="2"?(h=1,g=1):f==="3"&&(h=1);const m=Math.pow(2,i-1);h7(m,o,h,g),o[0]+=m*h,o[1]+=m*g}if(t%2===1){const l=o[0];o[0]=o[1],o[1]=l}return{face:t,ij:o,level:i}}function f7(n){if(n.isZero())return"";let e=n.toString(2);for(;e.length<a7+l7;)e="0"+e;const t=e.lastIndexOf("1"),s=e.substring(0,3),r=e.substring(3,t),i=r.length/2,o=je.fromString(s,!0,2).toString(10);let l="";if(i!==0)for(l=je.fromString(r,!0,2).toString(4);l.length<i;)l="0"+l;return`${o}/${l}`}function rR(n,e,t){const s=1<<e;return[(n[0]+t[0])/s,(n[1]+t[1])/s]}function gB(n){return n>=.5?1/3*(4*n*n-1):1/3*(1-4*(1-n)*(1-n))}function iR(n){return[gB(n[0]),gB(n[1])]}function oR(n,[e,t]){switch(n){case 0:return[1,e,t];case 1:return[-e,1,t];case 2:return[-e,-t,1];case 3:return[-1,-t,-e];case 4:return[t,-1,-e];case 5:return[t,e,-1];default:throw new Error("Invalid face")}}function aR([n,e,t]){const s=Math.atan2(t,Math.sqrt(n*n+e*e));return[Math.atan2(e,n)*dB,s*dB]}function h7(n,e,t,s){if(s===0){t===1&&(e[0]=n-1-e[0],e[1]=n-1-e[1]);const r=e[0];e[0]=e[1],e[1]=r}}function d7(n){const e=rR(n.ij,n.level,[.5,.5]),t=iR(e),s=oR(n.face,t);return aR(s)}const g7=100;function pB(n){const{face:e,ij:t,level:s}=n,r=[[0,0],[0,1],[1,1],[1,0],[0,0]],i=Math.max(1,Math.ceil(g7*Math.pow(2,-s))),o=new Float64Array(4*i*2+2);let l=0,f=0;for(let h=0;h<4;h++){const g=r[h].slice(0),m=r[h+1],A=(m[0]-g[0])/i,y=(m[1]-g[1])/i;for(let E=0;E<i;E++){g[0]+=A,g[1]+=y;const v=rR(t,s,g),S=iR(v),x=oR(e,S),O=aR(x);Math.abs(O[1])>89.999&&(O[0]=f);const R=O[0]-f;O[0]+=R>180?-360:R<-180?360:0,o[l++]=O[0],o[l++]=O[1],f=O[0]}}return o[l++]=o[0],o[l++]=o[1],o}function Ry(n){const e=p7(n);return u7(e)}function p7(n){if(n.indexOf("/")>0)return n;const e=sR(n);return f7(e)}function m7(n){const e=Ry(n);return d7(e)}function _7(n){let e;if(n.face===2||n.face===5){let t=null,s=0;for(let r=0;r<4;r++){const i=`${n.face}/${r}`,o=Ry(i),l=pB(o);(typeof t>"u"||t===null)&&(t=new Float64Array(4*l.length)),t.set(l,s),s+=l.length}e=mB(t)}else{const t=pB(n);e=mB(t)}return e}function mB(n){if(n.length%2!==0)throw new Error("Invalid corners");const e=[],t=[];for(let s=0;s<n.length;s+=2)e.push(n[s]),t.push(n[s+1]);return e.sort((s,r)=>s-r),t.sort((s,r)=>s-r),{west:e[0],east:e[e.length-1],north:t[t.length-1],south:t[0]}}function A7(n,e){const t=(e==null?void 0:e.minimumHeight)||0,s=(e==null?void 0:e.maximumHeight)||0,r=Ry(n),i=_7(r),o=i.west,l=i.south,f=i.east,h=i.north,g=[];return g.push(new L(o,h,t)),g.push(new L(f,h,t)),g.push(new L(f,l,t)),g.push(new L(o,l,t)),g.push(new L(o,h,s)),g.push(new L(f,h,s)),g.push(new L(f,l,s)),g.push(new L(o,l,s)),g}function cR(n){const e=n.token,t={minimumHeight:n.minimumHeight,maximumHeight:n.maximumHeight},s=A7(e,t),r=m7(e),i=r[0],o=r[1],l=qe.WGS84.cartographicToCartesian([i,o,t.maximumHeight]),f=new L(l[0],l[1],l[2]);s.push(f);const h=dw(s);return[...h.center,...h.halfAxes]}const y7=4,b7=8,T7={QUADTREE:y7,OCTREE:b7};function E7(n,e,t){if(n!=null&&n.box){const s=sR(n.s2VolumeInfo.token),r=i7(s,e),i=r7(r),o={...n.s2VolumeInfo};switch(o.token=i,t){case"OCTREE":const h=n.s2VolumeInfo,g=h.maximumHeight-h.minimumHeight,m=g/2,A=h.minimumHeight+g/2;h.minimumHeight=A-m,h.maximumHeight=A+m;break}return{box:cR(o),s2VolumeInfo:o}}}async function lR(n){const{subtree:e,subtreeData:t={level:0,x:0,y:0,z:0},parentData:s={mortonIndex:0,localLevel:-1,localX:0,localY:0,localZ:0},childIndex:r=0,implicitOptions:i,loaderOptions:o,s2VolumeBox:l}=n,{subdivisionScheme:f,subtreeLevels:h,maximumLevel:g,contentUrlTemplate:m,subtreesUriTemplate:A,basePath:y}=i,E={children:[],lodMetricValue:0,contentUrl:""};if(!g)return Wh.once(`Missing 'maximumLevel' or 'availableLevels' property. The subtree ${m} won't be loaded...`),E;const v=s.localLevel+1,S=t.level+v;if(S>g)return E;const x=T7[f],O=Math.log2(x),R=r&1,D=r>>1&1,z=r>>2&1,J=Ii(s.localX,R,1),ie=Ii(s.localY,D,1),re=Ii(s.localZ,z,1),ee=Ii(t.x,J,v),le=Ii(t.y,ie,v),fe=Ii(t.z,re,v),ye=Ii(s.mortonIndex,r,O),ke=v===h&&Gm(e.childSubtreeAvailability,ye);let me,Oe,W,oe;if(ke){const M=`${y}/${A}`,Z=cA(M,S,ee,le,fe);me=await zs(Z,Qw,o),oe=0,Oe={level:S,x:ee,y:le,z:fe},W={mortonIndex:0,localLevel:0,localX:0,localY:0,localZ:0}}else me=e,oe=(x**v-1)/(x-1)+ye,Oe=t,W={mortonIndex:ye,localLevel:v,localX:J,localY:ie,localZ:re};if(!Gm(me.tileAvailability,oe))return E;Gm(me.contentAvailability,oe)&&(E.contentUrl=cA(m,S,ee,le,fe));for(let M=0;M<x;M++){const Z=E7(l,M,f),ae=await lR({subtree:me,subtreeData:Oe,parentData:W,childIndex:M,implicitOptions:i,loaderOptions:o,s2VolumeBox:Z});(ae.contentUrl||ae.children.length)&&E.children.push(ae)}return E.contentUrl||E.children.length?C7(E,{level:S,x:ee,y:le,z:fe},i,l):E}function Gm(n,e){let t;return Array.isArray(n)?(t=n[0],n.length>1&&Wh.once('Not supported extension "3DTILES_multiple_contents" has been detected')):t=n,"constant"in t?!!t.constant:t.explicitBitstream?S7(e,t.explicitBitstream):!1}function C7(n,e,t,s){const{basePath:r,refine:i,getRefine:o,lodMetricType:l,getTileType:f,rootLodMetricValue:h,rootBoundingVolume:g}=t,m=n.contentUrl&&n.contentUrl.replace(`${r}/`,""),A=h/2**e.level,y=s!=null&&s.box?{box:s.box}:g,E=v7(y,e,t.subdivisionScheme);return{children:n.children,contentUrl:n.contentUrl,content:{uri:m},id:n.contentUrl,refine:o(i),type:f(n),lodMetricType:l,lodMetricValue:A,geometricError:A,transform:n.transform,boundingVolume:E}}function v7(n,e,t){if(n.region){const{level:s,x:r,y:i,z:o}=e,[l,f,h,g,m,A]=n.region,y=2**s,E=(h-l)/y,[v,S]=[l+E*r,l+E*(r+1)],x=(g-f)/y,[O,R]=[f+x*i,f+x*(i+1)];let D,z;if(t==="OCTREE"){const J=(A-m)/y;[D,z]=[m+J*o,m+J*(o+1)]}else[D,z]=[m,A];return{region:[v,O,S,R,D,z]}}if(n.box)return n;throw new Error(`Unsupported bounding volume type ${JSON.stringify(n)}`)}function Ii(n,e,t){return(n<<t)+e}function cA(n,e,t,s,r){const i=B7({level:e,x:t,y:s,z:r});return n.replace(/{level}|{x}|{y}|{z}/gi,o=>i[o])}function B7(n){const e={};for(const t in n)e[`{${t}}`]=n[t];return e}function S7(n,e){const t=Math.floor(n/8),s=n%8;return(e[t]>>s&1)===1}function xy(n,e=""){if(!e)return fr.EMPTY;const s=e.split("?")[0].split(".").pop();switch(s){case"pnts":return fr.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return fr.SCENEGRAPH;default:return s||fr.EMPTY}}function Iy(n){switch(n){case"REPLACE":case"replace":return Es.REPLACE;case"ADD":case"add":return Es.ADD;default:return n}}function lA(n,e){if(/^[a-z][0-9a-z+.-]*:/i.test(e)){const s=new URL(n,`${e}/`);return decodeURI(s.toString())}else if(n.startsWith("/"))return n;return JO(e,n)}function _B(n,e){var r;if(!n)return null;let t;if(n.content){const i=n.content.uri||((r=n.content)==null?void 0:r.url);typeof i<"u"&&(t=lA(i,e))}return{...n,id:t,contentUrl:t,lodMetricType:Ta.GEOMETRIC_ERROR,lodMetricValue:n.geometricError,transformMatrix:n.transform,type:xy(n,t),refine:Iy(n.refine)}}async function w7(n,e,t){let s=null;const r=yB(n.root);r&&n.root?s=await AB(n.root,n,e,r,t):s=_B(n.root,e);const i=[];for(i.push(s);i.length>0;){const o=i.pop()||{},l=o.children||[],f=[];for(const h of l){const g=yB(h);let m;g?m=await AB(h,n,e,g,t):m=_B(h,e),m&&(f.push(m),i.push(m))}o.children=f}return s}async function AB(n,e,t,s,r){var D,z,J;const{subdivisionScheme:i,maximumLevel:o,availableLevels:l,subtreeLevels:f,subtrees:{uri:h}}=s,g=cA(h,0,0,0,0),m=lA(g,t),A=await zs(m,Qw,r),y=(D=n.content)==null?void 0:D.uri,E=y?lA(y,t):"",v=(z=e==null?void 0:e.root)==null?void 0:z.refine,S=n.geometricError,x=(J=n.boundingVolume.extensions)==null?void 0:J["3DTILES_bounding_volume_S2"];if(x){const re={box:cR(x),s2VolumeInfo:x};n.boundingVolume=re}const O=n.boundingVolume,R={contentUrlTemplate:E,subtreesUriTemplate:h,subdivisionScheme:i,subtreeLevels:f,maximumLevel:Number.isFinite(l)?l-1:o,refine:v,basePath:t,lodMetricType:Ta.GEOMETRIC_ERROR,rootLodMetricValue:S,rootBoundingVolume:O,getTileType:xy,getRefine:Iy};return await R7(n,t,A,R,r)}async function R7(n,e,t,s,r){if(!n)return null;const{children:i,contentUrl:o}=await lR({subtree:t,implicitOptions:s,loaderOptions:r});let l,f=null;return o&&(l=o,f={uri:o.replace(`${e}/`,"")}),{...n,id:l,contentUrl:l,lodMetricType:Ta.GEOMETRIC_ERROR,lodMetricValue:n.geometricError,transformMatrix:n.transform,type:xy(n,l),refine:Iy(n.refine),content:f||n.content,children:i}}function yB(n){var e;return((e=n==null?void 0:n.extensions)==null?void 0:e["3DTILES_implicit_tiling"])||(n==null?void 0:n.implicitTiling)}const uR={dataType:null,batchType:null,id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:jw,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:x7,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};async function x7(n,e={},t){const s=e["3d-tiles"]||{};let r;return s.isTileset==="auto"?r=(t==null?void 0:t.url)&&t.url.indexOf(".json")!==-1:r=s.isTileset,r?I7(n,e,t):M7(n,e,t)}async function I7(n,e,t){var f;const s=JSON.parse(new TextDecoder().decode(n)),r=(t==null?void 0:t.url)||"",i=O7(r),o=await w7(s,i,e||{});return{...s,shape:"tileset3d",loader:uR,url:r,queryString:(t==null?void 0:t.queryString)||"",basePath:i,root:o||s.root,type:hn.TILES3D,lodMetricType:Ta.GEOMETRIC_ERROR,lodMetricValue:((f=s.root)==null?void 0:f.geometricError)||0}}async function M7(n,e,t){const s={content:{shape:"tile3d",featureIds:null}};return await qw(n,0,e,t,s.content),s.content}function O7(n){return vA(n)}const bB=[0],D7={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:uR,onTilesetLoad:{type:"function",value:n=>{}},onTileLoad:{type:"function",value:n=>{}},onTileUnload:{type:"function",value:n=>{}},onTileError:{type:"function",value:(n,e,t)=>{}},_getMeshColor:{type:"function",value:n=>[255,255,255]}};class vh extends lw{initializeState(){"onTileLoadFail"in this.props&&Ve.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){var e,t;return!!((t=(e=this.state)==null?void 0:e.tileset3d)!=null&&t.isLoaded()&&super.isLoaded)}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({props:e,oldProps:t,changeFlags:s}){if(e.data&&e.data!==t.data&&this._loadTileset(e.data),s.viewportChanged){const{activeViewports:r}=this.state;Object.keys(r).length&&(this._updateTileset(r),this.state.lastUpdatedViewports=r,this.state.activeViewports={})}if(s.propsChanged){const{layerMap:r}=this.state;for(const i in r)r[i].needsUpdate=!0}}activateViewport(e){const{activeViewports:t,lastUpdatedViewports:s}=this.state;this.internalState.viewport=e,t[e.id]=e;const r=s==null?void 0:s[e.id];(!r||!e.equals(r))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo({info:e,sourceLayer:t}){const s=t&&t.props.tile;return e.picked&&(e.object=s),e.sourceTile=s,e}filterSubLayer({layer:e,viewport:t}){const{tile:s}=e.props,{id:r}=t;return s.selected&&s.viewportIds.includes(r)}_updateAutoHighlight(e){const t=e.sourceTile,s=this.state.layerMap[t==null?void 0:t.id];s&&s.layer&&s.layer.updateAutoHighlight(e)}async _loadTileset(e){const{loadOptions:t={}}=this.props,s=this.props.loader||this.props.loaders,r=Array.isArray(s)?s[0]:s,i={loadOptions:{...t}};let o=e;if(r.preload){const h=await r.preload(e,t);h.url&&(o=h.url),h.headers&&(i.loadOptions.fetch={...i.loadOptions.fetch,headers:h.headers}),Object.assign(i,h)}const l=await zs(o,r,i.loadOptions),f=new K$(l,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...i});this.setState({tileset3d:f,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(f)}_onTileLoad(e){const{lastUpdatedViewports:t}=this.state;this.props.onTileLoad(e),this._updateTileset(t),this.setNeedsUpdate()}_onTileUnload(e){delete this.state.layerMap[e.id],this.props.onTileUnload(e)}_updateTileset(e){if(!e)return;const{tileset3d:t}=this.state,{timeline:s}=this.context,r=Object.keys(e).length;!s||!r||!t||t.selectTiles(Object.values(e)).then(i=>{this.state.frameNumber!==i&&this.setState({frameNumber:i})})}_getSubLayer(e,t){if(!e.content)return null;switch(e.type){case fr.POINTCLOUD:return this._makePointCloudLayer(e,t);case fr.SCENEGRAPH:return this._make3DModelLayer(e);case fr.MESH:return this._makeSimpleMeshLayer(e,t);default:throw new Error(`Tile3DLayer: Failed to render layer of type ${e.content.type}`)}}_makePointCloudLayer(e,t){const{attributes:s,pointCount:r,constantRGBA:i,cartographicOrigin:o,modelMatrix:l}=e.content,{positions:f,normals:h,colors:g}=s;if(!f)return null;const m=t&&t.props.data||{header:{vertexCount:r},attributes:{POSITION:f,NORMAL:h,COLOR_0:g}},{pointSize:A,getPointColor:y}=this.props,E=this.getSubLayerClass("pointcloud",gy);return new E({pointSize:A},this.getSubLayerProps({id:"pointcloud"}),{id:`${this.id}-pointcloud-${e.id}`,tile:e,data:m,coordinateSystem:Me.METER_OFFSETS,coordinateOrigin:o,modelMatrix:l,getColor:i||y,_offset:0})}_make3DModelLayer(e){const{gltf:t,instances:s,cartographicOrigin:r,modelMatrix:i}=e.content,o=this.getSubLayerClass("scenegraph",Ey);return new o({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:`${this.id}-scenegraph-${e.id}`,tile:e,data:s||bB,scenegraph:t,coordinateSystem:Me.METER_OFFSETS,coordinateOrigin:r,modelMatrix:i,getTransformMatrix:l=>l.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(e,t){const s=e.content,{attributes:r,indices:i,modelMatrix:o,cartographicOrigin:l,coordinateSystem:f=Me.METER_OFFSETS,material:h,featureIds:g}=s,{_getMeshColor:m}=this.props,A=t&&t.props.mesh||new ca({topology:"triangle-list",attributes:N7(r),indices:i}),y=this.getSubLayerClass("mesh",Cy);return new y(this.getSubLayerProps({id:"mesh"}),{id:`${this.id}-mesh-${e.id}`,tile:e,mesh:A,data:bB,getColor:m(e),pbrMaterial:h,modelMatrix:o,coordinateOrigin:l,coordinateSystem:f,featureIds:g,_offset:0})}renderLayers(){const{tileset3d:e,layerMap:t}=this.state;return e?e.tiles.map(s=>{const r=t[s.id]=t[s.id]||{tile:s};let{layer:i}=r;return s.selected&&(i?r.needsUpdate&&(i=this._getSubLayer(s,i),r.needsUpdate=!1):i=this._getSubLayer(s)),r.layer=i,i}).filter(Boolean):null}}vh.defaultProps=D7;vh.layerName="Tile3DLayer";function N7(n){const e={};return e.positions={...n.positions,value:new Float32Array(n.positions.value)},n.normals&&(e.normals=n.normals),n.texCoords&&(e.texCoords=n.texCoords),n.colors&&(e.colors=n.colors),n.uvRegions&&(e.uvRegions=n.uvRegions),e}async function Nl(n,e,t,s){return s._parse(n,e,t,s)}function Lt(n,e){if(!n)throw new Error(e||"loader assertion failed.")}const fR=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),TB=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);TB&&parseFloat(TB[1]);const F7="latest";function P7(){var n;return(n=globalThis._loadersgl_)!==null&&n!==void 0&&n.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},typeof __VERSION__>"u"?(console.warn("loaders.gl: The __VERSION__ variable is not injected using babel plugin. Latest unstable workers would be fetched from the CDN."),globalThis._loadersgl_.version=F7):globalThis._loadersgl_.version=__VERSION__),globalThis._loadersgl_.version}const U7=P7();function L7(n,e){if(!n)throw new Error("loaders.gl assertion failed.")}const My=typeof process!="object"||String(process)!=="[object process]"||process.browser,Oy=typeof importScripts=="function",EB=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);EB&&parseFloat(EB[1]);const Vm={};async function Bh(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;return e&&(n=k7(n,e,t,s)),Vm[n]=Vm[n]||H7(n),await Vm[n]}function k7(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(!t.useLocalLibraries&&n.startsWith("http"))return n;s=s||n;const r=t.modules||{};return r[s]?r[s]:My?t.CDN?(L7(t.CDN.startsWith("http")),`${t.CDN}/${e}@${U7}/dist/libs/${s}`):Oy?`../src/libs/${s}`:`modules/${e}/src/libs/${s}`:`modules/${e}/dist/libs/${s}`}async function H7(n){if(n.endsWith("wasm"))return await V7(n);if(!My)try{return xS&&void 0}catch(t){return console.error(t),null}if(Oy)return importScripts(n);const e=await j7(n);return G7(e,n)}function G7(n,e){if(!My)return;if(Oy)return eval.call(globalThis,n),null;const t=document.createElement("script");t.id=e;try{t.appendChild(document.createTextNode(n))}catch{t.text=n}return document.body.appendChild(t),null}async function V7(n){return await(await fetch(n)).arrayBuffer()}async function j7(n){return await(await fetch(n)).text()}function z7(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof n=="string"?n.slice(0,e):ArrayBuffer.isView(n)?CB(n.buffer,n.byteOffset,e):n instanceof ArrayBuffer?CB(n,0,e):""}function CB(n,e,t){if(n.byteLength<=e+t)return"";const s=new DataView(n);let r="";for(let i=0;i<t;i++)r+=String.fromCharCode(s.getUint8(e+i));return r}function $7(n){try{return JSON.parse(n)}catch{throw new Error(`Failed to parse JSON from data starting with "${z7(n)}"`)}}function Dy(n,e,t){const s=t!==void 0?new Uint8Array(n).subarray(e,e+t):new Uint8Array(n).subarray(e);return new Uint8Array(s).buffer}function Fl(n,e){return Lt(n>=0),Lt(e>0),n+(e-1)&-4}function X7(n,e,t){let s;if(n instanceof ArrayBuffer)s=new Uint8Array(n);else{const r=n.byteOffset,i=n.byteLength;s=new Uint8Array(n.buffer||n.arrayBuffer,r,i)}return e.set(s,t),t+Fl(s.byteLength,4)}function J7(){var n;if(typeof process<"u"&&typeof process.cwd<"u")return process.cwd();const e=(n=window.location)===null||n===void 0?void 0:n.pathname;return(e==null?void 0:e.slice(0,e.lastIndexOf("/")+1))||""}function W7(n){const e=n?n.lastIndexOf("/"):-1;return e>=0?n.substr(0,e):""}function Y7(){const n=[];for(let r=0;r<arguments.length;r++)n[r]=r<0||arguments.length<=r?void 0:arguments[r];let e="",t=!1,s;for(let r=n.length-1;r>=-1&&!t;r--){let i;r>=0?i=n[r]:(s===void 0&&(s=J7()),i=s),i.length!==0&&(e=`${i}/${e}`,t=i.charCodeAt(0)===Qc)}return e=K7(e,!t),t?`/${e}`:e.length>0?e:"."}const Qc=47,jm=46;function K7(n,e){let t="",s=-1,r=0,i,o=!1;for(let l=0;l<=n.length;++l){if(l<n.length)i=n.charCodeAt(l);else{if(i===Qc)break;i=Qc}if(i===Qc){if(!(s===l-1||r===1))if(s!==l-1&&r===2){if(t.length<2||!o||t.charCodeAt(t.length-1)!==jm||t.charCodeAt(t.length-2)!==jm){if(t.length>2){const f=t.length-1;let h=f;for(;h>=0&&t.charCodeAt(h)!==Qc;--h);if(h!==f){t=h===-1?"":t.slice(0,h),s=l,r=0,o=!1;continue}}else if(t.length===2||t.length===1){t="",s=l,r=0,o=!1;continue}}e&&(t.length>0?t+="/..":t="..",o=!0)}else{const f=n.slice(s+1,l);t.length>0?t+=`/${f}`:t=f,o=!1}s=l,r=0}else i===jm&&r!==-1?++r:r=-1}return t}let vB=function(n){return n[n.ADD=1]="ADD",n[n.REPLACE=2]="REPLACE",n}({}),xf=function(n){return n.EMPTY="empty",n.SCENEGRAPH="scenegraph",n.POINTCLOUD="pointcloud",n.MESH="mesh",n}({}),q7=function(n){return n.I3S="I3S",n.TILES3D="TILES3D",n}({}),ad=function(n){return n.GEOMETRIC_ERROR="geometricError",n.MAX_SCREEN_THRESHOLD="maxScreenThreshold",n}({});const hR=typeof __VERSION__<"u"?__VERSION__:"latest",Hc={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GLTF:"glTF"};function dR(n,e,t){Lt(n instanceof ArrayBuffer);const s=new TextDecoder("utf8"),r=new Uint8Array(n,e,t);return s.decode(r)}function Q7(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const t=new DataView(n);return`${String.fromCharCode(t.getUint8(e+0))}${String.fromCharCode(t.getUint8(e+1))}${String.fromCharCode(t.getUint8(e+2))}${String.fromCharCode(t.getUint8(e+3))}`}const Z7=typeof __VERSION__<"u"?__VERSION__:"latest",eJ={draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}},tJ={name:"Draco",id:"draco",module:"draco",version:Z7,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:eJ};function nJ(n){switch(n.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function sJ(n){let e=1/0,t=1/0,s=1/0,r=-1/0,i=-1/0,o=-1/0;const l=n.POSITION?n.POSITION.value:[],f=l&&l.length;for(let h=0;h<f;h+=3){const g=l[h],m=l[h+1],A=l[h+2];e=g<e?g:e,t=m<t?m:t,s=A<s?A:s,r=g>r?g:r,i=m>i?m:i,o=A>o?A:o}return[[e,t,s],[r,i,o]]}function rJ(n,e,t){const s=nJ(e.value),r=t||iJ(e);return{name:n,type:{type:"fixed-size-list",listSize:e.size,children:[{name:"value",type:s}]},nullable:!1,metadata:r}}function iJ(n){const e={};return"byteOffset"in n&&(e.byteOffset=n.byteOffset.toString(10)),"byteStride"in n&&(e.byteStride=n.byteStride.toString(10)),"normalized"in n&&(e.normalized=n.normalized.toString()),e}function oJ(n,e,t){const s=gR(e.metadata),r=[],i=aJ(e.attributes);for(const o in n){const l=n[o],f=BB(o,l,i[o]);r.push(f)}if(t){const o=BB("indices",t);r.push(o)}return{fields:r,metadata:s}}function aJ(n){const e={};for(const t in n){const s=n[t];e[s.name||"undefined"]=s}return e}function BB(n,e,t){const s=t?gR(t.metadata):void 0;return rJ(n,e,s)}function gR(n){Object.entries(n);const e={};for(const t in n)e[`${t}.string`]=JSON.stringify(n[t]);return e}const SB={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},cJ={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},lJ=4;class uJ{constructor(e){this.draco=void 0,this.decoder=void 0,this.metadataQuerier=void 0,this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=new this.draco.DecoderBuffer;s.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(t);const r=this.decoder.GetEncodedGeometryType(s),i=r===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let o;switch(r){case this.draco.TRIANGULAR_MESH:o=this.decoder.DecodeBufferToMesh(s,i);break;case this.draco.POINT_CLOUD:o=this.decoder.DecodeBufferToPointCloud(s,i);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!o.ok()||!i.ptr){const A=`DRACO decompression failed: ${o.error_msg()}`;throw new Error(A)}const l=this._getDracoLoaderData(i,r,t),f=this._getMeshData(i,l,t),h=sJ(f.attributes),g=oJ(f.attributes,l,f.indices);return{loader:"draco",loaderData:l,header:{vertexCount:i.num_points(),boundingBox:h},...f,schema:g}}finally{this.draco.destroy(s),i&&this.draco.destroy(i)}}_getDracoLoaderData(e,t,s){const r=this._getTopLevelMetadata(e),i=this._getDracoAttributes(e,s);return{geometry_type:t,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:r,attributes:i}}_getDracoAttributes(e,t){const s={};for(let r=0;r<e.num_attributes();r++){const i=this.decoder.GetAttribute(e,r),o=this._getAttributeMetadata(e,r);s[i.unique_id()]={unique_id:i.unique_id(),attribute_type:i.attribute_type(),data_type:i.data_type(),num_components:i.num_components(),byte_offset:i.byte_offset(),byte_stride:i.byte_stride(),normalized:i.normalized(),attribute_index:r,metadata:o};const l=this._getQuantizationTransform(i,t);l&&(s[i.unique_id()].quantization_transform=l);const f=this._getOctahedronTransform(i,t);f&&(s[i.unique_id()].octahedron_transform=f)}return s}_getMeshData(e,t,s){const r=this._getMeshAttributes(t,e,s);if(!r.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(s.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:r,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:r,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:r}}_getMeshAttributes(e,t,s){const r={};for(const i of Object.values(e.attributes)){const o=this._deduceAttributeName(i,s);i.name=o;const{value:l,size:f}=this._getAttributeValues(t,i);r[o]={value:l,size:f,byteOffset:i.byte_offset,byteStride:i.byte_stride,normalized:i.normalized}}return r}_getTriangleListIndices(e){const s=e.num_faces()*3,r=s*lJ,i=this.draco._malloc(r);try{return this.decoder.GetTrianglesUInt32Array(e,r,i),new Uint32Array(this.draco.HEAPF32.buffer,i,s).slice()}finally{this.draco._free(i)}}_getTriangleStripIndices(e){const t=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,t),dJ(t)}finally{this.draco.destroy(t)}}_getAttributeValues(e,t){const s=cJ[t.data_type],r=t.num_components,o=e.num_points()*r,l=o*s.BYTES_PER_ELEMENT,f=fJ(this.draco,s);let h;const g=this.draco._malloc(l);try{const m=this.decoder.GetAttribute(e,t.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,m,f,l,g),h=new s(this.draco.HEAPF32.buffer,g,o).slice()}finally{this.draco._free(g)}return{value:h,size:r}}_deduceAttributeName(e,t){const s=e.unique_id;for(const[o,l]of Object.entries(t.extraAttributes||{}))if(l===s)return o;const r=e.attribute_type;for(const o in SB)if(this.draco[o]===r)return SB[o];const i=t.attributeNameEntry||"name";return e.metadata[i]?e.metadata[i].string:`CUSTOM_ATTRIBUTE_${s}`}_getTopLevelMetadata(e){const t=this.decoder.GetMetadata(e);return this._getDracoMetadata(t)}_getAttributeMetadata(e,t){const s=this.decoder.GetAttributeMetadata(e,t);return this._getDracoMetadata(s)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const t={},s=this.metadataQuerier.NumEntries(e);for(let r=0;r<s;r++){const i=this.metadataQuerier.GetEntryName(e,r);t[i]=this._getDracoMetadataField(e,i)}return t}_getDracoMetadataField(e,t){const s=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,t,s);const r=hJ(s);return{int:this.metadataQuerier.GetIntEntry(e,t),string:this.metadataQuerier.GetStringEntry(e,t),double:this.metadataQuerier.GetDoubleEntry(e,t),intArray:r}}finally{this.draco.destroy(s)}}_disableAttributeTransforms(e){const{quantizedAttributes:t=[],octahedronAttributes:s=[]}=e,r=[...t,...s];for(const i of r)this.decoder.SkipAttributeTransform(this.draco[i])}_getQuantizationTransform(e,t){const{quantizedAttributes:s=[]}=t,r=e.attribute_type();if(s.map(o=>this.decoder[o]).includes(r)){const o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(e))return{quantization_bits:o.quantization_bits(),range:o.range(),min_values:new Float32Array([1,2,3]).map(l=>o.min_value(l))}}finally{this.draco.destroy(o)}}return null}_getOctahedronTransform(e,t){const{octahedronAttributes:s=[]}=t,r=e.attribute_type();if(s.map(o=>this.decoder[o]).includes(r)){const o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(e))return{quantization_bits:o.quantization_bits()}}finally{this.draco.destroy(o)}}return null}}function fJ(n,e){switch(e){case Float32Array:return n.DT_FLOAT32;case Int8Array:return n.DT_INT8;case Int16Array:return n.DT_INT16;case Int32Array:return n.DT_INT32;case Uint8Array:return n.DT_UINT8;case Uint16Array:return n.DT_UINT16;case Uint32Array:return n.DT_UINT32;default:return n.DT_INVALID}}function hJ(n){const e=n.size(),t=new Int32Array(e);for(let s=0;s<e;s++)t[s]=n.GetValue(s);return t}function dJ(n){const e=n.size(),t=new Int32Array(e);for(let s=0;s<e;s++)t[s]=n.GetValue(s);return t}const gJ="latest";function pJ(){var n;return(n=globalThis._loadersgl_)!==null&&n!==void 0&&n.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},typeof __VERSION__>"u"?(console.warn("loaders.gl: The __VERSION__ variable is not injected using babel plugin. Latest unstable workers would be fetched from the CDN."),globalThis._loadersgl_.version=gJ):globalThis._loadersgl_.version=__VERSION__),globalThis._loadersgl_.version}const mJ=pJ();function _J(n,e){if(!n)throw new Error("loaders.gl assertion failed.")}const Ny=typeof process!="object"||String(process)!=="[object process]"||process.browser,Fy=typeof importScripts=="function",wB=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);wB&&parseFloat(wB[1]);const zm={};async function $m(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;return e&&(n=AJ(n,e,t,s)),zm[n]=zm[n]||yJ(n),await zm[n]}function AJ(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(!t.useLocalLibraries&&n.startsWith("http"))return n;s=s||n;const r=t.modules||{};return r[s]?r[s]:Ny?t.CDN?(_J(t.CDN.startsWith("http")),`${t.CDN}/${e}@${mJ}/dist/libs/${s}`):Fy?`../src/libs/${s}`:`modules/${e}/src/libs/${s}`:`modules/${e}/dist/libs/${s}`}async function yJ(n){if(n.endsWith("wasm"))return await TJ(n);if(!Ny)try{return xS&&void 0}catch(t){return console.error(t),null}if(Fy)return importScripts(n);const e=await EJ(n);return bJ(e,n)}function bJ(n,e){if(!Ny)return;if(Fy)return eval.call(globalThis,n),null;const t=document.createElement("script");t.id=e;try{t.appendChild(document.createTextNode(n))}catch{t.text=n}return document.body.appendChild(t),null}async function TJ(n){return await(await fetch(n)).arrayBuffer()}async function EJ(n){return await(await fetch(n)).text()}const CJ="1.5.6",vJ="1.4.1",Xm=`https://www.gstatic.com/draco/versioned/decoders/${CJ}`,pn={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},Jm={[pn.DECODER]:`${Xm}/${pn.DECODER}`,[pn.DECODER_WASM]:`${Xm}/${pn.DECODER_WASM}`,[pn.FALLBACK_DECODER]:`${Xm}/${pn.FALLBACK_DECODER}`,[pn.ENCODER]:`https://raw.githubusercontent.com/google/draco/${vJ}/javascript/${pn.ENCODER}`};let Gc;async function BJ(n){const e=n.modules||{};return e.draco3d?Gc=Gc||e.draco3d.createDecoderModule({}).then(t=>({draco:t})):Gc=Gc||SJ(n),await Gc}async function SJ(n){let e,t;switch(n.draco&&n.draco.decoderType){case"js":e=await $m(Jm[pn.FALLBACK_DECODER],"draco",n,pn.FALLBACK_DECODER);break;case"wasm":default:[e,t]=await Promise.all([await $m(Jm[pn.DECODER],"draco",n,pn.DECODER),await $m(Jm[pn.DECODER_WASM],"draco",n,pn.DECODER_WASM)])}return e=e||globalThis.DracoDecoderModule,await wJ(e,t)}function wJ(n,e){const t={};return e&&(t.wasmBinary=e),new Promise(s=>{n({...t,onModuleLoaded:r=>s({draco:r})})})}const pR={...tJ,parse:RJ};async function RJ(n,e){const{draco:t}=await BJ(e),s=new uJ(t);try{return s.parseSync(n,e==null?void 0:e.draco)}finally{s.destroy()}}const xJ={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Bt={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},Pe={...xJ,...Bt},Wm={[Bt.DOUBLE]:Float64Array,[Bt.FLOAT]:Float32Array,[Bt.UNSIGNED_SHORT]:Uint16Array,[Bt.UNSIGNED_INT]:Uint32Array,[Bt.UNSIGNED_BYTE]:Uint8Array,[Bt.BYTE]:Int8Array,[Bt.SHORT]:Int16Array,[Bt.INT]:Int32Array},IJ={DOUBLE:Bt.DOUBLE,FLOAT:Bt.FLOAT,UNSIGNED_SHORT:Bt.UNSIGNED_SHORT,UNSIGNED_INT:Bt.UNSIGNED_INT,UNSIGNED_BYTE:Bt.UNSIGNED_BYTE,BYTE:Bt.BYTE,SHORT:Bt.SHORT,INT:Bt.INT},Ym="Failed to convert GL type";class Vs{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(const t in Wm)if(Wm[t]===e)return t;throw new Error(Ym)}static fromName(e){const t=IJ[e];if(!t)throw new Error(Ym);return t}static getArrayType(e){switch(e){case Bt.UNSIGNED_SHORT_5_6_5:case Bt.UNSIGNED_SHORT_4_4_4_4:case Bt.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const t=Wm[e];if(!t)throw new Error(Ym);return t}}static getByteSize(e){return Vs.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return!!Vs.getArrayType(e)}static createTypedArray(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0;r===void 0&&(r=(t.byteLength-s)/Vs.getByteSize(e));const i=Vs.getArrayType(e);return new i(t,s,r)}}function MJ(n,e){if(!n)throw new Error(`math.gl assertion failed. ${e}`)}function OJ(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const t=n>>11&31,s=n>>5&63,r=n&31;return e[0]=t<<3,e[1]=s<<2,e[2]=r<<3,e}new Ra;new L;new Ra;new Ra;function RB(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:255;return Wn(n,0,e)/e*2-1}function xB(n){return n<0?-1:1}function DJ(n,e,t,s){if(MJ(s),n<0||n>t||e<0||e>t)throw new Error(`x and y must be unsigned normalized integers between 0 and ${t}`);if(s.x=RB(n,t),s.y=RB(e,t),s.z=1-(Math.abs(s.x)+Math.abs(s.y)),s.z<0){const r=s.x;s.x=(1-Math.abs(s.y))*xB(r),s.y=(1-Math.abs(r))*xB(s.y)}return s.normalize()}function NJ(n,e,t){return DJ(n,e,255,t)}function IB(n){return(n%1+1)%1}class Py{constructor(e,t){this.json=void 0,this.buffer=void 0,this.featuresLength=0,this._cachedTypedArrays={},this.json=e,this.buffer=t}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return!!this.json[e]}getGlobalProperty(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Pe.UNSIGNED_INT,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const r=this.json[e];return r&&Number.isFinite(r.byteOffset)?this._getTypedArrayFromBinary(e,t,s,1,r.byteOffset):r}getPropertyArray(e,t,s){const r=this.json[e];return r&&Number.isFinite(r.byteOffset)?("componentType"in r&&(t=Vs.fromName(r.componentType)),this._getTypedArrayFromBinary(e,t,s,this.featuresLength,r.byteOffset)):this._getTypedArrayFromArray(e,t,r)}getProperty(e,t,s,r,i){const o=this.json[e];if(!o)return o;const l=this.getPropertyArray(e,t,s);if(s===1)return l[r];for(let f=0;f<s;++f)i[f]=l[s*r+f];return i}_getTypedArrayFromBinary(e,t,s,r,i){const o=this._cachedTypedArrays;let l=o[e];return l||(l=Vs.createTypedArray(t,this.buffer.buffer,this.buffer.byteOffset+i,r*s),o[e]=l),l}_getTypedArrayFromArray(e,t,s){const r=this._cachedTypedArrays;let i=r[e];return i||(i=Vs.createTypedArray(t,s),r[e]=i),i}}const FJ={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},PJ={SCALAR:(n,e)=>n[e],VEC2:(n,e)=>[n[2*e+0],n[2*e+1]],VEC3:(n,e)=>[n[3*e+0],n[3*e+1],n[3*e+2]],VEC4:(n,e)=>[n[4*e+0],n[4*e+1],n[4*e+2],n[4*e+3]],MAT2:(n,e)=>[n[4*e+0],n[4*e+1],n[4*e+2],n[4*e+3]],MAT3:(n,e)=>[n[9*e+0],n[9*e+1],n[9*e+2],n[9*e+3],n[9*e+4],n[9*e+5],n[9*e+6],n[9*e+7],n[9*e+8]],MAT4:(n,e)=>[n[16*e+0],n[16*e+1],n[16*e+2],n[16*e+3],n[16*e+4],n[16*e+5],n[16*e+6],n[16*e+7],n[16*e+8],n[16*e+9],n[16*e+10],n[16*e+11],n[16*e+12],n[16*e+13],n[16*e+14],n[16*e+15]]},UJ={SCALAR:(n,e,t)=>{e[t]=n},VEC2:(n,e,t)=>{e[2*t+0]=n[0],e[2*t+1]=n[1]},VEC3:(n,e,t)=>{e[3*t+0]=n[0],e[3*t+1]=n[1],e[3*t+2]=n[2]},VEC4:(n,e,t)=>{e[4*t+0]=n[0],e[4*t+1]=n[1],e[4*t+2]=n[2],e[4*t+3]=n[3]},MAT2:(n,e,t)=>{e[4*t+0]=n[0],e[4*t+1]=n[1],e[4*t+2]=n[2],e[4*t+3]=n[3]},MAT3:(n,e,t)=>{e[9*t+0]=n[0],e[9*t+1]=n[1],e[9*t+2]=n[2],e[9*t+3]=n[3],e[9*t+4]=n[4],e[9*t+5]=n[5],e[9*t+6]=n[6],e[9*t+7]=n[7],e[9*t+8]=n[8],e[9*t+9]=n[9]},MAT4:(n,e,t)=>{e[16*t+0]=n[0],e[16*t+1]=n[1],e[16*t+2]=n[2],e[16*t+3]=n[3],e[16*t+4]=n[4],e[16*t+5]=n[5],e[16*t+6]=n[6],e[16*t+7]=n[7],e[16*t+8]=n[8],e[16*t+9]=n[9],e[16*t+10]=n[10],e[16*t+11]=n[11],e[16*t+12]=n[12],e[16*t+13]=n[13],e[16*t+14]=n[14],e[16*t+15]=n[15]}};function LJ(n,e,t,s){const{componentType:r}=n;Lt(n.componentType);const i=typeof r=="string"?Vs.fromName(r):r,o=FJ[n.type],l=PJ[n.type],f=UJ[n.type];return t+=n.byteOffset,{values:Vs.createTypedArray(i,e,t,o*s),type:i,size:o,unpacker:l,packer:f}}const ks=n=>n!==void 0;function kJ(n,e,t){if(!e)return null;let s=n.getExtension("3DTILES_batch_table_hierarchy");const r=e.HIERARCHY;return r&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=r,s=r),s?HJ(s,t):null}function HJ(n,e){let t,s,r;const i=n.instancesLength,o=n.classes;let l=n.classIds,f=n.parentCounts,h=n.parentIds,g=i;ks(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,GL.UNSIGNED_SHORT),l.type=AttributeType.SCALAR,r=getBinaryAccessor(l),l=r.createArrayBufferView(e.buffer,e.byteOffset+l.byteOffset,i));let m;if(ks(f))for(ks(f.byteOffset)&&(f.componentType=defaultValue(f.componentType,GL.UNSIGNED_SHORT),f.type=AttributeType.SCALAR,r=getBinaryAccessor(f),f=r.createArrayBufferView(e.buffer,e.byteOffset+f.byteOffset,i)),m=new Uint16Array(i),g=0,t=0;t<i;++t)m[t]=g,g+=f[t];ks(h)&&ks(h.byteOffset)&&(h.componentType=defaultValue(h.componentType,GL.UNSIGNED_SHORT),h.type=AttributeType.SCALAR,r=getBinaryAccessor(h),h=r.createArrayBufferView(e.buffer,e.byteOffset+h.byteOffset,g));const A=o.length;for(t=0;t<A;++t){const S=o[t].length,x=o[t].instances,O=getBinaryProperties(S,x,e);o[t].instances=combine(O,x)}const y=new Array(A).fill(0),E=new Uint16Array(i);for(t=0;t<i;++t)s=l[t],E[t]=y[s],++y[s];const v={classes:o,classIds:l,classIndexes:E,parentCounts:f,parentIndexes:m,parentIds:h};return jJ(v),v}function Vc(n,e,t){if(!n)return;const s=n.parentCounts;return n.parentIds?t(n,e):s>0?GJ(n,e,t):VJ(n,e,t)}function GJ(n,e,t){const s=n.classIds,r=n.parentCounts,i=n.parentIds,o=n.parentIndexes,l=s.length,f=scratchVisited;f.length=Math.max(f.length,l);const h=++marker,g=scratchStack;for(g.length=0,g.push(e);g.length>0;){if(e=g.pop(),f[e]===h)continue;f[e]=h;const m=t(n,e);if(ks(m))return m;const A=r[e],y=o[e];for(let E=0;E<A;++E){const v=i[y+E];v!==e&&g.push(v)}}return null}function VJ(n,e,t){let s=!0;for(;s;){const r=t(n,e);if(ks(r))return r;const i=n.parentIds[e];s=i!==e,e=i}throw new Error("traverseHierarchySingleParent")}function jJ(n){const t=n.classIds.length;for(let s=0;s<t;++s)mR(n,s,stack)}function mR(n,e,t){const s=n.parentCounts,r=n.parentIds,i=n.parentIndexes,l=n.classIds.length;if(!ks(r))return;assert(e<l,`Parent index ${e} exceeds the total number of instances: ${l}`),assert(t.indexOf(e)===-1,"Circular dependency detected in the batch table hierarchy."),t.push(e);const f=ks(s)?s[e]:1,h=ks(s)?i[e]:e;for(let g=0;g<f;++g){const m=r[h+g];m!==e&&mR(n,m,t)}t.pop(e)}function fn(n){return n!=null}const If=(n,e)=>n,zJ={HIERARCHY:!0,extensions:!0,extras:!0};class _R{constructor(e,t,s){var r;let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this.json=void 0,this.binary=void 0,this.featureCount=void 0,this._extensions=void 0,this._properties=void 0,this._binaryProperties=void 0,this._hierarchy=void 0,Lt(s>=0),this.json=e||{},this.binary=t,this.featureCount=s,this._extensions=((r=this.json)===null||r===void 0?void 0:r.extensions)||{},this._properties={};for(const o in this.json)zJ[o]||(this._properties[o]=this.json[o]);this._binaryProperties=this._initializeBinaryProperties(),i["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=kJ(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,t){if(this._checkBatchId(e),Lt(typeof t=="string",t),this._hierarchy){const s=Vc(this._hierarchy,e,(r,i)=>{const o=r.classIds[i];return r.classes[o].name===t});return fn(s)}return!1}isExactClass(e,t){return Lt(typeof t=="string",t),this.getExactClassName(e)===t}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy){const t=this._hierarchy.classIds[e];return this._hierarchy.classes[t].name}}hasProperty(e,t){return this._checkBatchId(e),Lt(typeof t=="string",t),fn(this._properties[t])||this._hasPropertyInHierarchy(e,t)}getPropertyNames(e,t){this._checkBatchId(e),t=fn(t)?t:[],t.length=0;const s=Object.keys(this._properties);return t.push(...s),this._hierarchy&&this._getPropertyNamesInHierarchy(e,t),t}getProperty(e,t){if(this._checkBatchId(e),Lt(typeof t=="string",t),this._binaryProperties){const r=this._binaryProperties[t];if(fn(r))return this._getBinaryProperty(r,e)}const s=this._properties[t];if(fn(s))return If(s[e]);if(this._hierarchy){const r=this._getHierarchyProperty(e,t);if(fn(r))return r}}setProperty(e,t,s){const r=this.featureCount;if(this._checkBatchId(e),Lt(typeof t=="string",t),this._binaryProperties){const o=this._binaryProperties[t];if(o){this._setBinaryProperty(o,e,s);return}}if(this._hierarchy&&this._setHierarchyProperty(this,e,t,s))return;let i=this._properties[t];fn(i)||(this._properties[t]=new Array(r),i=this._properties[t]),i[e]=If(s)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,t){return e.unpack(e.typedArray,t)}_setBinaryProperty(e,t,s){e.pack(s,e.typedArray,t)}_initializeBinaryProperties(){let e=null;for(const t in this._properties){const s=this._properties[t],r=this._initializeBinaryProperty(t,s);r&&(e=e||{},e[t]=r)}return e}_initializeBinaryProperty(e,t){if("byteOffset"in t){const s=t;Lt(this.binary,`Property ${e} requires a batch table binary.`),Lt(s.type,`Property ${e} requires a type.`);const r=LJ(s,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:r.values,componentCount:r.size,unpack:r.unpacker,pack:r.packer}}return null}_hasPropertyInHierarchy(e,t){if(!this._hierarchy)return!1;const s=Vc(this._hierarchy,e,(r,i)=>{const o=r.classIds[i],l=r.classes[o].instances;return fn(l[t])});return fn(s)}_getPropertyNamesInHierarchy(e,t){Vc(this._hierarchy,e,(s,r)=>{const i=s.classIds[r],o=s.classes[i].instances;for(const l in o)o.hasOwnProperty(l)&&t.indexOf(l)===-1&&t.push(l)})}_getHierarchyProperty(e,t){return Vc(this._hierarchy,e,(s,r)=>{const i=s.classIds[r],o=s.classes[i],l=s.classIndexes[r],f=o.instances[t];return fn(f)?fn(f.typedArray)?this._getBinaryProperty(f,l):If(f[l]):null})}_setHierarchyProperty(e,t,s,r){const i=Vc(this._hierarchy,t,(o,l)=>{const f=o.classIds[l],h=o.classes[f],g=o.classIndexes[l],m=h.instances[s];return fn(m)?(Lt(l===t,`Inherited property "${s}" is read-only.`),fn(m.typedArray)?this._setBinaryProperty(m,g,r):m[g]=If(r),!0):!1});return fn(i)}}const Km=4;function cd(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const s=new DataView(e);if(n.magic=s.getUint32(t,!0),t+=Km,n.version=s.getUint32(t,!0),t+=Km,n.byteLength=s.getUint32(t,!0),t+=Km,n.version!==1)throw new Error(`3D Tile Version ${n.version} not supported`);return t}const $o=4,MB="b3dm tile in legacy format.";function Uy(n,e,t){const s=new DataView(e);let r;n.header=n.header||{};let i=s.getUint32(t,!0);t+=$o;let o=s.getUint32(t,!0);t+=$o;let l=s.getUint32(t,!0);t+=$o;let f=s.getUint32(t,!0);return t+=$o,l>=570425344?(t-=$o*2,r=i,l=o,f=0,i=0,o=0,console.warn(MB)):f>=570425344&&(t-=$o,r=l,l=i,f=o,i=0,o=0,console.warn(MB)),n.header.featureTableJsonByteLength=i,n.header.featureTableBinaryByteLength=o,n.header.batchTableJsonByteLength=l,n.header.batchTableBinaryByteLength=f,n.header.batchLength=r,t}function Ly(n,e,t,s){return t=$J(n,e,t),t=XJ(n,e,t),t}function $J(n,e,t,s){const{featureTableJsonByteLength:r,featureTableBinaryByteLength:i,batchLength:o}=n.header||{};if(n.featureTableJson={BATCH_LENGTH:o||0},r&&r>0){const l=dR(e,t,r);n.featureTableJson=JSON.parse(l)}return t+=r||0,n.featureTableBinary=new Uint8Array(e,t,i),t+=i||0,t}function XJ(n,e,t,s){const{batchTableJsonByteLength:r,batchTableBinaryByteLength:i}=n.header||{};if(r&&r>0){const o=dR(e,t,r);n.batchTableJson=JSON.parse(o),t+=r,i&&i>0&&(n.batchTableBinary=new Uint8Array(e,t,i),n.batchTableBinary=new Uint8Array(n.batchTableBinary),t+=i)}return t}function AR(n,e,t){if(!e&&(!n||!n.batchIds||!t))return null;const{batchIds:s,isRGB565:r,pointCount:i=0}=n;if(s&&t){const o=new Uint8ClampedArray(i*3);for(let l=0;l<i;l++){const f=s[l],g=t.getProperty(f,"dimensions").map(m=>m*255);o[l*3]=g[0],o[l*3+1]=g[1],o[l*3+2]=g[2]}return{type:Pe.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}if(e&&r){const o=new Uint8ClampedArray(i*3);for(let l=0;l<i;l++){const f=OJ(e[l]);o[l*3]=f[0],o[l*3+1]=f[1],o[l*3+2]=f[2]}return{type:Pe.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}return e&&e.length===i*3?{type:Pe.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:Pe.UNSIGNED_BYTE,value:e||new Uint8ClampedArray,size:4,normalized:!0}}const OB=new L;function JJ(n,e){if(!e)return null;if(n.isOctEncoded16P){const t=new Float32Array((n.pointsLength||0)*3);for(let s=0;s<(n.pointsLength||0);s++)NJ(e[s*2],e[s*2+1],OB),OB.toArray(t,s*3);return{type:Pe.FLOAT,size:2,value:t}}return{type:Pe.FLOAT,size:2,value:e}}function WJ(n,e,t){return n.isQuantized?t["3d-tiles"]&&t["3d-tiles"].decodeQuantizedPositions?(n.isQuantized=!1,YJ(n,e)):{type:Pe.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}function YJ(n,e){const t=new L,s=new Float32Array(n.pointCount*3);for(let r=0;r<n.pointCount;r++)t.set(e[r*3],e[r*3+1],e[r*3+2]).scale(1/n.quantizedRange).multiply(n.quantizedVolumeScale).add(n.quantizedVolumeOffset).toArray(s,r*3);return s}async function KJ(n,e,t,s,r){t=cd(n,e,t),t=Uy(n,e,t),t=Ly(n,e,t),qJ(n);const{featureTable:i,batchTable:o}=QJ(n);return await sW(n,i,o,s,r),ZJ(n,i,s),eW(n,i,o),tW(n,i),t}function qJ(n){n.attributes={positions:null,colors:null,normals:null,batchIds:null},n.isQuantized=!1,n.isTranslucent=!1,n.isRGB565=!1,n.isOctEncoded16P=!1}function QJ(n){const e=new Py(n.featureTableJson,n.featureTableBinary),t=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(t))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=t,n.featuresLength=t,n.pointsLength=t,n.pointCount=t,n.rtcCenter=e.getGlobalProperty("RTC_CENTER",Pe.FLOAT,3);const s=nW(n,e);return{featureTable:e,batchTable:s}}function ZJ(n,e,t){if(n.attributes=n.attributes||{positions:null,colors:null,normals:null,batchIds:null},!n.attributes.positions){if(e.hasProperty("POSITION"))n.attributes.positions=e.getPropertyArray("POSITION",Pe.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){const s=e.getPropertyArray("POSITION_QUANTIZED",Pe.UNSIGNED_SHORT,3);if(n.isQuantized=!0,n.quantizedRange=65535,n.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Pe.FLOAT,3),!n.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(n.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Pe.FLOAT,3),!n.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");n.attributes.positions=WJ(n,s,t)}}if(!n.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function eW(n,e,t){if(n.attributes=n.attributes||{positions:null,colors:null,normals:null,batchIds:null},!n.attributes.colors){let s=null;e.hasProperty("RGBA")?(s=e.getPropertyArray("RGBA",Pe.UNSIGNED_BYTE,4),n.isTranslucent=!0):e.hasProperty("RGB")?s=e.getPropertyArray("RGB",Pe.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(s=e.getPropertyArray("RGB565",Pe.UNSIGNED_SHORT,1),n.isRGB565=!0),n.attributes.colors=AR(n,s,t)}e.hasProperty("CONSTANT_RGBA")&&(n.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",Pe.UNSIGNED_BYTE,4))}function tW(n,e){if(n.attributes=n.attributes||{positions:null,colors:null,normals:null,batchIds:null},!n.attributes.normals){let t=null;e.hasProperty("NORMAL")?t=e.getPropertyArray("NORMAL",Pe.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(t=e.getPropertyArray("NORMAL_OCT16P",Pe.UNSIGNED_BYTE,2),n.isOctEncoded16P=!0),n.attributes.normals=JJ(n,t)}}function nW(n,e){let t=null;if(!n.batchIds&&e.hasProperty("BATCH_ID")&&(n.batchIds=e.getPropertyArray("BATCH_ID",Pe.UNSIGNED_SHORT,1),n.batchIds)){const s=e.getGlobalProperty("BATCH_LENGTH");if(!s)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:r,batchTableBinary:i}=n;t=new _R(r,i,s)}return t}async function sW(n,e,t,s,r){let i,o,l;const f=n.batchTableJson&&n.batchTableJson.extensions&&n.batchTableJson.extensions["3DTILES_draco_point_compression"];f&&(l=f.properties);const h=e.getExtension("3DTILES_draco_point_compression");if(h){o=h.properties;const m=h.byteOffset,A=h.byteLength;if(!o||!Number.isFinite(m)||!A)throw new Error("Draco properties, byteOffset, and byteLength must be defined");i=(n.featureTableBinary||[]).slice(m,m+A),n.hasPositions=Number.isFinite(o.POSITION),n.hasColors=Number.isFinite(o.RGB)||Number.isFinite(o.RGBA),n.hasNormals=Number.isFinite(o.NORMAL),n.hasBatchIds=Number.isFinite(o.BATCH_ID),n.isTranslucent=Number.isFinite(o.RGBA)}if(!i)return!0;const g={buffer:i,properties:{...o,...l},batchTableProperties:l};return await rW(n,g,s,r)}async function rW(n,e,t,s){if(!s)return;const r={...t,draco:{...t==null?void 0:t.draco,extraAttributes:e.batchTableProperties||{}}};delete r["3d-tiles"];const i=await Nl(e.buffer,pR,r,s),o=i.attributes.POSITION&&i.attributes.POSITION.value,l=i.attributes.COLOR_0&&i.attributes.COLOR_0.value,f=i.attributes.NORMAL&&i.attributes.NORMAL.value,h=i.attributes.BATCH_ID&&i.attributes.BATCH_ID.value,g=o&&i.attributes.POSITION.value.quantization,m=f&&i.attributes.NORMAL.value.quantization;if(g){const y=i.POSITION.data.quantization,E=y.range;n.quantizedVolumeScale=new L(E,E,E),n.quantizedVolumeOffset=new L(y.minValues),n.quantizedRange=(1<<y.quantizationBits)-1,n.isQuantizedDraco=!0}m&&(n.octEncodedRange=(1<<i.NORMAL.data.quantization.quantizationBits)-1,n.isOctEncodedDraco=!0);const A={};if(e.batchTableProperties)for(const y of Object.keys(e.batchTableProperties))i.attributes[y]&&i.attributes[y].value&&(A[y.toLowerCase()]=i.attributes[y].value);n.attributes={positions:o,colors:AR(n,l,void 0),normals:f,batchIds:h,...A}}const iW=typeof __VERSION__<"u"?__VERSION__:"latest";var qm;const oW=(qm=globalThis.loaders)===null||qm===void 0?void 0:qm.parseImageNode,uA=typeof Image<"u",fA=typeof ImageBitmap<"u",aW=!!oW,hA=fR?!0:aW;function cW(n){switch(n){case"auto":return fA||uA||hA;case"imagebitmap":return fA;case"image":return uA;case"data":return hA;default:throw new Error(`@loaders.gl/images: image ${n} not supported in this environment`)}}function lW(){if(fA)return"imagebitmap";if(uA)return"image";if(hA)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function uW(n){const e=fW(n);if(!e)throw new Error("Not an image");return e}function yR(n){switch(uW(n)){case"data":return n;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=n.width,e.height=n.height,t.drawImage(n,0,0),t.getImageData(0,0,n.width,n.height);default:throw new Error("getImageData")}}function fW(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&n instanceof Image?"image":n&&typeof n=="object"&&n.data&&n.width&&n.height?"data":null}const hW=/^data:image\/svg\+xml/,dW=/\.svg((\?|#).*)?$/;function ky(n){return n&&(hW.test(n)||dW.test(n))}function gW(n,e){if(ky(e)){let s=new TextDecoder().decode(n);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(s=unescape(encodeURIComponent(s)))}catch(i){throw new Error(i.message)}return`data:image/svg+xml;base64,${btoa(s)}`}return bR(n,e)}function bR(n,e){if(ky(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(n)])}async function TR(n,e,t){const s=gW(n,t),r=self.URL||self.webkitURL,i=typeof s!="string"&&r.createObjectURL(s);try{return await pW(i||s,e)}finally{i&&r.revokeObjectURL(i)}}async function pW(n,e){const t=new Image;return t.src=n,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((s,r)=>{try{t.onload=()=>s(t),t.onerror=i=>{const o=i instanceof Error?i.message:"error";r(new Error(o))}}catch(i){r(i)}})}const mW={};let DB=!0;async function _W(n,e,t){let s;ky(t)?s=await TR(n,e,t):s=bR(n,t);const r=e&&e.imagebitmap;return await AW(s,r)}async function AW(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((yW(e)||!DB)&&(e=null),e)try{return await createImageBitmap(n,e)}catch(t){console.warn(t),DB=!1}return await createImageBitmap(n)}function yW(n){for(const e in n||mW)return!1;return!0}function bW(n){return!vW(n,"ftyp",4)||(n[8]&96)===0?null:TW(n)}function TW(n){switch(EW(n,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function EW(n,e,t){return String.fromCharCode(...n.slice(e,t))}function CW(n){return[...n].map(e=>e.charCodeAt(0))}function vW(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const s=CW(e);for(let r=0;r<s.length;++r)if(s[r]!==n[r+t])return!1;return!0}const Hs=!1,fl=!0;function Hy(n){const e=Pl(n);return SW(e)||xW(e)||wW(e)||RW(e)||BW(e)}function BW(n){const e=new Uint8Array(n instanceof DataView?n.buffer:n),t=bW(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function SW(n){const e=Pl(n);return e.byteLength>=24&&e.getUint32(0,Hs)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Hs),height:e.getUint32(20,Hs)}:null}function wW(n){const e=Pl(n);return e.byteLength>=10&&e.getUint32(0,Hs)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,fl),height:e.getUint16(8,fl)}:null}function RW(n){const e=Pl(n);return e.byteLength>=14&&e.getUint16(0,Hs)===16973&&e.getUint32(2,fl)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,fl),height:e.getUint32(22,fl)}:null}function xW(n){const e=Pl(n);if(!(e.byteLength>=3&&e.getUint16(0,Hs)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:s,sofMarkers:r}=IW();let i=2;for(;i+9<e.byteLength;){const o=e.getUint16(i,Hs);if(r.has(o))return{mimeType:"image/jpeg",height:e.getUint16(i+5,Hs),width:e.getUint16(i+7,Hs)};if(!s.has(o))return null;i+=2,i+=e.getUint16(i,Hs)}return null}function IW(){const n=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)n.add(t);return{tableMarkers:n,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Pl(n){if(n instanceof DataView)return n;if(ArrayBuffer.isView(n))return new DataView(n.buffer);if(n instanceof ArrayBuffer)return new DataView(n);throw new Error("toDataView")}async function MW(n,e){var t;const{mimeType:s}=Hy(n)||{},r=(t=globalThis.loaders)===null||t===void 0?void 0:t.parseImageNode;return Lt(r),await r(n,s)}async function OW(n,e,t){e=e||{};const r=(e.image||{}).type||"auto",{url:i}=t||{},o=DW(r);let l;switch(o){case"imagebitmap":l=await _W(n,e,i);break;case"image":l=await TR(n,e,i);break;case"data":l=await MW(n);break;default:Lt(!1)}return r==="data"&&(l=yR(l)),l}function DW(n){switch(n){case"auto":case"data":return lW();default:return cW(n),n}}const NW=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],FW=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],PW={image:{type:"auto",decode:!0}},UW={id:"image",module:"images",name:"Images",version:iW,mimeTypes:FW,extensions:NW,parse:OW,tests:[n=>!!Hy(new DataView(n))],options:PW},Qm={};function LW(n){if(Qm[n]===void 0){const e=fR?HW(n):kW(n);Qm[n]=e}return Qm[n]}function kW(n){var e,t;const s=["image/png","image/jpeg","image/gif"],r=((e=globalThis.loaders)===null||e===void 0?void 0:e.imageFormatsNode)||s;return!!((t=globalThis.loaders)===null||t===void 0?void 0:t.parseImageNode)&&r.includes(n)}function HW(n){switch(n){case"image/avif":case"image/webp":return GW(n);default:return!0}}function GW(n){try{return document.createElement("canvas").toDataURL(n).indexOf(`data:${n}`)===0}catch{return!1}}function Pn(n,e){if(!n)throw new Error(e||"assert failed: gltf")}const ER={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},CR={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},VW=1.33,NB=["SCALAR","VEC2","VEC3","VEC4"],jW=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],zW=new Map(jW),$W={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},XW={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},JW={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function vR(n){return NB[n-1]||NB[0]}function Gy(n){const e=zW.get(n.constructor);if(!e)throw new Error("Illegal typed array");return e}function Vy(n,e){const t=JW[n.componentType],s=$W[n.type],r=XW[n.componentType],i=n.count*s,o=n.count*s*r;Pn(o>=0&&o<=e.byteLength);const l=CR[n.componentType],f=ER[n.type];return{ArrayType:t,length:i,byteLength:o,componentByteSize:l,numberOfComponentsInElement:f}}function BR(n){let{images:e,bufferViews:t}=n;e=e||[],t=t||[];const s=e.map(o=>o.bufferView);t=t.filter(o=>!s.includes(o));const r=t.reduce((o,l)=>o+l.byteLength,0),i=e.reduce((o,l)=>{const{width:f,height:h}=l.image;return o+f*h},0);return r+Math.ceil(4*i*VW)}function WW(n,e,t){const s=n.bufferViews[t];Pn(s);const r=s.buffer,i=e[r];Pn(i);const o=(s.byteOffset||0)+i.byteOffset;return new Uint8Array(i.arrayBuffer,o,s.byteLength)}function YW(n,e,t){var s,r;const i=typeof t=="number"?(s=n.accessors)===null||s===void 0?void 0:s[t]:t;if(!i)throw new Error(`No gltf accessor ${JSON.stringify(t)}`);const o=(r=n.bufferViews)===null||r===void 0?void 0:r[i.bufferView||0];if(!o)throw new Error(`No gltf buffer view for accessor ${o}`);const{arrayBuffer:l,byteOffset:f}=e[o.buffer],h=(f||0)+(i.byteOffset||0)+(o.byteOffset||0),{ArrayType:g,length:m,componentByteSize:A,numberOfComponentsInElement:y}=Vy(i,o),E=A*y,v=o.byteStride||E;if(typeof o.byteStride>"u"||o.byteStride===E)return new g(l,h,m);const S=new g(m);for(let x=0;x<i.count;x++){const O=new g(l,h+x*v,y);S.set(O,x*y)}return S}function KW(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}class en{constructor(e){this.gltf=void 0,this.sourceBuffers=void 0,this.byteLength=void 0,this.gltf={json:(e==null?void 0:e.json)||KW(),buffers:(e==null?void 0:e.buffers)||[],images:(e==null?void 0:e.images)||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){const t=this.getUsedExtensions().find(r=>r===e),s=this.getRequiredExtensions().find(r=>r===e);return typeof t=="string"||typeof s=="string"}getExtension(e){const t=this.getUsedExtensions().find(r=>r===e),s=this.json.extensions||{};return t?s[e]:null}getRequiredExtension(e){return this.getRequiredExtensions().find(s=>s===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,t){return(e.extensions||{})[t]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,t){if(typeof t=="object")return t;const s=this.json[e]&&this.json[e][t];if(!s)throw new Error(`glTF file error: Could not find ${e}[${t}]`);return s}getTypedArrayForBufferView(e){e=this.getBufferView(e);const t=e.buffer,s=this.gltf.buffers[t];Pn(s);const r=(e.byteOffset||0)+s.byteOffset;return new Uint8Array(s.arrayBuffer,r,e.byteLength)}getTypedArrayForAccessor(e){const t=this.getAccessor(e);return YW(this.gltf.json,this.gltf.buffers,t)}getTypedArrayForImageData(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),r=this.getBuffer(t.buffer).data,i=t.byteOffset||0;return new Uint8Array(r,i,t.byteLength)}addApplicationData(e,t){return this.json[e]=t,this}addExtraData(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}addObjectExtension(e,t,s){return e.extensions=e.extensions||{},e.extensions[t]=s,this.registerUsedExtension(t),this}setObjectExtension(e,t,s){const r=e.extensions||{};r[t]=s}removeObjectExtension(e,t){const s=(e==null?void 0:e.extensions)||{};if(s[t]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const r=this.json.extensionsRemoved;r.includes(t)||r.push(t)}delete s[t]}addExtension(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Pn(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}addRequiredExtension(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Pn(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(t=>t===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(t=>t===e)||this.json.extensionsRequired.push(e)}removeExtension(e){var t;if((t=this.json.extensions)!==null&&t!==void 0&&t[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const s=this.json.extensionsRemoved;s.includes(e)||s.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:t}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:t}),this.json.scenes.length-1}addNode(e){const{meshIndex:t,matrix:s}=e;this.json.nodes=this.json.nodes||[];const r={mesh:t};return s&&(r.matrix=s),this.json.nodes.push(r),this.json.nodes.length-1}addMesh(e){const{attributes:t,indices:s,material:r,mode:i=4}=e,l={primitives:[{attributes:this._addAttributes(t),mode:i}]};if(s){const f=this._addIndices(s);l.primitives[0].indices=f}return Number.isFinite(r)&&(l.primitives[0].material=r),this.json.meshes=this.json.meshes||[],this.json.meshes.push(l),this.json.meshes.length-1}addPointCloud(e){const s={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(s),this.json.meshes.length-1}addImage(e,t){const s=Hy(e),r=t||(s==null?void 0:s.mimeType),o={bufferView:this.addBufferView(e),mimeType:r};return this.json.images=this.json.images||[],this.json.images.push(o),this.json.images.length-1}addBufferView(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.byteLength;const r=e.byteLength;Pn(Number.isFinite(r)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const i={buffer:t,byteOffset:s,byteLength:r};return this.byteLength+=Fl(r,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(i),this.json.bufferViews.length-1}addAccessor(e,t){const s={bufferView:e,type:vR(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(s),this.json.accessors.length-1}addBinaryBuffer(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{size:3};const s=this.addBufferView(e);let r={min:t.min,max:t.max};(!r.min||!r.max)&&(r=this._getAccessorMinMax(e,t.size));const i={size:t.size,componentType:Gy(e),count:Math.round(e.length/t.size),min:r.min,max:r.max};return this.addAccessor(s,Object.assign(i,t))}addTexture(e){const{imageIndex:t}=e,s={source:t};return this.json.textures=this.json.textures||[],this.json.textures.push(s),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var e,t;this.gltf.buffers=[];const s=this.byteLength,r=new ArrayBuffer(s),i=new Uint8Array(r);let o=0;for(const l of this.sourceBuffers||[])o=X7(l,i,o);(e=this.json)!==null&&e!==void 0&&(t=e.buffers)!==null&&t!==void 0&&t[0]?this.json.buffers[0].byteLength=s:this.json.buffers=[{byteLength:s}],this.gltf.binary=r,this.sourceBuffers=[r]}_removeStringFromArray(e,t){let s=!0;for(;s;){const r=e.indexOf(t);r>-1?e.splice(r,1):s=!1}}_addAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t={};for(const s in e){const r=e[s],i=this._getGltfAttributeName(s),o=this.addBinaryBuffer(r.value,r);t[i]=o}return t}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,t){const s={min:null,max:null};if(e.length<t)return s;s.min=[],s.max=[];const r=e.subarray(0,t);for(const i of r)s.min.push(i),s.max.push(i);for(let i=t;i<e.length;i+=t)for(let o=0;o<t;o++)s.min[0+o]=Math.min(s.min[0+o],e[i+o]),s.max[0+o]=Math.max(s.max[0+o],e[i+o]);return s}}const SR={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},qW={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},wR={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function jy(n,e){return wR[e]*SR[n]}function ld(n,e,t,s){if(t!=="UINT8"&&t!=="UINT16"&&t!=="UINT32"&&t!=="UINT64")return null;const r=n.getTypedArrayForBufferView(e),i=ud(r,"SCALAR",t,s+1);return i instanceof BigInt64Array||i instanceof BigUint64Array?null:i}function ud(n,e,t){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;const r=SR[e],i=qW[t],o=wR[t],l=s*r,f=l*o;let h=n.buffer,g=n.byteOffset;return g%o!==0&&(h=new Uint8Array(h).slice(g,g+f).buffer,g=0),new i(h,g,l)}function zy(n,e,t){var s,r;const i=`TEXCOORD_${e.texCoord||0}`,o=t.attributes[i],l=n.getTypedArrayForAccessor(o),f=n.gltf.json,h=e.index,g=(s=f.textures)===null||s===void 0||(r=s[h])===null||r===void 0?void 0:r.source;if(typeof g<"u"){var m,A,y;const E=(m=f.images)===null||m===void 0||(A=m[g])===null||A===void 0?void 0:A.mimeType,v=(y=n.gltf.images)===null||y===void 0?void 0:y[g];if(v&&typeof v.width<"u"){const S=[];for(let x=0;x<l.length;x+=2){const O=QW(v,E,l,x,e.channels);S.push(O)}return S}}return[]}function RR(n,e,t,s,r){if(!(t!=null&&t.length))return;const i=[];for(const g of t){let m=s.findIndex(A=>A===g);m===-1&&(m=s.push(g)-1),i.push(m)}const o=new Uint32Array(i),l=n.gltf.buffers.push({arrayBuffer:o.buffer,byteOffset:o.byteOffset,byteLength:o.byteLength})-1,f=n.addBufferView(o,l,0),h=n.addAccessor(f,{size:1,componentType:Gy(o),count:o.length});r.attributes[e]=h}function QW(n,e,t,s){let r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:[0];const i={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},o=t[s],l=t[s+1];let f=1;e&&(e.indexOf("image/jpeg")!==-1||e.indexOf("image/png")!==-1)&&(f=4);const h=ZW(o,l,n,f);let g=0;for(const m of r){const A=typeof m=="number"?Object.values(i)[m]:i[m],y=h+A.offset,E=yR(n);if(E.data.length<=y)throw new Error(`${E.data.length} <= ${y}`);const v=E.data[y];g|=v<<A.shift}return g}function ZW(n,e,t){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;const r=t.width,i=IB(n)*(r-1),o=Math.round(i),l=t.height,f=IB(e)*(l-1),h=Math.round(f),g=t.components?t.components:s;return(h*r+o)*g}function xR(n,e,t,s,r){const i=[];for(let o=0;o<e;o++){const l=t[o],f=t[o+1]-t[o];if(f+l>s)break;const h=l/r,g=f/r;i.push(n.slice(h,h+g))}return i}function IR(n,e,t){const s=[];for(let r=0;r<e;r++){const i=r*t;s.push(n.slice(i,i+t))}return s}function MR(n,e,t,s){if(t)throw new Error("Not implemented - arrayOffsets for strings is specified");if(s){const r=[],i=new TextDecoder("utf8");let o=0;for(let l=0;l<n;l++){const f=s[l+1]-s[l];if(f+o<=e.length){const h=e.subarray(o,f+o),g=i.decode(h);r.push(g),o+=f}}return r}return[]}const OR="EXT_mesh_features",eY=OR;async function tY(n,e){const t=new en(n);nY(t,e)}function nY(n,e){const t=n.gltf.json;if(t.meshes)for(const s of t.meshes)for(const r of s.primitives)sY(n,r,e)}function sY(n,e,t){var s,r;if(!(t!=null&&(s=t.gltf)!==null&&s!==void 0&&s.loadBuffers))return;const i=(r=e.extensions)===null||r===void 0?void 0:r[OR],o=i==null?void 0:i.featureIds;if(o)for(const f of o){var l;let h;if(typeof f.attribute<"u"){const g=`_FEATURE_ID_${f.attribute}`,m=e.attributes[g];h=n.getTypedArrayForAccessor(m)}else typeof f.texture<"u"&&t!==null&&t!==void 0&&(l=t.gltf)!==null&&l!==void 0&&l.loadImages?h=zy(n,f.texture,e):h=[];f.data=h}}const rY=Object.freeze(Object.defineProperty({__proto__:null,decode:tY,name:eY},Symbol.toStringTag,{value:"Module"})),$y="EXT_structural_metadata",iY=$y;async function oY(n,e){const t=new en(n);aY(t,e)}function aY(n,e){var t,s;if(!((t=e.gltf)!==null&&t!==void 0&&t.loadBuffers))return;const r=n.getExtension($y);r&&((s=e.gltf)!==null&&s!==void 0&&s.loadImages&&cY(n,r),lY(n,r))}function cY(n,e){const t=e.propertyTextures,s=n.gltf.json;if(t&&s.meshes)for(const r of s.meshes)for(const i of r.primitives)fY(n,t,i,e)}function lY(n,e){const t=e.schema;if(!t)return;const s=t.classes,r=e.propertyTables;if(s&&r)for(const i in s){const o=uY(r,i);o&&dY(n,t,o)}}function uY(n,e){for(const t of n)if(t.class===e)return t;return null}function fY(n,e,t,s){var r;if(!e)return;const i=(r=t.extensions)===null||r===void 0?void 0:r[$y],o=i==null?void 0:i.propertyTextures;if(o)for(const l of o){const f=e[l];hY(n,f,t,s)}}function hY(n,e,t,s){if(!e.properties)return;s.dataAttributeNames||(s.dataAttributeNames=[]);const r=e.class;for(const o in e.properties){var i;const l=`${r}_${o}`,f=(i=e.properties)===null||i===void 0?void 0:i[o];if(!f)continue;f.data||(f.data=[]);const h=f.data,g=zy(n,f,t);g!==null&&(RR(n,l,g,h,t),f.data=h,s.dataAttributeNames.push(l))}}function dY(n,e,t){var s;const r=(s=e.classes)===null||s===void 0?void 0:s[t.class];if(!r)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${t.class}`);const i=t.count;for(const l in r.properties){var o;const f=r.properties[l],h=(o=t.properties)===null||o===void 0?void 0:o[l];if(h){const g=gY(n,e,f,i,h);h.data=g}}}function gY(n,e,t,s,r){let i=[];const o=r.values,l=n.getTypedArrayForBufferView(o),f=pY(n,t,r,s),h=mY(n,r,s);switch(t.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{i=_Y(t,s,l,f);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${t.type}`);case"STRING":{i=MR(s,l,f,h);break}case"ENUM":{i=AY(e,t,s,l,f);break}default:throw new Error(`Unknown classProperty type ${t.type}`)}return i}function pY(n,e,t,s){return e.array&&typeof e.count>"u"&&typeof t.arrayOffsets<"u"?ld(n,t.arrayOffsets,t.arrayOffsetType||"UINT32",s):null}function mY(n,e,t){return typeof e.stringOffsets<"u"?ld(n,e.stringOffsets,e.stringOffsetType||"UINT32",t):null}function _Y(n,e,t,s){const r=n.array,i=n.count,o=jy(n.type,n.componentType),l=t.byteLength/o;let f;return n.componentType?f=ud(t,n.type,n.componentType,l):f=t,r?s?xR(f,e,s,t.length,o):i?IR(f,e,i):[]:f}function AY(n,e,t,s,r){var i;const o=e.enumType;if(!o)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const l=(i=n.enums)===null||i===void 0?void 0:i[o];if(!l)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${o}`);const f=l.valueType||"UINT16",h=jy(e.type,f),g=s.byteLength/h;let m=ud(s,e.type,f,g);if(m||(m=s),e.array){if(r)return yY({valuesData:m,numberOfElements:t,arrayOffsets:r,valuesDataBytesLength:s.length,elementSize:h,enumEntry:l});const A=e.count;return A?bY(m,t,A,l):[]}return Xy(m,0,t,l)}function yY(n){const{valuesData:e,numberOfElements:t,arrayOffsets:s,valuesDataBytesLength:r,elementSize:i,enumEntry:o}=n,l=[];for(let f=0;f<t;f++){const h=s[f],g=s[f+1]-s[f];if(g+h>r)break;const m=h/i,A=g/i,y=Xy(e,m,A,o);l.push(y)}return l}function bY(n,e,t,s){const r=[];for(let i=0;i<e;i++){const o=t*i,l=Xy(n,o,t,s);r.push(l)}return r}function Xy(n,e,t,s){const r=[];for(let i=0;i<t;i++)if(n instanceof BigInt64Array||n instanceof BigUint64Array)r.push("");else{const o=n[e+i],l=TY(s,o);l?r.push(l.name):r.push("")}return r}function TY(n,e){for(const t of n.values)if(t.value===e)return t;return null}const EY=Object.freeze(Object.defineProperty({__proto__:null,decode:oY,name:iY},Symbol.toStringTag,{value:"Module"})),DR="EXT_feature_metadata",CY=DR;async function vY(n,e){const t=new en(n);BY(t,e)}function BY(n,e){var t,s;if(!((t=e.gltf)!==null&&t!==void 0&&t.loadBuffers))return;const r=n.getExtension(DR);r&&((s=e.gltf)!==null&&s!==void 0&&s.loadImages&&SY(n,r),wY(n,r))}function SY(n,e){const t=e.schema;if(!t)return;const s=t.classes,{featureTextures:r}=e;if(s&&r)for(const i in s){const o=s[i],l=xY(r,i);l&&MY(n,l,o)}}function wY(n,e){const t=e.schema;if(!t)return;const s=t.classes,r=e.featureTables;if(s&&r)for(const i in s){const o=RY(r,i);o&&IY(n,t,o)}}function RY(n,e){for(const t in n){const s=n[t];if(s.class===e)return s}return null}function xY(n,e){for(const t in n){const s=n[t];if(s.class===e)return s}return null}function IY(n,e,t){var s;if(!t.class)return;const r=(s=e.classes)===null||s===void 0?void 0:s[t.class];if(!r)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${t.class}`);const i=t.count;for(const l in r.properties){var o;const f=r.properties[l],h=(o=t.properties)===null||o===void 0?void 0:o[l];if(h){const g=OY(n,e,f,i,h);h.data=g}}}function MY(n,e,t){const s=e.class;for(const i in t.properties){var r;const o=e==null||(r=e.properties)===null||r===void 0?void 0:r[i];if(o){const l=UY(n,o,s);o.data=l}}}function OY(n,e,t,s,r){let i=[];const o=r.bufferView,l=n.getTypedArrayForBufferView(o),f=DY(n,t,r,s),h=NY(n,t,r,s);return t.type==="STRING"||t.componentType==="STRING"?i=MR(s,l,f,h):FY(t)&&(i=PY(t,s,l,f)),i}function DY(n,e,t,s){return e.type==="ARRAY"&&typeof e.componentCount>"u"&&typeof t.arrayOffsetBufferView<"u"?ld(n,t.arrayOffsetBufferView,t.offsetType||"UINT32",s):null}function NY(n,e,t,s){return typeof t.stringOffsetBufferView<"u"?ld(n,t.stringOffsetBufferView,t.offsetType||"UINT32",s):null}function FY(n){const e=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return e.includes(n.type)||typeof n.componentType<"u"&&e.includes(n.componentType)}function PY(n,e,t,s){const r=n.type==="ARRAY",i=n.componentCount,o="SCALAR",l=n.componentType||n.type,f=jy(o,l),h=t.byteLength/f,g=ud(t,o,l,h);return r?s?xR(g,e,s,t.length,f):i?IR(g,e,i):[]:g}function UY(n,e,t){const s=n.gltf.json;if(!s.meshes)return[];const r=[];for(const i of s.meshes)for(const o of i.primitives)LY(n,t,e,r,o);return r}function LY(n,e,t,s,r){const i={channels:t.channels,...t.texture},o=zy(n,i,r);o&&RR(n,e,o,s,r)}const kY=Object.freeze(Object.defineProperty({__proto__:null,decode:vY,name:CY},Symbol.toStringTag,{value:"Module"})),HY=typeof __VERSION__<"u"?__VERSION__:"latest",GY=typeof __VERSION__<"u"?__VERSION__:"latest",Sh={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let Zm;async function FB(n){const e=n.modules||{};return e.basis?e.basis:(Zm=Zm||VY(n),await Zm)}async function VY(n){let e=null,t=null;return[e,t]=await Promise.all([await Bh(Sh.TRANSCODER,"textures",n),await Bh(Sh.TRANSCODER_WASM,"textures",n)]),e=e||globalThis.BASIS,await jY(e,t)}function jY(n,e){const t={};return e&&(t.wasmBinary=e),new Promise(s=>{n(t).then(r=>{const{BasisFile:i,initializeBasis:o}=r;o(),s({BasisFile:i})})})}let e_;async function PB(n){const e=n.modules||{};return e.basisEncoder?e.basisEncoder:(e_=e_||zY(n),await e_)}async function zY(n){let e=null,t=null;return[e,t]=await Promise.all([await Bh(Sh.ENCODER,"textures",n),await Bh(Sh.ENCODER_WASM,"textures",n)]),e=e||globalThis.BASIS,await $Y(e,t)}function $Y(n,e){const t={};return e&&(t.wasmBinary=e),new Promise(s=>{n(t).then(r=>{const{BasisFile:i,KTX2File:o,initializeBasis:l,BasisEncoder:f}=r;l(),s({BasisFile:i,KTX2File:o,BasisEncoder:f})})})}const Xo={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_ASTC_4X4_KHR:37808},XY=["","WEBKIT_","MOZ_"],UB={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let Mf=null;function JY(n){if(!Mf){n=n||WY()||void 0,Mf=new Set;for(const e of XY)for(const t in UB)if(n&&n.getExtension(`${e}${t}`)){const s=UB[t];Mf.add(s)}}return Mf}function WY(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}var LB,kB,HB,GB,VB,jB,zB,$B;(function(n){n[n.NONE=0]="NONE",n[n.BASISLZ=1]="BASISLZ",n[n.ZSTD=2]="ZSTD",n[n.ZLIB=3]="ZLIB"})(LB||(LB={})),function(n){n[n.BASICFORMAT=0]="BASICFORMAT"}(kB||(kB={})),function(n){n[n.UNSPECIFIED=0]="UNSPECIFIED",n[n.ETC1S=163]="ETC1S",n[n.UASTC=166]="UASTC"}(HB||(HB={})),function(n){n[n.UNSPECIFIED=0]="UNSPECIFIED",n[n.SRGB=1]="SRGB"}(GB||(GB={})),function(n){n[n.UNSPECIFIED=0]="UNSPECIFIED",n[n.LINEAR=1]="LINEAR",n[n.SRGB=2]="SRGB",n[n.ITU=3]="ITU",n[n.NTSC=4]="NTSC",n[n.SLOG=5]="SLOG",n[n.SLOG2=6]="SLOG2"}(VB||(VB={})),function(n){n[n.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",n[n.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(jB||(jB={})),function(n){n[n.RGB=0]="RGB",n[n.RRR=3]="RRR",n[n.GGG=4]="GGG",n[n.AAA=15]="AAA"}(zB||(zB={})),function(n){n[n.RGB=0]="RGB",n[n.RGBA=3]="RGBA",n[n.RRR=4]="RRR",n[n.RRRG=5]="RRRG"}($B||($B={}));const Mn=[171,75,84,88,32,50,48,187,13,10,26,10];function YY(n){const e=new Uint8Array(n);return!(e.byteLength<Mn.length||e[0]!==Mn[0]||e[1]!==Mn[1]||e[2]!==Mn[2]||e[3]!==Mn[3]||e[4]!==Mn[4]||e[5]!==Mn[5]||e[6]!==Mn[6]||e[7]!==Mn[7]||e[8]!==Mn[8]||e[9]!==Mn[9]||e[10]!==Mn[10]||e[11]!==Mn[11])}const KY={etc1:{basisFormat:0,compressed:!0,format:Xo.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:Xo.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:Xo.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:Xo.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:Xo.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:Xo.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function qY(n,e){if(e.basis.containerFormat==="auto"){if(YY(n)){const s=await PB(e);return XB(s.KTX2File,n,e)}const{BasisFile:t}=await FB(e);return t_(t,n,e)}switch(e.basis.module){case"encoder":const t=await PB(e);switch(e.basis.containerFormat){case"ktx2":return XB(t.KTX2File,n,e);case"basis":default:return t_(t.BasisFile,n,e)}case"transcoder":default:const{BasisFile:s}=await FB(e);return t_(s,n,e)}}function t_(n,e,t){const s=new n(new Uint8Array(e));try{if(!s.startTranscoding())throw new Error("Failed to start basis transcoding");const r=s.getNumImages(),i=[];for(let o=0;o<r;o++){const l=s.getNumLevels(o),f=[];for(let h=0;h<l;h++)f.push(QY(s,o,h,t));i.push(f)}return i}finally{s.close(),s.delete()}}function QY(n,e,t,s){const r=n.getImageWidth(e,t),i=n.getImageHeight(e,t),o=n.getHasAlpha(),{compressed:l,format:f,basisFormat:h}=NR(s,o),g=n.getImageTranscodedSizeInBytes(e,t,h),m=new Uint8Array(g);if(!n.transcodeImage(m,e,t,h,0,0))throw new Error("failed to start Basis transcoding");return{width:r,height:i,data:m,compressed:l,format:f,hasAlpha:o}}function XB(n,e,t){const s=new n(new Uint8Array(e));try{if(!s.startTranscoding())throw new Error("failed to start KTX2 transcoding");const r=s.getLevels(),i=[];for(let o=0;o<r;o++){i.push(ZY(s,o,t));break}return[i]}finally{s.close(),s.delete()}}function ZY(n,e,t){const{alphaFlag:s,height:r,width:i}=n.getImageLevelInfo(e,0,0),{compressed:o,format:l,basisFormat:f}=NR(t,s),h=n.getImageTranscodedSizeInBytes(e,0,0,f),g=new Uint8Array(h);if(!n.transcodeImage(g,e,0,0,f,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:i,height:r,data:g,compressed:o,levelSize:h,hasAlpha:s,format:l}}function NR(n,e){let t=n&&n.basis&&n.basis.format;return t==="auto"&&(t=FR()),typeof t=="object"&&(t=e?t.alpha:t.noAlpha),t=t.toLowerCase(),KY[t]}function FR(){const n=JY();return n.has("astc")?"astc-4x4":n.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:n.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:n.has("etc1")?"etc1":n.has("etc2")?"etc2":"rgb565"}const eK={name:"Basis",id:"basis",module:"textures",version:GY,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},tK={...eK,parse:qY},Ca=!0,JB=1735152710,Jy=12,wh=8,nK=1313821514,sK=5130562,rK=0,iK=0,oK=1;function aK(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return`${String.fromCharCode(n.getUint8(e+0))}${String.fromCharCode(n.getUint8(e+1))}${String.fromCharCode(n.getUint8(e+2))}${String.fromCharCode(n.getUint8(e+3))}`}function cK(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=new DataView(n),{magic:r=JB}=t,i=s.getUint32(e,!1);return i===r||i===JB}function lK(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const s=new DataView(e),r=aK(s,t+0),i=s.getUint32(t+4,Ca),o=s.getUint32(t+8,Ca);switch(Object.assign(n,{header:{byteOffset:t,byteLength:o,hasBinChunk:!1},type:r,version:i,json:{},binChunks:[]}),t+=Jy,n.version){case 1:return uK(n,s,t);case 2:return fK(n,s,t,{});default:throw new Error(`Invalid GLB version ${n.version}. Only supports version 1 and 2.`)}}function uK(n,e,t){Lt(n.header.byteLength>Jy+wh);const s=e.getUint32(t+0,Ca),r=e.getUint32(t+4,Ca);return t+=wh,Lt(r===rK),dA(n,e,t,s),t+=s,t+=gA(n,e,t,n.header.byteLength),t}function fK(n,e,t,s){return Lt(n.header.byteLength>Jy+wh),hK(n,e,t,s),t+n.header.byteLength}function hK(n,e,t,s){for(;t+8<=n.header.byteLength;){const r=e.getUint32(t+0,Ca),i=e.getUint32(t+4,Ca);switch(t+=wh,i){case nK:dA(n,e,t,r);break;case sK:gA(n,e,t,r);break;case iK:s.strict||dA(n,e,t,r);break;case oK:s.strict||gA(n,e,t,r);break}t+=Fl(r,4)}return t}function dA(n,e,t,s){const r=new Uint8Array(e.buffer,t,s),o=new TextDecoder("utf8").decode(r);return n.json=JSON.parse(o),Fl(s,4)}function gA(n,e,t,s){return n.header.hasBinChunk=!0,n.binChunks.push({byteOffset:t,byteLength:s,arrayBuffer:e.buffer}),Fl(s,4)}function PR(n,e){if(n.startsWith("data:")||n.startsWith("http:")||n.startsWith("https:"))return n;const s=e.baseUri||e.uri;if(!s)throw new Error(`'baseUri' must be provided to resolve relative url ${n}`);return s.substr(0,s.lastIndexOf("/")+1)+n}const dK="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",gK="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",pK=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),mK=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),_K={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},AK={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function yK(n,e,t,s,r){let i=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"NONE";const o=await bK();CK(o,o.exports[AK[r]],n,e,t,s,o.exports[_K[i||"NONE"]])}let n_;async function bK(){return n_||(n_=TK()),n_}async function TK(){let n=dK;WebAssembly.validate(pK)&&(n=gK,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(EK(n),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function EK(n){const e=new Uint8Array(n.length);for(let s=0;s<n.length;++s){const r=n.charCodeAt(s);e[s]=r>96?r-71:r>64?r-65:r>47?r+4:r>46?63:62}let t=0;for(let s=0;s<n.length;++s)e[t++]=e[s]<60?mK[e[s]]:(e[s]-60)*64+e[++s];return e.buffer.slice(0,t)}function CK(n,e,t,s,r,i,o){const l=n.exports.sbrk,f=s+3&-4,h=l(f*r),g=l(i.length),m=new Uint8Array(n.exports.memory.buffer);m.set(i,g);const A=e(h,s,r,g,i.length);if(A===0&&o&&o(h,f,r),t.set(m.subarray(h,h+s*r)),l(h-l(0)),A!==0)throw new Error(`Malformed buffer data: ${A}`)}const Rh="EXT_meshopt_compression",vK=Rh;async function BK(n,e){var t,s;const r=new en(n);if(!(e!=null&&(t=e.gltf)!==null&&t!==void 0&&t.decompressMeshes)||!((s=e.gltf)!==null&&s!==void 0&&s.loadBuffers))return;const i=[];for(const o of n.json.bufferViews||[])i.push(SK(r,o));await Promise.all(i),r.removeExtension(Rh)}async function SK(n,e){const t=n.getObjectExtension(e,Rh);if(t){const{byteOffset:s=0,byteLength:r=0,byteStride:i,count:o,mode:l,filter:f="NONE",buffer:h}=t,g=n.gltf.buffers[h],m=new Uint8Array(g.arrayBuffer,g.byteOffset+s,r),A=new Uint8Array(n.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);await yK(A,o,i,m,l,f),n.removeObjectExtension(e,Rh)}}const wK=Object.freeze(Object.defineProperty({__proto__:null,decode:BK,name:vK},Symbol.toStringTag,{value:"Module"})),Yo="EXT_texture_webp",RK=Yo;function xK(n,e){const t=new en(n);if(!LW("image/webp")){if(t.getRequiredExtensions().includes(Yo))throw new Error(`gltf: Required extension ${Yo} not supported by browser`);return}const{json:s}=t;for(const r of s.textures||[]){const i=t.getObjectExtension(r,Yo);i&&(r.source=i.source),t.removeObjectExtension(r,Yo)}t.removeExtension(Yo)}const IK=Object.freeze(Object.defineProperty({__proto__:null,name:RK,preprocess:xK},Symbol.toStringTag,{value:"Module"})),Wf="KHR_texture_basisu",MK=Wf;function OK(n,e){const t=new en(n),{json:s}=t;for(const r of s.textures||[]){const i=t.getObjectExtension(r,Wf);i&&(r.source=i.source,t.removeObjectExtension(r,Wf))}t.removeExtension(Wf)}const DK=Object.freeze(Object.defineProperty({__proto__:null,name:MK,preprocess:OK},Symbol.toStringTag,{value:"Module"}));function NK(n){const e={};for(const t in n){const s=n[t];if(t!=="indices"){const r=UR(s);e[t]=r}}return e}function UR(n){const{buffer:e,size:t,count:s}=FK(n);return{value:e,size:t,byteOffset:0,count:s,type:vR(t),componentType:Gy(e)}}function FK(n){let e=n,t=1,s=0;return n&&n.value&&(e=n.value,t=n.size||1),e&&(ArrayBuffer.isView(e)||(e=PK(e,Float32Array)),s=e.length/t),{buffer:e,size:t,count:s}}function PK(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return n?Array.isArray(n)?new e(n):t&&!(n instanceof e)?new e(n):n:null}const oi="KHR_draco_mesh_compression",UK=oi;function LK(n,e,t){const s=new en(n);for(const r of LR(s))s.getObjectExtension(r,oi)}async function kK(n,e,t){var s;if(!(e!=null&&(s=e.gltf)!==null&&s!==void 0&&s.decompressMeshes))return;const r=new en(n),i=[];for(const o of LR(r))r.getObjectExtension(o,oi)&&i.push(GK(r,o,e,t));await Promise.all(i),r.removeExtension(oi)}function HK(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=new en(n);for(const s of t.json.meshes||[])VK(s,e),t.addRequiredExtension(oi)}async function GK(n,e,t,s){const r=n.getObjectExtension(e,oi);if(!r)return;const i=n.getTypedArrayForBufferView(r.bufferView),o=Dy(i.buffer,i.byteOffset),l={...t};delete l["3d-tiles"];const f=await Nl(o,pR,l,s),h=NK(f.attributes);for(const[g,m]of Object.entries(h))if(g in e.attributes){const A=e.attributes[g],y=n.getAccessor(A);y!=null&&y.min&&y!==null&&y!==void 0&&y.max&&(m.min=y.min,m.max=y.max)}e.attributes=h,f.indices&&(e.indices=UR(f.indices)),n.removeObjectExtension(e,oi),jK(e)}function VK(n,e){var t;let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:4,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;if(!r.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const o=r.DracoWriter.encodeSync({attributes:n}),l=i==null||(t=i.parseSync)===null||t===void 0?void 0:t.call(i,{attributes:n}),f=r._addFauxAttributes(l.attributes),h=r.addBufferView(o);return{primitives:[{attributes:f,mode:s,extensions:{[oi]:{bufferView:h,attributes:f}}}]}}function jK(n){if(!n.attributes&&Object.keys(n.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*LR(n){for(const e of n.json.meshes||[])for(const t of e.primitives)yield t}const zK=Object.freeze(Object.defineProperty({__proto__:null,decode:kK,encode:HK,name:UK,preprocess:LK},Symbol.toStringTag,{value:"Module"})),Wy="KHR_texture_transform",$K=Wy,Of=new L,XK=new at,JK=new at;async function WK(n,e){var t;if(!new en(n).hasExtension(Wy)||!((t=e.gltf)!==null&&t!==void 0&&t.loadBuffers))return;const i=n.json.materials||[];for(let o=0;o<i.length;o++)YK(o,n)}function YK(n,e){var t,s,r;const i=[],o=(t=e.json.materials)===null||t===void 0?void 0:t[n],l=o==null||(s=o.pbrMetallicRoughness)===null||s===void 0?void 0:s.baseColorTexture;l&&jc(e,n,l,i);const f=o==null?void 0:o.emissiveTexture;f&&jc(e,n,f,i);const h=o==null?void 0:o.normalTexture;h&&jc(e,n,h,i);const g=o==null?void 0:o.occlusionTexture;g&&jc(e,n,g,i);const m=o==null||(r=o.pbrMetallicRoughness)===null||r===void 0?void 0:r.metallicRoughnessTexture;m&&jc(e,n,m,i)}function jc(n,e,t,s){const r=KK(t,s);if(!r)return;const i=n.json.meshes||[];for(const o of i)for(const l of o.primitives){const f=l.material;Number.isFinite(f)&&e===f&&qK(n,l,r)}}function KK(n,e){var t;const s=(t=n.extensions)===null||t===void 0?void 0:t[Wy],{texCoord:r=0}=n,{texCoord:i=r}=s;if(!(e.findIndex(l=>{let[f,h]=l;return f===r&&h===i})!==-1)){const l=eq(s);return r!==i&&(n.texCoord=i),e.push([r,i]),{originalTexCoord:r,texCoord:i,matrix:l}}return null}function qK(n,e,t){const{originalTexCoord:s,texCoord:r,matrix:i}=t,o=e.attributes[`TEXCOORD_${s}`];if(Number.isFinite(o)){var l;const h=(l=n.json.accessors)===null||l===void 0?void 0:l[o];if(h&&h.bufferView){var f;const g=(f=n.json.bufferViews)===null||f===void 0?void 0:f[h.bufferView];if(g){const{arrayBuffer:m,byteOffset:A}=n.buffers[g.buffer],y=(A||0)+(h.byteOffset||0)+(g.byteOffset||0),{ArrayType:E,length:v}=Vy(h,g),S=CR[h.componentType],x=ER[h.type],O=g.byteStride||S*x,R=new Float32Array(v);for(let D=0;D<h.count;D++){const z=new E(m,y+D*O,2);Of.set(z[0],z[1],1),Of.transformByMatrix3(i),R.set([Of[0],Of[1]],D*x)}s===r?QK(h,g,n.buffers,R):ZK(r,h,e,n,R)}}}}function QK(n,e,t,s){n.componentType=5126,t.push({arrayBuffer:s.buffer,byteOffset:0,byteLength:s.buffer.byteLength}),e.buffer=t.length-1,e.byteLength=s.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function ZK(n,e,t,s,r){s.buffers.push({arrayBuffer:r.buffer,byteOffset:0,byteLength:r.buffer.byteLength});const i=s.json.bufferViews;if(!i)return;i.push({buffer:s.buffers.length-1,byteLength:r.buffer.byteLength,byteOffset:0});const o=s.json.accessors;o&&(o.push({bufferView:(i==null?void 0:i.length)-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),t.attributes[`TEXCOORD_${n}`]=o.length-1)}function eq(n){const{offset:e=[0,0],rotation:t=0,scale:s=[1,1]}=n,r=new at().set(1,0,0,0,1,0,e[0],e[1],1),i=XK.set(Math.cos(t),Math.sin(t),0,-Math.sin(t),Math.cos(t),0,0,0,1),o=JK.set(s[0],0,0,0,s[1],0,0,0,1);return r.multiplyRight(i).multiplyRight(o)}const tq=Object.freeze(Object.defineProperty({__proto__:null,decode:WK,name:$K},Symbol.toStringTag,{value:"Module"})),Pi="KHR_lights_punctual",nq=Pi;async function sq(n){const e=new en(n),{json:t}=e,s=e.getExtension(Pi);s&&(e.json.lights=s.lights,e.removeExtension(Pi));for(const r of t.nodes||[]){const i=e.getObjectExtension(r,Pi);i&&(r.light=i.light),e.removeObjectExtension(r,Pi)}}async function rq(n){const e=new en(n),{json:t}=e;if(t.lights){const s=e.addExtension(Pi);Pn(!s.lights),s.lights=t.lights,delete t.lights}if(e.json.lights){for(const s of e.json.lights){const r=s.node;e.addObjectExtension(r,Pi,s)}delete e.json.lights}}const iq=Object.freeze(Object.defineProperty({__proto__:null,decode:sq,encode:rq,name:nq},Symbol.toStringTag,{value:"Module"})),vl="KHR_materials_unlit",oq=vl;async function aq(n){const e=new en(n),{json:t}=e;for(const s of t.materials||[])s.extensions&&s.extensions.KHR_materials_unlit&&(s.unlit=!0),e.removeObjectExtension(s,vl);e.removeExtension(vl)}function cq(n){const e=new en(n),{json:t}=e;if(e.materials)for(const s of t.materials||[])s.unlit&&(delete s.unlit,e.addObjectExtension(s,vl,{}),e.addExtension(vl))}const lq=Object.freeze(Object.defineProperty({__proto__:null,decode:aq,encode:cq,name:oq},Symbol.toStringTag,{value:"Module"})),Zc="KHR_techniques_webgl",uq=Zc;async function fq(n){const e=new en(n),{json:t}=e,s=e.getExtension(Zc);if(s){const r=dq(s,e);for(const i of t.materials||[]){const o=e.getObjectExtension(i,Zc);o&&(i.technique=Object.assign({},o,r[o.technique]),i.technique.values=gq(i.technique,e)),e.removeObjectExtension(i,Zc)}e.removeExtension(Zc)}}async function hq(n,e){}function dq(n,e){const{programs:t=[],shaders:s=[],techniques:r=[]}=n,i=new TextDecoder;return s.forEach(o=>{if(Number.isFinite(o.bufferView))o.code=i.decode(e.getTypedArrayForBufferView(o.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),t.forEach(o=>{o.fragmentShader=s[o.fragmentShader],o.vertexShader=s[o.vertexShader]}),r.forEach(o=>{o.program=t[o.program]}),r}function gq(n,e){const t=Object.assign({},n.values);return Object.keys(n.uniforms||{}).forEach(s=>{n.uniforms[s].value&&!(s in t)&&(t[s]=n.uniforms[s].value)}),Object.keys(t).forEach(s=>{typeof t[s]=="object"&&t[s].index!==void 0&&(t[s].texture=e.getTexture(t[s].index))}),t}const pq=Object.freeze(Object.defineProperty({__proto__:null,decode:fq,encode:hq,name:uq},Symbol.toStringTag,{value:"Module"})),kR=[EY,rY,wK,IK,DK,zK,iq,lq,pq,tq,kY];function mq(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0;const s=kR.filter(i=>HR(i.name,e));for(const i of s){var r;(r=i.preprocess)===null||r===void 0||r.call(i,n,e,t)}}async function _q(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0;const s=kR.filter(i=>HR(i.name,e));for(const i of s){var r;await((r=i.decode)===null||r===void 0?void 0:r.call(i,n,e,t))}}function HR(n,e){var t;const s=(e==null||(t=e.gltf)===null||t===void 0?void 0:t.excludeExtensions)||{};return!(n in s&&!s[n])}const s_="KHR_binary_glTF";function Aq(n){const e=new en(n),{json:t}=e;for(const s of t.images||[]){const r=e.getObjectExtension(s,s_);r&&Object.assign(s,r),e.removeObjectExtension(s,s_)}t.buffers&&t.buffers[0]&&delete t.buffers[0].uri,e.removeExtension(s_)}const WB={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},yq={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class bq{constructor(){this.idToIndexMap={animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}},this.json=void 0}normalize(e,t){this.json=e.json;const s=e.json;switch(s.asset&&s.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${s.asset.version}`);return}if(!t.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(s),this._convertTopLevelObjectsToArrays(s),Aq(e),this._convertObjectIdsToArrayIndices(s),this._updateObjects(s),this._updateMaterial(s)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const t in WB)this._convertTopLevelObjectToArray(e,t)}_convertTopLevelObjectToArray(e,t){const s=e[t];if(!(!s||Array.isArray(s))){e[t]=[];for(const r in s){const i=s[r];i.id=i.id||r;const o=e[t].length;e[t].push(i),this.idToIndexMap[t][r]=o}}}_convertObjectIdsToArrayIndices(e){for(const t in WB)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const t of e.textures)this._convertTextureIds(t);for(const t of e.meshes)this._convertMeshIds(t);for(const t of e.nodes)this._convertNodeIds(t);for(const t of e.scenes)this._convertSceneIds(t)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const t of e.primitives){const{attributes:s,indices:r,material:i}=t;for(const o in s)s[o]=this._convertIdToIndex(s[o],"accessor");r&&(t.indices=this._convertIdToIndex(r,"accessor")),i&&(t.material=this._convertIdToIndex(i,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(t=>this._convertIdToIndex(t,"node"))),e.meshes&&(e.meshes=e.meshes.map(t=>this._convertIdToIndex(t,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(t=>this._convertIdToIndex(t,"node")))}_convertIdsToIndices(e,t){e[t]||(console.warn(`gltf v1: json doesn't contain attribute ${t}`),e[t]=[]);for(const s of e[t])for(const r in s){const i=s[r],o=this._convertIdToIndex(i,r);s[r]=o}}_convertIdToIndex(e,t){const s=yq[t];if(s in this.idToIndexMap){const r=this.idToIndexMap[s][e];if(!Number.isFinite(r))throw new Error(`gltf v1: failed to resolve ${t} with id ${e}`);return r}return e}_updateObjects(e){for(const t of this.json.buffers)delete t.type}_updateMaterial(e){for(const i of e.materials){var t,s,r;i.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const o=((t=i.values)===null||t===void 0?void 0:t.tex)||((s=i.values)===null||s===void 0?void 0:s.texture2d_0)||((r=i.values)===null||r===void 0?void 0:r.diffuseTex),l=e.textures.findIndex(f=>f.id===o);l!==-1&&(i.pbrMetallicRoughness.baseColorTexture={index:l})}}}function Tq(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new bq().normalize(n,e)}async function Eq(n,e){var t,s,r;let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0,l=arguments.length>4?arguments[4]:void 0;return Cq(n,e,i,o),Tq(n,{normalize:o==null||(t=o.gltf)===null||t===void 0?void 0:t.normalize}),mq(n,o,l),o!=null&&(s=o.gltf)!==null&&s!==void 0&&s.loadBuffers&&n.json.buffers&&await vq(n,o,l),o!=null&&(r=o.gltf)!==null&&r!==void 0&&r.loadImages&&await Bq(n,o,l),await _q(n,o,l),n}function Cq(n,e,t,s){if(s.uri&&(n.baseUri=s.uri),e instanceof ArrayBuffer&&!cK(e,t,s)&&(e=new TextDecoder().decode(e)),typeof e=="string")n.json=$7(e);else if(e instanceof ArrayBuffer){const o={};t=lK(o,e,t,s.glb),Pn(o.type==="glTF",`Invalid GLB magic string ${o.type}`),n._glb=o,n.json=o.json}else Pn(!1,"GLTF: must be ArrayBuffer or string");const r=n.json.buffers||[];if(n.buffers=new Array(r.length).fill(null),n._glb&&n._glb.header.hasBinChunk){const{binChunks:o}=n._glb;n.buffers[0]={arrayBuffer:o[0].arrayBuffer,byteOffset:o[0].byteOffset,byteLength:o[0].byteLength}}const i=n.json.images||[];n.images=new Array(i.length).fill({})}async function vq(n,e,t){const s=n.json.buffers||[];for(let o=0;o<s.length;++o){const l=s[o];if(l.uri){var r,i;const{fetch:f}=t;Pn(f);const h=PR(l.uri,e),g=await(t==null||(r=t.fetch)===null||r===void 0?void 0:r.call(t,h)),m=await(g==null||(i=g.arrayBuffer)===null||i===void 0?void 0:i.call(g));n.buffers[o]={arrayBuffer:m,byteOffset:0,byteLength:m.byteLength},delete l.uri}else n.buffers[o]===null&&(n.buffers[o]={arrayBuffer:new ArrayBuffer(l.byteLength),byteOffset:0,byteLength:l.byteLength})}}async function Bq(n,e,t){const s=Sq(n),r=n.json.images||[],i=[];for(const o of s)i.push(wq(n,r[o],o,e,t));return await Promise.all(i)}function Sq(n){const e=new Set,t=n.json.textures||[];for(const s of t)s.source!==void 0&&e.add(s.source);return Array.from(e).sort()}async function wq(n,e,t,s,r){let i;if(e.uri&&!e.hasOwnProperty("bufferView")){const l=PR(e.uri,s),{fetch:f}=r;i=await(await f(l)).arrayBuffer(),e.bufferView={data:i}}if(Number.isFinite(e.bufferView)){const l=WW(n.json,n.buffers,e.bufferView);i=Dy(l.buffer,l.byteOffset,l.byteLength)}Pn(i,"glTF image has no data");let o=await Nl(i,[UW,tK],{...s,mimeType:e.mimeType,basis:s.basis||{format:FR()}},r);o&&o[0]&&(o={compressed:!0,mipmaps:!1,width:o[0].width,height:o[0].height,data:o[0]}),n.images=n.images||[],n.images[t]=o}const xh={name:"glTF",id:"gltf",module:"gltf",version:HY,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:Rq,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function Rq(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0;e={...xh.options,...e},e.gltf={...xh.options.gltf,...e.gltf};const{byteOffset:s=0}=e;return await Eq({},n,s,e,t)}const xq={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Iq={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Jn={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},Mq={magFilter:Jn.TEXTURE_MAG_FILTER,minFilter:Jn.TEXTURE_MIN_FILTER,wrapS:Jn.TEXTURE_WRAP_S,wrapT:Jn.TEXTURE_WRAP_T},Oq={[Jn.TEXTURE_MAG_FILTER]:Jn.LINEAR,[Jn.TEXTURE_MIN_FILTER]:Jn.NEAREST_MIPMAP_LINEAR,[Jn.TEXTURE_WRAP_S]:Jn.REPEAT,[Jn.TEXTURE_WRAP_T]:Jn.REPEAT};function Dq(){return{id:"default-sampler",parameters:Oq}}function Nq(n){return Iq[n]}function Fq(n){return xq[n]}class Pq{constructor(){this.baseUri="",this.jsonUnprocessed=void 0,this.json=void 0,this.buffers=[],this.images=[]}postProcess(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{json:s,buffers:r=[],images:i=[]}=e,{baseUri:o=""}=e;return Pn(s),this.baseUri=o,this.buffers=r,this.images=i,this.jsonUnprocessed=s,this.json=this._resolveTree(e.json,t),this.json}_resolveTree(e){const t={...e};return this.json=t,e.bufferViews&&(t.bufferViews=e.bufferViews.map((s,r)=>this._resolveBufferView(s,r))),e.images&&(t.images=e.images.map((s,r)=>this._resolveImage(s,r))),e.samplers&&(t.samplers=e.samplers.map((s,r)=>this._resolveSampler(s,r))),e.textures&&(t.textures=e.textures.map((s,r)=>this._resolveTexture(s,r))),e.accessors&&(t.accessors=e.accessors.map((s,r)=>this._resolveAccessor(s,r))),e.materials&&(t.materials=e.materials.map((s,r)=>this._resolveMaterial(s,r))),e.meshes&&(t.meshes=e.meshes.map((s,r)=>this._resolveMesh(s,r))),e.nodes&&(t.nodes=e.nodes.map((s,r)=>this._resolveNode(s,r)),t.nodes=t.nodes.map((s,r)=>this._resolveNodeChildren(s))),e.skins&&(t.skins=e.skins.map((s,r)=>this._resolveSkin(s,r))),e.scenes&&(t.scenes=e.scenes.map((s,r)=>this._resolveScene(s,r))),typeof this.json.scene=="number"&&t.scenes&&(t.scene=t.scenes[this.json.scene]),t}getScene(e){return this._get(this.json.scenes,e)}getNode(e){return this._get(this.json.nodes,e)}getSkin(e){return this._get(this.json.skins,e)}getMesh(e){return this._get(this.json.meshes,e)}getMaterial(e){return this._get(this.json.materials,e)}getAccessor(e){return this._get(this.json.accessors,e)}getCamera(e){return this._get(this.json.cameras,e)}getTexture(e){return this._get(this.json.textures,e)}getSampler(e){return this._get(this.json.samplers,e)}getImage(e){return this._get(this.json.images,e)}getBufferView(e){return this._get(this.json.bufferViews,e)}getBuffer(e){return this._get(this.json.buffers,e)}_get(e,t){if(typeof t=="object")return t;const s=e&&e[t];return s||console.warn(`glTF file error: Could not find ${e}[${t}]`),s}_resolveScene(e,t){return{...e,id:e.id||`scene-${t}`,nodes:(e.nodes||[]).map(s=>this.getNode(s))}}_resolveNode(e,t){const s={...e,id:(e==null?void 0:e.id)||`node-${t}`};return e.mesh!==void 0&&(s.mesh=this.getMesh(e.mesh)),e.camera!==void 0&&(s.camera=this.getCamera(e.camera)),e.skin!==void 0&&(s.skin=this.getSkin(e.skin)),e.meshes!==void 0&&e.meshes.length&&(s.mesh=e.meshes.reduce((r,i)=>{const o=this.getMesh(i);return r.id=o.id,r.primitives=r.primitives.concat(o.primitives),r},{primitives:[]})),s}_resolveNodeChildren(e){return e.children&&(e.children=e.children.map(t=>this.getNode(t))),e}_resolveSkin(e,t){const s=typeof e.inverseBindMatrices=="number"?this.getAccessor(e.inverseBindMatrices):void 0;return{...e,id:e.id||`skin-${t}`,inverseBindMatrices:s}}_resolveMesh(e,t){const s={...e,id:e.id||`mesh-${t}`,primitives:[]};return e.primitives&&(s.primitives=e.primitives.map(r=>{const i={...r,attributes:{},indices:void 0,material:void 0},o=r.attributes;for(const l in o)i.attributes[l]=this.getAccessor(o[l]);return r.indices!==void 0&&(i.indices=this.getAccessor(r.indices)),r.material!==void 0&&(i.material=this.getMaterial(r.material)),i})),s}_resolveMaterial(e,t){const s={...e,id:e.id||`material-${t}`};if(s.normalTexture&&(s.normalTexture={...s.normalTexture},s.normalTexture.texture=this.getTexture(s.normalTexture.index)),s.occlusionTexture&&(s.occlusionTexture={...s.occlusionTexture},s.occlusionTexture.texture=this.getTexture(s.occlusionTexture.index)),s.emissiveTexture&&(s.emissiveTexture={...s.emissiveTexture},s.emissiveTexture.texture=this.getTexture(s.emissiveTexture.index)),s.emissiveFactor||(s.emissiveFactor=s.emissiveTexture?[1,1,1]:[0,0,0]),s.pbrMetallicRoughness){s.pbrMetallicRoughness={...s.pbrMetallicRoughness};const r=s.pbrMetallicRoughness;r.baseColorTexture&&(r.baseColorTexture={...r.baseColorTexture},r.baseColorTexture.texture=this.getTexture(r.baseColorTexture.index)),r.metallicRoughnessTexture&&(r.metallicRoughnessTexture={...r.metallicRoughnessTexture},r.metallicRoughnessTexture.texture=this.getTexture(r.metallicRoughnessTexture.index))}return s}_resolveAccessor(e,t){const s=Nq(e.componentType),r=Fq(e.type),i=s*r,o={...e,id:e.id||`accessor-${t}`,bytesPerComponent:s,components:r,bytesPerElement:i,value:void 0,bufferView:void 0,sparse:void 0};if(e.bufferView!==void 0&&(o.bufferView=this.getBufferView(e.bufferView)),o.bufferView){const l=o.bufferView.buffer,{ArrayType:f,byteLength:h}=Vy(o,o.bufferView),g=(o.bufferView.byteOffset||0)+(o.byteOffset||0)+l.byteOffset;let m=l.arrayBuffer.slice(g,g+h);o.bufferView.byteStride&&(m=this._getValueFromInterleavedBuffer(l,g,o.bufferView.byteStride,o.bytesPerElement,o.count)),o.value=new f(m)}return o}_getValueFromInterleavedBuffer(e,t,s,r,i){const o=new Uint8Array(i*r);for(let l=0;l<i;l++){const f=t+l*s;o.set(new Uint8Array(e.arrayBuffer.slice(f,f+r)),l*r)}return o.buffer}_resolveTexture(e,t){return{...e,id:e.id||`texture-${t}`,sampler:typeof e.sampler=="number"?this.getSampler(e.sampler):Dq(),source:typeof e.source=="number"?this.getImage(e.source):void 0}}_resolveSampler(e,t){const s={id:e.id||`sampler-${t}`,...e,parameters:{}};for(const r in s){const i=this._enumSamplerParameter(r);i!==void 0&&(s.parameters[i]=s[r])}return s}_enumSamplerParameter(e){return Mq[e]}_resolveImage(e,t){const s={...e,id:e.id||`image-${t}`,image:null,bufferView:e.bufferView!==void 0?this.getBufferView(e.bufferView):void 0},r=this.images[t];return r&&(s.image=r),s}_resolveBufferView(e,t){const s=e.buffer,r=this.buffers[s].arrayBuffer;let i=this.buffers[s].byteOffset||0;return e.byteOffset&&(i+=e.byteOffset),{id:`bufferView-${t}`,...e,buffer:this.buffers[s],data:new Uint8Array(r,i,e.byteLength)}}_resolveCamera(e,t){const s={...e,id:e.id||`camera-${t}`};return s.perspective,s.orthographic,s}}function GR(n,e){return new Pq().postProcess(n,e)}const pA={URI:0,EMBEDDED:1};function VR(n,e,t,s){n.rotateYtoZ=!0;const r=(n.byteOffset||0)+(n.byteLength||0)-t;if(r===0)throw new Error("glTF byte length must be greater than 0.");return n.gltfUpAxis=s!=null&&s["3d-tiles"]&&s["3d-tiles"].assetGltfUpAxis?s["3d-tiles"].assetGltfUpAxis:"Y",n.gltfArrayBuffer=Dy(e,t,r),n.gltfByteOffset=0,n.gltfByteLength=r,t%4===0||console.warn(`${n.type}: embedded glb is not aligned to a 4-byte boundary.`),(n.byteOffset||0)+(n.byteLength||0)}async function jR(n,e,t,s){const r=(t==null?void 0:t["3d-tiles"])||{};if(Uq(n,e),r.loadGLTF){if(!s)return;if(n.gltfUrl){const{fetch:i}=s,o=await i(n.gltfUrl,t);n.gltfArrayBuffer=await o.arrayBuffer(),n.gltfByteOffset=0}if(n.gltfArrayBuffer){const i=await Nl(n.gltfArrayBuffer,xh,t,s);n.gltf=GR(i),n.gpuMemoryUsageInBytes=BR(n.gltf),delete n.gltfArrayBuffer,delete n.gltfByteOffset,delete n.gltfByteLength}}}function Uq(n,e,t){switch(e){case pA.URI:if(n.gltfArrayBuffer){const s=new Uint8Array(n.gltfArrayBuffer,n.gltfByteOffset),i=new TextDecoder().decode(s);n.gltfUrl=i.replace(/[\s\0]+$/,"")}delete n.gltfArrayBuffer,delete n.gltfByteOffset,delete n.gltfByteLength;break;case pA.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function Lq(n,e,t,s,r){var i;t=kq(n,e,t,s),await jR(n,pA.EMBEDDED,s,r);const o=n==null||(i=n.gltf)===null||i===void 0?void 0:i.extensions;return o&&o.CESIUM_RTC&&(n.rtcCenter=o.CESIUM_RTC.center),t}function kq(n,e,t,s,r){t=cd(n,e,t),t=Uy(n,e,t),t=Ly(n,e,t),t=VR(n,e,t,s);const i=new Py(n.featureTableJson,n.featureTableBinary);return n.rtcCenter=i.getGlobalProperty("RTC_CENTER",Pe.FLOAT,3),t}async function Hq(n,e,t,s,r){return t=Gq(n,e,t,s),await jR(n,n.gltfFormat||0,s,r),t}function Gq(n,e,t,s,r){var i;if(t=cd(n,e,t),n.version!==1)throw new Error(`Instanced 3D Model version ${n.version} is not supported`);t=Uy(n,e,t);const o=new DataView(e);if(n.gltfFormat=o.getUint32(t,!0),t+=4,t=Ly(n,e,t),t=VR(n,e,t,s),!(n!=null&&(i=n.header)!==null&&i!==void 0&&i.featureTableJsonByteLength)||n.header.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const l=new Py(n.featureTableJson,n.featureTableBinary),f=l.getGlobalProperty("INSTANCES_LENGTH");if(l.featuresLength=f,!Number.isFinite(f))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");n.eastNorthUp=l.getGlobalProperty("EAST_NORTH_UP"),n.rtcCenter=l.getGlobalProperty("RTC_CENTER",Pe.FLOAT,3);const h=new _R(n.batchTableJson,n.batchTableBinary,f);return Vq(n,l,h,f),t}function Vq(n,e,t,s){const r=new Array(s),i=new L;new L,new L,new L;const o=new at,l=new ga,f=new L,h={},g=new we,m=[],A=[],y=[],E=[];for(let v=0;v<s;v++){let S;if(e.hasProperty("POSITION"))S=e.getProperty("POSITION",Pe.FLOAT,3,v,i);else if(e.hasProperty("POSITION_QUANTIZED")){S=e.getProperty("POSITION_QUANTIZED",Pe.UNSIGNED_SHORT,3,v,i);const J=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Pe.FLOAT,3);if(!J)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const ie=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Pe.FLOAT,3);if(!ie)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const re=65535;for(let ee=0;ee<3;ee++)S[ee]=S[ee]/re*ie[ee]+J[ee]}if(!S)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(i.copy(S),h.translation=i,n.normalUp=e.getProperty("NORMAL_UP",Pe.FLOAT,3,v,m),n.normalRight=e.getProperty("NORMAL_RIGHT",Pe.FLOAT,3,v,A),n.normalUp){if(!n.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");n.hasCustomOrientation=!0}else{if(n.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",Pe.UNSIGNED_SHORT,2,v,m),n.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",Pe.UNSIGNED_SHORT,2,v,A),n.octNormalUp)throw n.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");n.eastNorthUp?(qe.WGS84.eastNorthUpToFixedFrame(i,g),g.getRotationMatrix3(o)):o.identity()}l.fromMatrix3(o),h.rotation=l,f.set(1,1,1);const x=e.getProperty("SCALE",Pe.FLOAT,1,v,y);Number.isFinite(x)&&f.multiplyByScalar(x);const O=e.getProperty("SCALE_NON_UNIFORM",Pe.FLOAT,3,v,m);O&&f.scale(O),h.scale=f;let R=e.getProperty("BATCH_ID",Pe.UNSIGNED_SHORT,1,v,E);R===void 0&&(R=v);const D=new we().fromQuaternion(h.rotation);g.identity(),g.translate(h.translation),g.multiplyRight(D),g.scale(h.scale);const z=g.clone();r[v]={modelMatrix:z,batchId:R}}n.instances=r}async function jq(n,e,t,s,r,i){t=cd(n,e,t);const o=new DataView(e);for(n.tilesLength=o.getUint32(t,!0),t+=4,n.tiles=[];n.tiles.length<n.tilesLength&&(n.byteLength||0)-t>12;){const l={shape:"tile3d"};n.tiles.push(l),t=await i(e,t,s,r,l)}return t}async function zq(n,e,t,s){var r,i;if(n.rotateYtoZ=!0,n.gltfUpAxis=t!=null&&(r=t["3d-tiles"])!==null&&r!==void 0&&r.assetGltfUpAxis?t["3d-tiles"].assetGltfUpAxis:"Y",t!=null&&(i=t["3d-tiles"])!==null&&i!==void 0&&i.loadGLTF){if(!s)return e.byteLength;const o=await Nl(e,xh,t,s);n.gltf=GR(o),n.gpuMemoryUsageInBytes=BR(n.gltf)}else n.gltfArrayBuffer=e;return e.byteLength}async function zR(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0,r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{shape:"tile3d"};switch(r.byteOffset=e,r.type=Q7(n,e),r.type){case Hc.COMPOSITE:return await jq(r,n,e,t,s,zR);case Hc.BATCHED_3D_MODEL:return await Lq(r,n,e,t,s);case Hc.GLTF:return await zq(r,n,t,s);case Hc.INSTANCED_3D_MODEL:return await Hq(r,n,e,t,s);case Hc.POINT_CLOUD:return await KJ(r,n,e,t,s);default:throw new Error(`3DTileLoader: unknown type ${r.type}`)}}const $q=1952609651,Xq=1;async function Jq(n,e,t){if(new Uint32Array(n.slice(0,4))[0]!==$q)throw new Error("Wrong subtree file magic number");if(new Uint32Array(n.slice(4,8))[0]!==Xq)throw new Error("Wrong subtree file verson, must be 1");const i=YB(n.slice(8,16)),o=new Uint8Array(n,24,i),f=new TextDecoder("utf8").decode(o),h=JSON.parse(f),g=YB(n.slice(16,24));let m=new ArrayBuffer(0);if(g&&(m=n.slice(24+i)),await Df(h,h.tileAvailability,m,t),Array.isArray(h.contentAvailability))for(const A of h.contentAvailability)await Df(h,A,m,t);else await Df(h,h.contentAvailability,m,t);return await Df(h,h.childSubtreeAvailability,m,t),h}async function Df(n,e,t,s){const r=Number.isFinite(e.bitstream)?e.bitstream:e.bufferView;if(typeof r!="number")return;const i=n.bufferViews[r],o=n.buffers[i.buffer];if(!(s!=null&&s.baseUrl))throw new Error("Url is not provided");if(!s.fetch)throw new Error("fetch is not provided");if(o.uri){const l=`${(s==null?void 0:s.baseUrl)||""}/${o.uri}`,h=await(await s.fetch(l)).arrayBuffer();e.explicitBitstream=new Uint8Array(h,i.byteOffset,i.byteLength);return}e.explicitBitstream=new Uint8Array(t,i.byteOffset,i.byteLength)}function YB(n){const e=new DataView(n),t=e.getUint32(0,!0),s=e.getUint32(4,!0);return t+2**32*s}const $R={id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:hR,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:Jq,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var Qn=null;try{Qn=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function ze(n,e,t){this.low=n|0,this.high=e|0,this.unsigned=!!t}ze.prototype.__isLong__;Object.defineProperty(ze.prototype,"__isLong__",{value:!0});function tn(n){return(n&&n.__isLong__)===!0}function KB(n){var e=Math.clz32(n&-n);return n?31-e:e}ze.isLong=tn;var qB={},QB={};function Wi(n,e){var t,s,r;return e?(n>>>=0,(r=0<=n&&n<256)&&(s=QB[n],s)?s:(t=Le(n,0,!0),r&&(QB[n]=t),t)):(n|=0,(r=-128<=n&&n<128)&&(s=qB[n],s)?s:(t=Le(n,n<0?-1:0,!1),r&&(qB[n]=t),t))}ze.fromInt=Wi;function Zn(n,e){if(isNaN(n))return e?dr:bs;if(e){if(n<0)return dr;if(n>=XR)return YR}else{if(n<=-eS)return _n;if(n+1>=eS)return WR}return n<0?Zn(-n,e).neg():Le(n%va|0,n/va|0,e)}ze.fromNumber=Zn;function Le(n,e,t){return new ze(n,e,t)}ze.fromBits=Le;var Ih=Math.pow;function Yy(n,e,t){if(n.length===0)throw Error("empty string");if(typeof e=="number"?(t=e,e=!1):e=!!e,n==="NaN"||n==="Infinity"||n==="+Infinity"||n==="-Infinity")return e?dr:bs;if(t=t||10,t<2||36<t)throw RangeError("radix");var s;if((s=n.indexOf("-"))>0)throw Error("interior hyphen");if(s===0)return Yy(n.substring(1),e,t).neg();for(var r=Zn(Ih(t,8)),i=bs,o=0;o<n.length;o+=8){var l=Math.min(8,n.length-o),f=parseInt(n.substring(o,o+l),t);if(l<8){var h=Zn(Ih(t,l));i=i.mul(h).add(Zn(f))}else i=i.mul(r),i=i.add(Zn(f))}return i.unsigned=e,i}ze.fromString=Yy;function os(n,e){return typeof n=="number"?Zn(n,e):typeof n=="string"?Yy(n,e):Le(n.low,n.high,typeof e=="boolean"?e:n.unsigned)}ze.fromValue=os;var ZB=65536,Wq=1<<24,va=ZB*ZB,XR=va*va,eS=XR/2,tS=Wi(Wq),bs=Wi(0);ze.ZERO=bs;var dr=Wi(0,!0);ze.UZERO=dr;var ia=Wi(1);ze.ONE=ia;var JR=Wi(1,!0);ze.UONE=JR;var mA=Wi(-1);ze.NEG_ONE=mA;var WR=Le(-1,2147483647,!1);ze.MAX_VALUE=WR;var YR=Le(-1,-1,!0);ze.MAX_UNSIGNED_VALUE=YR;var _n=Le(0,-2147483648,!1);ze.MIN_VALUE=_n;var se=ze.prototype;se.toInt=function(){return this.unsigned?this.low>>>0:this.low};se.toNumber=function(){return this.unsigned?(this.high>>>0)*va+(this.low>>>0):this.high*va+(this.low>>>0)};se.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(_n)){var t=Zn(e),s=this.div(t),r=s.mul(t).sub(this);return s.toString(e)+r.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=Zn(Ih(e,6),this.unsigned),o=this,l="";;){var f=o.div(i),h=o.sub(f.mul(i)).toInt()>>>0,g=h.toString(e);if(o=f,o.isZero())return g+l;for(;g.length<6;)g="0"+g;l=""+g+l}};se.getHighBits=function(){return this.high};se.getHighBitsUnsigned=function(){return this.high>>>0};se.getLowBits=function(){return this.low};se.getLowBitsUnsigned=function(){return this.low>>>0};se.getNumBitsAbs=function(){if(this.isNegative())return this.eq(_n)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1};se.isSafeInteger=function(){var e=this.high>>21;return e?this.unsigned?!1:e===-1&&!(this.low===0&&this.high===-2097152):!0};se.isZero=function(){return this.high===0&&this.low===0};se.eqz=se.isZero;se.isNegative=function(){return!this.unsigned&&this.high<0};se.isPositive=function(){return this.unsigned||this.high>=0};se.isOdd=function(){return(this.low&1)===1};se.isEven=function(){return(this.low&1)===0};se.equals=function(e){return tn(e)||(e=os(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};se.eq=se.equals;se.notEquals=function(e){return!this.eq(e)};se.neq=se.notEquals;se.ne=se.notEquals;se.lessThan=function(e){return this.comp(e)<0};se.lt=se.lessThan;se.lessThanOrEqual=function(e){return this.comp(e)<=0};se.lte=se.lessThanOrEqual;se.le=se.lessThanOrEqual;se.greaterThan=function(e){return this.comp(e)>0};se.gt=se.greaterThan;se.greaterThanOrEqual=function(e){return this.comp(e)>=0};se.gte=se.greaterThanOrEqual;se.ge=se.greaterThanOrEqual;se.compare=function(e){if(tn(e)||(e=os(e)),this.eq(e))return 0;var t=this.isNegative(),s=e.isNegative();return t&&!s?-1:!t&&s?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};se.comp=se.compare;se.negate=function(){return!this.unsigned&&this.eq(_n)?_n:this.not().add(ia)};se.neg=se.negate;se.add=function(e){tn(e)||(e=os(e));var t=this.high>>>16,s=this.high&65535,r=this.low>>>16,i=this.low&65535,o=e.high>>>16,l=e.high&65535,f=e.low>>>16,h=e.low&65535,g=0,m=0,A=0,y=0;return y+=i+h,A+=y>>>16,y&=65535,A+=r+f,m+=A>>>16,A&=65535,m+=s+l,g+=m>>>16,m&=65535,g+=t+o,g&=65535,Le(A<<16|y,g<<16|m,this.unsigned)};se.subtract=function(e){return tn(e)||(e=os(e)),this.add(e.neg())};se.sub=se.subtract;se.multiply=function(e){if(this.isZero())return this;if(tn(e)||(e=os(e)),Qn){var t=Qn.mul(this.low,this.high,e.low,e.high);return Le(t,Qn.get_high(),this.unsigned)}if(e.isZero())return this.unsigned?dr:bs;if(this.eq(_n))return e.isOdd()?_n:bs;if(e.eq(_n))return this.isOdd()?_n:bs;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(tS)&&e.lt(tS))return Zn(this.toNumber()*e.toNumber(),this.unsigned);var s=this.high>>>16,r=this.high&65535,i=this.low>>>16,o=this.low&65535,l=e.high>>>16,f=e.high&65535,h=e.low>>>16,g=e.low&65535,m=0,A=0,y=0,E=0;return E+=o*g,y+=E>>>16,E&=65535,y+=i*g,A+=y>>>16,y&=65535,y+=o*h,A+=y>>>16,y&=65535,A+=r*g,m+=A>>>16,A&=65535,A+=i*h,m+=A>>>16,A&=65535,A+=o*f,m+=A>>>16,A&=65535,m+=s*g+r*h+i*f+o*l,m&=65535,Le(y<<16|E,m<<16|A,this.unsigned)};se.mul=se.multiply;se.divide=function(e){if(tn(e)||(e=os(e)),e.isZero())throw Error("division by zero");if(Qn){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Qn.div_u:Qn.div_s)(this.low,this.high,e.low,e.high);return Le(t,Qn.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?dr:bs;var s,r,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return dr;if(e.gt(this.shru(1)))return JR;i=dr}else{if(this.eq(_n)){if(e.eq(ia)||e.eq(mA))return _n;if(e.eq(_n))return ia;var o=this.shr(1);return s=o.div(e).shl(1),s.eq(bs)?e.isNegative()?ia:mA:(r=this.sub(e.mul(s)),i=s.add(r.div(e)),i)}else if(e.eq(_n))return this.unsigned?dr:bs;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=bs}for(r=this;r.gte(e);){s=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var l=Math.ceil(Math.log(s)/Math.LN2),f=l<=48?1:Ih(2,l-48),h=Zn(s),g=h.mul(e);g.isNegative()||g.gt(r);)s-=f,h=Zn(s,this.unsigned),g=h.mul(e);h.isZero()&&(h=ia),i=i.add(h),r=r.sub(g)}return i};se.div=se.divide;se.modulo=function(e){if(tn(e)||(e=os(e)),Qn){var t=(this.unsigned?Qn.rem_u:Qn.rem_s)(this.low,this.high,e.low,e.high);return Le(t,Qn.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};se.mod=se.modulo;se.rem=se.modulo;se.not=function(){return Le(~this.low,~this.high,this.unsigned)};se.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32};se.clz=se.countLeadingZeros;se.countTrailingZeros=function(){return this.low?KB(this.low):KB(this.high)+32};se.ctz=se.countTrailingZeros;se.and=function(e){return tn(e)||(e=os(e)),Le(this.low&e.low,this.high&e.high,this.unsigned)};se.or=function(e){return tn(e)||(e=os(e)),Le(this.low|e.low,this.high|e.high,this.unsigned)};se.xor=function(e){return tn(e)||(e=os(e)),Le(this.low^e.low,this.high^e.high,this.unsigned)};se.shiftLeft=function(e){return tn(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Le(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Le(0,this.low<<e-32,this.unsigned)};se.shl=se.shiftLeft;se.shiftRight=function(e){return tn(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Le(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Le(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};se.shr=se.shiftRight;se.shiftRightUnsigned=function(e){return tn(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Le(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):e===32?Le(this.high,0,this.unsigned):Le(this.high>>>e-32,0,this.unsigned)};se.shru=se.shiftRightUnsigned;se.shr_u=se.shiftRightUnsigned;se.rotateLeft=function(e){var t;return tn(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?Le(this.high,this.low,this.unsigned):e<32?(t=32-e,Le(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(e-=32,t=32-e,Le(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))};se.rotl=se.rotateLeft;se.rotateRight=function(e){var t;return tn(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?Le(this.high,this.low,this.unsigned):e<32?(t=32-e,Le(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(e-=32,t=32-e,Le(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))};se.rotr=se.rotateRight;se.toSigned=function(){return this.unsigned?Le(this.low,this.high,!1):this};se.toUnsigned=function(){return this.unsigned?this:Le(this.low,this.high,!0)};se.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};se.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};se.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};ze.fromBytes=function(e,t,s){return s?ze.fromBytesLE(e,t):ze.fromBytesBE(e,t)};ze.fromBytesLE=function(e,t){return new ze(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};ze.fromBytesBE=function(e,t){return new ze(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};typeof BigInt=="function"&&(ze.fromBigInt=function(e,t){var s=Number(BigInt.asIntN(32,e)),r=Number(BigInt.asIntN(32,e>>BigInt(32)));return Le(s,r,t)},ze.fromValue=function(e,t){return typeof e=="bigint"?ze.fromBigInt(e,t):os(e,t)},se.toBigInt=function(){var e=BigInt(this.low>>>0),t=BigInt(this.unsigned?this.high>>>0:this.high);return t<<BigInt(32)|e});const Yq=16;function KR(n){n==="X"&&(n="");const e=n.padEnd(Yq,"0");return ze.fromString(e,!0,16)}function Kq(n){if(n.isZero())return"X";let e=n.countTrailingZeros();const t=e%4;e=(e-t)/4;const s=e;e*=4;const i=n.shiftRightUnsigned(e).toString(16).replace(/0+$/,"");return Array(17-s-i.length).join("0")+i}function qq(n,e){const t=Qq(n).shiftRightUnsigned(2);return n.add(ze.fromNumber(2*e+1-4).multiply(t))}function Qq(n){return n.and(n.not().add(1))}const Zq=3,eQ=30,tQ=2*eQ+1,nS=180/Math.PI;function nQ(n){if(n.length===0)throw new Error(`Invalid Hilbert quad key ${n}`);const e=n.split("/"),t=parseInt(e[0],10),s=e[1],r=s.length;let i=0;const o=[0,0];for(let l=r-1;l>=0;l--){i=r-l;const f=s[l];let h=0,g=0;f==="1"?g=1:f==="2"?(h=1,g=1):f==="3"&&(h=1);const m=Math.pow(2,i-1);rQ(m,o,h,g),o[0]+=m*h,o[1]+=m*g}if(t%2===1){const l=o[0];o[0]=o[1],o[1]=l}return{face:t,ij:o,level:i}}function sQ(n){if(n.isZero())return"";let e=n.toString(2);for(;e.length<Zq+tQ;)e="0"+e;const t=e.lastIndexOf("1"),s=e.substring(0,3),r=e.substring(3,t),i=r.length/2,o=ze.fromString(s,!0,2).toString(10);let l="";if(i!==0)for(l=ze.fromString(r,!0,2).toString(4);l.length<i;)l="0"+l;return`${o}/${l}`}function qR(n,e,t){const s=1<<e;return[(n[0]+t[0])/s,(n[1]+t[1])/s]}function sS(n){return n>=.5?1/3*(4*n*n-1):1/3*(1-4*(1-n)*(1-n))}function QR(n){return[sS(n[0]),sS(n[1])]}function ZR(n,e){let[t,s]=e;switch(n){case 0:return[1,t,s];case 1:return[-t,1,s];case 2:return[-t,-s,1];case 3:return[-1,-s,-t];case 4:return[s,-1,-t];case 5:return[s,t,-1];default:throw new Error("Invalid face")}}function ex(n){let[e,t,s]=n;const r=Math.atan2(s,Math.sqrt(e*e+t*t));return[Math.atan2(t,e)*nS,r*nS]}function rQ(n,e,t,s){if(s===0){t===1&&(e[0]=n-1-e[0],e[1]=n-1-e[1]);const r=e[0];e[0]=e[1],e[1]=r}}function iQ(n){const e=qR(n.ij,n.level,[.5,.5]),t=QR(e),s=ZR(n.face,t);return ex(s)}const oQ=100;function rS(n){const{face:e,ij:t,level:s}=n,r=[[0,0],[0,1],[1,1],[1,0],[0,0]],i=Math.max(1,Math.ceil(oQ*Math.pow(2,-s))),o=new Float64Array(4*i*2+2);let l=0,f=0;for(let h=0;h<4;h++){const g=r[h].slice(0),m=r[h+1],A=(m[0]-g[0])/i,y=(m[1]-g[1])/i;for(let E=0;E<i;E++){g[0]+=A,g[1]+=y;const v=qR(t,s,g),S=QR(v),x=ZR(e,S),O=ex(x);Math.abs(O[1])>89.999&&(O[0]=f);const R=O[0]-f;O[0]+=R>180?-360:R<-180?360:0,o[l++]=O[0],o[l++]=O[1],f=O[0]}}return o[l++]=o[0],o[l++]=o[1],o}function Ky(n){const e=aQ(n);return nQ(e)}function aQ(n){if(n.indexOf("/")>0)return n;const e=KR(n);return sQ(e)}function cQ(n){const e=Ky(n);return iQ(e)}function lQ(n){let e;if(n.face===2||n.face===5){let t=null,s=0;for(let r=0;r<4;r++){const i=`${n.face}/${r}`,o=Ky(i),l=rS(o);(typeof t>"u"||t===null)&&(t=new Float64Array(4*l.length)),t.set(l,s),s+=l.length}e=iS(t)}else{const t=rS(n);e=iS(t)}return e}function iS(n){if(n.length%2!==0)throw new Error("Invalid corners");const e=[],t=[];for(let s=0;s<n.length;s+=2)e.push(n[s]),t.push(n[s+1]);return e.sort((s,r)=>s-r),t.sort((s,r)=>s-r),{west:e[0],east:e[e.length-1],north:t[t.length-1],south:t[0]}}function uQ(n,e){const t=(e==null?void 0:e.minimumHeight)||0,s=(e==null?void 0:e.maximumHeight)||0,r=Ky(n),i=lQ(r),o=i.west,l=i.south,f=i.east,h=i.north,g=[];return g.push(new L(o,h,t)),g.push(new L(f,h,t)),g.push(new L(f,l,t)),g.push(new L(o,l,t)),g.push(new L(o,h,s)),g.push(new L(f,h,s)),g.push(new L(f,l,s)),g.push(new L(o,l,s)),g}function tx(n){const e=n.token,t={minimumHeight:n.minimumHeight,maximumHeight:n.maximumHeight},s=uQ(e,t),r=cQ(e),i=r[0],o=r[1],l=qe.WGS84.cartographicToCartesian([i,o,t.maximumHeight]),f=new L(l[0],l[1],l[2]);s.push(f);const h=dw(s);return[...h.center,...h.halfAxes]}const fQ=4,hQ=8,dQ={QUADTREE:fQ,OCTREE:hQ};function gQ(n,e,t){if(n!=null&&n.box){const s=KR(n.s2VolumeInfo.token),r=qq(s,e),i=Kq(r),o={...n.s2VolumeInfo};switch(o.token=i,t){case"OCTREE":const h=n.s2VolumeInfo,g=h.maximumHeight-h.minimumHeight,m=g/2,A=h.minimumHeight+g/2;h.minimumHeight=A-m,h.maximumHeight=A+m;break}return{box:tx(o),s2VolumeInfo:o}}}async function nx(n){const{implicitOptions:e,parentData:t={mortonIndex:0,x:0,y:0,z:0},childIndex:s=0,globalData:r={level:0,mortonIndex:0,x:0,y:0,z:0},s2VolumeBox:i,loaderOptions:o}=n;let{subtree:l,level:f=0}=n;const{subdivisionScheme:h,subtreeLevels:g,maximumLevel:m,contentUrlTemplate:A,subtreesUriTemplate:y,basePath:E}=e,v={children:[],lodMetricValue:0,contentUrl:""};if(!m)return Wh.once(`Missing 'maximumLevel' or 'availableLevels' property. The subtree ${A} won't be loaded...`),v;const S=f+r.level;if(S>m)return v;const x=dQ[h],O=Math.log2(x),R=s&1,D=s>>1&1,z=s>>2&1,J=(x**f-1)/(x-1);let ie=Mi(t.mortonIndex,s,O),re=J+ie,ee=Mi(t.x,R,1),le=Mi(t.y,D,1),fe=Mi(t.z,z,1),ye=!1;f>=g&&(ye=r_(l.childSubtreeAvailability,ie));const ke=Mi(r.x,ee,f*O),me=Mi(r.y,le,f*O),Oe=Mi(r.z,fe,f*O);if(ye){const M=`${E}/${y}`,Z=_A(M,S,ke,me,Oe);l=await zs(Z,$R,o),r.mortonIndex=ie,r.x=ee,r.y=le,r.z=fe,r.level=f,ie=0,re=0,ee=0,le=0,fe=0,f=0}if(!r_(l.tileAvailability,re))return v;r_(l.contentAvailability,re)&&(v.contentUrl=_A(A,S,ke,me,Oe));const pe=f+1,He={mortonIndex:ie,x:ee,y:le,z:fe};for(let M=0;M<x;M++){const Z=gQ(i,M,h),ae=await nx({subtree:l,implicitOptions:e,loaderOptions:o,parentData:He,childIndex:M,level:pe,globalData:{...r},s2VolumeBox:Z});if(ae.contentUrl||ae.children.length){const ue=S+1,De=pQ(ae,ue,{childTileX:ee,childTileY:le,childTileZ:fe},e,i);v.children.push(De)}}return v}function r_(n,e){let t;return Array.isArray(n)?(t=n[0],n.length>1&&Wh.once('Not supported extension "3DTILES_multiple_contents" has been detected')):t=n,"constant"in t?!!t.constant:t.explicitBitstream?AQ(e,t.explicitBitstream):!1}function pQ(n,e,t,s,r){const{basePath:i,refine:o,getRefine:l,lodMetricType:f,getTileType:h,rootLodMetricValue:g,rootBoundingVolume:m}=s,A=n.contentUrl&&n.contentUrl.replace(`${i}/`,""),y=g/2**e,E=r!=null&&r.box?{box:r.box}:m,v=mQ(e,E,t);return{children:n.children,contentUrl:n.contentUrl,content:{uri:A},id:n.contentUrl,refine:l(o),type:h(n),lodMetricType:f,lodMetricValue:y,geometricError:y,transform:n.transform,boundingVolume:v}}function mQ(n,e,t){if(e.region){const{childTileX:s,childTileY:r,childTileZ:i}=t,[o,l,f,h,g,m]=e.region,A=2**n,y=(f-o)/A,E=(h-l)/A,v=(m-g)/A,[S,x]=[o+y*s,o+y*(s+1)],[O,R]=[l+E*r,l+E*(r+1)],[D,z]=[g+v*i,g+v*(i+1)];return{region:[S,O,x,R,D,z]}}if(e.box)return e;throw new Error(`Unsupported bounding volume type ${e}`)}function Mi(n,e,t){return(n<<t)+e}function _A(n,e,t,s,r){const i=_Q({level:e,x:t,y:s,z:r});return n.replace(/{level}|{x}|{y}|{z}/gi,o=>i[o])}function _Q(n){const e={};for(const t in n)e[`{${t}}`]=n[t];return e}function AQ(n,e){const t=Math.floor(n/8),s=n%8;return(e[t]>>s&1)===1}function qy(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(!e)return xf.EMPTY;const s=e.split("?")[0].split(".").pop();switch(s){case"pnts":return xf.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return xf.SCENEGRAPH;default:return s||xf.EMPTY}}function Qy(n){switch(n){case"REPLACE":case"replace":return vB.REPLACE;case"ADD":case"add":return vB.ADD;default:return n}}function AA(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",e=arguments.length>1?arguments[1]:void 0;if(/^[a-z][0-9a-z+.-]*:/i.test(e)){const s=new URL(n,`${e}/`);return decodeURI(s.toString())}else if(n.startsWith("/"))return n;return Y7(e,n)}function oS(n,e){if(!n)return null;let t;if(n.content){var s;const i=n.content.uri||((s=n.content)===null||s===void 0?void 0:s.url);t=AA(i,e)}return{...n,id:t,contentUrl:t,lodMetricType:ad.GEOMETRIC_ERROR,lodMetricValue:n.geometricError,transformMatrix:n.transform,type:qy(n,t),refine:Qy(n.refine)}}async function yQ(n,e,t){let s=null;const r=cS(n.root);r&&n.root?s=await aS(n.root,n,e,r,t):s=oS(n.root,e);const i=[];for(i.push(s);i.length>0;){const o=i.pop()||{},l=o.children||[],f=[];for(const h of l){const g=cS(h);let m;g?m=await aS(h,n,e,g,t):m=oS(h,e),m&&(f.push(m),i.push(m))}o.children=f}return s}async function aS(n,e,t,s,r){var i,o,l;const{subdivisionScheme:f,maximumLevel:h,availableLevels:g,subtreeLevels:m,subtrees:{uri:A}}=s,y=_A(A,0,0,0,0),E=AA(y,t),v=await zs(E,$R,r),S=AA((i=n.content)===null||i===void 0?void 0:i.uri,t),x=e==null||(o=e.root)===null||o===void 0?void 0:o.refine,O=n.geometricError,R=(l=n.boundingVolume.extensions)===null||l===void 0?void 0:l["3DTILES_bounding_volume_S2"];if(R){const ie={box:tx(R),s2VolumeInfo:R};n.boundingVolume=ie}const D=n.boundingVolume,z={contentUrlTemplate:S,subtreesUriTemplate:A,subdivisionScheme:f,subtreeLevels:m,maximumLevel:Number.isFinite(g)?g-1:h,refine:x,basePath:t,lodMetricType:ad.GEOMETRIC_ERROR,rootLodMetricValue:O,rootBoundingVolume:D,getTileType:qy,getRefine:Qy};return await bQ(n,t,v,z,r)}async function bQ(n,e,t,s,r){if(!n)return null;const{children:i,contentUrl:o}=await nx({subtree:t,implicitOptions:s,loaderOptions:r});let l,f=null;return o&&(l=o,f={uri:o.replace(`${e}/`,"")}),{...n,id:l,contentUrl:l,lodMetricType:ad.GEOMETRIC_ERROR,lodMetricValue:n.geometricError,transformMatrix:n.transform,type:qy(n,l),refine:Qy(n.refine),content:f||n.content,children:i}}function cS(n){var e;return(n==null||(e=n.extensions)===null||e===void 0?void 0:e["3DTILES_implicit_tiling"])||(n==null?void 0:n.implicitTiling)}const sx={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:hR,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:TQ,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};async function TQ(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0;const s=e["3d-tiles"]||{};let r;return s.isTileset==="auto"?r=(t==null?void 0:t.url)&&t.url.indexOf(".json")!==-1:r=s.isTileset,r?EQ(n,e,t):CQ(n,e,t)}async function EQ(n,e,t){var s;const r=JSON.parse(new TextDecoder().decode(n)),i=(t==null?void 0:t.url)||"",o=vQ(i),l=await yQ(r,o,e||{});return{...r,shape:"tileset3d",loader:sx,url:i,queryString:(t==null?void 0:t.queryString)||"",basePath:o,root:l||r.root,type:q7.TILES3D,lodMetricType:ad.GEOMETRIC_ERROR,lodMetricValue:((s=r.root)===null||s===void 0?void 0:s.geometricError)||0}}async function CQ(n,e,t){const s={content:{shape:"tile3d",featureIds:null}};return await zR(n,0,e,t,s.content),s.content}function vQ(n){return W7(n)}const BQ="modulepreload",SQ=function(n){return"/vite-react-map-gl-deck-gl-template/"+n},lS={},wQ=function(e,t,s){let r=Promise.resolve();if(t&&t.length>0){let o=function(h){return Promise.all(h.map(g=>Promise.resolve(g).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),f=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));r=o(t.map(h=>{if(h=SQ(h),h in lS)return;lS[h]=!0;const g=h.endsWith(".css"),m=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${m}`))return;const A=document.createElement("link");if(A.rel=g?"stylesheet":BQ,g||(A.as="script"),A.crossOrigin="",A.href=h,f&&A.setAttribute("nonce",f),document.head.appendChild(A),g)return new Promise((y,E)=>{A.addEventListener("load",y),A.addEventListener("error",()=>E(new Error(`Unable to preload CSS for ${h}`)))})}))}function i(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return r.then(o=>{for(const l of o||[])l.status==="rejected"&&i(l.reason);return e().catch(i)})},RQ=ge.createContext(null);function xQ(n,e){const t=Array.isArray(n)?n[0]:n?n.x:0,s=Array.isArray(n)?n[1]:n?n.y:0,r=Array.isArray(e)?e[0]:e?e.x:0,i=Array.isArray(e)?e[1]:e?e.y:0;return t===r&&s===i}function Ps(n,e){if(n===e)return!0;if(!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!Ps(n[t],e[t]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const t=Object.keys(n),s=Object.keys(e);if(t.length!==s.length)return!1;for(const r of t)if(!e.hasOwnProperty(r)||!Ps(n[r],e[r]))return!1;return!0}return!1}function uS(n){return{longitude:n.center.lng,latitude:n.center.lat,zoom:n.zoom,pitch:n.pitch,bearing:n.bearing,padding:n.padding}}function fS(n,e){const t=e.viewState||e,s={};if("longitude"in t&&"latitude"in t&&(t.longitude!==n.center.lng||t.latitude!==n.center.lat)){const r=n.center.constructor;s.center=new r(t.longitude,t.latitude)}return"zoom"in t&&t.zoom!==n.zoom&&(s.zoom=t.zoom),"bearing"in t&&t.bearing!==n.bearing&&(s.bearing=t.bearing),"pitch"in t&&t.pitch!==n.pitch&&(s.pitch=t.pitch),t.padding&&n.padding&&!Ps(t.padding,n.padding)&&(s.padding=t.padding),s}const IQ=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function hS(n){if(!n)return null;if(typeof n=="string"||("toJS"in n&&(n=n.toJS()),!n.layers))return n;const e={};for(const s of n.layers)e[s.id]=s;const t=n.layers.map(s=>{let r=null;"interactive"in s&&(r=Object.assign({},s),delete r.interactive);const i=e[s.ref];if(i){r=r||Object.assign({},s),delete r.ref;for(const o of IQ)o in i&&(r[o]=i[o])}return r||s});return{...n,layers:t}}const dS={version:8,sources:{},layers:[]},gS={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},pS={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},mS={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},MQ=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],OQ=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class Ba{constructor(e,t,s){this._map=null,this._internalUpdate=!1,this._hoveredFeatures=null,this._propsedCameraUpdate=null,this._styleComponents={},this._onEvent=r=>{const i=this.props[mS[r.type]];i?i(r):r.type==="error"&&console.error(r.error)},this._onCameraEvent=r=>{if(this._internalUpdate)return;r.viewState=this._propsedCameraUpdate||uS(this._map.transform);const i=this.props[pS[r.type]];i&&i(r)},this._onCameraUpdate=r=>this._internalUpdate?r:(this._propsedCameraUpdate=uS(r),fS(r,this.props)),this._onPointerEvent=r=>{(r.type==="mousemove"||r.type==="mouseout")&&this._updateHover(r);const i=this.props[gS[r.type]];i&&(this.props.interactiveLayerIds&&r.type!=="mouseover"&&r.type!=="mouseout"&&(r.features=this._hoveredFeatures||this._queryRenderedFeatures(r.point)),i(r),delete r.features)},this._MapClass=e,this.props=t,this._initialize(s)}get map(){return this._map}setProps(e){const t=this.props;this.props=e;const s=this._updateSettings(e,t),r=this._updateSize(e),i=this._updateViewState(e);this._updateStyle(e,t),this._updateStyleComponents(e),this._updateHandlers(e,t),(s||r||i&&!this._map.isMoving())&&this.redraw()}static reuse(e,t){const s=Ba.savedMaps.pop();if(!s)return null;const r=s.map,i=r.getContainer();for(t.className=i.className;i.childNodes.length>0;)t.appendChild(i.childNodes[0]);r._container=t;const o=r._resizeObserver;o&&(o.disconnect(),o.observe(t)),s.setProps({...e,styleDiffing:!1}),r.resize();const{initialViewState:l}=e;return l&&(l.bounds?r.fitBounds(l.bounds,{...l.fitBoundsOptions,duration:0}):s._updateViewState(l)),r.isStyleLoaded()?r.fire("load"):r.once("style.load",()=>r.fire("load")),r._update(),s}_initialize(e){const{props:t}=this,{mapStyle:s=dS}=t,r={...t,...t.initialViewState,container:e,style:hS(s)},i=r.initialViewState||r.viewState||r;if(Object.assign(r,{center:[i.longitude||0,i.latitude||0],zoom:i.zoom||0,pitch:i.pitch||0,bearing:i.bearing||0}),t.gl){const l=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=l,t.gl)}const o=new this._MapClass(r);i.padding&&o.setPadding(i.padding),t.cursor&&(o.getCanvas().style.cursor=t.cursor),o.transformCameraUpdate=this._onCameraUpdate,o.on("style.load",()=>{var l;this._styleComponents={light:o.getLight(),sky:o.getSky(),projection:(l=o.getProjection)==null?void 0:l.call(o),terrain:o.getTerrain()},this._updateStyleComponents(this.props)}),o.on("sourcedata",()=>{this._updateStyleComponents(this.props)});for(const l in gS)o.on(l,this._onPointerEvent);for(const l in pS)o.on(l,this._onCameraEvent);for(const l in mS)o.on(l,this._onEvent);this._map=o}recycle(){const t=this.map.getContainer().querySelector("[mapboxgl-children]");t==null||t.remove(),Ba.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_updateSize(e){const{viewState:t}=e;if(t){const s=this._map;if(t.width!==s.transform.width||t.height!==s.transform.height)return s.resize(),!0}return!1}_updateViewState(e){const t=this._map,s=t.transform;if(!t.isMoving()){const i=fS(s,e);if(Object.keys(i).length>0)return this._internalUpdate=!0,t.jumpTo(i),this._internalUpdate=!1,!0}return!1}_updateSettings(e,t){const s=this._map;let r=!1;for(const i of MQ)if(i in e&&!Ps(e[i],t[i])){r=!0;const o=s[`set${i[0].toUpperCase()}${i.slice(1)}`];o==null||o.call(s,e[i])}return r}_updateStyle(e,t){if(e.cursor!==t.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==t.mapStyle){const{mapStyle:s=dS,styleDiffing:r=!0}=e,i={diff:r};"localIdeographFontFamily"in e&&(i.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(hS(s),i)}}_updateStyleComponents({light:e,projection:t,sky:s,terrain:r}){var l,f;const i=this._map,o=this._styleComponents;i.style._loaded&&(e&&!Ps(e,o.light)&&(o.light=e,i.setLight(e)),t&&!Ps(t,o.projection)&&t!==((l=o.projection)==null?void 0:l.type)&&(o.projection=typeof t=="string"?{type:t}:t,(f=i.setProjection)==null||f.call(i,o.projection)),s&&!Ps(s,o.sky)&&(o.sky=s,i.setSky(s)),r!==void 0&&!Ps(r,o.terrain)&&(!r||i.getSource(r.source))&&(o.terrain=r,i.setTerrain(r)))}_updateHandlers(e,t){const s=this._map;for(const r of OQ){const i=e[r]??!0,o=t[r]??!0;Ps(i,o)||(i?s[r].enable(i):s[r].disable())}}_queryRenderedFeatures(e){const t=this._map,{interactiveLayerIds:s=[]}=this.props;try{return t.queryRenderedFeatures(e,{layers:s.filter(t.getLayer.bind(t))})}catch{return[]}}_updateHover(e){var r;const{props:t}=this;if(t.interactiveLayerIds&&(t.onMouseMove||t.onMouseEnter||t.onMouseLeave)){const i=e.type,o=((r=this._hoveredFeatures)==null?void 0:r.length)>0,l=this._queryRenderedFeatures(e.point),f=l.length>0;!f&&o&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=l,f&&!o&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=i}else this._hoveredFeatures=null}}Ba.savedMaps=[];const DQ=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function NQ(n){if(!n)return null;const e=n.map,t={getMap:()=>e};for(const s of FQ(e))!(s in t)&&!DQ.includes(s)&&(t[s]=e[s].bind(e));return t}function FQ(n){const e=new Set;let t=n;for(;t;){for(const s of Object.getOwnPropertyNames(t))s[0]!=="_"&&typeof n[s]=="function"&&s!=="fire"&&s!=="setEventedParent"&&e.add(s);t=Object.getPrototypeOf(t)}return Array.from(e)}const PQ=typeof document<"u"?ge.useLayoutEffect:ge.useEffect;function UQ(n,e){const{RTLTextPlugin:t,maxParallelImageRequests:s,workerCount:r,workerUrl:i}=e;if(t&&n.getRTLTextPluginStatus&&n.getRTLTextPluginStatus()==="unavailable"){const{pluginUrl:o,lazy:l=!0}=typeof t=="string"?{pluginUrl:t}:t;n.setRTLTextPlugin(o,f=>{f&&console.error(f)},l)}s!==void 0&&n.setMaxParallelImageRequests(s),r!==void 0&&n.setWorkerCount(r),i!==void 0&&n.setWorkerUrl(i)}const fd=ge.createContext(null);function LQ(n,e){const t=ge.useContext(RQ),[s,r]=ge.useState(null),i=ge.useRef(),{current:o}=ge.useRef({mapLib:null,map:null});ge.useEffect(()=>{const h=n.mapLib;let g=!0,m;return Promise.resolve(h||wQ(()=>import("./maplibre-gl-CHBr95qK.js").then(A=>A.m),[])).then(A=>{if(!g)return;if(!A)throw new Error("Invalid mapLib");const y="Map"in A?A:A.default;if(!y.Map)throw new Error("Invalid mapLib");UQ(y,n),n.reuseMaps&&(m=Ba.reuse(n,i.current)),m||(m=new Ba(y.Map,n,i.current)),o.map=NQ(m),o.mapLib=y,r(m),t==null||t.onMapMount(o.map,n.id)}).catch(A=>{const{onError:y}=n;y?y({type:"error",target:null,originalEvent:null,error:A}):console.error(A)}),()=>{g=!1,m&&(t==null||t.onMapUnmount(n.id),n.reuseMaps?m.recycle():m.destroy())}},[]),PQ(()=>{s&&s.setProps(n)}),ge.useImperativeHandle(e,()=>o.map,[s]);const l=ge.useMemo(()=>({position:"relative",width:"100%",height:"100%",...n.style}),[n.style]),f={height:"100%"};return ge.createElement("div",{id:n.id,ref:i,style:l},s&&ge.createElement(fd.Provider,{value:o},ge.createElement("div",{"mapboxgl-children":"",style:f},n.children)))}const kQ=ge.forwardRef(LQ);var rx=TS();const HQ=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function mr(n,e){if(!n||!e)return;const t=n.style;for(const s in e){const r=e[s];Number.isFinite(r)&&!HQ.test(s)?t[s]=`${r}px`:t[s]=r}}function ix(n,e){if(n===e)return null;const t=_S(n),s=_S(e),r=[];for(const i of s)t.has(i)||r.push(i);for(const i of t)s.has(i)||r.push(i);return r.length===0?null:r}function _S(n){return new Set(n?n.trim().split(/\s+/):[])}ge.memo(ge.forwardRef((n,e)=>{const{map:t,mapLib:s}=ge.useContext(fd),r=ge.useRef({props:n}),i=ge.useMemo(()=>{let x=!1;ge.Children.forEach(n.children,D=>{D&&(x=!0)});const O={...n,element:x?document.createElement("div"):void 0},R=new s.Marker(O);return R.setLngLat([n.longitude,n.latitude]),R.getElement().addEventListener("click",D=>{var z,J;(J=(z=r.current.props).onClick)==null||J.call(z,{type:"click",target:R,originalEvent:D})}),R.on("dragstart",D=>{var J,ie;const z=D;z.lngLat=i.getLngLat(),(ie=(J=r.current.props).onDragStart)==null||ie.call(J,z)}),R.on("drag",D=>{var J,ie;const z=D;z.lngLat=i.getLngLat(),(ie=(J=r.current.props).onDrag)==null||ie.call(J,z)}),R.on("dragend",D=>{var J,ie;const z=D;z.lngLat=i.getLngLat(),(ie=(J=r.current.props).onDragEnd)==null||ie.call(J,z)}),R},[]);ge.useEffect(()=>(i.addTo(t.getMap()),()=>{i.remove()}),[]);const{longitude:o,latitude:l,offset:f,style:h,draggable:g=!1,popup:m=null,rotation:A=0,rotationAlignment:y="auto",pitchAlignment:E="auto"}=n;ge.useEffect(()=>{mr(i.getElement(),h)},[h]),ge.useImperativeHandle(e,()=>i,[]);const v=r.current.props;(i.getLngLat().lng!==o||i.getLngLat().lat!==l)&&i.setLngLat([o,l]),f&&!xQ(i.getOffset(),f)&&i.setOffset(f),i.isDraggable()!==g&&i.setDraggable(g),i.getRotation()!==A&&i.setRotation(A),i.getRotationAlignment()!==y&&i.setRotationAlignment(y),i.getPitchAlignment()!==E&&i.setPitchAlignment(E),i.getPopup()!==m&&i.setPopup(m);const S=ix(v.className,n.className);if(S)for(const x of S)i.toggleClassName(x);return r.current.props=n,rx.createPortal(n.children,i.getElement())}));ge.memo(ge.forwardRef((n,e)=>{const{map:t,mapLib:s}=ge.useContext(fd),r=ge.useMemo(()=>document.createElement("div"),[]),i=ge.useRef({props:n}),o=ge.useMemo(()=>{const l={...n},f=new s.Popup(l);return f.setLngLat([n.longitude,n.latitude]),f.once("open",h=>{var g,m;(m=(g=i.current.props).onOpen)==null||m.call(g,h)}),f},[]);if(ge.useEffect(()=>{const l=f=>{var h,g;(g=(h=i.current.props).onClose)==null||g.call(h,f)};return o.on("close",l),o.setDOMContent(r).addTo(t.getMap()),()=>{o.off("close",l),o.isOpen()&&o.remove()}},[]),ge.useEffect(()=>{mr(o.getElement(),n.style)},[n.style]),ge.useImperativeHandle(e,()=>o,[]),o.isOpen()){const l=i.current.props;(o.getLngLat().lng!==n.longitude||o.getLngLat().lat!==n.latitude)&&o.setLngLat([n.longitude,n.latitude]),n.offset&&!Ps(l.offset,n.offset)&&o.setOffset(n.offset),(l.anchor!==n.anchor||l.maxWidth!==n.maxWidth)&&(o.options.anchor=n.anchor,o.setMaxWidth(n.maxWidth));const f=ix(l.className,n.className);if(f)for(const h of f)o.toggleClassName(h);i.current.props=n}return rx.createPortal(n.children,r)}));function ai(n,e,t,s){const r=ge.useContext(fd),i=ge.useMemo(()=>n(r),[]);return ge.useEffect(()=>{const o=e,l=null,f=typeof e=="function"?e:null,{map:h}=r;return h.hasControl(i)||(h.addControl(i,o==null?void 0:o.position),l&&l(r)),()=>{f&&f(r),h.hasControl(i)&&h.removeControl(i)}},[]),i}function GQ(n){const e=ai(({mapLib:t})=>new t.AttributionControl(n),{position:n.position});return ge.useEffect(()=>{mr(e._container,n.style)},[n.style]),null}ge.memo(GQ);function VQ(n){const e=ai(({mapLib:t})=>new t.FullscreenControl({container:n.containerId&&document.getElementById(n.containerId)}),{position:n.position});return ge.useEffect(()=>{mr(e._controlContainer,n.style)},[n.style]),null}ge.memo(VQ);function jQ(n,e){const t=ge.useRef({props:n}),s=ai(({mapLib:r})=>{const i=new r.GeolocateControl(n),o=i._setupUI;return i._setupUI=()=>{i._container.hasChildNodes()||o()},i.on("geolocate",l=>{var f,h;(h=(f=t.current.props).onGeolocate)==null||h.call(f,l)}),i.on("error",l=>{var f,h;(h=(f=t.current.props).onError)==null||h.call(f,l)}),i.on("outofmaxbounds",l=>{var f,h;(h=(f=t.current.props).onOutOfMaxBounds)==null||h.call(f,l)}),i.on("trackuserlocationstart",l=>{var f,h;(h=(f=t.current.props).onTrackUserLocationStart)==null||h.call(f,l)}),i.on("trackuserlocationend",l=>{var f,h;(h=(f=t.current.props).onTrackUserLocationEnd)==null||h.call(f,l)}),i},{position:n.position});return t.current.props=n,ge.useImperativeHandle(e,()=>s,[]),ge.useEffect(()=>{mr(s._container,n.style)},[n.style]),null}ge.memo(ge.forwardRef(jQ));function zQ(n){const e=ai(({mapLib:t})=>new t.NavigationControl(n),{position:n.position});return ge.useEffect(()=>{mr(e._container,n.style)},[n.style]),null}const $Q=ge.memo(zQ);function XQ(n){const e=ai(({mapLib:i})=>new i.ScaleControl(n),{position:n.position}),t=ge.useRef(n),s=t.current;t.current=n;const{style:r}=n;return n.maxWidth!==void 0&&n.maxWidth!==s.maxWidth&&(e.options.maxWidth=n.maxWidth),n.unit!==void 0&&n.unit!==s.unit&&e.setUnit(n.unit),ge.useEffect(()=>{mr(e._container,r)},[r]),null}ge.memo(XQ);function JQ(n){const e=ai(({mapLib:t})=>new t.TerrainControl(n),{position:n.position});return ge.useEffect(()=>{mr(e._container,n.style)},[n.style]),null}ge.memo(JQ);function WQ(n){const e=ai(({mapLib:t})=>new t.LogoControl(n),{position:n.position});return ge.useEffect(()=>{mr(e._container,n.style)},[n.style]),null}ge.memo(WQ);const i_=512,YQ=Math.PI/180;function ox({map:n,gl:e,deck:t}){if(n.__deck)return n.__deck;const s=t==null?void 0:t.props._customRender,r=t==null?void 0:t.props.onLoad,i={...t==null?void 0:t.props,_customRender:()=>{n.triggerRepaint(),s==null||s("")}};i.parameters={...yA(n,!0),...i.parameters},i.views||(i.views=Mh(n));let o;return(!t||t.props.gl===e)&&(Object.assign(i,{gl:e,width:null,height:null,touchAction:"unset",viewState:Bl(n)}),t!=null&&t.isInitialized?AS(t,n):i.onLoad=()=>{r==null||r(),AS(o,n)}),t?(o=t,t.setProps(i),t.userData.isExternal=!0):(o=new Tl(i),n.on("remove",()=>{ax(n)})),o.userData.mapboxLayers=new Set,n.__deck=o,n.on("render",()=>{o.isInitialized&&tZ(o,n)}),o}function AS(n,e){const t=()=>{n.isInitialized?nZ(n,e):e.off("move",t)};e.on("move",t)}function ax(n){var e;(e=n.__deck)==null||e.finalize(),n.__deck=null}function yA(n,e){const t=e?{depthWriteEnabled:!0,depthCompare:"less-equal",depthBias:0,blend:!0,blendColorSrcFactor:"src-alpha",blendColorDstFactor:"one-minus-src-alpha",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one-minus-src-alpha",blendColorOperation:"add",blendAlphaOperation:"add"}:{};return cx(n)==="globe"&&(t.cullMode="back"),t}function KQ(n,e){n.userData.mapboxLayers.add(e),Zy(n)}function qQ(n,e){n.userData.mapboxLayers.delete(e),Zy(n)}function QQ(n,e){Zy(n)}function ZQ(n,e,t,s){let{currentViewport:r}=n.userData,i=!1;r||(r=lx(n,e,s),n.userData.currentViewport=r,i=!0),n.isInitialized&&n._drawLayers("mapbox-repaint",{viewports:[r],layerFilter:({layer:o})=>t.id===o.id||o.props.operation.includes("terrain"),clearStack:i,clearCanvas:!1})}function cx(n){var s;const e=(s=n.getProjection)==null?void 0:s.call(n),t=(e==null?void 0:e.type)||(e==null?void 0:e.name);if(t==="globe")return"globe";if(t&&t!=="mercator")throw new Error("Unsupported projection");return"mercator"}function Mh(n){return cx(n)==="globe"?new uw({id:"mapbox"}):new ay({id:"mapbox"})}function Bl(n){var r;const{lng:e,lat:t}=n.getCenter(),s={longitude:(e+540)%360-180,latitude:t,zoom:n.getZoom(),bearing:n.getBearing(),pitch:n.getPitch(),padding:n.getPadding(),repeat:n.getRenderWorldCopies()};return(r=n.getTerrain)!=null&&r.call(n)&&eZ(n,s),s}function eZ(n,e){if(n.getFreeCameraOptions){const{position:t}=n.getFreeCameraOptions();if(!t||t.z===void 0)return;const s=n.transform.height,{longitude:r,latitude:i,pitch:o}=e,l=t.x*i_,f=(1-t.y)*i_,h=t.z*i_,g=_l([r,i]),m=l-g[0],A=f-g[1],y=Math.sqrt(m*m+A*A),E=o*YQ,v=1.5*s,S=E<.001?v*Math.cos(E)/h:v*Math.sin(E)/y;e.zoom=Math.log2(S);const x=v*Math.cos(E)/S,O=h-x;e.position=[0,0,O/Vf(i)]}else typeof n.transform.elevation=="number"&&(e.position=[0,0,n.transform.elevation])}function lx(n,e,t){const s=Bl(e),r=Mh(e);t&&(r.props.nearZMultiplier=.2);const i=(t==null?void 0:t.nearZ)??e.transform._nearZ,o=(t==null?void 0:t.farZ)??e.transform._farZ;return Number.isFinite(i)&&(s.nearZ=i/e.transform.height,s.farZ=o/e.transform.height),r.makeViewport({width:n.width,height:n.height,viewState:s})}function tZ(n,e){const{mapboxLayers:t,isExternal:s}=n.userData;if(s){const r=Array.from(t,g=>g.id),o=_a(n.props.layers,Boolean).some(g=>g&&!r.includes(g.id));let l=n.getViewports();const f=l.findIndex(g=>g.id==="mapbox"),h=l.length>1||f<0;(o||h)&&(f>=0&&(l=l.slice(),l[f]=lx(n,e)),n._drawLayers("mapbox-repaint",{viewports:l,layerFilter:g=>(!n.props.layerFilter||n.props.layerFilter(g))&&(g.viewport.id!=="mapbox"||!r.includes(g.layer.id)),clearCanvas:!1}))}n.userData.currentViewport=null}function nZ(n,e){n.setProps({viewState:Bl(e)}),n.needsRedraw({clearRedrawFlags:!0})}function Zy(n){if(n.userData.isExternal)return;const e=[];n.userData.mapboxLayers.forEach(t=>{const s=t.props.type,r=new s(t.props);e.push(r)}),n.setProps({layers:e})}class sZ{constructor(e){if(!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.slot=e.slot,this.map=null,this.deck=null,this.props=e}onAdd(e,t){this.map=e,this.deck=ox({map:e,gl:t,deck:this.props.deck}),KQ(this.deck,this)}onRemove(){this.deck&&qQ(this.deck,this)}setProps(e){Object.assign(this.props,e,{id:this.id}),this.deck&&QQ(this.deck)}render(e,t){ZQ(this.deck,this.map,this,t)}}const o_="__UNDEFINED__";function Nf(n,e,t,s){if(!n||!e||!n.style||!n.style._loaded)return;const r=_a(s,Boolean);if(t!==s){const l=_a(t,Boolean),f=new Set(l.map(h=>h.id));for(const h of r)f.delete(h.id);for(const h of f)n.getLayer(h)&&n.removeLayer(h)}for(const l of r){const f=n.getLayer(l.id);f?(f.implementation||f).setProps(l.props):n.addLayer(new sZ({id:l.id,deck:e,slot:l.props.slot}),l.props.beforeId)}const i=n.style._order,o={};for(const l of r){let{beforeId:f}=l.props;(!f||!i.includes(f))&&(f=o_),o[f]=o[f]||[],o[f].push(l.id)}for(const l in o){const f=o[l];let h=l===o_?i.length:i.indexOf(l),g=l===o_?void 0:l;for(let m=f.length-1;m>=0;m--){const A=f[m],y=i.indexOf(A);y!==h-1&&(n.moveLayer(A,g),y>h&&h++),h--,g=A}}}class rZ{constructor(e){this._handleStyleChange=()=>{Nf(this._map,this._deck,this._props.layers,this._props.layers)},this._updateContainerSize=()=>{if(this._map&&this._container){const{clientWidth:r,clientHeight:i}=this._map.getContainer();Object.assign(this._container.style,{width:`${r}px`,height:`${i}px`})}},this._updateViewState=()=>{const r=this._deck,i=this._map;r&&i&&(r.setProps({views:this._props.views||Mh(i),viewState:Bl(i)}),r.isInitialized&&r.redraw())},this._handleMouseEvent=r=>{const i=this._deck;if(!i||!i.isInitialized)return;const o={type:r.type,offsetCenter:r.point,srcEvent:r},l=this._lastMouseDownPoint;switch(!r.point&&l&&(o.deltaX=r.originalEvent.clientX-l.clientX,o.deltaY=r.originalEvent.clientY-l.clientY,o.offsetCenter={x:l.x+o.deltaX,y:l.y+o.deltaY}),o.type){case"mousedown":i._onPointerDown(o),this._lastMouseDownPoint={...r.point,clientX:r.originalEvent.clientX,clientY:r.originalEvent.clientY};break;case"dragstart":o.type="panstart",i._onEvent(o);break;case"drag":o.type="panmove",i._onEvent(o);break;case"dragend":o.type="panend",i._onEvent(o);break;case"click":o.tapCount=1,i._onEvent(o);break;case"dblclick":o.type="click",o.tapCount=2,i._onEvent(o);break;case"mousemove":o.type="pointermove",i._onPointerMove(o);break;case"mouseout":o.type="pointerleave",i._onPointerMove(o);break;default:return}};const{interleaved:t=!1,...s}=e;this._interleaved=t,this._props=s}setProps(e){this._interleaved&&e.layers&&Nf(this._map,this._deck,this._props.layers,e.layers),Object.assign(this._props,e),this._deck&&this._map&&this._deck.setProps({...this._props,parameters:{...yA(this._map,this._interleaved),...this._props.parameters}})}onAdd(e){return this._map=e,this._interleaved?this._onAddInterleaved(e):this._onAddOverlaid(e)}_onAddOverlaid(e){const t=document.createElement("div");return Object.assign(t.style,{position:"absolute",left:0,top:0,textAlign:"initial",pointerEvents:"none"}),this._container=t,this._deck=new Tl({...this._props,parent:t,parameters:{...yA(e,!1),...this._props.parameters},views:this._props.views||Mh(e),viewState:Bl(e)}),e.on("resize",this._updateContainerSize),e.on("render",this._updateViewState),e.on("mousedown",this._handleMouseEvent),e.on("dragstart",this._handleMouseEvent),e.on("drag",this._handleMouseEvent),e.on("dragend",this._handleMouseEvent),e.on("mousemove",this._handleMouseEvent),e.on("mouseout",this._handleMouseEvent),e.on("click",this._handleMouseEvent),e.on("dblclick",this._handleMouseEvent),this._updateContainerSize(),t}_onAddInterleaved(e){const t=e.painter.context.gl;return t instanceof WebGLRenderingContext&&Ve.warn("Incompatible basemap library. See: https://deck.gl/docs/api-reference/mapbox/overview#compatibility")(),this._deck=ox({map:e,gl:t,deck:new Tl({...this._props,gl:t})}),e.on("styledata",this._handleStyleChange),Nf(e,this._deck,[],this._props.layers),document.createElement("div")}onRemove(){const e=this._map;e&&(this._interleaved?this._onRemoveInterleaved(e):this._onRemoveOverlaid(e)),this._deck=void 0,this._map=void 0,this._container=void 0}_onRemoveOverlaid(e){var t;e.off("resize",this._updateContainerSize),e.off("render",this._updateViewState),e.off("mousedown",this._handleMouseEvent),e.off("dragstart",this._handleMouseEvent),e.off("drag",this._handleMouseEvent),e.off("dragend",this._handleMouseEvent),e.off("mousemove",this._handleMouseEvent),e.off("mouseout",this._handleMouseEvent),e.off("click",this._handleMouseEvent),e.off("dblclick",this._handleMouseEvent),(t=this._deck)==null||t.finalize()}_onRemoveInterleaved(e){e.off("styledata",this._handleStyleChange),Nf(e,this._deck,this._props.layers,[]),ax(e)}getDefaultPosition(){return"top-left"}pickObject(e){return Mt(this._deck),this._deck.pickObject(e)}pickMultipleObjects(e){return Mt(this._deck),this._deck.pickMultipleObjects(e)}pickObjects(e){return Mt(this._deck),this._deck.pickObjects(e)}finalize(){this._map&&this._map.removeControl(this)}getCanvas(){return this._map?this._interleaved?this._map.getCanvas():this._deck.getCanvas():null}}function iZ(){const n=r=>(ai(()=>new rZ(r)).setProps(r),null),t=[new vh({id:"nagasaki-point-cloud-layer",type:typeof vh,pointSize:1.6,data:"https://smb.optgeo.org/ipfs/QmdAr2FWQKCVv7CAcLRuTBt1583Qi7DA4gaA92g3ujeL1v/tileset.json",loaders:[sx]})],s={longitude:129.339,latitude:33.0124,zoom:9,pitch:60,bearing:0};return ar.jsx(ar.Fragment,{children:ar.jsxs("main",{children:[ar.jsx("h1",{children:'"Nagasaki Point Cloud" by deck.gl + react-map-gl'}),ar.jsxs(kQ,{mapStyle:"https://tile.openstreetmap.jp/styles/osm-bright-en/style.json",attributionControl:{compact:!0},maxZoom:22,maxPitch:85,scrollZoom:!0,dragPan:!0,dragRotate:!0,hash:!0,initialViewState:s,children:[ar.jsx(n,{layers:t}),ar.jsx($Q,{position:"top-right",visualizePitch:!0,showZoom:!0,showCompass:!0})]})]})})}zM.createRoot(document.getElementById("root")).render(ar.jsx(UM.StrictMode,{children:ar.jsx(iZ,{})}));export{bS as g};
